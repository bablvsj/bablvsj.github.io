<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>17 Three.jsæŠ€å·§ä¹‹æŒ‰éœ€æ¸²æŸ“ | Bablvsj's Blog</title><meta name=keywords content="Three.js"><meta name=description content="17 Three.jsæŠ€å·§ä¹‹æŒ‰éœ€æ¸²æŸ“ - Bablvsj's Blog"><meta name=author content><link rel=canonical href=https://bablvsj.github.io/posts/threejs/17-three.js%E6%8A%80%E5%B7%A7%E4%B9%8B%E6%8C%89%E9%9C%80%E6%B8%B2%E6%9F%93/><link crossorigin=anonymous href=/assets/css/stylesheet.241265d51339977eb0f90d05780e286ec2789600ca4137f29552dec9dee06569.css integrity="sha256-JBJl1RM5l36w+Q0FeA4obsJ4lgDKQTfylVLeyd7gZWk=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://bablvsj.github.io/img/Q.gif><link rel=icon type=image/png sizes=16x16 href=https://bablvsj.github.io/img/Q.gif><link rel=icon type=image/png sizes=32x32 href=https://bablvsj.github.io/img/Q.gif><link rel=apple-touch-icon href=https://bablvsj.github.io/Q.gif><link rel=mask-icon href=https://bablvsj.github.io/Q.gif><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=stylesheet href=/css/syntax.css><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="17 Three.jsæŠ€å·§ä¹‹æŒ‰éœ€æ¸²æŸ“"><meta property="og:description" content><meta property="og:type" content="article"><meta property="og:url" content="https://bablvsj.github.io/posts/threejs/17-three.js%E6%8A%80%E5%B7%A7%E4%B9%8B%E6%8C%89%E9%9C%80%E6%B8%B2%E6%9F%93/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-12-19T17:11:35+08:00"><meta property="article:modified_time" content="2023-12-19T17:11:35+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="17 Three.jsæŠ€å·§ä¹‹æŒ‰éœ€æ¸²æŸ“"><meta name=twitter:description content><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"æ–‡ç« ","item":"https://bablvsj.github.io/posts/"},{"@type":"ListItem","position":3,"name":"17 Three.jsæŠ€å·§ä¹‹æŒ‰éœ€æ¸²æŸ“","item":"https://bablvsj.github.io/posts/threejs/17-three.js%E6%8A%80%E5%B7%A7%E4%B9%8B%E6%8C%89%E9%9C%80%E6%B8%B2%E6%9F%93/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"17 Three.jsæŠ€å·§ä¹‹æŒ‰éœ€æ¸²æŸ“","name":"17 Three.jsæŠ€å·§ä¹‹æŒ‰éœ€æ¸²æŸ“","description":"","keywords":["Three.js"],"articleBody":"çµé­‚æ‹·é—®ï¼šä»€ä¹ˆå«æŒ‰éœ€æ¸²æŸ“ï¼ŸæŒ‰å“ªä¸ªéœ€ï¼Ÿ\nç­”ï¼šå°±æ˜¯å­—é¢æ„æ€â€”â€”éœ€è¦çš„æ—¶å€™æ‰æ¸²æŸ“ï¼Œä¸éœ€è¦çš„æ—¶å€™ä¸æ¸²æŸ“ã€‚\nåœ¨ åŸºç¡€ç¯‡ ä¸­ï¼Œæˆ‘ä»¬æ‰€æœ‰çš„ç¤ºä¾‹ä¸­ï¼Œéƒ½æœ‰ä»¥ä¸‹ä»£ç ï¼š\nconst render = () =\u003e{ ... renderer.render(scene,camera) window.requestAnimationFrame(render) } window.requestAnimationFrame(render) ä¹Ÿå°±æ˜¯æ„å‘³ç€ï¼Œæ— è®ºä»»ä½•æ—¶å€™ï¼Œæˆ‘ä»¬éƒ½ä¼šåœ¨æ¯ä¸€å¸§ä¸Šè¿›è¡Œåœºæ™¯æ¸²æŸ“ã€‚\nå‡è®¾åœºæ™¯æœ¬èº«å°±æ˜¯é™æ­¢çš„ï¼Œæ²¡æœ‰ä»»ä½•ç‰©ä½“å˜åŒ–ï¼Œæ­¤æ—¶ä¾ç„¶è¿›è¡Œä¸é—´æ–­çš„å¾ªç¯æ¸²æŸ“ï¼Œå…¶å®æ˜¯å¯¹å®¢æˆ·ç«¯è®¾å¤‡æ€§èƒ½ã€ç”µé‡çš„ä¸€ç§æµªè´¹ã€‚\næŒ‰éœ€æ¸²æŸ“ç¤ºä¾‹ï¼šRenderingOnDemand åœ¨åŸºç¡€ç¯‡ä¸­ï¼Œæ‰€æœ‰ç¤ºä¾‹éƒ½æ˜¯ä»¥ HelloXxxx æ¥å‘½å React ç»„ä»¶çš„ï¼Œä½†æ˜¯ä»¥åæˆ‘ä»¬ä¸ä¼šç»§ç»­ä½¿ç”¨è¿™ç§å‘½åæ–¹å¼ï¼Œè€Œæ˜¯ä¼šæ ¹æ®å®é™…è®²è§£å†…å®¹æ¥å®šä¹‰ React ç»„ä»¶åã€‚\nåªæ¸²æŸ“ä¸€æ¬¡çš„ä¸€ä¸ªç¤ºä¾‹ scr/components/rendering-on-demand/index.tsx\nimport { useEffect, useRef } from 'react' import * as Three from 'three' import { OrbitControls } from 'three/examples/jsm/controls/OrbitControls' import './index.scss' const RenderingOnDemand = () =\u003e { const canvasRef = useRef(null) useEffect(() =\u003e { if (canvasRef.current === null) { return } const renderer = new Three.WebGLRenderer({ canvas: canvasRef.current }) const scene = new Three.Scene() const camera = new Three.PerspectiveCamera(45, 2, 1, 100) camera.position.z = 20 const light = new Three.DirectionalLight(0xFFFFFF, 1) light.position.set(5, 5, 10) scene.add(light) const colors = ['blue', 'red', 'green'] const cubes: Three.Mesh[] = [] colors.forEach((color, index) =\u003e { const material = new Three.MeshPhongMaterial({ color }) const geometry = new Three.BoxBufferGeometry(4, 4, 4) const mesh = new Three.Mesh(geometry, material) mesh.position.x = (index - 1) * 6 scene.add(mesh) cubes.push(mesh) }) const render = () =\u003e { renderer.render(scene, camera) } window.requestAnimationFrame(render) const controls = new OrbitControls(camera, canvasRef.current) controls.update() const handleResize = () =\u003e { if (canvasRef.current === null) { return } const width = canvasRef.current.clientWidth const height = canvasRef.current.clientHeight camera.aspect = width / height camera.updateProjectionMatrix() renderer.setSize(width, height, false) } handleResize() window.addEventListener('resize', handleResize) return () =\u003e { window.removeEventListener('resize', handleResize) } }, [canvasRef]) return ( ) } export default RenderingOnDemand è¯·æ³¨æ„ä¸Šé¢ä»£ç ä¸­çš„è¿™ä¸€æ®µï¼š\nconst render = () =\u003e { renderer.render(scene, camera) } ä»¥å¾€ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬è¿˜ä¼šåœ¨ render é‡Œæ·»åŠ ï¼šwindow.requestAnimationFrame(render) ä¸åœçš„å¾ªç¯æ¸²æŸ“åœºæ™¯ã€‚\nå½“æˆ‘ä»¬è¿™æ¬¡æ²¡æœ‰æ·»åŠ è¿™è¡Œä»£ç åï¼Œå®é™…è¿è¡Œï¼Œä¼šå¾—åˆ°ä»¥ä¸‹ç»“æœï¼š\nåœºæ™¯åªåœ¨åˆå§‹åŒ–æ—¶ï¼Œæ¸²æŸ“ä¸€æ¬¡ å°½ç®¡æ·»åŠ æœ‰ OrbitControlsï¼Œä½†æ˜¯ä»»ä½•é¼ æ ‡æ“ä½œï¼Œåœºæ™¯å¹¶ä¸ä¼šè¿›è¡Œæ›´æ–°æ¸²æŸ“ å°½ç®¡æ·»åŠ æœ‰æµè§ˆå™¨çª—å£å°ºå¯¸å˜åŒ–ç›‘å¬ï¼Œä½†æ˜¯æµè§ˆå™¨åªä¼šé’ˆå¯¹ canvas è¿›è¡Œå˜å½¢æ‹‰ä¼¸ï¼Œåœºæ™¯å¹¶ä¸ä¼šè¿›è¡Œæ›´æ–°æ¸²æŸ“ æˆ‘ä»¬è‚¯å®šæ˜¯éœ€è¦å½“ OrbitControlå‘ç”Ÿæ”¹å˜ã€æµè§ˆå™¨çª—å£å‘ç”Ÿæ”¹å˜æ—¶ï¼Œé‡æ–°æ¸²æŸ“åœºæ™¯ã€‚\nå¦‚ä½•å®ç°è¿™ 2 ä¸ªéœ€æ±‚å‘¢ï¼Ÿ\nå½“ OrbitControls å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæˆ‘ä»¬æ·»åŠ å¯¹åº”äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œè°ƒç”¨ render å‡½æ•°å³å¯ã€‚\nconst controls = new OrbitControls(camera, canvasRef.current) + controls.addEventListener('change',render) //æ·»åŠ äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œè§¦å‘é‡æ–°æ¸²æŸ“ controls.update() å½“æµè§ˆå™¨çª—å£å°ºå¯¸å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæˆ‘ä»¬åœ¨ handleResize å‡½æ•°ä¸­è°ƒç”¨ render å‡½æ•°å³å¯ã€‚\nconst handleResize = () =\u003e { if (canvasRef.current === null) { return } const width = canvasRef.current.clientWidth const height = canvasRef.current.clientHeight camera.aspect = width / height camera.updateProjectionMatrix() renderer.setSize(width, height, false) + window.requestAnimationFrame(render) //è§¦å‘é‡æ–°æ¸²æŸ“ //æ³¨æ„ï¼Œè¿™é‡Œå¹¶ä¸å»ºè®®ç›´æ¥è°ƒç”¨ render()ï¼Œè€Œæ˜¯é€‰æ‹©æ‰§è¡Œ window.requestAnimationFrame(render) } å°±è¿™ä¹ˆç®€å•ï¼Œå°±è¿™ä¹ˆ easy ã€‚\nå®é™…ä¿®æ”¹åçš„ä»£ç ï¼Œè°ƒè¯•è¿è¡Œåï¼Œå°±åšåˆ°äº† æŒ‰éœ€æ¸²æŸ“ã€‚\nä¸ºä»€ä¹ˆä¸å»ºè®®ç›´æ¥è°ƒç”¨ render() ï¼Ÿ\nç­”ï¼šå› ä¸ºç›´æ¥ render() æ˜¯åœ¨å½“å‰å¸§ä¸­æ‰§è¡Œçš„ä»£ç ï¼Œè¿™æ ·å¯èƒ½ä¼šè®©æµè§ˆå™¨ å¡é¡¿ä¸€ä¸‹ï¼Œè€Œé€‰æ‹©æ‰§è¡Œ window.requestAnimationFrame(render) åˆ™æ˜ç¡®å‘ŠçŸ¥æµè§ˆå™¨ï¼Œåœ¨ä¸‹ä¸€å¸§ä¸­æ‰§è¡Œï¼Œç¡®ä¿ç”¨æˆ·ä½“éªŒæµç•…ä¸€äº›ã€‚\nå®Œç¾ï¼Ÿ ä»”ç»†è§‚å¯Ÿä½ ä¼šå‘ç°ï¼Œå½“æˆ‘ä»¬æ‹–æ‹½é¼ æ ‡ä¼šè§¦å‘é‡æ–°æ¸²æŸ“ï¼Œé¼ æ ‡æ‹–æ‹½å’Œé‡æ–°æ¸²æŸ“å‡ ä¹æ˜¯ åŒæ—¶å‘ç”ŸåˆåŒæ—¶ç»“æŸçš„ã€‚\nåœæ­¢é¼ æ ‡æ‹–æ‹½ï¼Œåœºæ™¯å˜åŒ–(æ¸²æŸ“)æˆ›ç„¶è€Œæ­¢ã€‚\nä½ æƒ³è±¡ä¸€ä¸‹è¿™ä¸ªåœºæ™¯ï¼š\nä½ æ‰‹æ‹‰ç€ä¸€ä¸ªç»³å­ï¼Œç»³å­å¦å¤–ä¸€å¤´æ‹´åœ¨ä¸€ä¸ªæ¯”è¾ƒé‡çš„é“çƒä¸Šé¢ï¼Œæ­¤æ—¶ä½ æ‹‰ç€ç»³å­æ‹½ç€é“çƒå‰è¿›ã€‚\nå‡å¦‚è¯´ä½ çªç„¶åœæ­¢è„šæ­¥ï¼Œé‚£ä¹ˆåº”è¯¥å‘ç”Ÿä»€ä¹ˆï¼Ÿ\nAã€é“çƒå’Œä½ åŒæ—¶åœæ­¢(åˆ†ç§’ä¸å·®)\nBã€å°½ç®¡ä½ åœä¸‹äº†è„šæ­¥ï¼Œä½†æ˜¯é“çƒç”±äºæƒ¯æ€§ï¼Œä¾ç„¶ä¼šå¾€å‰ç§»åŠ¨ä¸€ç‚¹ç‚¹\nå“ªæ€•é“çƒç‰¹åˆ«æ²‰ï¼Œå¤šå°‘æ€»ä¼šè¡¨ç°å‡ºå¾€å‰ä¸€ç‚¹ç‚¹çš„ç§»åŠ¨çš„è¿¹è±¡çš„\næˆ‘ä»¬éƒ½ç›¸ä¿¡ï¼ŒB é€‰é¡¹æ›´åŠ ç¬¦åˆæˆ‘ä»¬æ—¥å¸¸çš„æ„ŸçŸ¥é¢„æœŸã€‚\næŠŠè¯é¢˜æ‹‰å›åˆ° é¼ æ ‡æ§åˆ¶è½¨é“ ä¸Šé¢æ¥ï¼Œäº‹å®ä¸Šå½“æˆ‘ä»¬æ‹–æ‹½é¼ æ ‡ç§»åŠ¨åœæ­¢åï¼Œä¸åº”è¯¥ç«‹å³åœæ­¢åœºæ™¯æ¸²æŸ“ï¼Œè€Œæ˜¯åº”è¯¥è®©åœºæ™¯ç»§ç»­å¾€åæ¸²æŸ“ä¸€ç‚¹ç‚¹ã€‚\nå¦‚ä½•å®ç°\"æƒ¯æ€§\"ï¼Ÿ ç­”ï¼šå¼€å¯ è½¨é“æ§åˆ¶å™¨çš„ enableDamping å±æ€§ã€‚\ndamping å•è¯çš„æ„æ€æ˜¯ é˜»å°¼ï¼Œä¹Ÿå°±æ˜¯ æƒ¯æ€§\ncontrols.enableDamping = true enableDamping é»˜è®¤å€¼ä¸º false\nä½†æ˜¯ï¼Œè®¾ç½® enableDamping ä¸º true ä¹‹åï¼Œä¼šå¼•å‘æ–°çš„é—®é¢˜ã€‚\nenableDamping è®¾ç½®ä¸º true ä¹‹åï¼Œéœ€è¦ç»§ç»­è°ƒç”¨ OrbitControls å®ä¾‹ çš„ update() å‡½æ•°ï¼Œä»¥ä¾¿ç›¸æœºèƒ½å¤Ÿ â€œé ç€æƒ¯æ€§ç»§ç»­å¾€å‰ç§»åŠ¨è½¨é“â€ã€‚\nä½†æ˜¯è™½ç„¶æˆ‘ä»¬å·²åœæ­¢äº†é¼ æ ‡æ‹–æ‹½ï¼Œä½†æ˜¯ç”±äºæƒ¯æ€§ï¼Œcontrols ä¼šç»§ç»­è§¦å‘ change äº‹ä»¶ã€‚\nè€Œ change äº‹ä»¶åˆä¼šè°ƒç”¨ render å‡½æ•°\næœ€ç»ˆæ¼”å˜æˆäº†ä¸€ä¸ª æ— é™å¾ªç¯ çš„çŠ¶å†µ\nå°½ç®¡æ˜¯æ— é™å¾ªç¯æ¸²æŸ“ï¼Œä½†æ˜¯è¯·æ”¾å¿ƒï¼Œå¹¶ä¸ä¼šå› æ­¤é€ æˆå®¢æˆ·ç«¯å´©æºƒï¼Œå› ä¸ºåœ¨ä¹‹å‰çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬æœ¬èº«å°±æ˜¯ä¸æ–­çš„æ— é™å¾ªç¯è°ƒç”¨ render å‡½æ•°çš„ã€‚\nå¦‚ä½•è§£å†³æƒ¯æ€§å¼•å‘çš„æ— é™å¾ªç¯æ¸²æŸ“ï¼Ÿ\nç­”ï¼šæˆ‘ä»¬å¯ä»¥æ·»åŠ ä¸€ä¸ª Boolean ç±»å‹çš„å‚æ•°ï¼Œç”¨æ¥åŒºåˆ†å‡ºç©¶ç«Ÿæ˜¯ æƒ¯æ€§å¼•å‘çš„æ¸²æŸ“ï¼Œè¿˜æ˜¯æˆ‘ä»¬ä¸»åŠ¨é¼ æ ‡æ‹–æ‹½å¼•å‘çš„æ¸²æŸ“ã€‚\nè¯·æ³¨æ„ï¼Œä¸è¦ç”¨ useState æ¥åˆ›å»º è¿™ä¸ª Boolean å‚æ•°ï¼Œå› ä¸º useState æ˜¯å¼‚æ­¥çš„ï¼Œå¹¶ä¸”æ¯æ¬¡æ‰§è¡Œ useState æ”¹å˜ boo çš„å€¼éƒ½ä¼šå¼•å‘é‡æ–°æ¸²æŸ“ã€‚\næˆ‘ä»¬é‡‡ç”¨çš„æ˜¯åœ¨ ç»„ä»¶å¤–éƒ¨å£°æ˜ çš„æ–¹å¼æ¥å®šä¹‰ booã€‚\nå…·ä½“çš„åšæ³•æ˜¯ï¼š\n+ let boo = false const RenderingOnDemand = () =\u003e { useEffect(() =\u003e{ ... const render = () =\u003e { + boo = false + controls.update() renderer.render(scene, camera) } window.requestAnimationFrame(render) + const handleChange = () =\u003e { + if (boo === false) { + boo = true + window.requestAnimationFrame(render) + } + } const controls = new OrbitControls(camera, canvasRef.current) - controls.addEventListener('change', render) + controls.addEventListener('change', handleChange) + controls.enableDamping = true controls.update() return () =\u003e{ window.removeEventListener('resize', handleResize) } },[canvasRef]) } ç”±äºå­˜åœ¨ â€œæƒ¯æ€§â€ï¼Œæ‰€ä»¥ä¼šåœ¨ æƒ¯æ€§ æœŸé—´ç»§ç»­ä¸æ–­è°ƒç”¨ controls.update()ï¼Œç›´è‡³æƒ¯æ€§æ¶ˆå¤±ï¼Œä¸å†è§¦å‘ change æ—¶é—´ï¼Œæ­¤æ—¶æ‰ä¼šåœæ­¢è°ƒç”¨ controls.update()ï¼Œä»è€Œä¸­æ–­äº† æ— é™å¾ªç¯æ¸²æŸ“ã€‚\nå®Œæ•´çš„ç¤ºä¾‹ä»£ç ï¼š\nimport { useEffect, useRef } from 'react' import * as Three from 'three' import { OrbitControls } from 'three/examples/jsm/controls/OrbitControls' import './index.scss' let boo = false const RenderingOnDemand = () =\u003e { const canvasRef = useRef(null) useEffect(() =\u003e { if (canvasRef.current === null) { return } const renderer = new Three.WebGLRenderer({ canvas: canvasRef.current }) const scene = new Three.Scene() const camera = new Three.PerspectiveCamera(45, 2, 1, 100) camera.position.z = 20 const light = new Three.DirectionalLight(0xFFFFFF, 1) light.position.set(5, 5, 10) scene.add(light) const colors = ['blue', 'red', 'green'] const cubes: Three.Mesh[] = [] colors.forEach((color, index) =\u003e { const material = new Three.MeshPhongMaterial({ color }) const geometry = new Three.BoxBufferGeometry(4, 4, 4) const mesh = new Three.Mesh(geometry, material) mesh.position.x = (index - 1) * 6 scene.add(mesh) cubes.push(mesh) }) const render = () =\u003e { boo = false controls.update() renderer.render(scene, camera) } window.requestAnimationFrame(render) const handleChange = () =\u003e { if (boo === false) { boo = true window.requestAnimationFrame(render) } } const controls = new OrbitControls(camera, canvasRef.current) controls.addEventListener('change', handleChange) controls.enableDamping = true controls.update() const handleResize = () =\u003e { if (canvasRef.current === null) { return } const width = canvasRef.current.clientWidth const height = canvasRef.current.clientHeight camera.aspect = width / height camera.updateProjectionMatrix() renderer.setSize(width, height, false) window.requestAnimationFrame(render) } handleResize() window.addEventListener('resize', handleResize) return () =\u003e { window.removeEventListener('resize', handleResize) } }, [canvasRef]) return ( ) } export default RenderingOnDemand è¡¥å……ä¸€ä¸ª OrbitControls çš„çŸ¥è¯† æˆ‘ä¹Ÿå°±æ˜¯ä»Šå¤©æ‰çŸ¥é“ï¼ŒåŸæ¥ OrbitControls é™¤äº†é¼ æ ‡å¯æ”¹å˜è½¨è¿¹ä¹‹å¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡é”®ç›˜ä¸Šçš„ 4 ä¸ªæ–¹å‘é”®(ä¸Šä¸‹å·¦å³)æ¥æ›´æ”¹è§†å›¾ã€‚\nä½†æ˜¯æˆ‘åœ¨ React ä¸­è¯•éªŒï¼Œå‘ç°é”®ç›˜äº‹ä»¶å¹¶ä¸è§¦å‘ã€‚äºæ˜¯æˆ‘è‡ªå·±æ–°å»ºä¸€ä¸ª React ç»„ä»¶ï¼Œè¿›ä¸€æ­¥æµ‹è¯•ï¼š\nimport { useRef, useEffect } from 'react' const TestKeydown = () =\u003e { const canvasRef = useRef(null) const handleKeydown = (eve: KeyboardEvent) =\u003e { console.log(eve) } useEffect(() =\u003e { if (canvasRef.current === null) { return } canvasRef.current.addEventListener('keydown', handleKeydown, false) }, [canvasRef]) return ( ","wordCount":"2598","inLanguage":"en","datePublished":"2023-12-19T17:11:35+08:00","dateModified":"2023-12-19T17:11:35+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://bablvsj.github.io/posts/threejs/17-three.js%E6%8A%80%E5%B7%A7%E4%B9%8B%E6%8C%89%E9%9C%80%E6%B8%B2%E6%9F%93/"},"publisher":{"@type":"Organization","name":"Bablvsj's Blog","logo":{"@type":"ImageObject","url":"https://bablvsj.github.io/img/Q.gif"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://bablvsj.github.io accesskey=h title="Bablvsj's Blog (Alt + H)">Bablvsj's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://bablvsj.github.io/ title=ä¸»é¡µ><span>ä¸»é¡µ</span></a></li><li><a href=https://bablvsj.github.io/archives/ title=æ—¶é—´è½´><span>æ—¶é—´è½´</span></a></li><li><a href=https://bablvsj.github.io/tags title=æ ‡ç­¾><span>æ ‡ç­¾</span></a></li><li><a href=https://bablvsj.github.io/about title=å…³äº><span>å…³äº</span></a></li><li><a href=https://bablvsj.github.io/search title="ğŸ” (Alt + /)" accesskey=/><span>ğŸ”</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>17 Three.jsæŠ€å·§ä¹‹æŒ‰éœ€æ¸²æŸ“</h1><div class=post-meta><div class=post-tags-meta><a href=https://bablvsj.github.io/tags/three.js/>Three.js</a></div>6 min&nbsp;Â·&nbsp;<span title='2023-12-19 17:11:35 +0800 +0800'>2023/12/19</span></div></header><aside id=toc-container class="toc-container wide"><div class=toc><div class=inner><ul><li><a href=#%e6%8c%89%e9%9c%80%e6%b8%b2%e6%9f%93%e7%a4%ba%e4%be%8brenderingondemand aria-label=æŒ‰éœ€æ¸²æŸ“ç¤ºä¾‹ï¼šRenderingOnDemand>æŒ‰éœ€æ¸²æŸ“ç¤ºä¾‹ï¼šRenderingOnDemand</a><ul><ul><li><a href=#%e5%8f%aa%e6%b8%b2%e6%9f%93%e4%b8%80%e6%ac%a1%e7%9a%84%e4%b8%80%e4%b8%aa%e7%a4%ba%e4%be%8b aria-label=åªæ¸²æŸ“ä¸€æ¬¡çš„ä¸€ä¸ªç¤ºä¾‹>åªæ¸²æŸ“ä¸€æ¬¡çš„ä¸€ä¸ªç¤ºä¾‹</a></li><li><a href=#%e5%ae%8c%e7%be%8e aria-label=å®Œç¾ï¼Ÿ>å®Œç¾ï¼Ÿ</a></li><li><a href=#%e5%a6%82%e4%bd%95%e5%ae%9e%e7%8e%b0%e6%83%af%e6%80%a7 aria-label=å¦‚ä½•å®ç°&amp;quot;æƒ¯æ€§&amp;quot;ï¼Ÿ>å¦‚ä½•å®ç°"æƒ¯æ€§"ï¼Ÿ</a></li></ul></ul></li><li><a href=#%e8%a1%a5%e5%85%85%e4%b8%80%e4%b8%aa-orbitcontrols-%e7%9a%84%e7%9f%a5%e8%af%86 aria-label="è¡¥å……ä¸€ä¸ª OrbitControls çš„çŸ¥è¯†">è¡¥å……ä¸€ä¸ª OrbitControls çš„çŸ¥è¯†</a></li></ul></div></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><p><strong>çµé­‚æ‹·é—®ï¼šä»€ä¹ˆå«æŒ‰éœ€æ¸²æŸ“ï¼ŸæŒ‰å“ªä¸ªéœ€ï¼Ÿ</strong></p><p>ç­”ï¼šå°±æ˜¯å­—é¢æ„æ€â€”â€”éœ€è¦çš„æ—¶å€™æ‰æ¸²æŸ“ï¼Œä¸éœ€è¦çš„æ—¶å€™ä¸æ¸²æŸ“ã€‚</p><p>åœ¨ åŸºç¡€ç¯‡ ä¸­ï¼Œæˆ‘ä»¬æ‰€æœ‰çš„ç¤ºä¾‹ä¸­ï¼Œéƒ½æœ‰ä»¥ä¸‹ä»£ç ï¼š</p><div class=highlight><pre tabindex=0 style=color:#3c3836;background-color:#fbf1c7;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>const render = () =&gt;{
</span></span><span style=display:flex><span>    ...
</span></span><span style=display:flex><span>    renderer.render(scene,camera)
</span></span><span style=display:flex><span>    window.requestAnimationFrame(render)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>window.requestAnimationFrame(render)
</span></span></code></pre></div><p>ä¹Ÿå°±æ˜¯æ„å‘³ç€ï¼Œæ— è®ºä»»ä½•æ—¶å€™ï¼Œæˆ‘ä»¬éƒ½ä¼šåœ¨æ¯ä¸€å¸§ä¸Šè¿›è¡Œåœºæ™¯æ¸²æŸ“ã€‚</p><p>å‡è®¾åœºæ™¯æœ¬èº«å°±æ˜¯é™æ­¢çš„ï¼Œæ²¡æœ‰ä»»ä½•ç‰©ä½“å˜åŒ–ï¼Œæ­¤æ—¶ä¾ç„¶è¿›è¡Œä¸é—´æ–­çš„å¾ªç¯æ¸²æŸ“ï¼Œå…¶å®æ˜¯å¯¹å®¢æˆ·ç«¯è®¾å¤‡æ€§èƒ½ã€ç”µé‡çš„ä¸€ç§æµªè´¹ã€‚</p><h2 id=æŒ‰éœ€æ¸²æŸ“ç¤ºä¾‹renderingondemand>æŒ‰éœ€æ¸²æŸ“ç¤ºä¾‹ï¼šRenderingOnDemand<a hidden class=anchor aria-hidden=true href=#æŒ‰éœ€æ¸²æŸ“ç¤ºä¾‹renderingondemand>#</a></h2><blockquote><p>åœ¨åŸºç¡€ç¯‡ä¸­ï¼Œæ‰€æœ‰ç¤ºä¾‹éƒ½æ˜¯ä»¥ HelloXxxx æ¥å‘½å React ç»„ä»¶çš„ï¼Œä½†æ˜¯ä»¥åæˆ‘ä»¬ä¸ä¼šç»§ç»­ä½¿ç”¨è¿™ç§å‘½åæ–¹å¼ï¼Œè€Œæ˜¯ä¼šæ ¹æ®å®é™…è®²è§£å†…å®¹æ¥å®šä¹‰ React ç»„ä»¶åã€‚</p></blockquote><h4 id=åªæ¸²æŸ“ä¸€æ¬¡çš„ä¸€ä¸ªç¤ºä¾‹>åªæ¸²æŸ“ä¸€æ¬¡çš„ä¸€ä¸ªç¤ºä¾‹<a hidden class=anchor aria-hidden=true href=#åªæ¸²æŸ“ä¸€æ¬¡çš„ä¸€ä¸ªç¤ºä¾‹>#</a></h4><p>scr/components/rendering-on-demand/index.tsx</p><div class=highlight><pre tabindex=0 style=color:#3c3836;background-color:#fbf1c7;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>import { useEffect, useRef } from &#39;react&#39;
</span></span><span style=display:flex><span>import * as Three from &#39;three&#39;
</span></span><span style=display:flex><span>import { OrbitControls } from &#39;three/examples/jsm/controls/OrbitControls&#39;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>import &#39;./index.scss&#39;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>const RenderingOnDemand = () =&gt; {
</span></span><span style=display:flex><span>    const canvasRef = useRef&lt;HTMLCanvasElement&gt;(null)
</span></span><span style=display:flex><span>    useEffect(() =&gt; {
</span></span><span style=display:flex><span>        if (canvasRef.current === null) { return }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        const renderer = new Three.WebGLRenderer({ canvas: canvasRef.current })
</span></span><span style=display:flex><span>        const scene = new Three.Scene()
</span></span><span style=display:flex><span>        const camera = new Three.PerspectiveCamera(45, 2, 1, 100)
</span></span><span style=display:flex><span>        camera.position.z = 20
</span></span><span style=display:flex><span>        const light = new Three.DirectionalLight(0xFFFFFF, 1)
</span></span><span style=display:flex><span>        light.position.set(5, 5, 10)
</span></span><span style=display:flex><span>        scene.add(light)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        const colors = [&#39;blue&#39;, &#39;red&#39;, &#39;green&#39;]
</span></span><span style=display:flex><span>        const cubes: Three.Mesh[] = []
</span></span><span style=display:flex><span>        colors.forEach((color, index) =&gt; {
</span></span><span style=display:flex><span>            const material = new Three.MeshPhongMaterial({ color })
</span></span><span style=display:flex><span>            const geometry = new Three.BoxBufferGeometry(4, 4, 4)
</span></span><span style=display:flex><span>            const mesh = new Three.Mesh(geometry, material)
</span></span><span style=display:flex><span>            mesh.position.x = (index - 1) * 6
</span></span><span style=display:flex><span>            scene.add(mesh)
</span></span><span style=display:flex><span>            cubes.push(mesh)
</span></span><span style=display:flex><span>        })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        const render = () =&gt; {
</span></span><span style=display:flex><span>            renderer.render(scene, camera)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        window.requestAnimationFrame(render)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        const controls = new OrbitControls(camera, canvasRef.current)
</span></span><span style=display:flex><span>        controls.update()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        const handleResize = () =&gt; {
</span></span><span style=display:flex><span>            if (canvasRef.current === null) { return }
</span></span><span style=display:flex><span>            const width = canvasRef.current.clientWidth
</span></span><span style=display:flex><span>            const height = canvasRef.current.clientHeight
</span></span><span style=display:flex><span>            camera.aspect = width / height
</span></span><span style=display:flex><span>            camera.updateProjectionMatrix()
</span></span><span style=display:flex><span>            renderer.setSize(width, height, false)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        handleResize()
</span></span><span style=display:flex><span>        window.addEventListener(&#39;resize&#39;, handleResize)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        return () =&gt; {
</span></span><span style=display:flex><span>            window.removeEventListener(&#39;resize&#39;, handleResize)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }, [canvasRef])
</span></span><span style=display:flex><span>    return (
</span></span><span style=display:flex><span>        &lt;canvas ref={canvasRef} className=&#39;full-screen&#39; /&gt;
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>export default RenderingOnDemand
</span></span></code></pre></div><p><strong>è¯·æ³¨æ„ä¸Šé¢ä»£ç ä¸­çš„è¿™ä¸€æ®µï¼š</strong></p><div class=highlight><pre tabindex=0 style=color:#3c3836;background-color:#fbf1c7;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>const render = () =&gt; {
</span></span><span style=display:flex><span>    renderer.render(scene, camera)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>ä»¥å¾€ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬è¿˜ä¼šåœ¨ render é‡Œæ·»åŠ ï¼š<code>window.requestAnimationFrame(render)</code> ä¸åœçš„å¾ªç¯æ¸²æŸ“åœºæ™¯ã€‚</p><p>å½“æˆ‘ä»¬è¿™æ¬¡æ²¡æœ‰æ·»åŠ è¿™è¡Œä»£ç åï¼Œå®é™…è¿è¡Œï¼Œä¼šå¾—åˆ°ä»¥ä¸‹ç»“æœï¼š</p><ol><li>åœºæ™¯åªåœ¨åˆå§‹åŒ–æ—¶ï¼Œæ¸²æŸ“ä¸€æ¬¡</li><li>å°½ç®¡æ·»åŠ æœ‰ OrbitControlsï¼Œä½†æ˜¯ä»»ä½•é¼ æ ‡æ“ä½œï¼Œåœºæ™¯å¹¶ä¸ä¼šè¿›è¡Œæ›´æ–°æ¸²æŸ“</li><li>å°½ç®¡æ·»åŠ æœ‰æµè§ˆå™¨çª—å£å°ºå¯¸å˜åŒ–ç›‘å¬ï¼Œä½†æ˜¯æµè§ˆå™¨åªä¼šé’ˆå¯¹ canvas è¿›è¡Œå˜å½¢æ‹‰ä¼¸ï¼Œåœºæ™¯å¹¶ä¸ä¼šè¿›è¡Œæ›´æ–°æ¸²æŸ“</li></ol><p><strong>æˆ‘ä»¬è‚¯å®šæ˜¯éœ€è¦å½“ OrbitControlå‘ç”Ÿæ”¹å˜ã€æµè§ˆå™¨çª—å£å‘ç”Ÿæ”¹å˜æ—¶ï¼Œé‡æ–°æ¸²æŸ“åœºæ™¯ã€‚</strong></p><p><strong>å¦‚ä½•å®ç°è¿™ 2 ä¸ªéœ€æ±‚å‘¢ï¼Ÿ</strong></p><p><strong>å½“ OrbitControls å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæˆ‘ä»¬æ·»åŠ å¯¹åº”äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œè°ƒç”¨ render å‡½æ•°å³å¯ã€‚</strong></p><div class=highlight><pre tabindex=0 style=color:#3c3836;background-color:#fbf1c7;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-diff data-lang=diff><span style=display:flex><span>  const controls = new OrbitControls(camera, canvasRef.current)
</span></span><span style=display:flex><span><span style=color:#282828;background-color:#79740e>+ controls.addEventListener(&#39;change&#39;,render) //æ·»åŠ äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œè§¦å‘é‡æ–°æ¸²æŸ“
</span></span></span><span style=display:flex><span><span style=color:#282828;background-color:#79740e></span>  controls.update()
</span></span></code></pre></div><p><strong>å½“æµè§ˆå™¨çª—å£å°ºå¯¸å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæˆ‘ä»¬åœ¨ handleResize å‡½æ•°ä¸­è°ƒç”¨ render å‡½æ•°å³å¯ã€‚</strong></p><div class=highlight><pre tabindex=0 style=color:#3c3836;background-color:#fbf1c7;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-diff data-lang=diff><span style=display:flex><span>const handleResize = () =&gt; {
</span></span><span style=display:flex><span>    if (canvasRef.current === null) { return }
</span></span><span style=display:flex><span>    const width = canvasRef.current.clientWidth
</span></span><span style=display:flex><span>    const height = canvasRef.current.clientHeight
</span></span><span style=display:flex><span>    camera.aspect = width / height
</span></span><span style=display:flex><span>    camera.updateProjectionMatrix()
</span></span><span style=display:flex><span>    renderer.setSize(width, height, false)
</span></span><span style=display:flex><span><span style=color:#282828;background-color:#79740e>+   window.requestAnimationFrame(render) //è§¦å‘é‡æ–°æ¸²æŸ“
</span></span></span><span style=display:flex><span><span style=color:#282828;background-color:#79740e></span>    //æ³¨æ„ï¼Œè¿™é‡Œå¹¶ä¸å»ºè®®ç›´æ¥è°ƒç”¨ render()ï¼Œè€Œæ˜¯é€‰æ‹©æ‰§è¡Œ window.requestAnimationFrame(render)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><blockquote><p>å°±è¿™ä¹ˆç®€å•ï¼Œå°±è¿™ä¹ˆ easy ã€‚</p></blockquote><p>å®é™…ä¿®æ”¹åçš„ä»£ç ï¼Œè°ƒè¯•è¿è¡Œåï¼Œå°±åšåˆ°äº† æŒ‰éœ€æ¸²æŸ“ã€‚</p><p><strong>ä¸ºä»€ä¹ˆä¸å»ºè®®ç›´æ¥è°ƒç”¨ render() ï¼Ÿ</strong></p><p>ç­”ï¼šå› ä¸ºç›´æ¥ render() æ˜¯åœ¨å½“å‰å¸§ä¸­æ‰§è¡Œçš„ä»£ç ï¼Œè¿™æ ·å¯èƒ½ä¼šè®©æµè§ˆå™¨ å¡é¡¿ä¸€ä¸‹ï¼Œè€Œé€‰æ‹©æ‰§è¡Œ window.requestAnimationFrame(render) åˆ™æ˜ç¡®å‘ŠçŸ¥æµè§ˆå™¨ï¼Œåœ¨ä¸‹ä¸€å¸§ä¸­æ‰§è¡Œï¼Œç¡®ä¿ç”¨æˆ·ä½“éªŒæµç•…ä¸€äº›ã€‚</p><h4 id=å®Œç¾>å®Œç¾ï¼Ÿ<a hidden class=anchor aria-hidden=true href=#å®Œç¾>#</a></h4><p>ä»”ç»†è§‚å¯Ÿä½ ä¼šå‘ç°ï¼Œå½“æˆ‘ä»¬æ‹–æ‹½é¼ æ ‡ä¼šè§¦å‘é‡æ–°æ¸²æŸ“ï¼Œé¼ æ ‡æ‹–æ‹½å’Œé‡æ–°æ¸²æŸ“å‡ ä¹æ˜¯ åŒæ—¶å‘ç”ŸåˆåŒæ—¶ç»“æŸçš„ã€‚</p><p>åœæ­¢é¼ æ ‡æ‹–æ‹½ï¼Œåœºæ™¯å˜åŒ–(æ¸²æŸ“)æˆ›ç„¶è€Œæ­¢ã€‚</p><p>ä½ æƒ³è±¡ä¸€ä¸‹è¿™ä¸ªåœºæ™¯ï¼š</p><ol><li><p>ä½ æ‰‹æ‹‰ç€ä¸€ä¸ªç»³å­ï¼Œç»³å­å¦å¤–ä¸€å¤´æ‹´åœ¨ä¸€ä¸ªæ¯”è¾ƒé‡çš„é“çƒä¸Šé¢ï¼Œæ­¤æ—¶ä½ æ‹‰ç€ç»³å­æ‹½ç€é“çƒå‰è¿›ã€‚</p></li><li><p>å‡å¦‚è¯´ä½ çªç„¶åœæ­¢è„šæ­¥ï¼Œé‚£ä¹ˆåº”è¯¥å‘ç”Ÿä»€ä¹ˆï¼Ÿ</p><p>Aã€é“çƒå’Œä½ åŒæ—¶åœæ­¢(åˆ†ç§’ä¸å·®)</p><p>Bã€å°½ç®¡ä½ åœä¸‹äº†è„šæ­¥ï¼Œä½†æ˜¯é“çƒç”±äºæƒ¯æ€§ï¼Œä¾ç„¶ä¼šå¾€å‰ç§»åŠ¨ä¸€ç‚¹ç‚¹</p><blockquote><p>å“ªæ€•é“çƒç‰¹åˆ«æ²‰ï¼Œå¤šå°‘æ€»ä¼šè¡¨ç°å‡ºå¾€å‰ä¸€ç‚¹ç‚¹çš„ç§»åŠ¨çš„è¿¹è±¡çš„</p></blockquote></li></ol><p>æˆ‘ä»¬éƒ½ç›¸ä¿¡ï¼ŒB é€‰é¡¹æ›´åŠ ç¬¦åˆæˆ‘ä»¬æ—¥å¸¸çš„æ„ŸçŸ¥é¢„æœŸã€‚</p><p>æŠŠè¯é¢˜æ‹‰å›åˆ° é¼ æ ‡æ§åˆ¶è½¨é“ ä¸Šé¢æ¥ï¼Œäº‹å®ä¸Šå½“æˆ‘ä»¬æ‹–æ‹½é¼ æ ‡ç§»åŠ¨åœæ­¢åï¼Œä¸åº”è¯¥ç«‹å³åœæ­¢åœºæ™¯æ¸²æŸ“ï¼Œè€Œæ˜¯åº”è¯¥è®©åœºæ™¯ç»§ç»­å¾€åæ¸²æŸ“ä¸€ç‚¹ç‚¹ã€‚</p><h4 id=å¦‚ä½•å®ç°æƒ¯æ€§>å¦‚ä½•å®ç°"æƒ¯æ€§"ï¼Ÿ<a hidden class=anchor aria-hidden=true href=#å¦‚ä½•å®ç°æƒ¯æ€§>#</a></h4><p>ç­”ï¼šå¼€å¯ è½¨é“æ§åˆ¶å™¨çš„ enableDamping å±æ€§ã€‚</p><blockquote><p>damping å•è¯çš„æ„æ€æ˜¯ é˜»å°¼ï¼Œä¹Ÿå°±æ˜¯ æƒ¯æ€§</p></blockquote><div class=highlight><pre tabindex=0 style=color:#3c3836;background-color:#fbf1c7;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>controls.enableDamping = true
</span></span></code></pre></div><blockquote><p>enableDamping é»˜è®¤å€¼ä¸º false</p></blockquote><p>ä½†æ˜¯ï¼Œè®¾ç½® enableDamping ä¸º true ä¹‹åï¼Œä¼šå¼•å‘æ–°çš„é—®é¢˜ã€‚</p><ol><li><p>enableDamping è®¾ç½®ä¸º true ä¹‹åï¼Œéœ€è¦ç»§ç»­è°ƒç”¨ OrbitControls å®ä¾‹ çš„ update() å‡½æ•°ï¼Œä»¥ä¾¿ç›¸æœºèƒ½å¤Ÿ â€œé ç€æƒ¯æ€§ç»§ç»­å¾€å‰ç§»åŠ¨è½¨é“â€ã€‚</p></li><li><p>ä½†æ˜¯è™½ç„¶æˆ‘ä»¬å·²åœæ­¢äº†é¼ æ ‡æ‹–æ‹½ï¼Œä½†æ˜¯ç”±äºæƒ¯æ€§ï¼Œcontrols ä¼šç»§ç»­è§¦å‘ change äº‹ä»¶ã€‚</p></li><li><p>è€Œ change äº‹ä»¶åˆä¼šè°ƒç”¨ render å‡½æ•°</p></li><li><p>æœ€ç»ˆæ¼”å˜æˆäº†ä¸€ä¸ª æ— é™å¾ªç¯ çš„çŠ¶å†µ</p><blockquote><p>å°½ç®¡æ˜¯æ— é™å¾ªç¯æ¸²æŸ“ï¼Œä½†æ˜¯è¯·æ”¾å¿ƒï¼Œå¹¶ä¸ä¼šå› æ­¤é€ æˆå®¢æˆ·ç«¯å´©æºƒï¼Œå› ä¸ºåœ¨ä¹‹å‰çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬æœ¬èº«å°±æ˜¯ä¸æ–­çš„æ— é™å¾ªç¯è°ƒç”¨ render å‡½æ•°çš„ã€‚</p></blockquote></li></ol><p><strong>å¦‚ä½•è§£å†³æƒ¯æ€§å¼•å‘çš„æ— é™å¾ªç¯æ¸²æŸ“ï¼Ÿ</strong></p><p>ç­”ï¼šæˆ‘ä»¬å¯ä»¥æ·»åŠ ä¸€ä¸ª Boolean ç±»å‹çš„å‚æ•°ï¼Œç”¨æ¥åŒºåˆ†å‡ºç©¶ç«Ÿæ˜¯ æƒ¯æ€§å¼•å‘çš„æ¸²æŸ“ï¼Œè¿˜æ˜¯æˆ‘ä»¬ä¸»åŠ¨é¼ æ ‡æ‹–æ‹½å¼•å‘çš„æ¸²æŸ“ã€‚</p><p>è¯·æ³¨æ„ï¼Œä¸è¦ç”¨ useState æ¥åˆ›å»º è¿™ä¸ª Boolean å‚æ•°ï¼Œå› ä¸º useState æ˜¯å¼‚æ­¥çš„ï¼Œå¹¶ä¸”æ¯æ¬¡æ‰§è¡Œ useState æ”¹å˜ boo çš„å€¼éƒ½ä¼šå¼•å‘é‡æ–°æ¸²æŸ“ã€‚</p><p>æˆ‘ä»¬é‡‡ç”¨çš„æ˜¯åœ¨ ç»„ä»¶å¤–éƒ¨å£°æ˜ çš„æ–¹å¼æ¥å®šä¹‰ booã€‚</p><p>å…·ä½“çš„åšæ³•æ˜¯ï¼š</p><div class=highlight><pre tabindex=0 style=color:#3c3836;background-color:#fbf1c7;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-diff data-lang=diff><span style=display:flex><span><span style=color:#282828;background-color:#79740e>+ let boo = false
</span></span></span><span style=display:flex><span><span style=color:#282828;background-color:#79740e></span>const RenderingOnDemand = () =&gt; {
</span></span><span style=display:flex><span>    useEffect(() =&gt;{
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>      ...
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>      const render = () =&gt; {
</span></span><span style=display:flex><span><span style=color:#282828;background-color:#79740e>+           boo = false
</span></span></span><span style=display:flex><span><span style=color:#282828;background-color:#79740e>+           controls.update()
</span></span></span><span style=display:flex><span><span style=color:#282828;background-color:#79740e></span>            renderer.render(scene, camera)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      window.requestAnimationFrame(render)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#282828;background-color:#79740e>+     const handleChange = () =&gt; {
</span></span></span><span style=display:flex><span><span style=color:#282828;background-color:#79740e>+        if (boo === false) {
</span></span></span><span style=display:flex><span><span style=color:#282828;background-color:#79740e>+            boo = true
</span></span></span><span style=display:flex><span><span style=color:#282828;background-color:#79740e>+            window.requestAnimationFrame(render)
</span></span></span><span style=display:flex><span><span style=color:#282828;background-color:#79740e>+         }
</span></span></span><span style=display:flex><span><span style=color:#282828;background-color:#79740e>+      }
</span></span></span><span style=display:flex><span><span style=color:#282828;background-color:#79740e></span>        
</span></span><span style=display:flex><span>      const controls = new OrbitControls(camera, canvasRef.current)
</span></span><span style=display:flex><span><span style=color:#282828;background-color:#9d0006>-     controls.addEventListener(&#39;change&#39;, render)
</span></span></span><span style=display:flex><span><span style=color:#282828;background-color:#9d0006></span><span style=color:#282828;background-color:#79740e>+     controls.addEventListener(&#39;change&#39;, handleChange)
</span></span></span><span style=display:flex><span><span style=color:#282828;background-color:#79740e>+     controls.enableDamping = true
</span></span></span><span style=display:flex><span><span style=color:#282828;background-color:#79740e></span>      controls.update()
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>      return () =&gt;{
</span></span><span style=display:flex><span>        window.removeEventListener(&#39;resize&#39;, handleResize)
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    },[canvasRef])
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>ç”±äºå­˜åœ¨ â€œæƒ¯æ€§â€ï¼Œæ‰€ä»¥ä¼šåœ¨ æƒ¯æ€§ æœŸé—´ç»§ç»­ä¸æ–­è°ƒç”¨ controls.update()ï¼Œç›´è‡³æƒ¯æ€§æ¶ˆå¤±ï¼Œä¸å†è§¦å‘ change æ—¶é—´ï¼Œæ­¤æ—¶æ‰ä¼šåœæ­¢è°ƒç”¨ controls.update()ï¼Œä»è€Œä¸­æ–­äº† æ— é™å¾ªç¯æ¸²æŸ“ã€‚</p><p><strong>å®Œæ•´çš„ç¤ºä¾‹ä»£ç ï¼š</strong></p><div class=highlight><pre tabindex=0 style=color:#3c3836;background-color:#fbf1c7;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>import { useEffect, useRef } from &#39;react&#39;
</span></span><span style=display:flex><span>import * as Three from &#39;three&#39;
</span></span><span style=display:flex><span>import { OrbitControls } from &#39;three/examples/jsm/controls/OrbitControls&#39;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>import &#39;./index.scss&#39;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>let boo = false
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>const RenderingOnDemand = () =&gt; {
</span></span><span style=display:flex><span>    const canvasRef = useRef&lt;HTMLCanvasElement&gt;(null)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    useEffect(() =&gt; {
</span></span><span style=display:flex><span>        if (canvasRef.current === null) { return }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        const renderer = new Three.WebGLRenderer({ canvas: canvasRef.current })
</span></span><span style=display:flex><span>        const scene = new Three.Scene()
</span></span><span style=display:flex><span>        const camera = new Three.PerspectiveCamera(45, 2, 1, 100)
</span></span><span style=display:flex><span>        camera.position.z = 20
</span></span><span style=display:flex><span>        const light = new Three.DirectionalLight(0xFFFFFF, 1)
</span></span><span style=display:flex><span>        light.position.set(5, 5, 10)
</span></span><span style=display:flex><span>        scene.add(light)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        const colors = [&#39;blue&#39;, &#39;red&#39;, &#39;green&#39;]
</span></span><span style=display:flex><span>        const cubes: Three.Mesh[] = []
</span></span><span style=display:flex><span>        colors.forEach((color, index) =&gt; {
</span></span><span style=display:flex><span>            const material = new Three.MeshPhongMaterial({ color })
</span></span><span style=display:flex><span>            const geometry = new Three.BoxBufferGeometry(4, 4, 4)
</span></span><span style=display:flex><span>            const mesh = new Three.Mesh(geometry, material)
</span></span><span style=display:flex><span>            mesh.position.x = (index - 1) * 6
</span></span><span style=display:flex><span>            scene.add(mesh)
</span></span><span style=display:flex><span>            cubes.push(mesh)
</span></span><span style=display:flex><span>        })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        const render = () =&gt; {
</span></span><span style=display:flex><span>            boo = false
</span></span><span style=display:flex><span>            controls.update()
</span></span><span style=display:flex><span>            renderer.render(scene, camera)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        window.requestAnimationFrame(render)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        const handleChange = () =&gt; {
</span></span><span style=display:flex><span>            if (boo === false) {
</span></span><span style=display:flex><span>                boo = true
</span></span><span style=display:flex><span>                window.requestAnimationFrame(render)
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        const controls = new OrbitControls(camera, canvasRef.current)
</span></span><span style=display:flex><span>        controls.addEventListener(&#39;change&#39;, handleChange)
</span></span><span style=display:flex><span>        controls.enableDamping = true
</span></span><span style=display:flex><span>        controls.update()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        const handleResize = () =&gt; {
</span></span><span style=display:flex><span>            if (canvasRef.current === null) { return }
</span></span><span style=display:flex><span>            const width = canvasRef.current.clientWidth
</span></span><span style=display:flex><span>            const height = canvasRef.current.clientHeight
</span></span><span style=display:flex><span>            camera.aspect = width / height
</span></span><span style=display:flex><span>            camera.updateProjectionMatrix()
</span></span><span style=display:flex><span>            renderer.setSize(width, height, false)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            window.requestAnimationFrame(render)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        handleResize()
</span></span><span style=display:flex><span>        window.addEventListener(&#39;resize&#39;, handleResize)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        return () =&gt; {
</span></span><span style=display:flex><span>            window.removeEventListener(&#39;resize&#39;, handleResize)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }, [canvasRef])
</span></span><span style=display:flex><span>    return (
</span></span><span style=display:flex><span>        &lt;canvas ref={canvasRef} className=&#39;full-screen&#39; /&gt;
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>export default RenderingOnDemand
</span></span></code></pre></div><h2 id=è¡¥å……ä¸€ä¸ª-orbitcontrols-çš„çŸ¥è¯†>è¡¥å……ä¸€ä¸ª OrbitControls çš„çŸ¥è¯†<a hidden class=anchor aria-hidden=true href=#è¡¥å……ä¸€ä¸ª-orbitcontrols-çš„çŸ¥è¯†>#</a></h2><p>æˆ‘ä¹Ÿå°±æ˜¯ä»Šå¤©æ‰çŸ¥é“ï¼ŒåŸæ¥ OrbitControls é™¤äº†é¼ æ ‡å¯æ”¹å˜è½¨è¿¹ä¹‹å¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡é”®ç›˜ä¸Šçš„ 4 ä¸ªæ–¹å‘é”®(ä¸Šä¸‹å·¦å³)æ¥æ›´æ”¹è§†å›¾ã€‚</p><p>ä½†æ˜¯æˆ‘åœ¨ React ä¸­è¯•éªŒï¼Œå‘ç°é”®ç›˜äº‹ä»¶å¹¶ä¸è§¦å‘ã€‚äºæ˜¯æˆ‘è‡ªå·±æ–°å»ºä¸€ä¸ª React ç»„ä»¶ï¼Œè¿›ä¸€æ­¥æµ‹è¯•ï¼š</p><div class=highlight><pre tabindex=0 style=color:#3c3836;background-color:#fbf1c7;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>import { useRef, useEffect } from &#39;react&#39;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>const TestKeydown = () =&gt; {
</span></span><span style=display:flex><span>    const canvasRef = useRef&lt;HTMLCanvasElement&gt;(null)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    const handleKeydown = (eve: KeyboardEvent) =&gt; {
</span></span><span style=display:flex><span>        console.log(eve)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    useEffect(() =&gt; {
</span></span><span style=display:flex><span>        if (canvasRef.current === null) { return }
</span></span><span style=display:flex><span>        canvasRef.current.addEventListener(&#39;keydown&#39;, handleKeydown, false)
</span></span><span style=display:flex><span>    }, [canvasRef])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    return (
</span></span><span style=display:flex><span>        &lt;canvas ref={canvasRef} style={{ display: &#39;block&#39;, width: &#39;100%&#39;, height: &#39;100%&#39; }} /&gt;
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>export default TestKeydown
</span></span></code></pre></div><p>å®é™…è¿è¡Œå‘ç°ï¼Œç¡®å®æ ¹æœ¬ä¸ä¼šè§¦å‘é”®ç›˜äº‹ä»¶ã€‚</p><p>åç»è¿‡æŸ¥é˜…èµ„æ–™ï¼Œæ‰çŸ¥é“å¯¹äº React æ¥è¯´ï¼Œæ›´åŠ å€¾å‘äºä½¿ç”¨ React åˆæˆäº‹ä»¶ï¼Œä¾‹å¦‚ &lt;imput onKeydown={ xxx } /> è€Œä¸æ˜¯ é€šè¿‡ addEventListener(&lsquo;keydown&rsquo;,xxx)ã€‚</p><p>ä¸Šé¢çš„ä»£ç è‹¥æƒ³è§¦å‘é”®ç›˜äº‹ä»¶ï¼Œéœ€è¦ä¿®æ”¹æˆï¼š</p><div class=highlight><pre tabindex=0 style=color:#3c3836;background-color:#fbf1c7;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-diff data-lang=diff><span style=display:flex><span>import { useRef, useEffect } from &#39;react&#39;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>const TestKeydown = () =&gt; {
</span></span><span style=display:flex><span>    const canvasRef = useRef&lt;HTMLCanvasElement&gt;(null)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    const handleKeydown = (eve: KeyboardEvent) =&gt; {
</span></span><span style=display:flex><span>        console.log(eve)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    useEffect(() =&gt; {
</span></span><span style=display:flex><span>        if (canvasRef.current === null) { return }
</span></span><span style=display:flex><span><span style=color:#282828;background-color:#79740e>+        canvasRef.current.focus()
</span></span></span><span style=display:flex><span><span style=color:#282828;background-color:#79740e></span>        canvasRef.current.addEventListener(&#39;keydown&#39;, handleKeydown, false)
</span></span><span style=display:flex><span>    }, [canvasRef])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    return (
</span></span><span style=display:flex><span><span style=color:#282828;background-color:#79740e>+        &lt;canvas ref={canvasRef} tabIndex={0} style={{ display: &#39;block&#39;, width: &#39;100%&#39;, height: &#39;100%&#39; }} /&gt;
</span></span></span><span style=display:flex><span><span style=color:#282828;background-color:#79740e></span>    )
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>export default TestKeydown
</span></span></code></pre></div><ol><li>æ·»åŠ  canvas è‡ªåŠ¨è·å–ç„¦ç‚¹</li><li>ç»™ canvas æ·»åŠ  tabIndex å€¼ï¼Œè¯¥å€¼æ˜¯ -1ã€0ã€1 éƒ½å¯ä»¥ï¼Œä½†æ˜¯å¿…é¡»æ·»åŠ </li></ol><p>ä½†æ˜¯å¯¹äº OrbitControls æ¥è¯´ï¼Œè‹¥æƒ³åœ¨ React ä¸­ä¹Ÿä½¿ç”¨é”®ç›˜äº‹ä»¶ï¼Œåˆ™åªèƒ½ä¾æ­¤ä¿®æ”¹ã€‚</p><p>ä¸è¿‡å½“ canvas å¤±å»ç„¦ç‚¹åï¼Œåˆ™é”®ç›˜äº‹ä»¶å°±ä¼šå¤±æ•ˆã€‚</p><p><strong>Three.js å®˜æ–¹ç¤ºä¾‹ä½¿ç”¨çš„æ˜¯åŸç”Ÿçš„ html + jsï¼Œæ˜¯å®Œå…¨æ”¯æŒé”®ç›˜äº‹ä»¶çš„ã€‚</strong></p><p><strong>React åˆ™å¯¹åŸç”Ÿé”®ç›˜äº‹ä»¶æ”¯æŒåº¦ä¸é«˜ã€‚</strong></p><blockquote><p>ä¸è¿‡æˆ‘ä»¬å®Œå…¨ä¸å¿…ä»‹æ„è¿™ä»¶äº‹æƒ…ï¼Œæˆ‘ä»¬ç»§ç»­ä½¿ç”¨é¼ æ ‡æ¥æ§åˆ¶åœºæ™¯å˜æ¢è§’åº¦å¥½äº†ã€‚</p></blockquote><p>ä¸‹ä¸€èŠ‚ï¼Œæˆ‘ä»¬å­¦ä¹ å¦‚ä½•è°ƒè¯•Three.jsã€‚</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://bablvsj.github.io/tags/three.js/>Three.js</a></li></ul><nav class=paginav><a class=prev href=https://bablvsj.github.io/posts/threejs/16-three.js%E5%9F%BA%E7%A1%80%E4%B9%8B%E8%87%AA%E5%AE%9A%E4%B9%89%E5%87%A0%E4%BD%95%E4%BD%93/><span class=title>Â« Prev</span><br><span>16 Three.jsåŸºç¡€ä¹‹è‡ªå®šä¹‰å‡ ä½•ä½“</span></a>
<a class=next href=https://bablvsj.github.io/posts/threejs/18-three.js%E6%8A%80%E5%B7%A7%E4%B9%8B%E8%B0%83%E8%AF%95/><span class=title>Next Â»</span><br><span>18 Three.jsæŠ€å·§ä¹‹è°ƒè¯•</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://bablvsj.github.io>Bablvsj's Blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span><div class=flex-c-d><a class=flex-d-c href="https://www.upyun.com/?utm_source=lianmeng&utm_medium=referral" target=_blank><span>æœ¬ç«™ç”±</span><img width=60 src=/images/upyun.png>æä¾›CDNåŠ é€Ÿ/äº‘å­˜å‚¨æœåŠ¡</a></div></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>