<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>19 Three.jsæŠ€å·§ä¹‹ç”»å¸ƒ | Bablvsj's Blog</title><meta name=keywords content="Three.js"><meta name=description content="19 Three.jsæŠ€å·§ä¹‹ç”»å¸ƒ - Bablvsj's Blog"><meta name=author content><link rel=canonical href=https://bablvsj.github.io/posts/threejs/19-three.js%E6%8A%80%E5%B7%A7%E4%B9%8B%E7%94%BB%E5%B8%83/><link crossorigin=anonymous href=/assets/css/stylesheet.241265d51339977eb0f90d05780e286ec2789600ca4137f29552dec9dee06569.css integrity="sha256-JBJl1RM5l36w+Q0FeA4obsJ4lgDKQTfylVLeyd7gZWk=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://bablvsj.github.io/img/Q.gif><link rel=icon type=image/png sizes=16x16 href=https://bablvsj.github.io/img/Q.gif><link rel=icon type=image/png sizes=32x32 href=https://bablvsj.github.io/img/Q.gif><link rel=apple-touch-icon href=https://bablvsj.github.io/Q.gif><link rel=mask-icon href=https://bablvsj.github.io/Q.gif><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=stylesheet href=/css/syntax.css><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="19 Three.jsæŠ€å·§ä¹‹ç”»å¸ƒ"><meta property="og:description" content><meta property="og:type" content="article"><meta property="og:url" content="https://bablvsj.github.io/posts/threejs/19-three.js%E6%8A%80%E5%B7%A7%E4%B9%8B%E7%94%BB%E5%B8%83/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-12-19T17:11:35+08:00"><meta property="article:modified_time" content="2023-12-19T17:11:35+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="19 Three.jsæŠ€å·§ä¹‹ç”»å¸ƒ"><meta name=twitter:description content><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"æ–‡ç« ","item":"https://bablvsj.github.io/posts/"},{"@type":"ListItem","position":3,"name":"19 Three.jsæŠ€å·§ä¹‹ç”»å¸ƒ","item":"https://bablvsj.github.io/posts/threejs/19-three.js%E6%8A%80%E5%B7%A7%E4%B9%8B%E7%94%BB%E5%B8%83/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"19 Three.jsæŠ€å·§ä¹‹ç”»å¸ƒ","name":"19 Three.jsæŠ€å·§ä¹‹ç”»å¸ƒ","description":"","keywords":["Three.js"],"articleBody":"æœ¬æ–‡è®²è§£ä¸€ä¸‹ ç”»å¸ƒ Canvas çš„ä¸€äº›å®ç”¨æŠ€å·§ã€‚\nåˆ›å»ºç”»å¸ƒæˆªå±(å¿«ç…§)ï¼Œå¹¶ä¿å­˜å›¾ç‰‡åˆ°æœ¬åœ° è®¾ç½®ä¸æ¸…é™¤ç”»å¸ƒå†…å®¹ è·å–é”®ç›˜äº‹ä»¶ è®¾ç½®ç”»å¸ƒé€æ˜åº¦ è®¾ç½®ç”»å¸ƒä¸ºèƒŒæ™¯ ç¤ºä¾‹åŸºæœ¬ä»£ç ï¼šHelloCanvas å…ˆåˆ¶ä½œä¸€ä¸ªç®€å•çš„ã€å¸¦åŠ¨ç”»çš„Three.jsåœºæ™¯ ä¸ºäº†æ¼”ç¤ºå„ä¸ªåŠŸèƒ½ï¼Œæˆ‘ä»¬å…ˆåˆ›å»ºä¸€ä¸ªåŸºç¡€çš„ Three.js åŠ¨ç”»åœºæ™¯ï¼šåœºæ™¯ä¸Šæœ‰ 3 ä¸ªä¸åŒé¢œè‰²ã€ä¸åœæ—‹è½¬çš„ç«‹æ–¹ä½“ã€‚\nè¿™ä¸ªåœºæ™¯åœ¨ä¹‹å‰å¤šä¸ªç¤ºä¾‹ä¸­å·²ç»åˆ›å»ºè¿‡å¤šæ¬¡ï¼Œä½†æ˜¯è¿™æ¬¡å’Œä¹‹å‰çš„ç•¥å¾®ä¸åŒã€‚\n**ä¸åŒç‚¹1ï¼š**ç”±äºæœ¬æ–‡æ˜¯è®²è§£ canvas çš„ï¼Œæœ¬èº«å’Œ Three.js æ²¡å¤ªå¤§çš„å…³è”ï¼Œæ‰€ä»¥è¿™æ¬¡æˆ‘ä»¬ä¼šåˆ›å»ºä¸€ä¸ª useCreateScene çš„è‡ªå®šä¹‰ hookï¼Œç”¨æ¥ä¸“é—¨åˆ›å»º 3D åœºæ™¯ï¼Œè¿™æ ·æˆ‘ä»¬çš„ index.tsx ä»£ç å¯ä»¥æ›´åŠ ç®€æ´ã€‚\næ‰€è°“ è‡ªå®šä¹‰ react hookï¼Œæœ¬è´¨ä¸Šå°±æ˜¯åŒ…å«æœ‰ hook çš„æ™®é€šå‡½æ•°\n**ä¸åŒç‚¹2ï¼š**ç”±äºè®²è§£è¿‡ç¨‹ä¸­éœ€è¦ç”¨åˆ°ä¸€äº›æŒ‰é’®ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™æ¬¡å°†å¼•å…¥ react-dat-gui è¿™ä¸ªç»„ä»¶ï¼Œæ¥æ·»åŠ ä¸€äº›ç¤ºä¾‹ç›¸å…³æŒ‰é’®ã€‚\nå…³äºå¦‚ä½•ä½¿ç”¨ react-dat-gui è¿™ä¸ªï¼Œè¯·å‚è€ƒæˆ‘å†™çš„ Reactä¸­ä½¿ç”¨GUI.md è¿™ç¯‡æ•™ç¨‹ã€‚\nè¯·åŠ¡å¿…å­¦ä¹ ä¸€ä¸‹ react-dat-gui è¿™ä¸ªç»„ä»¶ï¼Œåœ¨åç»­ç¤ºä¾‹ä¸­æˆ‘ä»¬ä¼šç»å¸¸ä½¿ç”¨è¿™ä¸ªç»„ä»¶æ¥ä½œä¸ºè°ƒè¯•é¢æ¿ã€‚\nå…·ä½“çš„ä»£ç  æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªä¸“é—¨å­˜æ”¾æœ¬ç¤ºä¾‹çš„ç›®å½• src/components/hello-canvas/\nuse-create-scene.tsï¼š\nimport { useEffect } from 'react' import * as Three from 'three' import { OrbitControls } from 'three/examples/jsm/controls/OrbitControls' const useCreateScene = (canvasRef: React.RefObject) =\u003e { useEffect(() =\u003e { if (canvasRef.current === null) { return } const renderer = new Three.WebGLRenderer({ canvas: canvasRef.current }) const scene = new Three.Scene() scene.background = new Three.Color(0x222222) const camera = new Three.PerspectiveCamera(45, 2, 0.1, 100) camera.position.set(0, 5, 10) const light = new Three.DirectionalLight(0xFFFFFF, 1) light.position.set(5, 10, 0) scene.add(light) const controls = new OrbitControls(camera, canvasRef.current) controls.update() const colors = ['blue', 'red', 'green'] const cubes: Three.Mesh[] = [] colors.forEach((color, index) =\u003e { const mat = new Three.MeshPhongMaterial({ color }) const geo = new Three.BoxBufferGeometry(2, 2, 2) const mesh = new Three.Mesh(geo, mat) mesh.position.x = (index - 1) * 4 scene.add(mesh) cubes.push(mesh) }) const render = (time: number) =\u003e { time *= 0.001 cubes.forEach((cube) =\u003e { cube.rotation.x = cube.rotation.y = time }) renderer.render(scene, camera) window.requestAnimationFrame(render) } window.requestAnimationFrame(render) const handleResize = () =\u003e { if (canvasRef.current === null) { return } const width = canvasRef.current.clientWidth const height = canvasRef.current.clientHeight camera.aspect = width / height camera.updateProjectionMatrix() renderer.setSize(width, height, false) } handleResize() window.addEventListener('resize', handleResize) return () =\u003e { window.removeEventListener('resize', handleResize) } }, [canvasRef]) } export default useCreateScene index.scssï¼š\n.full-screen, canvas { display: block; height: inherit; width: inherit; } .dat-gui { top: 16px !important; font-size: 18px !important; } index.tsxï¼š\nimport { useRef, useState } from 'react' import DatGUI, { DatButton } from 'react-dat-gui' import useCreateScene from './use-create-scene' import './index.scss' import 'react-dat-gui/dist/index.css' const HelloCanvas = () =\u003e { const canvasRef = useRef(null) const [date, setDate] = useState({}) useCreateScene(canvasRef) const handleGUIUpdate = (newDate: any) =\u003e { setDate(newDate) } const handleSaveClick = () =\u003e { //ç¼–å†™ç‚¹å‡»ä¹‹åçš„ä»£ç  } return ( ) } export default HelloCanvas è¡¥å……è¯´æ˜ï¼š\næ‰€æœ‰åˆ›å»º 3D åœºæ™¯çš„ä»£ç éƒ½è½¬ç§»åˆ°äº† use-create-scene.ts ä¸­ï¼Œindex.tsx çš„ä»£ç ç»ˆäºçœ‹ä¸Šå»éå¸¸ç®€æ´äº†ã€‚\næˆ‘ä»¬ä½¿ç”¨äº† æ ‡ç­¾ï¼Œä½†æ˜¯ç”±äºæˆ‘ä»¬æœ¬èº«åªä½¿ç”¨ æŒ‰é’®()ï¼Œå¹¶æœªç”¨åˆ°ä»»ä½•å…¶ä»–å˜é‡ï¼Œæ‰€ä»¥\nè¿™è¡Œå±æ€§é…ç½®åªæ˜¯ä¸ºäº†ä¸è®© DatGUI æŠ¥ç¼ºçœé”™è¯¯ï¼Œå¹¶æ— å…¶ä»–ä½œç”¨ã€‚\nDatGUI çš„ dateã€onUpdate ä¸ºå¿…å¡«å±æ€§\nè‡³æ­¤ï¼Œæœ¬ç¤ºä¾‹æ‰€ç”¨åˆ°çš„åŸºç¡€åœºæ™¯ä»£ç å·²æ­å»ºå¥½ï¼Œæ¥ä¸‹æ¥å¼€å§‹è®²è§£ canvas çš„ä½¿ç”¨æŠ€å·§ã€‚\nåˆ›å»ºç”»å¸ƒæˆªå±(å¿«ç…§)ï¼Œå¹¶ä¿å­˜å›¾ç‰‡åˆ°æœ¬åœ° å…ˆè¯´ä¸€ä¸‹å¦‚ä½•åˆ›å»ºç”»å¸ƒæˆªå±(å¿«ç…§) å¯¹äº HTML5 ä¸­çš„ canvas æ¥è¯´ï¼Œåˆ›å»ºç”»å¸ƒæˆªå±(å¿«ç…§)æœ‰ 2 ç§æ–¹å¼ï¼šcanvas.toDataURL()ã€canvas.toBolb()\næ‰€è°“æˆªå±å’Œå¿«ç…§ï¼Œæ›´åŠ å‡†ç¡®çš„è¯´æ³•åº”è¯¥æ˜¯ï¼šè·å–ç”»å¸ƒå½“å‰å›¾ç‰‡çš„å†…å®¹\nç¬¬1ç§ï¼šcanvas.toDataURL() canvas.toDataURL() å¯ä»¥åˆ›å»ºä¸€ä¸ªä¸´æ—¶çš„å›¾ç‰‡åœ°å€ï¼Œè¯¥å›¾ç‰‡åœ°å€å¯ä»¥ä½œä¸ºå½“å‰é¡µé¢ä¸­çš„ æ ‡ç­¾ä¸­çš„ src å±æ€§å€¼ã€‚æˆ–è€…å¯ä»¥åˆ›å»ºä¸€ä¸ªä¸‹è½½é“¾æ¥ï¼Œç‚¹å‡»ä¸‹è½½è¿™ä¸ªå›¾ç‰‡ã€‚\ntoDataURL()ç”¨æ³•ï¼š\ncanvas.toDataURL(type?: string, quality?: any): string; typeï¼šå›¾ç‰‡æ ¼å¼ç±»å‹ï¼Œå€¼åªèƒ½æ˜¯ â€œimage/pngâ€ æˆ– â€œimage/jpegâ€\né™¤äº†ä¸Šé¢ 2 ä¸ªå›ºå®šå€¼ï¼Œè‹¥ä½ å¡«å†™å…¶ä»–å€¼åˆ™ä¸å¯ä½œç”¨ä¹Ÿä¸æŠ¥é”™ï¼Œæœ€ç»ˆä¼šä½¿ç”¨ â€œimage/pngâ€ æ¥ä½œä¸ºé»˜è®¤å€¼\nå¯¹äº è°·æ­Œæµè§ˆå™¨ Chrome ï¼Œè¿˜é¢å¤–æ”¯æŒä¸€ä¸ªç±»å‹ â€œimage/webpâ€\nqualityï¼šjpeg å›¾ç‰‡çš„å‹ç¼©è´¨é‡ï¼Œå–å€¼èŒƒå›´ 0 - 1ï¼Œé»˜è®¤å€¼ä¸º 0.92\nquality çš„å€¼è¶Šå¤§ï¼Œå›¾ç‰‡æ¸…æ™°åº¦è¶Šé«˜ï¼Œæ–‡ä»¶ä½“ç§¯è¶Šå¤§\nå¦‚æœ quality çš„å€¼ä¸åœ¨ 0-1 èŒƒå›´å†…ï¼Œåˆ™ä¼šä½¿ç”¨é»˜è®¤å€¼ 0.92\nåˆ›å»º PNG å›¾ç‰‡ï¼š\nconst imgurl = canvas.toDataURL('image/png') console.log(imgurl) //è¾“å‡ºä»¥ä¸‹å†…å®¹ data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAB4AAAAEUCAYAAADK... åˆ›å»º JPEG å›¾ç‰‡ï¼š\nconst imgurl = canvas.toDataURL('image/jpeg',quality) console.log(imgurl) //è¾“å‡ºä»¥ä¸‹å†…å®¹ data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAYEBQY... è¯·æ³¨æ„ä¸Šé¢è¾“å‡ºå†…å®¹ä¸­ï¼Œå‡åŒ…å«äº† â€base64â€œï¼Œè¿™ç§æ ¼å¼çš„å›¾ç‰‡ï¼Œæ˜¯å¯ä»¥è‡ªåŠ¨ä¸‹è½½çš„\nå…³äºå›¾ç‰‡è‡ªåŠ¨ä¸‹è½½ä¿å­˜åˆ°æœ¬åœ°æˆ‘ä»¬ä¼šç¨åè®²è§£\nç¬¬2ç§ï¼šcanvas.toBlob() canvas.toBlob() å¯ä»¥åˆ›å»º Blob å¯¹è±¡ï¼Œè¯¥å¯¹è±¡åŒ…å«å›¾ç‰‡çš„æ•°æ®å†…å®¹ã€‚\næ³¨æ„ï¼šcanvas.toDataURL() æ˜¯è·å¾—ä¸€ä¸ªä¸´æ—¶çš„å›¾ç‰‡åœ°å€ï¼Œè€Œ canvas.toBlob() æ˜¯è·å¾—å›¾ç‰‡æ•°æ®å†…å®¹ã€‚\ncanvas.toBlob()ç”¨æ³•ï¼š\ntoBlob(callback: BlobCallback, type?: string, quality?: any): void; callbackï¼šè·å¾— Blob å¯¹è±¡çš„å›è°ƒå‡½æ•°\né€šå¸¸ä¸ºï¼šcanvas.toBlob( (blob: Blob|null) =\u003e {} )\ntypeï¼šå›¾ç‰‡çš„æ ¼å¼ç±»å‹ï¼Œé»˜è®¤å€¼ä¸º â€œimage/pngâ€\nqualityï¼šè‹¥å›¾ç‰‡æ ¼å¼ç±»å‹ä¸º â€œimage/jpegâ€ï¼Œquality è¡¨ç¤º JPEG çš„å‹ç¼©è´¨é‡\ntype çš„å–å€¼å’Œé»˜è®¤å€¼ã€quality çš„å–å€¼èŒƒå›´å’Œé»˜è®¤å€¼ ä¸ canvas.toDataURL() å®Œå…¨ç›¸åŒ\nä½¿ç”¨ç¤ºä¾‹ï¼š\ncanvas.toBlob((blob) =\u003e { console.log(blob) }) æˆ– canvas.toBlob((blob) =\u003e { console.log(blob) }, 'image/jpeg', 0.8) æ³¨æ„ï¼šä¸åŒäº canvas.toDataURL()ï¼Œcanvas.toBlob() è¿™ä¸ªå‡½æ•°æ˜¯æ²¡æœ‰è¿”å›å€¼çš„\nå¦å¤–ï¼Œå‡è®¾ä½¿ç”¨ jpeg å‹ç¼©è´¨é‡ä¸º 0.8ï¼Œæ–‡ä»¶ä½“ç§¯æœ‰å¯èƒ½åªæœ‰ png æ ¼å¼çš„ 1/3 ã€‚\nè¡¥å……è¯´æ˜ å…³äºåˆ†è¾¨ç‡ï¼š\næŒ‰ç…§ MDN æ–‡æ¡£ï¼Œæ— è®ºå“ªç§æ–¹å¼ä¿å­˜çš„å›¾ç‰‡åˆ†è¾¨ç‡éƒ½æ˜¯ 96ï¼Œä½†æ˜¯æˆ‘åœ¨ PC æœºä¸Šè¯•éªŒï¼Œå°†ä¸‹è½½çš„å›¾ç‰‡ä¿å­˜åˆ°æœ¬åœ°ï¼Œå¹¶åœ¨ PhotoShop è½¯ä»¶ä¸­æŸ¥çœ‹ï¼Œå‘ç°å›¾ç‰‡åˆ†è¾¨ç‡ä¾ç„¶æ˜¯ 72ã€‚\næˆ‘æ€€ç–‘ ä¿å­˜å›¾ç‰‡çš„åˆ†è¾¨ç‡å…¶å®æ˜¯å’Œ å½“å‰ç³»ç»Ÿä¸€è‡´çš„ã€‚å‡è®¾åœ¨æ‰‹æœºä¸Šï¼Œæœ‰å¯èƒ½å›¾ç‰‡åˆ†è¾¨ç‡å°±æ˜¯ 96 äº†ã€‚\nç¨åæˆ‘ä¼šåœ¨æ‰‹æœºä¸ŠéªŒè¯ä¸€ä¸‹ å›¾ç‰‡åˆ†è¾¨ç‡ è¿™ä¸ªé—®é¢˜ã€‚\næœ€åï¼Œå»ºè®®ä½ å» MDN ä¸Šçœ‹ canvas ä¿å­˜å›¾ç‰‡ çš„ç›¸å…³è®²è§£ä½œä¸ºæœ¬å°èŠ‚çš„è¡¥å……ã€‚\nhttps://developer.mozilla.org/zh-CN/docs/Web/API/Canvas_API/Tutorial/Pixel_manipulation_with_canvas\nå†è¯´ä¸€ä¸‹å¦‚ä½•è‡ªåŠ¨å°†å›¾ç‰‡ä¸‹è½½åˆ°æœ¬åœ° å›¾ç‰‡è‡ªåŠ¨ä¸‹è½½åˆ°æœ¬åœ°çš„æ€è·¯ï¼šåœ¨JSä¸­åˆ›å»ºä¸€ä¸ª a é“¾æ¥ï¼Œå¹¶ä¸”æ¨¡æ‹Ÿå‡º a ç‚¹å‡»äº‹ä»¶\nä½¿ç”¨toDataURL()å‡½æ•°ï¼š\nconst canvas = canvasRef.current const imgurl = canvas.toDataURL('image/jpeg', 0.8) const a = document.createElement('a') a.href = imgurl a.download = 'myimg.jpeg' a.click() æ³¨æ„ï¼šæˆ‘åŸæœ¬ä»¥ä¸ºè¿˜éœ€è¦å°† a æ ‡ç­¾æ’å…¥åˆ°ç½‘é¡µ body ä¸­æ‰å¯ä»¥å®ç°è‡ªåŠ¨ä¸‹è½½ï¼Œä½†æ˜¯ç»è¿‡è¯•éªŒå‘ç°æ ¹æœ¬ä¸éœ€è¦è¿™æ ·ï¼Œä»¥ä¸‹ä¸ºæˆ‘åŸæœ¬å†™çš„ä»£ç ï¼š\nconst a = document.createElement('a') document.body.appendChild(a) //æ ¹æœ¬æ— éœ€æ­¤è¡Œä»£ç  a.style.display = 'none' //ç”±äºä¸éœ€è¦æ·»åŠ åˆ° body ä¸­ï¼Œå› æ­¤ä¹Ÿæ— éœ€æ­¤è¡Œä»£ç  a.href = imgurl a.download = 'myimg.jpeg' a.click() document.body.removeChild(a) //æ ¹æœ¬æ— éœ€æ­¤è¡Œä»£ç  ä½¿ç”¨toBlob()å‡½æ•°ï¼š\nconst canvas = canvasRef.current canvas.toBlob((blob) =\u003e { const imgurl = window.URL.createObjectURL(blob) const a = document.createElement('a') a.href = imgurl a.download = 'myimg.jpeg' a.click() }, 'image/jpeg', 0.8) å°æ€»ç»“ï¼š\nè‹¥ä½¿ç”¨ canvas.toDataURL()ï¼Œåˆ™å¯ä»¥ç›´æ¥å°†å¾—åˆ°çš„å›¾ç‰‡ä¸´æ—¶åœ°å€ èµ‹å€¼ç»™ a.href è‹¥ä½¿ç”¨ canvas.toBlob()ï¼Œåˆ™éœ€è¦é€šè¿‡ window.URL.createObjectURL() è¿™ä¸ªå‡½æ•°å°† Blob æ•°æ®è½¬åŒ–å¾—åˆ°å¯¹åº”çš„åœ°å€ï¼Œç„¶åå†èµ‹å€¼ç»™ a.href å¥½äº†ï¼Œå…³äºå¦‚ä½•è·å–ç”»å¸ƒå›¾ç‰‡æ•°æ®ã€å¦‚ä½•ä¿æŒå›¾ç‰‡åˆ°æœ¬åœ°è®²è§£å®Œæ¯•ï¼Œæ¥å®è·µå§ã€‚\næ— è®ºé‡‡ç”¨ canvas.toDataURL() è¿˜æ˜¯ canvas.toBlob() éƒ½å¯ä»¥ï¼Œæœ¬ç¤ºä¾‹æˆ‘ä»¬é‡‡ç”¨ toBlob() ã€‚\næˆ‘ä»¬å°† index.stx çš„ä»£ç ä¿®æ”¹å¦‚ä¸‹ï¼š\nimport { useRef, useState } from 'react' import DatGUI, { DatButton } from 'react-dat-gui' import useCreateScene from './use-create-scene' import './index.scss' import 'react-dat-gui/dist/index.css' const HelloCanvas = () =\u003e { const canvasRef = useRef(null) const [date, setDate] = useState({}) useCreateScene(canvasRef) const handleGUIUpdate = (newDate: any) =\u003e { setDate(newDate) } const handleSaveClick = () =\u003e { if (canvasRef.current === null) { return } const canvas = canvasRef.current //é‡‡ç”¨ toDataURL() æ–¹å¼ // const imgurl = canvas.toDataURL('image/jpeg', 0.8) // const a = document.createElement('a') // a.href = imgurl // a.download = 'myimg.jpeg' //æˆ‘ä»¬å®šä¹‰ä¸‹è½½å›¾ç‰‡çš„æ–‡ä»¶å // a.click() //é‡‡ç”¨ toBlob() æ–¹å¼ canvas.toBlob((blob) =\u003e { const imgurl = window.URL.createObjectURL(blob) const a = document.createElement('a') a.href = imgurl a.download = 'myimg.jpeg' a.click() }, 'image/jpeg', 0.8) } return ( ) } export default HelloCanvas å®é™…è¿è¡Œï¼Œç‚¹å‡»å³ä¸Šè§’çš„ æŒ‰é’®ï¼Œå°±ä¼šç»™ç”»å¸ƒåˆ›å»ºå›¾ç‰‡å¿«ç…§ï¼Œå¹¶ä¸”è‡ªåŠ¨ä¸‹è½½åˆ°æœ¬åœ°ã€‚\nç„¶åä½ å¯ä»¥æŸ¥çœ‹åˆšåˆšä¸‹è½½åˆ°æœ¬åœ°çš„ myimg.jpeg è¿™ä¸ªæ–‡ä»¶ï¼Œæ‰“å¼€å®ƒâ€”â€”ä½ ä¼šå‘ç°ï¼Ÿï¼Ÿï¼Ÿ\næ€ä¹ˆå›¾ç‰‡å•¥å†…å®¹éƒ½æ²¡æœ‰ï¼Ÿçº¯è‰²çš„ï¼Ÿ3 ä¸ªç«‹æ–¹ä½“å‘¢ï¼Ÿ\nwhat ï¼Ÿwhy ï¼Ÿ\nå‘µï¼Œé©¬ä¸Šè®²è§£ä¸ºä»€ä¹ˆã€‚\né—®é¢˜å‡ºåœ¨äº†å“ªé‡Œï¼Ÿ\né¦–å…ˆæˆ‘ä»¬å®¹æ˜“æƒ³åˆ°ï¼Œåœ¨ use-create-scene.ts çš„ render() å‡½æ•°ä¸­ï¼Œä¸åœçš„è¿è¡Œç€æ¯ä¸€å¸§éƒ½è¿›è¡Œç”»å¸ƒé‡æ–°æ¸²æŸ“çš„ä»£ç ï¼Œè«éæ˜¯æˆ‘ä»¬æˆªå›¾é‚£ä¸€ç¬é—´åˆšå¥½ç”»å¸ƒè¿˜æœªæ¸²æŸ“å®Œæˆï¼Ÿ\nå¥½ï¼Œæˆ‘ä»¬å…ˆæŠŠé‚£è¡Œä»£ç åˆ é™¤æ‰ï¼Œçœ‹æ˜¯å¦å°±å¯ä»¥æˆªå›¾æ˜¾ç¤ºæœ‰å†…å®¹äº†ã€‚\nconst render = (time: number) =\u003e { time *= 0.001 cubes.forEach((cube) =\u003e { cube.rotation.x = cube.rotation.y = time }) renderer.render(scene, camera) - window.requestAnimationFrame(render) } window.requestAnimationFrame(render) å†æ¬¡è¿è¡Œï¼Œ3 ä¸ªç«‹æ–¹ä½“æ˜¯é™æ­¢çŠ¶æ€ï¼Œæ­¤æ—¶ç‚¹å‡»æŒ‰é’®ä¿å­˜æˆªå›¾ã€‚\næŸ¥çœ‹è¯¥å›¾ï¼Œç«Ÿç„¶ä¾ç„¶æ˜¯ç©ºç™½ï¼Œæ²¡æœ‰å†…å®¹çš„ã€‚\nçœ‹æ¥é—®é¢˜å¹¶ä¸å‡ºåœ¨ä¸Šé¢ä¸€è¡Œä»£ç ä¸­ï¼Œæˆ‘ä»¬æ¢å¤åˆšæ‰åˆ é™¤çš„ window.requestAnimationFrame(render)ï¼Œå†å»æƒ³å…¶ä»–åŸå› ã€‚\nçœŸå®çš„åŸå› æ˜¯ï¼š\næˆ‘ä»¬æ‰€è°“çš„é’ˆå¯¹ç”»å¸ƒæˆªå± åˆ›å»ºå¿«ç…§ï¼Œå®é™…ä¸Šæ˜¯è·å– canvas ä¸­çš„æ•°æ® ä½†è¿™ä¸ªæ•°æ®å¹¶ä¸æ˜¯é’ˆå¯¹ DOM ä¸­å·²æ˜¾ç¤ºçš„ canvasï¼Œè€Œæ˜¯é’ˆå¯¹ canvas å¯¹è±¡ä¸­ç¼“å†²åŒºçš„æ•°æ® å…³é”®åœ¨äºå½“ canvas æ¸²æŸ“å®Œæˆå(DOMä¸­å·²æ˜¾ç¤ºå‡ºå†…å®¹)ï¼Œé»˜è®¤ä¼šæ¸…ç©º ç¼“å†²åŒºä¸­çš„æ•°æ® æ‰€ä»¥ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬ä¸ºä»€ä¹ˆå» â€œè·å– canvas å›¾åƒæ•°æ®æ—¶å¾—åˆ°æ˜¯ç©ºç™½å†…å®¹â€ çš„åŸå›  canvasä»è®¡ç®—åˆ°æ˜¾ç¤ºçš„è¿‡ç¨‹ï¼š\ncanvas æ ¹æ®ç›¸åº”çš„ JS è§„åˆ™ï¼Œå¼€å§‹åˆ›å»ºã€è®¡ç®—ç”»å¸ƒå†…å®¹æ•°æ® canvas å°†è®¡ç®—å¾—åˆ°çš„ç”»å¸ƒå†…å®¹æ•°æ®å¡«å……åˆ° canvas ç¼“å†²åŒº å½“ canvas ç”»å¸ƒå†…å®¹è®¡ç®—å®Œæˆï¼Œæ­¤æ—¶ canvas ç¼“å†²åŒºå·²æœ‰å®Œæ•´çš„ç”»å¸ƒå†…å®¹æ•°æ®åï¼Œå°†ç”»å¸ƒå†…å®¹æ˜¾ç¤ºåˆ° DOM ä¸­ å†è¯´ä¸€éï¼š\næˆ‘ä»¬ä¹‹å‰çš„ç¤ºä¾‹ä¸­ï¼Œæ¸²æŸ“å¹¶æ˜¾ç¤º canvas å†…å®¹çš„å‡½æ•° render å’Œ åˆ›å»ºç”»å¸ƒå¿«ç…§ çš„å‡½æ•°æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œè¿™å°±é€ æˆäº†å½“æˆ‘ä»¬å»è·å– canvas ç¼“å†²åŒºæ•°æ®æ—¶ï¼Œcanvas å·²ç»å°†ç”»å¸ƒå†…å®¹æ˜¾ç¤ºåˆ° DOM ä¸­å¹¶ä¸”æ¸…ç©ºäº†ç¼“å†²åŒºã€‚\nè§£å†³åŠæ³•ï¼š\nè§£å†³åŠæ³•å°±æ˜¯å½“æˆ‘ä»¬è¦åˆ›å»ºç”»å¸ƒå¿«ç…§ï¼Œè·å– canvas ç¼“å†²åŒºå†…å®¹ä¹‹å‰ï¼Œåœ¨åŒä¸€ä¸ªå‡½æ•°ä½“å†…ï¼Œé¢å¤–è°ƒç”¨ä¸€æ¬¡ render å‡½æ•°ï¼Œç¡®ä¿æ­¤æ—¶ canvas ç¼“å†²åŒºå†…æ˜¯æœ‰å†…å®¹çš„ã€‚\nå®é™…ä»£ç ï¼š\nç¬¬1ï¼šç”±äºæˆ‘ä»¬ç¤ºä¾‹ä»£ç ä¸­ï¼Œrender å‡½æ•°æœ¬èº«ä½äº useCreateScene å‡½æ•°å†…éƒ¨ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦åˆ›é€ ä¸€ä¸ª renderRef çš„é’©å­(hook)ï¼Œå°† renderRef å¯¹å¤– return å‡ºå»ï¼Œä»¥ä¾¿ index.stx ä¸­å¯ä»¥è·å– render å‡½æ•°çš„å¼•ç”¨ã€‚\ntype RenderType = () =\u003e void ... const renderRef = useRef(null) ... renderRef.current = render ... return renderRef ç¬¬2ï¼šè¿™æ ·åšå¼•ç”³å‡ºå¦å¤–ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯æˆ‘ä»¬çš„ render å‡½æ•°å…¶å®æ˜¯æœ‰å‚æ•° time çš„ï¼š\nconst render = (time: number) =\u003e { time *= 0.001 cubes.forEach((cube) =\u003e { cube.rotation.x = cube.rotation.y = time }) renderer.render(scene, camera) window.requestAnimationFrame(render) } window.requestAnimationFrame(render) è€Œæˆ‘ä»¬å¸Œæœ› index.tsx ä¸­è°ƒç”¨ render() æ˜¯ä¸ä¼ å‚æ•° time çš„ã€‚å› ä¸º index.tsx ä¸­æ ¹æœ¬ä¸å­˜åœ¨ time è¿™ä¸ªå˜é‡ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å¯¹ æ¸²æŸ“ è¿›è¡Œé€‚å½“çš„æ”¹é€ ã€‚\næˆ‘ä»¬å°†åŸæœ¬çš„ æ¸²æŸ“å‡½æ•° render() æ‹†åˆ†æˆ 2 ä¸ªå‡½æ•°ï¼š\nå•çº¯è´Ÿè´£æ¸²æŸ“çš„ render å‡½æ•° è´Ÿè´£ä¿®æ”¹ç‰©ä½“å±æ€§ä»è€Œäº§ç”ŸåŠ¨ç”»çš„ animate å‡½æ•° const render = () =\u003e { renderer.render(scene, camera) } renderRef.current = render const animate = (time: number) =\u003e { time *= 0.001 cubes.forEach((cube) =\u003e { cube.rotation.x = cube.rotation.y = time }) render() //è¿™æ · render() å°±æ˜¯ä¸€ä¸ªä¸éœ€è¦å‚æ•°çš„å‡½æ•° window.requestAnimationFrame(animate) } window.requestAnimationFrame(animate) ç»è¿‡è¿™æ ·æ”¹é€ åï¼Œå®Œæ•´çš„ use-create-screen.ts ä»£ç å¦‚ä¸‹ï¼š\nimport { useEffect, useRef } from 'react' import * as Three from 'three' import { OrbitControls } from 'three/examples/jsm/controls/OrbitControls' type RenderType = () =\u003e void const useCreateScene = (canvasRef: React.RefObject) =\u003e { const renderRef = useRef(null) useEffect(() =\u003e { if (canvasRef.current === null) { return } const renderer = new Three.WebGLRenderer({ canvas: canvasRef.current }) const scene = new Three.Scene() scene.background = new Three.Color(0x222222) const camera = new Three.PerspectiveCamera(45, 2, 0.1, 100) camera.position.set(0, 5, 10) const light = new Three.DirectionalLight(0xFFFFFF, 1) light.position.set(5, 10, 0) scene.add(light) const controls = new OrbitControls(camera, canvasRef.current) controls.update() const colors = ['blue', 'red', 'green'] const cubes: Three.Mesh[] = [] colors.forEach((color, index) =\u003e { const mat = new Three.MeshPhongMaterial({ color }) const geo = new Three.BoxBufferGeometry(2, 2, 2) const mesh = new Three.Mesh(geo, mat) mesh.position.x = (index - 1) * 4 scene.add(mesh) cubes.push(mesh) }) const render = () =\u003e { renderer.render(scene, camera) } renderRef.current = render const animate = (time: number) =\u003e { time *= 0.001 cubes.forEach((cube) =\u003e { cube.rotation.x = cube.rotation.y = time }) render() //è¿™æ · render() å°±æ˜¯ä¸€ä¸ªä¸éœ€è¦å‚æ•°çš„å‡½æ•° window.requestAnimationFrame(animate) } window.requestAnimationFrame(animate) const handleResize = () =\u003e { if (canvasRef.current === null) { return } const width = canvasRef.current.clientWidth const height = canvasRef.current.clientHeight camera.aspect = width / height camera.updateProjectionMatrix() renderer.setSize(width, height, false) } handleResize() window.addEventListener('resize', handleResize) return () =\u003e { window.removeEventListener('resize', handleResize) } }, [canvasRef]) return renderRef } export default useCreateScene index.tsx å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š\nimport { useRef, useState } from 'react' import DatGUI, { DatButton } from 'react-dat-gui' import useCreateScene from './use-create-scene' import './index.scss' import 'react-dat-gui/dist/index.css' const HelloCanvas = () =\u003e { const canvasRef = useRef(null) const [date, setDate] = useState({}) const renderRef = useCreateScene(canvasRef) //è·å–è‡ªå®šä¹‰ hook è¿”å›çš„ renderRef const handleGUIUpdate = (newDate: any) =\u003e { setDate(newDate) } const handleSaveClick = () =\u003e { if (canvasRef.current === null || renderRef.current === null) { return } const canvas = canvasRef.current renderRef.current() //æ­¤æ—¶è°ƒç”¨ render()ï¼Œè¿›è¡Œä¸€æ¬¡æ¸²æŸ“ï¼Œç¡®ä¿ canvas ç¼“å†²åŒºæœ‰æ•°æ® //é‡‡ç”¨ toDataURL() æ–¹å¼ // const imgurl = canvas.toDataURL('image/jpeg', 0.8) // const a = document.createElement('a') // a.href = imgurl // a.download = 'myimg.jpeg' //æˆ‘ä»¬å®šä¹‰ä¸‹è½½å›¾ç‰‡çš„æ–‡ä»¶å // a.click() //é‡‡ç”¨ toBlob() æ–¹å¼ canvas.toBlob((blob) =\u003e { const imgurl = window.URL.createObjectURL(blob) const a = document.createElement('a') a.href = imgurl a.download = 'myimg.jpeg' a.click() }, 'image/jpeg', 0.8) } return ( ) } export default HelloCanvas è°ƒè¯•è¿è¡Œï¼Œè¿™æ¬¡ä¿å­˜çš„ç”»å¸ƒå¿«ç…§å›¾ç‰‡ï¼Œå°±ä¸ä¼šå†æ˜¯ç©ºç™½ï¼Œè€Œæ˜¯æœ‰å…·ä½“å†…å®¹äº†ã€‚\nè®¾ç½®ä¸æ¸…é™¤ç”»å¸ƒå†…å®¹ ä¸Šé¢åˆšè®²åˆ° HTML5 ä¸­çš„ Canvas æ¯æ¬¡æ¸²æŸ“éƒ½å­˜åœ¨ä¸€ä¸ª æ•°æ®ç¼“å†²åŒºçš„æ¦‚å¿µï¼Œè€Œ Three.js çš„æ¸²æŸ“å™¨ WebGLRenderer ä¹ŸåŒæ ·å­˜åœ¨ æ•°æ®ç¼“å†²åŒº è¿™ä¸ªæ¦‚å¿µã€‚\nWebGLRenderer ç¼“å†²åŒºå†…ä¸ºæ¯æ¬¡æ¸²æŸ“åœºæ™¯å¾—åˆ°çš„ç”»é¢æ•°æ®ï¼Œé»˜è®¤æƒ…å†µä¸‹æ¯ä¸€æ¬¡æ¸²æŸ“éƒ½ä¼šæ¸…ç©º(é‡Šæ”¾)ä¸Šä¸€æ¬¡çš„æ¸²æŸ“ç”»é¢æ•°æ®ã€‚\nCanvas æ•°æ®ç¼“å†²åŒºæ¯æ¬¡æ¸…ç©º è¿™ä¸ªæˆ‘ä»¬æ²¡æœ‰åŠæ³•ä¿®æ”¹ï¼Œåªèƒ½è°ƒç”¨æ¸²æŸ“å‡½æ•°ï¼Œé‡æ–°æ¸²æŸ“ä¸€æ¬¡ã€‚\nä½†æ˜¯ WebGLRenderer çš„æ•°æ®ç¼“å†²åŒºå´æ˜¯å¯ä»¥é€šè¿‡è®¾ç½®è®©é»˜è®¤ä¸æ¸…é™¤çš„ã€‚\næ‰€è°“ä¸æ¸…é™¤ä¸Šä¸€æ¬¡æ•°æ®ç¼“å†²åŒºçš„å†…å®¹ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯ä¿ç•™ä¸Šä¸€æ¬¡æ¸²æŸ“ç”»é¢å†…å®¹\næ‰€è°“ä¸æ¸…é™¤ç”»å¸ƒå†…å®¹ï¼Œæœ¬è´¨ä¸Šæ˜¯è®©æ¸²æŸ“å™¨ä¸æ¸…é™¤ä¹‹å‰çš„æ¸²æŸ“å†…å®¹\nè®¾ç½® WebGLRenderer ä¿ç•™æ•°æ®ç¼“å†²åŒºä¸­çš„å†å²æ•°æ®ï¼š\næˆ‘ä»¬åªéœ€è¦å°† WebGLRender çš„é…ç½®ä¿®æ”¹å¦‚ä¸‹ï¼š\nconst renderer = new Three.WebGLRenderer({ canvas: canvasRef.current, preserveDrawingBuffer: true, alpha: true }) renderer.autoClearColor = false ç»è¿‡ä»¥ä¸Šçš„ä¿®æ”¹ä¹‹åï¼Œæ¯æ¬¡æ¸²æŸ“éƒ½ä¼šç»§ç»­ä¿ç•™ä¹‹å‰æ¸²æŸ“å†å²ç”»é¢ã€‚\nè°ƒè¯•è¿è¡Œä»£ç ï¼Œä½ å°±èƒ½æ„Ÿå—åˆ°å’Œä¹‹å‰æ¸²æŸ“çš„ä¸ä¸€æ ·æ•ˆæœäº†ã€‚\nä½†æ˜¯ï¼Œå­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼šå½“æµè§ˆå™¨çª—å£å°ºå¯¸æ”¹å˜åï¼Œç”±äºæ‰§è¡Œäº† renderer.setSize()ï¼Œåˆ™æ­¤æ—¶ æ¸²æŸ“å™¨ä¸­è¿‡å¾€çš„æ¸²æŸ“å†…å®¹å°†ä¼šè¢«æ¸…ç©ºã€‚\næ¸²æŸ“å™¨ä¸­çš„æ¸²æŸ“å†å²å†…å®¹è¢«æ¸…ç©ºåï¼Œç”»é¢å°±å¥½åƒç¬¬ä¸€æ¬¡åˆšå¼€å§‹é‚£æ ·ï¼Œé‡æ–°å¼€å§‹æ¸²æŸ“ã€‚\nè¡¥å……è¯´æ˜ï¼šå½“ç”¨æˆ·åœ¨æ‰‹æœºä¸Šæµè§ˆæ—¶ï¼Œæ‰‹æœºä»ç«–å±å˜ä¸ºæ¨ªå±æ—¶ï¼Œä¹Ÿä¼šè§¦å‘é‡æ–°ç»˜åˆ¶ã€‚\nçœŸæ­£çš„è§£å†³æ–¹æ¡ˆï¼šç¦»å±æ¸²æŸ“\nä¾‹å¦‚ä½¿ç”¨ WebGLRenderTargetï¼Œå…·ä½“è¯·å›é¡¾æˆ‘ä»¬ä¹‹å‰è®²è§£çš„å†…å®¹ï¼š15 Three.jsåŸºç¡€ä¹‹ç¦»å±æ¸²æŸ“.md\nè¡¥å……ä¸€ä¸ªç¤ºä¾‹ï¼šPreserveDrawingBuffer src/components/hello-canvas/preserve-drawing-buffer.tsx\nç¤ºä¾‹ç›®æ ‡ åˆ›å»ºä¸€ä¸ªç”± 6 ä¸ªç«‹æ–¹ä½“ï¼Œåšç›¸äº’ç¼ ç»•è¿åŠ¨çš„ä¸€ä¸ªç‰©ä½“ åˆ›å»ºä¸€ä¸ªæ­£äº¤é•œå¤´ OrthographicCamera ç»™ canvas æ·»åŠ é¼ æ ‡æ»‘åŠ¨ç›‘å¬ã€ä»¥åŠ æ‰‹æŒ‡æ»‘åŠ¨ç›‘å¬ å½“ é¼ æ ‡æˆ–æ‰‹æŒ‡æ»‘åŠ¨ç”»å¸ƒæ—¶ï¼Œæ›´æ–° ç‰©ä½“ åœ¨é•œå¤´ä¸­çš„ä½ç½® è®¾ç½®æ¸²æŸ“å™¨ä¸æ¸…é™¤å†å²ç”»é¢ æœ€ç»ˆå‘ˆç°å‡ºçš„æ•ˆæœï¼šç±»ä¼¼ä¸€ä¸ª ç”»ç¬”åœ¨ç”»æ¿ä¸Š ç”»ç”» çš„æ•ˆæœã€‚\nPreserveDrawingBuffer ä»£ç ï¼š\nimport { useEffect, useRef } from 'react' import * as Three from 'three' import './index.scss' const state = { x: 0, y: 0, z: 0 } const PreserveDrawingBuffer = () =\u003e { const canvasRef = useRef(null) useEffect(() =\u003e { if (canvasRef.current === null) { return } const renderer = new Three.WebGLRenderer({ canvas: canvasRef.current, preserveDrawingBuffer: true, alpha: true }) renderer.autoClearColor = false const camera = new Three.OrthographicCamera(-2, 2, 1, -1, -1, 1) const scene = new Three.Scene() scene.background = new Three.Color(0xFFFFFF) const light = new Three.DirectionalLight(0xFFFFFF, 1) light.position.set(-1, 2, 3) scene.add(light) const geometry = new Three.BoxBufferGeometry(1, 1, 1) const base = new Three.Object3D() scene.add(base) base.scale.set(0.1, 0.1, 0.1) const colors = ['#F00', '#FF0', '#0F0', '#0FF', '#00F', '#F0F'] const numArr = [-2, 2] //åŒä¸€åæ ‡è½´ä¸Šï¼Œå¯¹ç§° 2 ä¸ªç«‹æ–¹ä½“çš„åæ ‡ colors.forEach((color, index) =\u003e { const material = new Three.MeshPhongMaterial({ color }) const cube = new Three.Mesh(geometry, material) const col = Math.floor(index / numArr.length) const row = index % numArr.length let result = [0, 0, 0] result[col] = numArr[row] cube.position.set(result[0], result[1], result[2]) base.add(cube) }) const temp = new Three.Vector3() const updatePosition = (x: number, y: number) =\u003e { if (canvasRef.current === null) { return } // const rect = canvasRef.current.getBoundingClientRect() // const newX = (x - rect.left) * canvasRef.current.width / rect.width // const newY = (y - rect.top) * canvasRef.current.height / rect.height // const resX = newX / canvasRef.current.width * 2 - 1 // const resY = newY / canvasRef.current.height * -2 + 1 const resX = x / canvasRef.current.width * 2 - 1 const resY = y / canvasRef.current.height * -2 + 1 temp.set(resX, resY, 0).unproject(camera) state.x = temp.x state.y = temp.y } const handleMouseMove = (eve: MouseEvent) =\u003e { updatePosition(eve.clientX, eve.clientY) } const handleTouchMove = (eve: TouchEvent) =\u003e { eve.preventDefault() const touche = eve.touches[0] updatePosition(touche.clientX, touche.clientY) } canvasRef.current.addEventListener('mousemove', handleMouseMove) canvasRef.current.addEventListener('touchmove', handleTouchMove, { passive: false }) const render = (time: number) =\u003e { time = time * 0.001 base.position.set(state.x, state.y, state.z) base.rotation.x = time base.rotation.y = time * 1.11 renderer.render(scene, camera) window.requestAnimationFrame(render) } window.requestAnimationFrame(render) const handleResize = () =\u003e { if (canvasRef.current === null) { return } const width = canvasRef.current.clientWidth const height = canvasRef.current.clientHeight camera.right = width / height camera.left = - camera.right camera.updateProjectionMatrix() renderer.setSize(width, height, false) } handleResize() window.addEventListener('resize', handleResize) return () =\u003e { window.removeEventListener('resize', handleResize) } }, [canvasRef]) return ( ) } export default PreserveDrawingBuffer è¡¥å……è¯´æ˜ï¼š\nä¸Šé¢è¿™æ®µä»£ç ç•¥å¾®å¤æ‚ã€é™Œç”Ÿã€‚å› ä¸ºè¿™æ®µä»£ç ä¸­æœ‰å‡ ä¸ªåœ°æ–¹æ˜¯æˆ‘ä»¬ä¹‹å‰ç¤ºä¾‹ä¸­ä»æ¥æœªæ¥è§¦è¿‡çš„ï¼š\nä½¿ç”¨çš„æ˜¯æ­£äº¤é•œå¤´ï¼Œè€Œä¸æ˜¯é€è§†é•œå¤´\nå½“çª—å£å°ºå¯¸å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæ›´æ–°æ­£äº¤é•œå¤´\næ›´æ–°æ–¹å¼å’Œæˆ‘ä»¬ä¹‹å‰ä¹ æƒ¯ä½¿ç”¨çš„ é€è§†é•œå¤´(PerspectiveCamera) å¤§ä¸åŒ\nç›‘å¬é¼ æ ‡æ»‘åŠ¨ã€æ‰‹æŒ‡æ»‘åŠ¨äº‹ä»¶\næ›´æ–° ç‰©ä½“ åœ¨æ­£äº¤é•œå¤´ä¸­çš„ â€œæŠ•å½±ä½ç½®â€\né¢å¤–è¡¥å……ï¼š\nä¸Šè¿°ä»£ç ä¸­ï¼Œ6 ä¸ªç«‹æ–¹ä½“ ä»–ä»¬åˆ†åˆ«æ˜¯ï¼š\nåœ¨ x è½´å¯¹ç§°çš„ 2 ä¸ªç«‹æ–¹ä½“\nåœ¨ç¤ºä¾‹ä¸­ï¼Œå¯¹åº”çš„åæ ‡åˆ†åˆ«ä¸º (-2,0,0)ã€(2,0,0)\nåœ¨ y è½´å¯¹ç§°çš„ 2 ä¸ªç«‹æ–¹ä½“\nåœ¨ç¤ºä¾‹ä¸­ï¼Œå¯¹åº”çš„åæ ‡åˆ†åˆ«ä¸º (0,-2,0)ã€(0,2,0)\nåœ¨ z è½´å †æˆçš„ 2 ä¸ªç«‹æ–¹ä½“\nåœ¨ç¤ºä¾‹ä¸­ï¼Œå¯¹åº”çš„åæ ‡åˆ†åˆ«ä¸º (0,0,-2)ã€(0,0,2)\nè¿™ 6 ä¸ªç«‹æ–¹ä½“ä»–ä»¬ä¾æ¬¡å¯¹åº”çš„åæ ‡ï¼Œæ²¡æœ‰æå‰å†™æ­»ï¼Œè€Œæ˜¯é€šè¿‡ä¸€æ®µç‰¹æ®Šçš„ forEach å¾ªç¯æ¥è®¡ç®—å¾—å‡ºçš„ã€‚\nå¯ä»¥é˜…è¯»ä¸‹é¢è¿™æ®µé€šç”¨çš„ä»£ç ï¼Œå¸®åŠ©ä½ ç†è§£ æ•´ä¸ª forEach å¾ªç¯æ˜¯å¦‚ä½•å¾—åˆ°æ¯ä¸ªç«‹æ–¹ä½“åæ ‡çš„ã€‚\n//éå†å‡º ç›®æ ‡é•¿åº¦ä¸ºNï¼Œç‰¹æ®Šå€¼ä¸º [xx, xx, ...] çš„ å¤šç»´æ•°ç»„ const numArr = [-2, 2] //å®šä¹‰ç‰¹æ®Šä½ç½®ä¸Šå‡ºç°çš„æ•°å­— const arrLength = 3 //å®šä¹‰ç›®æ ‡æ•°ç»„é•¿åº¦ const total = arrLength * numArr.length //æ ¹æ®ç›®æ ‡æ•°ç»„é•¿åº¦ä»¥åŠç‰¹æ®Šæ•°å­—çš„ä¸ªæ•°ï¼Œè®¡ç®—å¾—å‡ºç›®æ ‡æ•°ç»„çš„æ€»ä¸ªæ•° for (let i = 0; i \u003c total; i++) { const col = Math.floor(i / numArr.length) //è®¡ç®—å‡ºç‰¹æ®Šä½ç½®çš„ç´¢å¼• const row = i % numArr.length //è®¡ç®—å‡ºç‰¹æ®Šä½ç½®ä¸Šæ•°å­—å€¼å¯¹åº”çš„ç´¢å¼• let result = new Array(arrLength) //å¾—åˆ°ä¸€ä¸ª é•¿åº¦ä¸º arrLenght çš„æ•°ç»„ result.fill(0) //å°†æ•°ç»„æ¯ä¸€é¡¹å¡«å……ä¸º 0 result[col] = numArr[row] //ä¿®æ”¹ç‰¹æ®Šä½ç½®ä¸Šçš„å€¼ console.log(result) } å¦‚æœä½ å¯¹ useCreateScene è¿™ä¸ªç¤ºä¾‹ä¸å¤ªç†è§£ä¹Ÿæ²¡æœ‰å…³ç³»ï¼Œå› ä¸ºæ¯•ç«Ÿè¿™ä¸ªç¤ºä¾‹ä¸­å‡ºç°äº†ä¸€äº›æˆ‘ä»¬ä¹‹å‰ç¤ºä¾‹ä¸­ä»æœªç”¨åˆ°çš„ä¸€äº›ç±»ï¼Œä½ å¯ä»¥å…ˆè·³è¿‡è¿™ä¸ªç¤ºä¾‹ï¼Œç»§ç»­åé¢çš„å­¦ä¹ ã€‚\néšç€æ—¥åå¯¹äº æ­£äº¤é•œå¤´ çš„å¤šæ¬¡ä½¿ç”¨ï¼Œç»ˆå½’ä¼šç†Ÿç»ƒå¹¶ç†è§£çš„ã€‚\nè·å–é”®ç›˜äº‹ä»¶ è®© Canvas è·å–é”®ç›˜äº‹ä»¶ å¿…é¡»åŒæ—¶æ»¡è¶³ä»¥ä¸‹ 2 ä¸ªæ¡ä»¶åï¼Œcanvas æ‰å¯ä»¥è·å¾—é”®ç›˜äº‹ä»¶ã€‚\ncanvas å½“å‰è·å¾—ç„¦ç‚¹\næ ‡ç­¾ä¸­å¿…é¡»æ·»åŠ  tabIndexå±æ€§ï¼Œ\nå±æ€§å€¼æ˜¯ -1ã€0ã€1 éƒ½æ— æ‰€è°“ï¼Œå»ºè®®è®¾ç½®ä¸º 0\nè¡¥å……è¯´æ˜ï¼šå½“ canvas è·å¾—å½“å‰ç„¦ç‚¹åï¼Œä¼šåœ¨å››å‘¨å‡ºç°ä¸€ä¸ªè“è‰²è¾¹æ¡†ï¼Œå¯ä»¥é€šè¿‡å®šä¹‰ css æ ·å¼æ¥å–æ¶ˆè¿™ä¸ªæ ·å¼ã€‚\ncanvas:focus { outline: none; } ç®€å•ç¤ºä¾‹ï¼š\nimport { useEffect, useRef } from 'react' import './index.scss' const CanvasKeyboard = () =\u003e { const canvasRef = useRef(null) useEffect(() =\u003e { if (canvasRef.current === null) { return } canvasRef.current.focus() //è‡ªåŠ¨è·å–ç„¦ç‚¹ const handleKeydown = (event: KeyboardEvent) =\u003e { console.log(event) } canvasRef.current.addEventListener('keydown', handleKeydown) return () =\u003e { if (canvasRef.current === null) { return } canvasRef.current.removeEventListener('keydown', handleKeydown) } }, [canvasRef]) return ( ) } export default CanvasKeyboard è®© OrbitControl è·å–é”®ç›˜äº‹ä»¶ é»˜è®¤ OrbitControl å¯¹è±¡å°±åŒ…å«é”®ç›˜æ–¹å‘é”®ä¾¦å¬ã€‚\né”®ç›˜ä¸Šçš„ ä¸Šä¸‹å·¦å³ æ–¹å‘é”® å‡å¯æ“æ§æ”¹å˜ é•œå¤´è½¨é“è§†å›¾ã€‚\nä½†æ˜¯æˆ‘ä»¬ä¹‹å‰çš„ä»£ç ä¸­ï¼Œç»å¸¸æ˜¯è¿™æ ·å†™çš„ï¼š\nconst controls = new OrbitControls(camera, canvasRef.current) è¿™æ ·å­˜åœ¨çš„é—®é¢˜æ˜¯ï¼Œå½“ canvas å¤±å»ç„¦ç‚¹åï¼Œå°±æ— æ³•å†è·å¾—é”®ç›˜äº‹ä»¶ã€‚\næœ€ç®€å•çš„è§£å†³åŠæ³•å°±æ˜¯å°†ä»£ç ä¿®æ”¹ä¸ºï¼š\nconst controls = new OrbitControls(camera, document.body) è¿™æ ·é”®ç›˜äº‹ä»¶å°±ä¸å®¹æ˜“ä¸¢å¤±ã€‚\nè®¾ç½®ç”»å¸ƒé€æ˜åº¦ è®¾ç½®ç”»å¸ƒé€æ˜åº¦ï¼Œä½ å¯èƒ½ä¼šç–‘æƒ‘ï¼Œè¿™æœ‰ä»€ä¹ˆå¥½è®²çš„ï¼Œç›´æ¥é€šè¿‡ css ç»™ canvas æ·»åŠ é€æ˜åº¦æ ·å¼å³å¯ï¼š\ncanvas { opacity: 0.4; } è¿™æ ·åšè‚¯å®šæ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯è¿™é‡Œè¯´çš„ â€œè®¾ç½®ç”»å¸ƒé€æ˜åº¦â€ å®é™…ä¸Šæ˜¯æŒ‡ ç»™ä¸åŒç‰©ä½“è®¾ç½®é€æ˜åº¦ã€‚\nä¾‹å¦‚æˆ‘ä»¬ä¹‹å‰ç¤ºä¾‹ä¸­çš„ç«‹æ–¹ä½“ï¼Œé‚£ä¹ˆæ‰€æœ‰çš„ç¤ºä¾‹ä¸­ç«‹æ–¹ä½“éƒ½ä¸æ˜¯åŠé€æ˜çš„ã€‚\nç»™æè´¨è®¾ç½®é€æ˜åº¦ï¼š\néœ€è¦ç»™æè´¨è®¾ç½®é€æ˜åº¦\nconst mat = new Three.MeshPhongMaterial({ color, opacity: 0.4 }) æ¸²æŸ“å™¨éœ€è¦å¼€å¯é€æ˜åº¦æ¸²æŸ“\nconst renderer = new Three.WebGLRenderer({ canvas: canvasRef.current, alpha:true, premultipliedAlpha:false }) alphaï¼šcanvas æ˜¯å¦åŒ…å«é€æ˜åº¦ï¼Œé»˜è®¤ä¸º false\npremultipliedAlphaï¼šrenderer æ˜¯å¦å‡è®¾é¢œè‰²æœ‰ premultiplied alpha (é¢„ä¹˜alpha)ï¼Œé»˜è®¤ä¸º true\né’ˆå¯¹ é¢„ä¹˜Alpha çš„è¡¥å……è¯´æ˜ï¼š\npremultiplied alphaï¼šé¢œè‰²å€¼ é¢„ä¹˜ alpha\nè¿™æ˜¯ä¼ ç»Ÿ 3D ç»˜åˆ¶ä¸­çš„ä¸€ä¸ªé‡è¦æ¦‚å¿µï¼Œä½ å¯ä»¥ç®€å•ç†è§£æˆå¦‚ä¸‹ï¼š\nå‡è®¾æˆ‘ä»¬è¦è¡¨ç¤ºä¸€ä¸ª é€æ˜åº¦ä¸º 60% çš„çº¯çº¢è‰²ï¼Œé‡‡ç”¨ RGBA çš„æ–¹å¼ä¸º (255,0,0,0.6)ï¼Œé€šè¿‡ é¢„ä¹˜ alphaï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°é€æ˜åº¦ä¸º 60% çš„çº¯çº¢è‰²å¦‚æœæ”¾ç½®åœ¨çº¯ç™½è‰²åº•ä¸Šï¼Œå®é™…ä¸Šæœ€ç»ˆå‘ˆç°å‡ºæ¥çš„é¢œè‰²å’Œ RGB ( 255,102,102) æ˜¯å®Œå…¨ç›¸åŒçš„ã€‚\nå‡è®¾ä¸€ä¸ªé¢œè‰²ä½¿ç”¨ RGBA æ¥è¡¨ç¤ºï¼Œé€æ˜åº¦ä¸º Aã€rgb é¢œè‰²ä¸º Cã€çº¯ç™½è‰²(255,255,255)ä¸º Fï¼Œé‚£ä¹ˆæŠŠ RGBA è½¬åŒ–ä¸º RGB çš„å…¬å¼ä¸ºï¼š\nCA + ( 1-A ) F\nä¹Ÿå°±æ˜¯è¯´ rgba(255,0,0,0.6) è½¬åŒ–ä¸ºå¯¹åº”çš„ rgb è¿‡ç¨‹ä¸ºï¼š\n(255,0,0)0.6 + (1-0.6) (255,255,255) = (255, 255 x 0.4, 255 x 0.4) = (255,102,102)\næš‚æ—¶çœ‹ä¸æ‡‚æ²¡æœ‰å…³ç³»ï¼Œåªéœ€è®°ä½è‹¥æƒ³è®©æ¸²æŸ“å™¨å°†ç‰©ä½“æ¸²æŸ“å‡ºåŠé€æ˜ï¼Œé™¤äº†ç‰©ä½“æœ¬èº«æè´¨é…ç½®é€æ˜åº¦ä»¥å¤–ï¼Œè¿˜éœ€è¦å°†æ¸²æŸ“å™¨ä¸­çš„ alpha è®¾ç½®ä¸º true ã€premultipliedAlpha è®¾ç½®ä¸º false\nè®¾ç½®ç”»å¸ƒä¸ºèƒŒæ™¯ å°† canvas è®¾ç½®ä¸ºç½‘é¡µèƒŒæ™¯ï¼Œäº‹å®ä¸Šä¹Ÿå¾ˆç®€å•ï¼Œå¯¹åº”çš„æ ·å¼ï¼š\ncanvas { position: fixed; top: 0; left: 0; z-index: -1; } ä¸Šè¿° CSS æ ·å¼å°±è®© canvas ä½ç½®å›ºå®šï¼Œä¸”å±‚çº§æœ€ä½ï¼Œè¿™æ ·å°±æˆä¸ºå½“å‰ç½‘é¡µèƒŒæ™¯äº†ã€‚\nä½†æ˜¯å®é™…é¡¹ç›®ä¸­ï¼Œæ›´åŠ å»ºè®®å°† canvas åŒ…å«åœ¨ä¸€ä¸ª iframe ä¸­åï¼Œå†ä½œä¸º ç½‘é¡µçš„èƒŒæ™¯ã€‚\nè¿™æ ·åšæœ‰å‡ ä¸ªç†ç”±ï¼š\nä½¿ç”¨ iframe åï¼Œå¯ä»¥å°† canvasã€Three.js çš„ç›¸å…³ä»£ç ç‹¬ç«‹å‡ºæ¥ å¯ä»¥å¤šä¸ªé¡µé¢éƒ½å¼•ç”¨è¿™ä¸ª iframe iframeçš„ç›¸å…³ç¤ºä¾‹ï¼š\nHello Three.js #background { position: fixed; width:100%; height:100%; left:0; top:0; z-index:-1; border:none; pointer-events:none; } ä¸Šè¿° css æ ·å¼ä¸­ï¼š\nposition: fixed; å¯ä»¥è®© iframe ä½ç½®å›ºå®š z-index: -1; å¯ä»¥è®© iframe å±‚çº§æœ€ä½ border: none; å¯ä»¥è®© iframe ä¸æ˜¾ç¤ºè¾¹æ¡† pointer-events: none; è®© iframe æ°¸è¿œä¸ä¼šæˆä¸ºé¼ æ ‡äº‹ä»¶çš„ targetï¼Œæ„å‘³ç€è®© iframe ä¸æ¥å—é¼ æ ‡äº¤äº’äº‹ä»¶ å…³äºæ›´å¤š canvas çš„ç›¸å…³ç”¨æ³•ï¼Œå»ºè®®é˜…è¯» MDN ä¸Šå…³äº canvas çš„ç›¸å…³æ–‡æ¡£ï¼š\nhttps://developer.mozilla.org/zh-CN/docs/Web/API/Canvas_API\nè‡³æ­¤ï¼Œå…³äº Three.js çš„ä¸€äº›å¸¸ç”¨æŠ€å·§è®²è§£å®Œæ¯•ã€‚\næ¥ä¸‹æ¥å¼€å§‹è®²è§£ Three.js çš„ä¸€äº›æ€§èƒ½ä¼˜åŒ–ã€‚\n","wordCount":"7202","inLanguage":"en","datePublished":"2023-12-19T17:11:35+08:00","dateModified":"2023-12-19T17:11:35+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://bablvsj.github.io/posts/threejs/19-three.js%E6%8A%80%E5%B7%A7%E4%B9%8B%E7%94%BB%E5%B8%83/"},"publisher":{"@type":"Organization","name":"Bablvsj's Blog","logo":{"@type":"ImageObject","url":"https://bablvsj.github.io/img/Q.gif"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://bablvsj.github.io accesskey=h title="Bablvsj's Blog (Alt + H)">Bablvsj's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://bablvsj.github.io/ title=ä¸»é¡µ><span>ä¸»é¡µ</span></a></li><li><a href=https://bablvsj.github.io/archives/ title=æ—¶é—´è½´><span>æ—¶é—´è½´</span></a></li><li><a href=https://bablvsj.github.io/tags title=æ ‡ç­¾><span>æ ‡ç­¾</span></a></li><li><a href=https://bablvsj.github.io/about title=å…³äº><span>å…³äº</span></a></li><li><a href=https://bablvsj.github.io/search title="ğŸ” (Alt + /)" accesskey=/><span>ğŸ”</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>19 Three.jsæŠ€å·§ä¹‹ç”»å¸ƒ</h1><div class=post-meta><div class=post-tags-meta><a href=https://bablvsj.github.io/tags/three.js/>Three.js</a></div>15 min&nbsp;Â·&nbsp;<span title='2023-12-19 17:11:35 +0800 +0800'>2023/12/19</span></div></header><aside id=toc-container class="toc-container wide"><div class=toc><div class=inner><ul><li><a href=#%e7%a4%ba%e4%be%8b%e5%9f%ba%e6%9c%ac%e4%bb%a3%e7%a0%81hellocanvas aria-label=ç¤ºä¾‹åŸºæœ¬ä»£ç ï¼šHelloCanvas>ç¤ºä¾‹åŸºæœ¬ä»£ç ï¼šHelloCanvas</a><ul><ul><li><a href=#%e5%85%88%e5%88%b6%e4%bd%9c%e4%b8%80%e4%b8%aa%e7%ae%80%e5%8d%95%e7%9a%84%e5%b8%a6%e5%8a%a8%e7%94%bb%e7%9a%84threejs%e5%9c%ba%e6%99%af aria-label=å…ˆåˆ¶ä½œä¸€ä¸ªç®€å•çš„ã€å¸¦åŠ¨ç”»çš„Three.jsåœºæ™¯>å…ˆåˆ¶ä½œä¸€ä¸ªç®€å•çš„ã€å¸¦åŠ¨ç”»çš„Three.jsåœºæ™¯</a></li><li><a href=#%e5%85%b7%e4%bd%93%e7%9a%84%e4%bb%a3%e7%a0%81 aria-label=å…·ä½“çš„ä»£ç >å…·ä½“çš„ä»£ç </a></li></ul></ul></li><li><a href=#%e5%88%9b%e5%bb%ba%e7%94%bb%e5%b8%83%e6%88%aa%e5%b1%8f%e5%bf%ab%e7%85%a7%e5%b9%b6%e4%bf%9d%e5%ad%98%e5%9b%be%e7%89%87%e5%88%b0%e6%9c%ac%e5%9c%b0 aria-label=åˆ›å»ºç”»å¸ƒæˆªå±(å¿«ç…§)ï¼Œå¹¶ä¿å­˜å›¾ç‰‡åˆ°æœ¬åœ°>åˆ›å»ºç”»å¸ƒæˆªå±(å¿«ç…§)ï¼Œå¹¶ä¿å­˜å›¾ç‰‡åˆ°æœ¬åœ°</a><ul><li><a href=#%e5%85%88%e8%af%b4%e4%b8%80%e4%b8%8b%e5%a6%82%e4%bd%95%e5%88%9b%e5%bb%ba%e7%94%bb%e5%b8%83%e6%88%aa%e5%b1%8f%e5%bf%ab%e7%85%a7 aria-label=å…ˆè¯´ä¸€ä¸‹å¦‚ä½•åˆ›å»ºç”»å¸ƒæˆªå±(å¿«ç…§)>å…ˆè¯´ä¸€ä¸‹å¦‚ä½•åˆ›å»ºç”»å¸ƒæˆªå±(å¿«ç…§)</a><ul><li><a href=#%e7%ac%ac1%e7%a7%8dcanvastodataurl aria-label=ç¬¬1ç§ï¼šcanvas.toDataURL()>ç¬¬1ç§ï¼šcanvas.toDataURL()</a></li><li><a href=#%e7%ac%ac2%e7%a7%8dcanvastoblob aria-label=ç¬¬2ç§ï¼šcanvas.toBlob()>ç¬¬2ç§ï¼šcanvas.toBlob()</a></li><li><a href=#%e8%a1%a5%e5%85%85%e8%af%b4%e6%98%8e aria-label=è¡¥å……è¯´æ˜>è¡¥å……è¯´æ˜</a></li></ul></li><li><a href=#%e5%86%8d%e8%af%b4%e4%b8%80%e4%b8%8b%e5%a6%82%e4%bd%95%e8%87%aa%e5%8a%a8%e5%b0%86%e5%9b%be%e7%89%87%e4%b8%8b%e8%bd%bd%e5%88%b0%e6%9c%ac%e5%9c%b0 aria-label=å†è¯´ä¸€ä¸‹å¦‚ä½•è‡ªåŠ¨å°†å›¾ç‰‡ä¸‹è½½åˆ°æœ¬åœ°>å†è¯´ä¸€ä¸‹å¦‚ä½•è‡ªåŠ¨å°†å›¾ç‰‡ä¸‹è½½åˆ°æœ¬åœ°</a></li></ul></li><li><a href=#%e8%ae%be%e7%bd%ae%e4%b8%8d%e6%b8%85%e9%99%a4%e7%94%bb%e5%b8%83%e5%86%85%e5%ae%b9 aria-label=è®¾ç½®ä¸æ¸…é™¤ç”»å¸ƒå†…å®¹>è®¾ç½®ä¸æ¸…é™¤ç”»å¸ƒå†…å®¹</a><ul><li><a href=#%e8%a1%a5%e5%85%85%e4%b8%80%e4%b8%aa%e7%a4%ba%e4%be%8bpreservedrawingbuffer aria-label=è¡¥å……ä¸€ä¸ªç¤ºä¾‹ï¼šPreserveDrawingBuffer>è¡¥å……ä¸€ä¸ªç¤ºä¾‹ï¼šPreserveDrawingBuffer</a><ul><li><a href=#%e7%a4%ba%e4%be%8b%e7%9b%ae%e6%a0%87 aria-label=ç¤ºä¾‹ç›®æ ‡>ç¤ºä¾‹ç›®æ ‡</a></li></ul></li></ul></li><li><a href=#%e8%8e%b7%e5%8f%96%e9%94%ae%e7%9b%98%e4%ba%8b%e4%bb%b6 aria-label=è·å–é”®ç›˜äº‹ä»¶>è·å–é”®ç›˜äº‹ä»¶</a><ul><ul><li><a href=#%e8%ae%a9-canvas-%e8%8e%b7%e5%8f%96%e9%94%ae%e7%9b%98%e4%ba%8b%e4%bb%b6 aria-label="è®© Canvas è·å–é”®ç›˜äº‹ä»¶">è®© Canvas è·å–é”®ç›˜äº‹ä»¶</a></li><li><a href=#%e8%ae%a9-orbitcontrol-%e8%8e%b7%e5%8f%96%e9%94%ae%e7%9b%98%e4%ba%8b%e4%bb%b6 aria-label="è®© OrbitControl è·å–é”®ç›˜äº‹ä»¶">è®© OrbitControl è·å–é”®ç›˜äº‹ä»¶</a></li></ul></ul></li><li><a href=#%e8%ae%be%e7%bd%ae%e7%94%bb%e5%b8%83%e9%80%8f%e6%98%8e%e5%ba%a6 aria-label=è®¾ç½®ç”»å¸ƒé€æ˜åº¦>è®¾ç½®ç”»å¸ƒé€æ˜åº¦</a></li><li><a href=#%e8%ae%be%e7%bd%ae%e7%94%bb%e5%b8%83%e4%b8%ba%e8%83%8c%e6%99%af aria-label=è®¾ç½®ç”»å¸ƒä¸ºèƒŒæ™¯>è®¾ç½®ç”»å¸ƒä¸ºèƒŒæ™¯</a></li></ul></div></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><p>æœ¬æ–‡è®²è§£ä¸€ä¸‹ ç”»å¸ƒ Canvas çš„ä¸€äº›å®ç”¨æŠ€å·§ã€‚</p><ul><li>åˆ›å»ºç”»å¸ƒæˆªå±(å¿«ç…§)ï¼Œå¹¶ä¿å­˜å›¾ç‰‡åˆ°æœ¬åœ°</li><li>è®¾ç½®ä¸æ¸…é™¤ç”»å¸ƒå†…å®¹</li><li>è·å–é”®ç›˜äº‹ä»¶</li><li>è®¾ç½®ç”»å¸ƒé€æ˜åº¦</li><li>è®¾ç½®ç”»å¸ƒä¸ºèƒŒæ™¯</li></ul><h2 id=ç¤ºä¾‹åŸºæœ¬ä»£ç hellocanvas>ç¤ºä¾‹åŸºæœ¬ä»£ç ï¼šHelloCanvas<a hidden class=anchor aria-hidden=true href=#ç¤ºä¾‹åŸºæœ¬ä»£ç hellocanvas>#</a></h2><h4 id=å…ˆåˆ¶ä½œä¸€ä¸ªç®€å•çš„å¸¦åŠ¨ç”»çš„threejsåœºæ™¯>å…ˆåˆ¶ä½œä¸€ä¸ªç®€å•çš„ã€å¸¦åŠ¨ç”»çš„Three.jsåœºæ™¯<a hidden class=anchor aria-hidden=true href=#å…ˆåˆ¶ä½œä¸€ä¸ªç®€å•çš„å¸¦åŠ¨ç”»çš„threejsåœºæ™¯>#</a></h4><p>ä¸ºäº†æ¼”ç¤ºå„ä¸ªåŠŸèƒ½ï¼Œæˆ‘ä»¬å…ˆåˆ›å»ºä¸€ä¸ªåŸºç¡€çš„ Three.js åŠ¨ç”»åœºæ™¯ï¼šåœºæ™¯ä¸Šæœ‰ 3 ä¸ªä¸åŒé¢œè‰²ã€ä¸åœæ—‹è½¬çš„ç«‹æ–¹ä½“ã€‚</p><p>è¿™ä¸ªåœºæ™¯åœ¨ä¹‹å‰å¤šä¸ªç¤ºä¾‹ä¸­å·²ç»åˆ›å»ºè¿‡å¤šæ¬¡ï¼Œä½†æ˜¯è¿™æ¬¡å’Œä¹‹å‰çš„ç•¥å¾®ä¸åŒã€‚</p><p>**ä¸åŒç‚¹1ï¼š**ç”±äºæœ¬æ–‡æ˜¯è®²è§£ canvas çš„ï¼Œæœ¬èº«å’Œ Three.js æ²¡å¤ªå¤§çš„å…³è”ï¼Œæ‰€ä»¥è¿™æ¬¡æˆ‘ä»¬ä¼šåˆ›å»ºä¸€ä¸ª useCreateScene çš„è‡ªå®šä¹‰ hookï¼Œç”¨æ¥ä¸“é—¨åˆ›å»º 3D åœºæ™¯ï¼Œè¿™æ ·æˆ‘ä»¬çš„ index.tsx ä»£ç å¯ä»¥æ›´åŠ ç®€æ´ã€‚</p><blockquote><p>æ‰€è°“ <code>è‡ªå®šä¹‰ react hook</code>ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯åŒ…å«æœ‰ hook çš„æ™®é€šå‡½æ•°</p></blockquote><p>**ä¸åŒç‚¹2ï¼š**ç”±äºè®²è§£è¿‡ç¨‹ä¸­éœ€è¦ç”¨åˆ°ä¸€äº›æŒ‰é’®ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™æ¬¡å°†å¼•å…¥ react-dat-gui è¿™ä¸ªç»„ä»¶ï¼Œæ¥æ·»åŠ ä¸€äº›ç¤ºä¾‹ç›¸å…³æŒ‰é’®ã€‚</p><p>å…³äºå¦‚ä½•ä½¿ç”¨ react-dat-gui è¿™ä¸ªï¼Œè¯·å‚è€ƒæˆ‘å†™çš„ <a href=https://github.com/puxiao/notes/blob/master/React%E4%B8%AD%E4%BD%BF%E7%94%A8GUI.md>Reactä¸­ä½¿ç”¨GUI.md</a> è¿™ç¯‡æ•™ç¨‹ã€‚</p><blockquote><p>è¯·åŠ¡å¿…å­¦ä¹ ä¸€ä¸‹ react-dat-gui è¿™ä¸ªç»„ä»¶ï¼Œåœ¨åç»­ç¤ºä¾‹ä¸­æˆ‘ä»¬ä¼šç»å¸¸ä½¿ç”¨è¿™ä¸ªç»„ä»¶æ¥ä½œä¸ºè°ƒè¯•é¢æ¿ã€‚</p></blockquote><h4 id=å…·ä½“çš„ä»£ç >å…·ä½“çš„ä»£ç <a hidden class=anchor aria-hidden=true href=#å…·ä½“çš„ä»£ç >#</a></h4><p>æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªä¸“é—¨å­˜æ”¾æœ¬ç¤ºä¾‹çš„ç›®å½• src/components/hello-canvas/</p><p><strong>use-create-scene.tsï¼š</strong></p><div class=highlight><pre tabindex=0 style=color:#3c3836;background-color:#fbf1c7;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>import { useEffect } from &#39;react&#39;
</span></span><span style=display:flex><span>import * as Three from &#39;three&#39;
</span></span><span style=display:flex><span>import { OrbitControls } from &#39;three/examples/jsm/controls/OrbitControls&#39;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>const useCreateScene = (canvasRef: React.RefObject&lt;HTMLCanvasElement&gt;) =&gt; {
</span></span><span style=display:flex><span>    useEffect(() =&gt; {
</span></span><span style=display:flex><span>        if (canvasRef.current === null) { return }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        const renderer = new Three.WebGLRenderer({ canvas: canvasRef.current })
</span></span><span style=display:flex><span>        const scene = new Three.Scene()
</span></span><span style=display:flex><span>        scene.background = new Three.Color(0x222222)
</span></span><span style=display:flex><span>        const camera = new Three.PerspectiveCamera(45, 2, 0.1, 100)
</span></span><span style=display:flex><span>        camera.position.set(0, 5, 10)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        const light = new Three.DirectionalLight(0xFFFFFF, 1)
</span></span><span style=display:flex><span>        light.position.set(5, 10, 0)
</span></span><span style=display:flex><span>        scene.add(light)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        const controls = new OrbitControls(camera, canvasRef.current)
</span></span><span style=display:flex><span>        controls.update()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        const colors = [&#39;blue&#39;, &#39;red&#39;, &#39;green&#39;]
</span></span><span style=display:flex><span>        const cubes: Three.Mesh[] = []
</span></span><span style=display:flex><span>        colors.forEach((color, index) =&gt; {
</span></span><span style=display:flex><span>            const mat = new Three.MeshPhongMaterial({ color })
</span></span><span style=display:flex><span>            const geo = new Three.BoxBufferGeometry(2, 2, 2)
</span></span><span style=display:flex><span>            const mesh = new Three.Mesh(geo, mat)
</span></span><span style=display:flex><span>            mesh.position.x = (index - 1) * 4
</span></span><span style=display:flex><span>            scene.add(mesh)
</span></span><span style=display:flex><span>            cubes.push(mesh)
</span></span><span style=display:flex><span>        })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        const render = (time: number) =&gt; {
</span></span><span style=display:flex><span>            time *= 0.001
</span></span><span style=display:flex><span>            cubes.forEach((cube) =&gt; {
</span></span><span style=display:flex><span>                cube.rotation.x = cube.rotation.y = time
</span></span><span style=display:flex><span>            })
</span></span><span style=display:flex><span>            renderer.render(scene, camera)
</span></span><span style=display:flex><span>            window.requestAnimationFrame(render)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        window.requestAnimationFrame(render)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        const handleResize = () =&gt; {
</span></span><span style=display:flex><span>            if (canvasRef.current === null) { return }
</span></span><span style=display:flex><span>            const width = canvasRef.current.clientWidth
</span></span><span style=display:flex><span>            const height = canvasRef.current.clientHeight
</span></span><span style=display:flex><span>            camera.aspect = width / height
</span></span><span style=display:flex><span>            camera.updateProjectionMatrix()
</span></span><span style=display:flex><span>            renderer.setSize(width, height, false)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        handleResize()
</span></span><span style=display:flex><span>        window.addEventListener(&#39;resize&#39;, handleResize)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        return () =&gt; {
</span></span><span style=display:flex><span>            window.removeEventListener(&#39;resize&#39;, handleResize)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }, [canvasRef])
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>export default useCreateScene
</span></span></code></pre></div><p><strong>index.scssï¼š</strong></p><div class=highlight><pre tabindex=0 style=color:#3c3836;background-color:#fbf1c7;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>.full-screen,
</span></span><span style=display:flex><span>canvas {
</span></span><span style=display:flex><span>    display: block;
</span></span><span style=display:flex><span>    height: inherit;
</span></span><span style=display:flex><span>    width: inherit;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>.dat-gui {
</span></span><span style=display:flex><span>    top: 16px !important;
</span></span><span style=display:flex><span>    font-size: 18px !important;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>index.tsxï¼š</strong></p><div class=highlight><pre tabindex=0 style=color:#3c3836;background-color:#fbf1c7;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>import { useRef, useState } from &#39;react&#39;
</span></span><span style=display:flex><span>import DatGUI, { DatButton } from &#39;react-dat-gui&#39;
</span></span><span style=display:flex><span>import useCreateScene from &#39;./use-create-scene&#39;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>import &#39;./index.scss&#39;
</span></span><span style=display:flex><span>import &#39;react-dat-gui/dist/index.css&#39;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>const HelloCanvas = () =&gt; {
</span></span><span style=display:flex><span>    const canvasRef = useRef&lt;HTMLCanvasElement&gt;(null)
</span></span><span style=display:flex><span>    const [date, setDate] = useState&lt;any&gt;({})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    useCreateScene(canvasRef)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    const handleGUIUpdate = (newDate: any) =&gt; {
</span></span><span style=display:flex><span>        setDate(newDate)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    const handleSaveClick = () =&gt; {
</span></span><span style=display:flex><span>        //ç¼–å†™ç‚¹å‡»ä¹‹åçš„ä»£ç 
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    return (
</span></span><span style=display:flex><span>        &lt;div className=&#39;full-screen&#39;&gt;
</span></span><span style=display:flex><span>            &lt;canvas ref={canvasRef} className=&#39;full-screen&#39; /&gt;
</span></span><span style=display:flex><span>            &lt;DatGUI data={date} onUpdate={handleGUIUpdate} className=&#39;dat-gui&#39; &gt;
</span></span><span style=display:flex><span>                &lt;DatButton label=&#39;ç‚¹å‡»ä¿å­˜ç”»å¸ƒå¿«ç…§&#39; onClick={handleSaveClick} /&gt;
</span></span><span style=display:flex><span>            &lt;/DatGUI&gt;
</span></span><span style=display:flex><span>        &lt;/div&gt;
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>export default HelloCanvas
</span></span></code></pre></div><p><strong>è¡¥å……è¯´æ˜ï¼š</strong></p><ol><li><p>æ‰€æœ‰åˆ›å»º 3D åœºæ™¯çš„ä»£ç éƒ½è½¬ç§»åˆ°äº† use-create-scene.ts ä¸­ï¼Œindex.tsx çš„ä»£ç ç»ˆäºçœ‹ä¸Šå»éå¸¸ç®€æ´äº†ã€‚</p></li><li><p>æˆ‘ä»¬ä½¿ç”¨äº† &lt;DatGUI > æ ‡ç­¾ï¼Œä½†æ˜¯ç”±äºæˆ‘ä»¬æœ¬èº«åªä½¿ç”¨ æŒ‰é’®(&lt;DatButton >)ï¼Œå¹¶æœªç”¨åˆ°ä»»ä½•å…¶ä»–å˜é‡ï¼Œæ‰€ä»¥</p><p><code>&lt;DatGUI data={date} onUpdate={handleGUIUpdate} ></code>è¿™è¡Œå±æ€§é…ç½®åªæ˜¯ä¸ºäº†ä¸è®© DatGUI æŠ¥ç¼ºçœé”™è¯¯ï¼Œå¹¶æ— å…¶ä»–ä½œç”¨ã€‚</p><blockquote><p>DatGUI çš„ dateã€onUpdate ä¸ºå¿…å¡«å±æ€§</p></blockquote></li></ol><p>è‡³æ­¤ï¼Œæœ¬ç¤ºä¾‹æ‰€ç”¨åˆ°çš„åŸºç¡€åœºæ™¯ä»£ç å·²æ­å»ºå¥½ï¼Œæ¥ä¸‹æ¥å¼€å§‹è®²è§£ canvas çš„ä½¿ç”¨æŠ€å·§ã€‚</p><h2 id=åˆ›å»ºç”»å¸ƒæˆªå±å¿«ç…§å¹¶ä¿å­˜å›¾ç‰‡åˆ°æœ¬åœ°>åˆ›å»ºç”»å¸ƒæˆªå±(å¿«ç…§)ï¼Œå¹¶ä¿å­˜å›¾ç‰‡åˆ°æœ¬åœ°<a hidden class=anchor aria-hidden=true href=#åˆ›å»ºç”»å¸ƒæˆªå±å¿«ç…§å¹¶ä¿å­˜å›¾ç‰‡åˆ°æœ¬åœ°>#</a></h2><h3 id=å…ˆè¯´ä¸€ä¸‹å¦‚ä½•åˆ›å»ºç”»å¸ƒæˆªå±å¿«ç…§>å…ˆè¯´ä¸€ä¸‹å¦‚ä½•åˆ›å»ºç”»å¸ƒæˆªå±(å¿«ç…§)<a hidden class=anchor aria-hidden=true href=#å…ˆè¯´ä¸€ä¸‹å¦‚ä½•åˆ›å»ºç”»å¸ƒæˆªå±å¿«ç…§>#</a></h3><p>å¯¹äº HTML5 ä¸­çš„ canvas æ¥è¯´ï¼Œåˆ›å»ºç”»å¸ƒæˆªå±(å¿«ç…§)æœ‰ 2 ç§æ–¹å¼ï¼šcanvas.toDataURL()ã€canvas.toBolb()</p><blockquote><p>æ‰€è°“æˆªå±å’Œå¿«ç…§ï¼Œæ›´åŠ å‡†ç¡®çš„è¯´æ³•åº”è¯¥æ˜¯ï¼šè·å–ç”»å¸ƒå½“å‰å›¾ç‰‡çš„å†…å®¹</p></blockquote><h4 id=ç¬¬1ç§canvastodataurl>ç¬¬1ç§ï¼šcanvas.toDataURL()<a hidden class=anchor aria-hidden=true href=#ç¬¬1ç§canvastodataurl>#</a></h4><p>canvas.toDataURL() å¯ä»¥åˆ›å»ºä¸€ä¸ªä¸´æ—¶çš„å›¾ç‰‡åœ°å€ï¼Œè¯¥å›¾ç‰‡åœ°å€å¯ä»¥ä½œä¸ºå½“å‰é¡µé¢ä¸­çš„ &lt;image >æ ‡ç­¾ä¸­çš„ src å±æ€§å€¼ã€‚æˆ–è€…å¯ä»¥åˆ›å»ºä¸€ä¸ªä¸‹è½½é“¾æ¥ï¼Œç‚¹å‡»ä¸‹è½½è¿™ä¸ªå›¾ç‰‡ã€‚</p><p><strong>toDataURL()ç”¨æ³•ï¼š</strong></p><div class=highlight><pre tabindex=0 style=color:#3c3836;background-color:#fbf1c7;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>canvas.toDataURL(type?: string, quality?: any): string;
</span></span></code></pre></div><ol><li><p>typeï¼šå›¾ç‰‡æ ¼å¼ç±»å‹ï¼Œå€¼åªèƒ½æ˜¯ &ldquo;image/png&rdquo; æˆ– &ldquo;image/jpeg&rdquo;</p><blockquote><p>é™¤äº†ä¸Šé¢ 2 ä¸ªå›ºå®šå€¼ï¼Œè‹¥ä½ å¡«å†™å…¶ä»–å€¼åˆ™ä¸å¯ä½œç”¨ä¹Ÿä¸æŠ¥é”™ï¼Œæœ€ç»ˆä¼šä½¿ç”¨ &ldquo;image/png&rdquo; æ¥ä½œä¸ºé»˜è®¤å€¼</p></blockquote><blockquote><p>å¯¹äº è°·æ­Œæµè§ˆå™¨ Chrome ï¼Œè¿˜é¢å¤–æ”¯æŒä¸€ä¸ªç±»å‹ â€œimage/webpâ€</p></blockquote></li><li><p>qualityï¼šjpeg å›¾ç‰‡çš„å‹ç¼©è´¨é‡ï¼Œå–å€¼èŒƒå›´ 0 - 1ï¼Œé»˜è®¤å€¼ä¸º 0.92</p><blockquote><p>quality çš„å€¼è¶Šå¤§ï¼Œå›¾ç‰‡æ¸…æ™°åº¦è¶Šé«˜ï¼Œæ–‡ä»¶ä½“ç§¯è¶Šå¤§</p></blockquote><blockquote><p>å¦‚æœ quality çš„å€¼ä¸åœ¨ 0-1 èŒƒå›´å†…ï¼Œåˆ™ä¼šä½¿ç”¨é»˜è®¤å€¼ 0.92</p></blockquote></li></ol><p><strong>åˆ›å»º PNG å›¾ç‰‡ï¼š</strong></p><div class=highlight><pre tabindex=0 style=color:#3c3836;background-color:#fbf1c7;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>const imgurl = canvas.toDataURL(&#39;image/png&#39;)
</span></span><span style=display:flex><span>console.log(imgurl)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>//è¾“å‡ºä»¥ä¸‹å†…å®¹
</span></span><span style=display:flex><span>data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAB4AAAAEUCAYAAADK...
</span></span></code></pre></div><p><strong>åˆ›å»º JPEG å›¾ç‰‡ï¼š</strong></p><div class=highlight><pre tabindex=0 style=color:#3c3836;background-color:#fbf1c7;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>const imgurl = canvas.toDataURL(&#39;image/jpeg&#39;,quality)
</span></span><span style=display:flex><span>console.log(imgurl)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>//è¾“å‡ºä»¥ä¸‹å†…å®¹
</span></span><span style=display:flex><span>data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAYEBQY...
</span></span></code></pre></div><blockquote><p>è¯·æ³¨æ„ä¸Šé¢è¾“å‡ºå†…å®¹ä¸­ï¼Œå‡åŒ…å«äº† â€base64â€œï¼Œè¿™ç§æ ¼å¼çš„å›¾ç‰‡ï¼Œæ˜¯å¯ä»¥è‡ªåŠ¨ä¸‹è½½çš„</p><p>å…³äºå›¾ç‰‡è‡ªåŠ¨ä¸‹è½½ä¿å­˜åˆ°æœ¬åœ°æˆ‘ä»¬ä¼šç¨åè®²è§£</p></blockquote><h4 id=ç¬¬2ç§canvastoblob>ç¬¬2ç§ï¼šcanvas.toBlob()<a hidden class=anchor aria-hidden=true href=#ç¬¬2ç§canvastoblob>#</a></h4><p>canvas.toBlob() å¯ä»¥åˆ›å»º Blob å¯¹è±¡ï¼Œè¯¥å¯¹è±¡åŒ…å«å›¾ç‰‡çš„æ•°æ®å†…å®¹ã€‚</p><blockquote><p>æ³¨æ„ï¼šcanvas.toDataURL() æ˜¯è·å¾—ä¸€ä¸ªä¸´æ—¶çš„å›¾ç‰‡åœ°å€ï¼Œè€Œ canvas.toBlob() æ˜¯è·å¾—å›¾ç‰‡æ•°æ®å†…å®¹ã€‚</p></blockquote><p><strong>canvas.toBlob()ç”¨æ³•ï¼š</strong></p><div class=highlight><pre tabindex=0 style=color:#3c3836;background-color:#fbf1c7;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>toBlob(callback: BlobCallback, type?: string, quality?: any): void;
</span></span></code></pre></div><ol><li><p>callbackï¼šè·å¾— Blob å¯¹è±¡çš„å›è°ƒå‡½æ•°</p><blockquote><p>é€šå¸¸ä¸ºï¼šcanvas.toBlob( (blob: Blob|null) => {} )</p></blockquote></li><li><p>typeï¼šå›¾ç‰‡çš„æ ¼å¼ç±»å‹ï¼Œé»˜è®¤å€¼ä¸º &ldquo;image/png&rdquo;</p></li><li><p>qualityï¼šè‹¥å›¾ç‰‡æ ¼å¼ç±»å‹ä¸º &ldquo;image/jpeg&rdquo;ï¼Œquality è¡¨ç¤º JPEG çš„å‹ç¼©è´¨é‡</p><blockquote><p>type çš„å–å€¼å’Œé»˜è®¤å€¼ã€quality çš„å–å€¼èŒƒå›´å’Œé»˜è®¤å€¼ ä¸ canvas.toDataURL() å®Œå…¨ç›¸åŒ</p></blockquote></li></ol><p><strong>ä½¿ç”¨ç¤ºä¾‹ï¼š</strong></p><div class=highlight><pre tabindex=0 style=color:#3c3836;background-color:#fbf1c7;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>canvas.toBlob((blob) =&gt; {
</span></span><span style=display:flex><span>    console.log(blob)
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>æˆ–
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>canvas.toBlob((blob) =&gt; {
</span></span><span style=display:flex><span>    console.log(blob)
</span></span><span style=display:flex><span>}, &#39;image/jpeg&#39;, 0.8)
</span></span></code></pre></div><blockquote><p>æ³¨æ„ï¼šä¸åŒäº canvas.toDataURL()ï¼Œcanvas.toBlob() è¿™ä¸ªå‡½æ•°æ˜¯æ²¡æœ‰è¿”å›å€¼çš„</p></blockquote><blockquote><p>å¦å¤–ï¼Œå‡è®¾ä½¿ç”¨ jpeg å‹ç¼©è´¨é‡ä¸º 0.8ï¼Œæ–‡ä»¶ä½“ç§¯æœ‰å¯èƒ½åªæœ‰ png æ ¼å¼çš„ 1/3 ã€‚</p></blockquote><h4 id=è¡¥å……è¯´æ˜>è¡¥å……è¯´æ˜<a hidden class=anchor aria-hidden=true href=#è¡¥å……è¯´æ˜>#</a></h4><p><strong>å…³äºåˆ†è¾¨ç‡ï¼š</strong></p><p>æŒ‰ç…§ MDN æ–‡æ¡£ï¼Œæ— è®ºå“ªç§æ–¹å¼ä¿å­˜çš„å›¾ç‰‡åˆ†è¾¨ç‡éƒ½æ˜¯ 96ï¼Œä½†æ˜¯æˆ‘åœ¨ PC æœºä¸Šè¯•éªŒï¼Œå°†ä¸‹è½½çš„å›¾ç‰‡ä¿å­˜åˆ°æœ¬åœ°ï¼Œå¹¶åœ¨ PhotoShop è½¯ä»¶ä¸­æŸ¥çœ‹ï¼Œå‘ç°å›¾ç‰‡åˆ†è¾¨ç‡ä¾ç„¶æ˜¯ 72ã€‚</p><p>æˆ‘æ€€ç–‘ ä¿å­˜å›¾ç‰‡çš„åˆ†è¾¨ç‡å…¶å®æ˜¯å’Œ å½“å‰ç³»ç»Ÿä¸€è‡´çš„ã€‚å‡è®¾åœ¨æ‰‹æœºä¸Šï¼Œæœ‰å¯èƒ½å›¾ç‰‡åˆ†è¾¨ç‡å°±æ˜¯ 96 äº†ã€‚</p><blockquote><p>ç¨åæˆ‘ä¼šåœ¨æ‰‹æœºä¸ŠéªŒè¯ä¸€ä¸‹ å›¾ç‰‡åˆ†è¾¨ç‡ è¿™ä¸ªé—®é¢˜ã€‚</p></blockquote><p>æœ€åï¼Œå»ºè®®ä½ å» MDN ä¸Šçœ‹ canvas ä¿å­˜å›¾ç‰‡ çš„ç›¸å…³è®²è§£ä½œä¸ºæœ¬å°èŠ‚çš„è¡¥å……ã€‚</p><p><a href=https://developer.mozilla.org/zh-CN/docs/Web/API/Canvas_API/Tutorial/Pixel_manipulation_with_canvas>https://developer.mozilla.org/zh-CN/docs/Web/API/Canvas_API/Tutorial/Pixel_manipulation_with_canvas</a></p><h3 id=å†è¯´ä¸€ä¸‹å¦‚ä½•è‡ªåŠ¨å°†å›¾ç‰‡ä¸‹è½½åˆ°æœ¬åœ°>å†è¯´ä¸€ä¸‹å¦‚ä½•è‡ªåŠ¨å°†å›¾ç‰‡ä¸‹è½½åˆ°æœ¬åœ°<a hidden class=anchor aria-hidden=true href=#å†è¯´ä¸€ä¸‹å¦‚ä½•è‡ªåŠ¨å°†å›¾ç‰‡ä¸‹è½½åˆ°æœ¬åœ°>#</a></h3><p><strong>å›¾ç‰‡è‡ªåŠ¨ä¸‹è½½åˆ°æœ¬åœ°çš„æ€è·¯ï¼šåœ¨JSä¸­åˆ›å»ºä¸€ä¸ª a é“¾æ¥ï¼Œå¹¶ä¸”æ¨¡æ‹Ÿå‡º a ç‚¹å‡»äº‹ä»¶</strong></p><p><strong>ä½¿ç”¨toDataURL()å‡½æ•°ï¼š</strong></p><div class=highlight><pre tabindex=0 style=color:#3c3836;background-color:#fbf1c7;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>const canvas = canvasRef.current
</span></span><span style=display:flex><span>const imgurl = canvas.toDataURL(&#39;image/jpeg&#39;, 0.8)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>const a = document.createElement(&#39;a&#39;)
</span></span><span style=display:flex><span>a.href = imgurl
</span></span><span style=display:flex><span>a.download = &#39;myimg.jpeg&#39;
</span></span><span style=display:flex><span>a.click()
</span></span></code></pre></div><blockquote><p>æ³¨æ„ï¼šæˆ‘åŸæœ¬ä»¥ä¸ºè¿˜éœ€è¦å°† a æ ‡ç­¾æ’å…¥åˆ°ç½‘é¡µ body ä¸­æ‰å¯ä»¥å®ç°è‡ªåŠ¨ä¸‹è½½ï¼Œä½†æ˜¯ç»è¿‡è¯•éªŒå‘ç°æ ¹æœ¬ä¸éœ€è¦è¿™æ ·ï¼Œä»¥ä¸‹ä¸ºæˆ‘åŸæœ¬å†™çš„ä»£ç ï¼š</p><div class=highlight><pre tabindex=0 style=color:#3c3836;background-color:#fbf1c7;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>const a = document.createElement(&#39;a&#39;)
</span></span><span style=display:flex><span>document.body.appendChild(a) //æ ¹æœ¬æ— éœ€æ­¤è¡Œä»£ç 
</span></span><span style=display:flex><span>a.style.display = &#39;none&#39; //ç”±äºä¸éœ€è¦æ·»åŠ åˆ° body ä¸­ï¼Œå› æ­¤ä¹Ÿæ— éœ€æ­¤è¡Œä»£ç 
</span></span><span style=display:flex><span>a.href = imgurl
</span></span><span style=display:flex><span>a.download = &#39;myimg.jpeg&#39;
</span></span><span style=display:flex><span>a.click()
</span></span><span style=display:flex><span>document.body.removeChild(a) //æ ¹æœ¬æ— éœ€æ­¤è¡Œä»£ç 
</span></span></code></pre></div></blockquote><p><strong>ä½¿ç”¨toBlob()å‡½æ•°ï¼š</strong></p><div class=highlight><pre tabindex=0 style=color:#3c3836;background-color:#fbf1c7;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>const canvas = canvasRef.current
</span></span><span style=display:flex><span>canvas.toBlob((blob) =&gt; {
</span></span><span style=display:flex><span>    const imgurl = window.URL.createObjectURL(blob)
</span></span><span style=display:flex><span>    const a = document.createElement(&#39;a&#39;)
</span></span><span style=display:flex><span>    a.href = imgurl
</span></span><span style=display:flex><span>    a.download = &#39;myimg.jpeg&#39;
</span></span><span style=display:flex><span>    a.click()
</span></span><span style=display:flex><span>}, &#39;image/jpeg&#39;, 0.8)
</span></span></code></pre></div><p><strong>å°æ€»ç»“ï¼š</strong></p><ol><li>è‹¥ä½¿ç”¨ canvas.toDataURL()ï¼Œåˆ™å¯ä»¥ç›´æ¥å°†å¾—åˆ°çš„å›¾ç‰‡ä¸´æ—¶åœ°å€ èµ‹å€¼ç»™ a.href</li><li>è‹¥ä½¿ç”¨ canvas.toBlob()ï¼Œåˆ™éœ€è¦é€šè¿‡ window.URL.createObjectURL() è¿™ä¸ªå‡½æ•°å°† Blob æ•°æ®è½¬åŒ–å¾—åˆ°å¯¹åº”çš„åœ°å€ï¼Œç„¶åå†èµ‹å€¼ç»™ a.href</li></ol><p>å¥½äº†ï¼Œå…³äºå¦‚ä½•è·å–ç”»å¸ƒå›¾ç‰‡æ•°æ®ã€å¦‚ä½•ä¿æŒå›¾ç‰‡åˆ°æœ¬åœ°è®²è§£å®Œæ¯•ï¼Œæ¥å®è·µå§ã€‚</p><p>æ— è®ºé‡‡ç”¨ canvas.toDataURL() è¿˜æ˜¯ canvas.toBlob() éƒ½å¯ä»¥ï¼Œæœ¬ç¤ºä¾‹æˆ‘ä»¬é‡‡ç”¨ toBlob() ã€‚</p><p>æˆ‘ä»¬å°† index.stx çš„ä»£ç ä¿®æ”¹å¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#3c3836;background-color:#fbf1c7;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>import { useRef, useState } from &#39;react&#39;
</span></span><span style=display:flex><span>import DatGUI, { DatButton } from &#39;react-dat-gui&#39;
</span></span><span style=display:flex><span>import useCreateScene from &#39;./use-create-scene&#39;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>import &#39;./index.scss&#39;
</span></span><span style=display:flex><span>import &#39;react-dat-gui/dist/index.css&#39;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>const HelloCanvas = () =&gt; {
</span></span><span style=display:flex><span>    const canvasRef = useRef&lt;HTMLCanvasElement&gt;(null)
</span></span><span style=display:flex><span>    const [date, setDate] = useState&lt;any&gt;({})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    useCreateScene(canvasRef)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    const handleGUIUpdate = (newDate: any) =&gt; {
</span></span><span style=display:flex><span>        setDate(newDate)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    const handleSaveClick = () =&gt; {
</span></span><span style=display:flex><span>        if (canvasRef.current === null) { return }
</span></span><span style=display:flex><span>        const canvas = canvasRef.current
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        //é‡‡ç”¨ toDataURL() æ–¹å¼
</span></span><span style=display:flex><span>        // const imgurl = canvas.toDataURL(&#39;image/jpeg&#39;, 0.8)
</span></span><span style=display:flex><span>        // const a = document.createElement(&#39;a&#39;)
</span></span><span style=display:flex><span>        // a.href = imgurl
</span></span><span style=display:flex><span>        // a.download = &#39;myimg.jpeg&#39; //æˆ‘ä»¬å®šä¹‰ä¸‹è½½å›¾ç‰‡çš„æ–‡ä»¶å
</span></span><span style=display:flex><span>        // a.click()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        //é‡‡ç”¨ toBlob() æ–¹å¼
</span></span><span style=display:flex><span>        canvas.toBlob((blob) =&gt; {
</span></span><span style=display:flex><span>            const imgurl = window.URL.createObjectURL(blob)
</span></span><span style=display:flex><span>            const a = document.createElement(&#39;a&#39;)
</span></span><span style=display:flex><span>            a.href = imgurl
</span></span><span style=display:flex><span>            a.download = &#39;myimg.jpeg&#39;
</span></span><span style=display:flex><span>            a.click()
</span></span><span style=display:flex><span>        }, &#39;image/jpeg&#39;, 0.8)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    return (
</span></span><span style=display:flex><span>        &lt;div className=&#39;full-screen&#39;&gt;
</span></span><span style=display:flex><span>            &lt;canvas ref={canvasRef} className=&#39;full-screen&#39; /&gt;
</span></span><span style=display:flex><span>            &lt;DatGUI data={date} onUpdate={handleGUIUpdate} className=&#39;dat-gui&#39; &gt;
</span></span><span style=display:flex><span>                &lt;DatButton label=&#39;ç‚¹å‡»ä¿å­˜ç”»å¸ƒå¿«ç…§&#39; onClick={handleSaveClick} /&gt;
</span></span><span style=display:flex><span>            &lt;/DatGUI&gt;
</span></span><span style=display:flex><span>        &lt;/div&gt;
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>export default HelloCanvas
</span></span></code></pre></div><p>å®é™…è¿è¡Œï¼Œç‚¹å‡»å³ä¸Šè§’çš„ æŒ‰é’®ï¼Œå°±ä¼šç»™ç”»å¸ƒåˆ›å»ºå›¾ç‰‡å¿«ç…§ï¼Œå¹¶ä¸”è‡ªåŠ¨ä¸‹è½½åˆ°æœ¬åœ°ã€‚</p><p>ç„¶åä½ å¯ä»¥æŸ¥çœ‹åˆšåˆšä¸‹è½½åˆ°æœ¬åœ°çš„ myimg.jpeg è¿™ä¸ªæ–‡ä»¶ï¼Œæ‰“å¼€å®ƒâ€”â€”ä½ ä¼šå‘ç°ï¼Ÿï¼Ÿï¼Ÿ</p><p><strong>æ€ä¹ˆå›¾ç‰‡å•¥å†…å®¹éƒ½æ²¡æœ‰ï¼Ÿçº¯è‰²çš„ï¼Ÿ3 ä¸ªç«‹æ–¹ä½“å‘¢ï¼Ÿ</strong></p><p><strong>what ï¼Ÿwhy ï¼Ÿ</strong></p><p>å‘µï¼Œé©¬ä¸Šè®²è§£ä¸ºä»€ä¹ˆã€‚</p><p><strong>é—®é¢˜å‡ºåœ¨äº†å“ªé‡Œï¼Ÿ</strong></p><p>é¦–å…ˆæˆ‘ä»¬å®¹æ˜“æƒ³åˆ°ï¼Œåœ¨ use-create-scene.ts çš„ render() å‡½æ•°ä¸­ï¼Œä¸åœçš„è¿è¡Œç€æ¯ä¸€å¸§éƒ½è¿›è¡Œç”»å¸ƒé‡æ–°æ¸²æŸ“çš„ä»£ç ï¼Œè«éæ˜¯æˆ‘ä»¬æˆªå›¾é‚£ä¸€ç¬é—´åˆšå¥½ç”»å¸ƒè¿˜æœªæ¸²æŸ“å®Œæˆï¼Ÿ</p><p>å¥½ï¼Œæˆ‘ä»¬å…ˆæŠŠé‚£è¡Œä»£ç åˆ é™¤æ‰ï¼Œçœ‹æ˜¯å¦å°±å¯ä»¥æˆªå›¾æ˜¾ç¤ºæœ‰å†…å®¹äº†ã€‚</p><div class=highlight><pre tabindex=0 style=color:#3c3836;background-color:#fbf1c7;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-diff data-lang=diff><span style=display:flex><span>const render = (time: number) =&gt; {
</span></span><span style=display:flex><span>    time *= 0.001
</span></span><span style=display:flex><span>    cubes.forEach((cube) =&gt; {
</span></span><span style=display:flex><span>        cube.rotation.x = cube.rotation.y = time
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>    renderer.render(scene, camera)
</span></span><span style=display:flex><span><span style=color:#282828;background-color:#9d0006>-   window.requestAnimationFrame(render)
</span></span></span><span style=display:flex><span><span style=color:#282828;background-color:#9d0006></span>}
</span></span><span style=display:flex><span>window.requestAnimationFrame(render)
</span></span></code></pre></div><p>å†æ¬¡è¿è¡Œï¼Œ3 ä¸ªç«‹æ–¹ä½“æ˜¯é™æ­¢çŠ¶æ€ï¼Œæ­¤æ—¶ç‚¹å‡»æŒ‰é’®ä¿å­˜æˆªå›¾ã€‚</p><p>æŸ¥çœ‹è¯¥å›¾ï¼Œç«Ÿç„¶ä¾ç„¶æ˜¯ç©ºç™½ï¼Œæ²¡æœ‰å†…å®¹çš„ã€‚</p><p>çœ‹æ¥é—®é¢˜å¹¶ä¸å‡ºåœ¨ä¸Šé¢ä¸€è¡Œä»£ç ä¸­ï¼Œæˆ‘ä»¬æ¢å¤åˆšæ‰åˆ é™¤çš„ <code>window.requestAnimationFrame(render)</code>ï¼Œå†å»æƒ³å…¶ä»–åŸå› ã€‚</p><p><strong>çœŸå®çš„åŸå› æ˜¯ï¼š</strong></p><ol><li>æˆ‘ä»¬æ‰€è°“çš„é’ˆå¯¹ç”»å¸ƒæˆªå± åˆ›å»ºå¿«ç…§ï¼Œå®é™…ä¸Šæ˜¯è·å– canvas ä¸­çš„æ•°æ®</li><li>ä½†è¿™ä¸ªæ•°æ®å¹¶ä¸æ˜¯é’ˆå¯¹ DOM ä¸­å·²æ˜¾ç¤ºçš„ canvasï¼Œè€Œæ˜¯é’ˆå¯¹ canvas å¯¹è±¡ä¸­ç¼“å†²åŒºçš„æ•°æ®</li><li>å…³é”®åœ¨äºå½“ canvas æ¸²æŸ“å®Œæˆå(DOMä¸­å·²æ˜¾ç¤ºå‡ºå†…å®¹)ï¼Œé»˜è®¤ä¼šæ¸…ç©º ç¼“å†²åŒºä¸­çš„æ•°æ®</li><li>æ‰€ä»¥ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬ä¸ºä»€ä¹ˆå» â€œè·å– canvas å›¾åƒæ•°æ®æ—¶å¾—åˆ°æ˜¯ç©ºç™½å†…å®¹â€ çš„åŸå› </li></ol><p><strong>canvasä»è®¡ç®—åˆ°æ˜¾ç¤ºçš„è¿‡ç¨‹ï¼š</strong></p><ol><li>canvas æ ¹æ®ç›¸åº”çš„ JS è§„åˆ™ï¼Œå¼€å§‹åˆ›å»ºã€è®¡ç®—ç”»å¸ƒå†…å®¹æ•°æ®</li><li>canvas å°†è®¡ç®—å¾—åˆ°çš„ç”»å¸ƒå†…å®¹æ•°æ®å¡«å……åˆ° canvas ç¼“å†²åŒº</li><li>å½“ canvas ç”»å¸ƒå†…å®¹è®¡ç®—å®Œæˆï¼Œæ­¤æ—¶ canvas ç¼“å†²åŒºå·²æœ‰å®Œæ•´çš„ç”»å¸ƒå†…å®¹æ•°æ®åï¼Œå°†ç”»å¸ƒå†…å®¹æ˜¾ç¤ºåˆ° DOM ä¸­</li></ol><p><strong>å†è¯´ä¸€éï¼š</strong></p><p>æˆ‘ä»¬ä¹‹å‰çš„ç¤ºä¾‹ä¸­ï¼Œæ¸²æŸ“å¹¶æ˜¾ç¤º canvas å†…å®¹çš„å‡½æ•° render å’Œ åˆ›å»ºç”»å¸ƒå¿«ç…§ çš„å‡½æ•°æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œè¿™å°±é€ æˆäº†å½“æˆ‘ä»¬å»è·å– canvas ç¼“å†²åŒºæ•°æ®æ—¶ï¼Œcanvas å·²ç»å°†ç”»å¸ƒå†…å®¹æ˜¾ç¤ºåˆ° DOM ä¸­å¹¶ä¸”æ¸…ç©ºäº†ç¼“å†²åŒºã€‚</p><p><strong>è§£å†³åŠæ³•ï¼š</strong></p><p>è§£å†³åŠæ³•å°±æ˜¯å½“æˆ‘ä»¬è¦åˆ›å»ºç”»å¸ƒå¿«ç…§ï¼Œè·å– canvas ç¼“å†²åŒºå†…å®¹ä¹‹å‰ï¼Œåœ¨åŒä¸€ä¸ªå‡½æ•°ä½“å†…ï¼Œé¢å¤–è°ƒç”¨ä¸€æ¬¡ render å‡½æ•°ï¼Œç¡®ä¿æ­¤æ—¶ canvas ç¼“å†²åŒºå†…æ˜¯æœ‰å†…å®¹çš„ã€‚</p><p><strong>å®é™…ä»£ç ï¼š</strong></p><p>ç¬¬1ï¼šç”±äºæˆ‘ä»¬ç¤ºä¾‹ä»£ç ä¸­ï¼Œrender å‡½æ•°æœ¬èº«ä½äº useCreateScene å‡½æ•°å†…éƒ¨ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦åˆ›é€ ä¸€ä¸ª renderRef çš„é’©å­(hook)ï¼Œå°† renderRef å¯¹å¤– return å‡ºå»ï¼Œä»¥ä¾¿ index.stx ä¸­å¯ä»¥è·å– render å‡½æ•°çš„å¼•ç”¨ã€‚</p><div class=highlight><pre tabindex=0 style=color:#3c3836;background-color:#fbf1c7;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>type RenderType = () =&gt; void
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>const renderRef = useRef&lt;RenderType | null&gt;(null)
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>renderRef.current = render
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>return renderRef
</span></span></code></pre></div><p>ç¬¬2ï¼šè¿™æ ·åšå¼•ç”³å‡ºå¦å¤–ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯æˆ‘ä»¬çš„ render å‡½æ•°å…¶å®æ˜¯æœ‰å‚æ•° time çš„ï¼š</p><div class=highlight><pre tabindex=0 style=color:#3c3836;background-color:#fbf1c7;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>const render = (time: number) =&gt; {
</span></span><span style=display:flex><span>    time *= 0.001
</span></span><span style=display:flex><span>    cubes.forEach((cube) =&gt; {
</span></span><span style=display:flex><span>        cube.rotation.x = cube.rotation.y = time
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>    renderer.render(scene, camera)
</span></span><span style=display:flex><span>    window.requestAnimationFrame(render)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>window.requestAnimationFrame(render)
</span></span></code></pre></div><p>è€Œæˆ‘ä»¬å¸Œæœ› index.tsx ä¸­è°ƒç”¨ render() æ˜¯ä¸ä¼ å‚æ•° time çš„ã€‚å› ä¸º index.tsx ä¸­æ ¹æœ¬ä¸å­˜åœ¨ time è¿™ä¸ªå˜é‡ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å¯¹ æ¸²æŸ“ è¿›è¡Œé€‚å½“çš„æ”¹é€ ã€‚</p><p>æˆ‘ä»¬å°†åŸæœ¬çš„ æ¸²æŸ“å‡½æ•° render() æ‹†åˆ†æˆ 2 ä¸ªå‡½æ•°ï¼š</p><ol><li>å•çº¯è´Ÿè´£æ¸²æŸ“çš„ render å‡½æ•°</li><li>è´Ÿè´£ä¿®æ”¹ç‰©ä½“å±æ€§ä»è€Œäº§ç”ŸåŠ¨ç”»çš„ animate å‡½æ•°</li></ol><div class=highlight><pre tabindex=0 style=color:#3c3836;background-color:#fbf1c7;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>const render = () =&gt; {
</span></span><span style=display:flex><span>    renderer.render(scene, camera)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>renderRef.current = render
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>const animate = (time: number) =&gt; {
</span></span><span style=display:flex><span>    time *= 0.001
</span></span><span style=display:flex><span>    cubes.forEach((cube) =&gt; {
</span></span><span style=display:flex><span>        cube.rotation.x = cube.rotation.y = time
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>    render() //è¿™æ · render() å°±æ˜¯ä¸€ä¸ªä¸éœ€è¦å‚æ•°çš„å‡½æ•°
</span></span><span style=display:flex><span>    window.requestAnimationFrame(animate)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>window.requestAnimationFrame(animate)
</span></span></code></pre></div><p>ç»è¿‡è¿™æ ·æ”¹é€ åï¼Œå®Œæ•´çš„ use-create-screen.ts ä»£ç å¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#3c3836;background-color:#fbf1c7;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>import { useEffect, useRef } from &#39;react&#39;
</span></span><span style=display:flex><span>import * as Three from &#39;three&#39;
</span></span><span style=display:flex><span>import { OrbitControls } from &#39;three/examples/jsm/controls/OrbitControls&#39;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>type RenderType = () =&gt; void
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>const useCreateScene = (canvasRef: React.RefObject&lt;HTMLCanvasElement&gt;) =&gt; {
</span></span><span style=display:flex><span>    const renderRef = useRef&lt;RenderType | null&gt;(null)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    useEffect(() =&gt; {
</span></span><span style=display:flex><span>        if (canvasRef.current === null) { return }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        const renderer = new Three.WebGLRenderer({ canvas: canvasRef.current })
</span></span><span style=display:flex><span>        const scene = new Three.Scene()
</span></span><span style=display:flex><span>        scene.background = new Three.Color(0x222222)
</span></span><span style=display:flex><span>        const camera = new Three.PerspectiveCamera(45, 2, 0.1, 100)
</span></span><span style=display:flex><span>        camera.position.set(0, 5, 10)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        const light = new Three.DirectionalLight(0xFFFFFF, 1)
</span></span><span style=display:flex><span>        light.position.set(5, 10, 0)
</span></span><span style=display:flex><span>        scene.add(light)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        const controls = new OrbitControls(camera, canvasRef.current)
</span></span><span style=display:flex><span>        controls.update()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        const colors = [&#39;blue&#39;, &#39;red&#39;, &#39;green&#39;]
</span></span><span style=display:flex><span>        const cubes: Three.Mesh[] = []
</span></span><span style=display:flex><span>        colors.forEach((color, index) =&gt; {
</span></span><span style=display:flex><span>            const mat = new Three.MeshPhongMaterial({ color })
</span></span><span style=display:flex><span>            const geo = new Three.BoxBufferGeometry(2, 2, 2)
</span></span><span style=display:flex><span>            const mesh = new Three.Mesh(geo, mat)
</span></span><span style=display:flex><span>            mesh.position.x = (index - 1) * 4
</span></span><span style=display:flex><span>            scene.add(mesh)
</span></span><span style=display:flex><span>            cubes.push(mesh)
</span></span><span style=display:flex><span>        })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        const render = () =&gt; {
</span></span><span style=display:flex><span>            renderer.render(scene, camera)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        renderRef.current = render
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        const animate = (time: number) =&gt; {
</span></span><span style=display:flex><span>            time *= 0.001
</span></span><span style=display:flex><span>            cubes.forEach((cube) =&gt; {
</span></span><span style=display:flex><span>                cube.rotation.x = cube.rotation.y = time
</span></span><span style=display:flex><span>            })
</span></span><span style=display:flex><span>            render() //è¿™æ · render() å°±æ˜¯ä¸€ä¸ªä¸éœ€è¦å‚æ•°çš„å‡½æ•°
</span></span><span style=display:flex><span>            window.requestAnimationFrame(animate)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        window.requestAnimationFrame(animate)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        const handleResize = () =&gt; {
</span></span><span style=display:flex><span>            if (canvasRef.current === null) { return }
</span></span><span style=display:flex><span>            const width = canvasRef.current.clientWidth
</span></span><span style=display:flex><span>            const height = canvasRef.current.clientHeight
</span></span><span style=display:flex><span>            camera.aspect = width / height
</span></span><span style=display:flex><span>            camera.updateProjectionMatrix()
</span></span><span style=display:flex><span>            renderer.setSize(width, height, false)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        handleResize()
</span></span><span style=display:flex><span>        window.addEventListener(&#39;resize&#39;, handleResize)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        return () =&gt; {
</span></span><span style=display:flex><span>            window.removeEventListener(&#39;resize&#39;, handleResize)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }, [canvasRef])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    return renderRef
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>export default useCreateScene
</span></span></code></pre></div><p>index.tsx å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#3c3836;background-color:#fbf1c7;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>import { useRef, useState } from &#39;react&#39;
</span></span><span style=display:flex><span>import DatGUI, { DatButton } from &#39;react-dat-gui&#39;
</span></span><span style=display:flex><span>import useCreateScene from &#39;./use-create-scene&#39;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>import &#39;./index.scss&#39;
</span></span><span style=display:flex><span>import &#39;react-dat-gui/dist/index.css&#39;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>const HelloCanvas = () =&gt; {
</span></span><span style=display:flex><span>    const canvasRef = useRef&lt;HTMLCanvasElement&gt;(null)
</span></span><span style=display:flex><span>    const [date, setDate] = useState&lt;any&gt;({})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    const renderRef =  useCreateScene(canvasRef) //è·å–è‡ªå®šä¹‰ hook è¿”å›çš„ renderRef
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    const handleGUIUpdate = (newDate: any) =&gt; {
</span></span><span style=display:flex><span>        setDate(newDate)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    const handleSaveClick = () =&gt; {
</span></span><span style=display:flex><span>        if (canvasRef.current === null || renderRef.current === null) { return }
</span></span><span style=display:flex><span>        const canvas = canvasRef.current
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        renderRef.current() //æ­¤æ—¶è°ƒç”¨ render()ï¼Œè¿›è¡Œä¸€æ¬¡æ¸²æŸ“ï¼Œç¡®ä¿ canvas ç¼“å†²åŒºæœ‰æ•°æ®
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        //é‡‡ç”¨ toDataURL() æ–¹å¼
</span></span><span style=display:flex><span>        // const imgurl = canvas.toDataURL(&#39;image/jpeg&#39;, 0.8)
</span></span><span style=display:flex><span>        // const a = document.createElement(&#39;a&#39;)
</span></span><span style=display:flex><span>        // a.href = imgurl
</span></span><span style=display:flex><span>        // a.download = &#39;myimg.jpeg&#39; //æˆ‘ä»¬å®šä¹‰ä¸‹è½½å›¾ç‰‡çš„æ–‡ä»¶å
</span></span><span style=display:flex><span>        // a.click()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        //é‡‡ç”¨ toBlob() æ–¹å¼
</span></span><span style=display:flex><span>        canvas.toBlob((blob) =&gt; {
</span></span><span style=display:flex><span>            const imgurl = window.URL.createObjectURL(blob)
</span></span><span style=display:flex><span>            const a = document.createElement(&#39;a&#39;)
</span></span><span style=display:flex><span>            a.href = imgurl
</span></span><span style=display:flex><span>            a.download = &#39;myimg.jpeg&#39;
</span></span><span style=display:flex><span>            a.click()
</span></span><span style=display:flex><span>        }, &#39;image/jpeg&#39;, 0.8)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    return (
</span></span><span style=display:flex><span>        &lt;div className=&#39;full-screen&#39;&gt;
</span></span><span style=display:flex><span>            &lt;canvas ref={canvasRef} className=&#39;full-screen&#39; /&gt;
</span></span><span style=display:flex><span>            &lt;DatGUI data={date} onUpdate={handleGUIUpdate} className=&#39;dat-gui&#39; &gt;
</span></span><span style=display:flex><span>                &lt;DatButton label=&#39;ç‚¹å‡»ä¿å­˜ç”»å¸ƒå¿«ç…§&#39; onClick={handleSaveClick} /&gt;
</span></span><span style=display:flex><span>            &lt;/DatGUI&gt;
</span></span><span style=display:flex><span>        &lt;/div&gt;
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>export default HelloCanvas
</span></span></code></pre></div><p>è°ƒè¯•è¿è¡Œï¼Œè¿™æ¬¡ä¿å­˜çš„ç”»å¸ƒå¿«ç…§å›¾ç‰‡ï¼Œå°±ä¸ä¼šå†æ˜¯ç©ºç™½ï¼Œè€Œæ˜¯æœ‰å…·ä½“å†…å®¹äº†ã€‚</p><h2 id=è®¾ç½®ä¸æ¸…é™¤ç”»å¸ƒå†…å®¹>è®¾ç½®ä¸æ¸…é™¤ç”»å¸ƒå†…å®¹<a hidden class=anchor aria-hidden=true href=#è®¾ç½®ä¸æ¸…é™¤ç”»å¸ƒå†…å®¹>#</a></h2><p>ä¸Šé¢åˆšè®²åˆ° HTML5 ä¸­çš„ Canvas æ¯æ¬¡æ¸²æŸ“éƒ½å­˜åœ¨ä¸€ä¸ª æ•°æ®ç¼“å†²åŒºçš„æ¦‚å¿µï¼Œè€Œ Three.js çš„æ¸²æŸ“å™¨ WebGLRenderer ä¹ŸåŒæ ·å­˜åœ¨ æ•°æ®ç¼“å†²åŒº è¿™ä¸ªæ¦‚å¿µã€‚</p><p>WebGLRenderer ç¼“å†²åŒºå†…ä¸ºæ¯æ¬¡æ¸²æŸ“åœºæ™¯å¾—åˆ°çš„ç”»é¢æ•°æ®ï¼Œé»˜è®¤æƒ…å†µä¸‹æ¯ä¸€æ¬¡æ¸²æŸ“éƒ½ä¼šæ¸…ç©º(é‡Šæ”¾)ä¸Šä¸€æ¬¡çš„æ¸²æŸ“ç”»é¢æ•°æ®ã€‚</p><p>Canvas æ•°æ®ç¼“å†²åŒºæ¯æ¬¡æ¸…ç©º è¿™ä¸ªæˆ‘ä»¬æ²¡æœ‰åŠæ³•ä¿®æ”¹ï¼Œåªèƒ½è°ƒç”¨æ¸²æŸ“å‡½æ•°ï¼Œé‡æ–°æ¸²æŸ“ä¸€æ¬¡ã€‚</p><p>ä½†æ˜¯ WebGLRenderer çš„æ•°æ®ç¼“å†²åŒºå´æ˜¯å¯ä»¥é€šè¿‡è®¾ç½®è®©é»˜è®¤ä¸æ¸…é™¤çš„ã€‚</p><blockquote><p>æ‰€è°“ä¸æ¸…é™¤ä¸Šä¸€æ¬¡æ•°æ®ç¼“å†²åŒºçš„å†…å®¹ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯ä¿ç•™ä¸Šä¸€æ¬¡æ¸²æŸ“ç”»é¢å†…å®¹</p></blockquote><blockquote><p>æ‰€è°“ä¸æ¸…é™¤ç”»å¸ƒå†…å®¹ï¼Œæœ¬è´¨ä¸Šæ˜¯è®©æ¸²æŸ“å™¨ä¸æ¸…é™¤ä¹‹å‰çš„æ¸²æŸ“å†…å®¹</p></blockquote><p><strong>è®¾ç½® WebGLRenderer ä¿ç•™æ•°æ®ç¼“å†²åŒºä¸­çš„å†å²æ•°æ®ï¼š</strong></p><p>æˆ‘ä»¬åªéœ€è¦å°† WebGLRender çš„é…ç½®ä¿®æ”¹å¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#3c3836;background-color:#fbf1c7;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>const renderer = new Three.WebGLRenderer({
</span></span><span style=display:flex><span>    canvas: canvasRef.current,
</span></span><span style=display:flex><span>    preserveDrawingBuffer: true,
</span></span><span style=display:flex><span>    alpha: true
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span>renderer.autoClearColor = false
</span></span></code></pre></div><p>ç»è¿‡ä»¥ä¸Šçš„ä¿®æ”¹ä¹‹åï¼Œæ¯æ¬¡æ¸²æŸ“éƒ½ä¼šç»§ç»­ä¿ç•™ä¹‹å‰æ¸²æŸ“å†å²ç”»é¢ã€‚</p><p>è°ƒè¯•è¿è¡Œä»£ç ï¼Œä½ å°±èƒ½æ„Ÿå—åˆ°å’Œä¹‹å‰æ¸²æŸ“çš„ä¸ä¸€æ ·æ•ˆæœäº†ã€‚</p><p><strong>ä½†æ˜¯ï¼Œå­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼šå½“æµè§ˆå™¨çª—å£å°ºå¯¸æ”¹å˜åï¼Œç”±äºæ‰§è¡Œäº† renderer.setSize()ï¼Œåˆ™æ­¤æ—¶ æ¸²æŸ“å™¨ä¸­è¿‡å¾€çš„æ¸²æŸ“å†…å®¹å°†ä¼šè¢«æ¸…ç©ºã€‚</strong></p><blockquote><p>æ¸²æŸ“å™¨ä¸­çš„æ¸²æŸ“å†å²å†…å®¹è¢«æ¸…ç©ºåï¼Œç”»é¢å°±å¥½åƒç¬¬ä¸€æ¬¡åˆšå¼€å§‹é‚£æ ·ï¼Œé‡æ–°å¼€å§‹æ¸²æŸ“ã€‚</p></blockquote><blockquote><p>è¡¥å……è¯´æ˜ï¼šå½“ç”¨æˆ·åœ¨æ‰‹æœºä¸Šæµè§ˆæ—¶ï¼Œæ‰‹æœºä»ç«–å±å˜ä¸ºæ¨ªå±æ—¶ï¼Œä¹Ÿä¼šè§¦å‘é‡æ–°ç»˜åˆ¶ã€‚</p></blockquote><p><strong>çœŸæ­£çš„è§£å†³æ–¹æ¡ˆï¼šç¦»å±æ¸²æŸ“</strong></p><p>ä¾‹å¦‚ä½¿ç”¨ WebGLRenderTargetï¼Œå…·ä½“è¯·å›é¡¾æˆ‘ä»¬ä¹‹å‰è®²è§£çš„å†…å®¹ï¼š<a href=https://github.com/puxiao/threejs-tutorial/blob/main/15%20Three.js%E5%9F%BA%E7%A1%80%E4%B9%8B%E7%A6%BB%E5%B1%8F%E6%B8%B2%E6%9F%93.md>15 Three.jsåŸºç¡€ä¹‹ç¦»å±æ¸²æŸ“.md</a></p><h3 id=è¡¥å……ä¸€ä¸ªç¤ºä¾‹preservedrawingbuffer>è¡¥å……ä¸€ä¸ªç¤ºä¾‹ï¼šPreserveDrawingBuffer<a hidden class=anchor aria-hidden=true href=#è¡¥å……ä¸€ä¸ªç¤ºä¾‹preservedrawingbuffer>#</a></h3><p>src/components/hello-canvas/preserve-drawing-buffer.tsx</p><h4 id=ç¤ºä¾‹ç›®æ ‡>ç¤ºä¾‹ç›®æ ‡<a hidden class=anchor aria-hidden=true href=#ç¤ºä¾‹ç›®æ ‡>#</a></h4><ol><li>åˆ›å»ºä¸€ä¸ªç”± 6 ä¸ªç«‹æ–¹ä½“ï¼Œåšç›¸äº’ç¼ ç»•è¿åŠ¨çš„ä¸€ä¸ªç‰©ä½“</li><li>åˆ›å»ºä¸€ä¸ªæ­£äº¤é•œå¤´ OrthographicCamera</li><li>ç»™ canvas æ·»åŠ é¼ æ ‡æ»‘åŠ¨ç›‘å¬ã€ä»¥åŠ æ‰‹æŒ‡æ»‘åŠ¨ç›‘å¬</li><li>å½“ é¼ æ ‡æˆ–æ‰‹æŒ‡æ»‘åŠ¨ç”»å¸ƒæ—¶ï¼Œæ›´æ–° ç‰©ä½“ åœ¨é•œå¤´ä¸­çš„ä½ç½®</li><li>è®¾ç½®æ¸²æŸ“å™¨ä¸æ¸…é™¤å†å²ç”»é¢</li></ol><p>æœ€ç»ˆå‘ˆç°å‡ºçš„æ•ˆæœï¼šç±»ä¼¼ä¸€ä¸ª ç”»ç¬”åœ¨ç”»æ¿ä¸Š ç”»ç”» çš„æ•ˆæœã€‚</p><p><strong>PreserveDrawingBuffer ä»£ç ï¼š</strong></p><div class=highlight><pre tabindex=0 style=color:#3c3836;background-color:#fbf1c7;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>import { useEffect, useRef } from &#39;react&#39;
</span></span><span style=display:flex><span>import * as Three from &#39;three&#39;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>import &#39;./index.scss&#39;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>const state = { x: 0, y: 0, z: 0 }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>const PreserveDrawingBuffer = () =&gt; {
</span></span><span style=display:flex><span>    const canvasRef = useRef&lt;HTMLCanvasElement | null&gt;(null)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    useEffect(() =&gt; {
</span></span><span style=display:flex><span>        if (canvasRef.current === null) { return }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        const renderer = new Three.WebGLRenderer({
</span></span><span style=display:flex><span>            canvas: canvasRef.current,
</span></span><span style=display:flex><span>            preserveDrawingBuffer: true,
</span></span><span style=display:flex><span>            alpha: true
</span></span><span style=display:flex><span>        })
</span></span><span style=display:flex><span>        renderer.autoClearColor = false
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        const camera = new Three.OrthographicCamera(-2, 2, 1, -1, -1, 1)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        const scene = new Three.Scene()
</span></span><span style=display:flex><span>        scene.background = new Three.Color(0xFFFFFF)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        const light = new Three.DirectionalLight(0xFFFFFF, 1)
</span></span><span style=display:flex><span>        light.position.set(-1, 2, 3)
</span></span><span style=display:flex><span>        scene.add(light)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        const geometry = new Three.BoxBufferGeometry(1, 1, 1)
</span></span><span style=display:flex><span>        const base = new Three.Object3D()
</span></span><span style=display:flex><span>        scene.add(base)
</span></span><span style=display:flex><span>        base.scale.set(0.1, 0.1, 0.1)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        const colors = [&#39;#F00&#39;, &#39;#FF0&#39;, &#39;#0F0&#39;, &#39;#0FF&#39;, &#39;#00F&#39;, &#39;#F0F&#39;]
</span></span><span style=display:flex><span>        const numArr = [-2, 2] //åŒä¸€åæ ‡è½´ä¸Šï¼Œå¯¹ç§° 2 ä¸ªç«‹æ–¹ä½“çš„åæ ‡
</span></span><span style=display:flex><span>        colors.forEach((color, index) =&gt; {
</span></span><span style=display:flex><span>            const material = new Three.MeshPhongMaterial({ color })
</span></span><span style=display:flex><span>            const cube = new Three.Mesh(geometry, material)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            const col = Math.floor(index / numArr.length)
</span></span><span style=display:flex><span>            const row = index % numArr.length
</span></span><span style=display:flex><span>            let result = [0, 0, 0]
</span></span><span style=display:flex><span>            result[col] = numArr[row]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            cube.position.set(result[0], result[1], result[2])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            base.add(cube)
</span></span><span style=display:flex><span>        })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        const temp = new Three.Vector3()
</span></span><span style=display:flex><span>        const updatePosition = (x: number, y: number) =&gt; {
</span></span><span style=display:flex><span>            if (canvasRef.current === null) { return }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            // const rect = canvasRef.current.getBoundingClientRect()
</span></span><span style=display:flex><span>            // const newX = (x - rect.left) * canvasRef.current.width / rect.width
</span></span><span style=display:flex><span>            // const newY = (y - rect.top) * canvasRef.current.height / rect.height
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            // const resX = newX / canvasRef.current.width * 2 - 1
</span></span><span style=display:flex><span>            // const resY = newY / canvasRef.current.height * -2 + 1
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            const resX = x / canvasRef.current.width * 2 - 1
</span></span><span style=display:flex><span>            const resY = y / canvasRef.current.height * -2 + 1
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            temp.set(resX, resY, 0).unproject(camera)
</span></span><span style=display:flex><span>            state.x = temp.x
</span></span><span style=display:flex><span>            state.y = temp.y
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        const handleMouseMove = (eve: MouseEvent) =&gt; {
</span></span><span style=display:flex><span>            updatePosition(eve.clientX, eve.clientY)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        const handleTouchMove = (eve: TouchEvent) =&gt; {
</span></span><span style=display:flex><span>            eve.preventDefault()
</span></span><span style=display:flex><span>            const touche = eve.touches[0]
</span></span><span style=display:flex><span>            updatePosition(touche.clientX, touche.clientY)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        canvasRef.current.addEventListener(&#39;mousemove&#39;, handleMouseMove)
</span></span><span style=display:flex><span>        canvasRef.current.addEventListener(&#39;touchmove&#39;, handleTouchMove, { passive: false })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        const render = (time: number) =&gt; {
</span></span><span style=display:flex><span>            time = time * 0.001
</span></span><span style=display:flex><span>            base.position.set(state.x, state.y, state.z)
</span></span><span style=display:flex><span>            base.rotation.x = time
</span></span><span style=display:flex><span>            base.rotation.y = time * 1.11
</span></span><span style=display:flex><span>            renderer.render(scene, camera)
</span></span><span style=display:flex><span>            window.requestAnimationFrame(render)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        window.requestAnimationFrame(render)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        const handleResize = () =&gt; {
</span></span><span style=display:flex><span>            if (canvasRef.current === null) { return }
</span></span><span style=display:flex><span>            const width = canvasRef.current.clientWidth
</span></span><span style=display:flex><span>            const height = canvasRef.current.clientHeight
</span></span><span style=display:flex><span>            camera.right = width / height
</span></span><span style=display:flex><span>            camera.left = - camera.right
</span></span><span style=display:flex><span>            camera.updateProjectionMatrix()
</span></span><span style=display:flex><span>            renderer.setSize(width, height, false)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        handleResize()
</span></span><span style=display:flex><span>        window.addEventListener(&#39;resize&#39;, handleResize)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        return () =&gt; {
</span></span><span style=display:flex><span>            window.removeEventListener(&#39;resize&#39;, handleResize)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }, [canvasRef])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    return (
</span></span><span style=display:flex><span>        &lt;canvas ref={canvasRef} className=&#39;full-screen&#39; /&gt;
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>export default PreserveDrawingBuffer
</span></span></code></pre></div><p><strong>è¡¥å……è¯´æ˜ï¼š</strong></p><p>ä¸Šé¢è¿™æ®µä»£ç ç•¥å¾®å¤æ‚ã€é™Œç”Ÿã€‚å› ä¸ºè¿™æ®µä»£ç ä¸­æœ‰å‡ ä¸ªåœ°æ–¹æ˜¯æˆ‘ä»¬ä¹‹å‰ç¤ºä¾‹ä¸­ä»æ¥æœªæ¥è§¦è¿‡çš„ï¼š</p><ol><li><p>ä½¿ç”¨çš„æ˜¯æ­£äº¤é•œå¤´ï¼Œè€Œä¸æ˜¯é€è§†é•œå¤´</p></li><li><p>å½“çª—å£å°ºå¯¸å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæ›´æ–°æ­£äº¤é•œå¤´</p><blockquote><p>æ›´æ–°æ–¹å¼å’Œæˆ‘ä»¬ä¹‹å‰ä¹ æƒ¯ä½¿ç”¨çš„ é€è§†é•œå¤´(PerspectiveCamera) å¤§ä¸åŒ</p></blockquote></li><li><p>ç›‘å¬é¼ æ ‡æ»‘åŠ¨ã€æ‰‹æŒ‡æ»‘åŠ¨äº‹ä»¶</p></li><li><p>æ›´æ–° ç‰©ä½“ åœ¨æ­£äº¤é•œå¤´ä¸­çš„ â€œæŠ•å½±ä½ç½®â€</p></li></ol><p><strong>é¢å¤–è¡¥å……ï¼š</strong></p><p>ä¸Šè¿°ä»£ç ä¸­ï¼Œ6 ä¸ªç«‹æ–¹ä½“ ä»–ä»¬åˆ†åˆ«æ˜¯ï¼š</p><ol><li><p>åœ¨ x è½´å¯¹ç§°çš„ 2 ä¸ªç«‹æ–¹ä½“</p><blockquote><p>åœ¨ç¤ºä¾‹ä¸­ï¼Œå¯¹åº”çš„åæ ‡åˆ†åˆ«ä¸º (-2,0,0)ã€(2,0,0)</p></blockquote></li><li><p>åœ¨ y è½´å¯¹ç§°çš„ 2 ä¸ªç«‹æ–¹ä½“</p><blockquote><p>åœ¨ç¤ºä¾‹ä¸­ï¼Œå¯¹åº”çš„åæ ‡åˆ†åˆ«ä¸º (0,-2,0)ã€(0,2,0)</p></blockquote></li><li><p>åœ¨ z è½´å †æˆçš„ 2 ä¸ªç«‹æ–¹ä½“</p><blockquote><p>åœ¨ç¤ºä¾‹ä¸­ï¼Œå¯¹åº”çš„åæ ‡åˆ†åˆ«ä¸º (0,0,-2)ã€(0,0,2)</p></blockquote></li></ol><p>è¿™ 6 ä¸ªç«‹æ–¹ä½“ä»–ä»¬ä¾æ¬¡å¯¹åº”çš„åæ ‡ï¼Œæ²¡æœ‰æå‰å†™æ­»ï¼Œè€Œæ˜¯é€šè¿‡ä¸€æ®µç‰¹æ®Šçš„ forEach å¾ªç¯æ¥è®¡ç®—å¾—å‡ºçš„ã€‚</p><p>å¯ä»¥é˜…è¯»ä¸‹é¢è¿™æ®µé€šç”¨çš„ä»£ç ï¼Œå¸®åŠ©ä½ ç†è§£ æ•´ä¸ª forEach å¾ªç¯æ˜¯å¦‚ä½•å¾—åˆ°æ¯ä¸ªç«‹æ–¹ä½“åæ ‡çš„ã€‚</p><div class=highlight><pre tabindex=0 style=color:#3c3836;background-color:#fbf1c7;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>//éå†å‡º ç›®æ ‡é•¿åº¦ä¸ºNï¼Œç‰¹æ®Šå€¼ä¸º [xx, xx, ...] çš„ å¤šç»´æ•°ç»„
</span></span><span style=display:flex><span>const numArr = [-2, 2] //å®šä¹‰ç‰¹æ®Šä½ç½®ä¸Šå‡ºç°çš„æ•°å­—
</span></span><span style=display:flex><span>const arrLength = 3 //å®šä¹‰ç›®æ ‡æ•°ç»„é•¿åº¦
</span></span><span style=display:flex><span>const total = arrLength * numArr.length //æ ¹æ®ç›®æ ‡æ•°ç»„é•¿åº¦ä»¥åŠç‰¹æ®Šæ•°å­—çš„ä¸ªæ•°ï¼Œè®¡ç®—å¾—å‡ºç›®æ ‡æ•°ç»„çš„æ€»ä¸ªæ•°
</span></span><span style=display:flex><span>for (let i = 0; i &lt; total; i++) {
</span></span><span style=display:flex><span>    const col = Math.floor(i / numArr.length) //è®¡ç®—å‡ºç‰¹æ®Šä½ç½®çš„ç´¢å¼•
</span></span><span style=display:flex><span>    const row = i % numArr.length //è®¡ç®—å‡ºç‰¹æ®Šä½ç½®ä¸Šæ•°å­—å€¼å¯¹åº”çš„ç´¢å¼•
</span></span><span style=display:flex><span>    let result = new Array(arrLength) //å¾—åˆ°ä¸€ä¸ª é•¿åº¦ä¸º arrLenght çš„æ•°ç»„
</span></span><span style=display:flex><span>    result.fill(0) //å°†æ•°ç»„æ¯ä¸€é¡¹å¡«å……ä¸º 0
</span></span><span style=display:flex><span>    result[col] = numArr[row] //ä¿®æ”¹ç‰¹æ®Šä½ç½®ä¸Šçš„å€¼
</span></span><span style=display:flex><span>    console.log(result)
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>å¦‚æœä½ å¯¹ useCreateScene è¿™ä¸ªç¤ºä¾‹ä¸å¤ªç†è§£ä¹Ÿæ²¡æœ‰å…³ç³»ï¼Œå› ä¸ºæ¯•ç«Ÿè¿™ä¸ªç¤ºä¾‹ä¸­å‡ºç°äº†ä¸€äº›æˆ‘ä»¬ä¹‹å‰ç¤ºä¾‹ä¸­ä»æœªç”¨åˆ°çš„ä¸€äº›ç±»ï¼Œä½ å¯ä»¥å…ˆè·³è¿‡è¿™ä¸ªç¤ºä¾‹ï¼Œç»§ç»­åé¢çš„å­¦ä¹ ã€‚</p><blockquote><p>éšç€æ—¥åå¯¹äº æ­£äº¤é•œå¤´ çš„å¤šæ¬¡ä½¿ç”¨ï¼Œç»ˆå½’ä¼šç†Ÿç»ƒå¹¶ç†è§£çš„ã€‚</p></blockquote><h2 id=è·å–é”®ç›˜äº‹ä»¶>è·å–é”®ç›˜äº‹ä»¶<a hidden class=anchor aria-hidden=true href=#è·å–é”®ç›˜äº‹ä»¶>#</a></h2><h4 id=è®©-canvas-è·å–é”®ç›˜äº‹ä»¶>è®© Canvas è·å–é”®ç›˜äº‹ä»¶<a hidden class=anchor aria-hidden=true href=#è®©-canvas-è·å–é”®ç›˜äº‹ä»¶>#</a></h4><p>å¿…é¡»åŒæ—¶æ»¡è¶³ä»¥ä¸‹ 2 ä¸ªæ¡ä»¶åï¼Œcanvas æ‰å¯ä»¥è·å¾—é”®ç›˜äº‹ä»¶ã€‚</p><ol><li><p>canvas å½“å‰è·å¾—ç„¦ç‚¹</p></li><li><p><code>&lt;canvas \></code> æ ‡ç­¾ä¸­å¿…é¡»æ·»åŠ  tabIndexå±æ€§ï¼Œ</p><blockquote><p>å±æ€§å€¼æ˜¯ -1ã€0ã€1 éƒ½æ— æ‰€è°“ï¼Œå»ºè®®è®¾ç½®ä¸º 0</p></blockquote></li></ol><p>è¡¥å……è¯´æ˜ï¼šå½“ canvas è·å¾—å½“å‰ç„¦ç‚¹åï¼Œä¼šåœ¨å››å‘¨å‡ºç°ä¸€ä¸ªè“è‰²è¾¹æ¡†ï¼Œå¯ä»¥é€šè¿‡å®šä¹‰ css æ ·å¼æ¥å–æ¶ˆè¿™ä¸ªæ ·å¼ã€‚</p><div class=highlight><pre tabindex=0 style=color:#3c3836;background-color:#fbf1c7;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>canvas:focus {
</span></span><span style=display:flex><span>    outline: none;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>ç®€å•ç¤ºä¾‹ï¼š</strong></p><div class=highlight><pre tabindex=0 style=color:#3c3836;background-color:#fbf1c7;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>import { useEffect, useRef } from &#39;react&#39;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>import &#39;./index.scss&#39;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>const CanvasKeyboard = () =&gt; {
</span></span><span style=display:flex><span>    const canvasRef = useRef&lt;HTMLCanvasElement | null&gt;(null)
</span></span><span style=display:flex><span>    useEffect(() =&gt; {
</span></span><span style=display:flex><span>        if (canvasRef.current === null) { return }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        canvasRef.current.focus() //è‡ªåŠ¨è·å–ç„¦ç‚¹
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        const handleKeydown = (event: KeyboardEvent) =&gt; {
</span></span><span style=display:flex><span>            console.log(event)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        canvasRef.current.addEventListener(&#39;keydown&#39;, handleKeydown)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        return () =&gt; {
</span></span><span style=display:flex><span>            if (canvasRef.current === null) { return }
</span></span><span style=display:flex><span>            canvasRef.current.removeEventListener(&#39;keydown&#39;, handleKeydown)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }, [canvasRef])
</span></span><span style=display:flex><span>    return (
</span></span><span style=display:flex><span>        &lt;canvas ref={canvasRef} className=&#39;full-screen&#39; tabIndex={0} /&gt;
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>export default CanvasKeyboard
</span></span></code></pre></div><h4 id=è®©-orbitcontrol-è·å–é”®ç›˜äº‹ä»¶>è®© OrbitControl è·å–é”®ç›˜äº‹ä»¶<a hidden class=anchor aria-hidden=true href=#è®©-orbitcontrol-è·å–é”®ç›˜äº‹ä»¶>#</a></h4><p>é»˜è®¤ OrbitControl å¯¹è±¡å°±åŒ…å«é”®ç›˜æ–¹å‘é”®ä¾¦å¬ã€‚</p><p>é”®ç›˜ä¸Šçš„ ä¸Šä¸‹å·¦å³ æ–¹å‘é”® å‡å¯æ“æ§æ”¹å˜ é•œå¤´è½¨é“è§†å›¾ã€‚</p><p>ä½†æ˜¯æˆ‘ä»¬ä¹‹å‰çš„ä»£ç ä¸­ï¼Œç»å¸¸æ˜¯è¿™æ ·å†™çš„ï¼š</p><div class=highlight><pre tabindex=0 style=color:#3c3836;background-color:#fbf1c7;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>const controls = new OrbitControls(camera, canvasRef.current)
</span></span></code></pre></div><p>è¿™æ ·å­˜åœ¨çš„é—®é¢˜æ˜¯ï¼Œå½“ canvas å¤±å»ç„¦ç‚¹åï¼Œå°±æ— æ³•å†è·å¾—é”®ç›˜äº‹ä»¶ã€‚</p><p>æœ€ç®€å•çš„è§£å†³åŠæ³•å°±æ˜¯å°†ä»£ç ä¿®æ”¹ä¸ºï¼š</p><div class=highlight><pre tabindex=0 style=color:#3c3836;background-color:#fbf1c7;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>const controls = new OrbitControls(camera, document.body)
</span></span></code></pre></div><p>è¿™æ ·é”®ç›˜äº‹ä»¶å°±ä¸å®¹æ˜“ä¸¢å¤±ã€‚</p><h2 id=è®¾ç½®ç”»å¸ƒé€æ˜åº¦>è®¾ç½®ç”»å¸ƒé€æ˜åº¦<a hidden class=anchor aria-hidden=true href=#è®¾ç½®ç”»å¸ƒé€æ˜åº¦>#</a></h2><p>è®¾ç½®ç”»å¸ƒé€æ˜åº¦ï¼Œä½ å¯èƒ½ä¼šç–‘æƒ‘ï¼Œè¿™æœ‰ä»€ä¹ˆå¥½è®²çš„ï¼Œç›´æ¥é€šè¿‡ css ç»™ canvas æ·»åŠ é€æ˜åº¦æ ·å¼å³å¯ï¼š</p><div class=highlight><pre tabindex=0 style=color:#3c3836;background-color:#fbf1c7;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>canvas {
</span></span><span style=display:flex><span>    opacity: 0.4;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>è¿™æ ·åšè‚¯å®šæ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯è¿™é‡Œè¯´çš„ â€œè®¾ç½®ç”»å¸ƒé€æ˜åº¦â€ å®é™…ä¸Šæ˜¯æŒ‡ ç»™ä¸åŒç‰©ä½“è®¾ç½®é€æ˜åº¦ã€‚</p><p>ä¾‹å¦‚æˆ‘ä»¬ä¹‹å‰ç¤ºä¾‹ä¸­çš„ç«‹æ–¹ä½“ï¼Œé‚£ä¹ˆæ‰€æœ‰çš„ç¤ºä¾‹ä¸­ç«‹æ–¹ä½“éƒ½ä¸æ˜¯åŠé€æ˜çš„ã€‚</p><p><strong>ç»™æè´¨è®¾ç½®é€æ˜åº¦ï¼š</strong></p><ol><li><p>éœ€è¦ç»™æè´¨è®¾ç½®é€æ˜åº¦</p><div class=highlight><pre tabindex=0 style=color:#3c3836;background-color:#fbf1c7;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>const mat = new Three.MeshPhongMaterial({
</span></span><span style=display:flex><span>    color,
</span></span><span style=display:flex><span>    opacity: 0.4
</span></span><span style=display:flex><span>})
</span></span></code></pre></div></li><li><p>æ¸²æŸ“å™¨éœ€è¦å¼€å¯é€æ˜åº¦æ¸²æŸ“</p><div class=highlight><pre tabindex=0 style=color:#3c3836;background-color:#fbf1c7;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>const renderer = new Three.WebGLRenderer({ 
</span></span><span style=display:flex><span>    canvas: canvasRef.current,
</span></span><span style=display:flex><span>    alpha:true,
</span></span><span style=display:flex><span>    premultipliedAlpha:false
</span></span><span style=display:flex><span>})
</span></span></code></pre></div><blockquote><p>alphaï¼šcanvas æ˜¯å¦åŒ…å«é€æ˜åº¦ï¼Œé»˜è®¤ä¸º false</p><p>premultipliedAlphaï¼šrenderer æ˜¯å¦å‡è®¾é¢œè‰²æœ‰ premultiplied alpha (é¢„ä¹˜alpha)ï¼Œé»˜è®¤ä¸º true</p></blockquote></li></ol><p><strong>é’ˆå¯¹ é¢„ä¹˜Alpha çš„è¡¥å……è¯´æ˜ï¼š</strong></p><p>premultiplied alphaï¼šé¢œè‰²å€¼ é¢„ä¹˜ alpha</p><p>è¿™æ˜¯ä¼ ç»Ÿ 3D ç»˜åˆ¶ä¸­çš„ä¸€ä¸ªé‡è¦æ¦‚å¿µï¼Œä½ å¯ä»¥ç®€å•ç†è§£æˆå¦‚ä¸‹ï¼š</p><p>å‡è®¾æˆ‘ä»¬è¦è¡¨ç¤ºä¸€ä¸ª é€æ˜åº¦ä¸º 60% çš„çº¯çº¢è‰²ï¼Œé‡‡ç”¨ RGBA çš„æ–¹å¼ä¸º (255,0,0,0.6)ï¼Œé€šè¿‡ é¢„ä¹˜ alphaï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°é€æ˜åº¦ä¸º 60% çš„çº¯çº¢è‰²å¦‚æœæ”¾ç½®åœ¨çº¯ç™½è‰²åº•ä¸Šï¼Œå®é™…ä¸Šæœ€ç»ˆå‘ˆç°å‡ºæ¥çš„é¢œè‰²å’Œ RGB ( 255,102,102) æ˜¯å®Œå…¨ç›¸åŒçš„ã€‚</p><p>å‡è®¾ä¸€ä¸ªé¢œè‰²ä½¿ç”¨ RGBA æ¥è¡¨ç¤ºï¼Œé€æ˜åº¦ä¸º Aã€rgb é¢œè‰²ä¸º Cã€çº¯ç™½è‰²(255,255,255)ä¸º Fï¼Œé‚£ä¹ˆæŠŠ RGBA è½¬åŒ–ä¸º RGB çš„å…¬å¼ä¸ºï¼š</p><p>C<em>A + ( 1-A )</em> F</p><p>ä¹Ÿå°±æ˜¯è¯´ rgba(255,0,0,0.6) è½¬åŒ–ä¸ºå¯¹åº”çš„ rgb è¿‡ç¨‹ä¸ºï¼š</p><p>(255,0,0)<em>0.6 + (1-0.6)</em> (255,255,255) = (255, 255 x 0.4, 255 x 0.4) = (255,102,102)</p><p><strong>æš‚æ—¶çœ‹ä¸æ‡‚æ²¡æœ‰å…³ç³»ï¼Œåªéœ€è®°ä½è‹¥æƒ³è®©æ¸²æŸ“å™¨å°†ç‰©ä½“æ¸²æŸ“å‡ºåŠé€æ˜ï¼Œé™¤äº†ç‰©ä½“æœ¬èº«æè´¨é…ç½®é€æ˜åº¦ä»¥å¤–ï¼Œè¿˜éœ€è¦å°†æ¸²æŸ“å™¨ä¸­çš„ alpha è®¾ç½®ä¸º true ã€premultipliedAlpha è®¾ç½®ä¸º false</strong></p><h2 id=è®¾ç½®ç”»å¸ƒä¸ºèƒŒæ™¯>è®¾ç½®ç”»å¸ƒä¸ºèƒŒæ™¯<a hidden class=anchor aria-hidden=true href=#è®¾ç½®ç”»å¸ƒä¸ºèƒŒæ™¯>#</a></h2><p>å°† canvas è®¾ç½®ä¸ºç½‘é¡µèƒŒæ™¯ï¼Œäº‹å®ä¸Šä¹Ÿå¾ˆç®€å•ï¼Œå¯¹åº”çš„æ ·å¼ï¼š</p><div class=highlight><pre tabindex=0 style=color:#3c3836;background-color:#fbf1c7;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>canvas {
</span></span><span style=display:flex><span>  position: fixed;
</span></span><span style=display:flex><span>  top: 0;
</span></span><span style=display:flex><span>  left: 0;
</span></span><span style=display:flex><span>  z-index: -1;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>ä¸Šè¿° CSS æ ·å¼å°±è®© canvas ä½ç½®å›ºå®šï¼Œä¸”å±‚çº§æœ€ä½ï¼Œè¿™æ ·å°±æˆä¸ºå½“å‰ç½‘é¡µèƒŒæ™¯äº†ã€‚</p><p>ä½†æ˜¯å®é™…é¡¹ç›®ä¸­ï¼Œæ›´åŠ å»ºè®®å°† canvas åŒ…å«åœ¨ä¸€ä¸ª iframe ä¸­åï¼Œå†ä½œä¸º ç½‘é¡µçš„èƒŒæ™¯ã€‚</p><p>è¿™æ ·åšæœ‰å‡ ä¸ªç†ç”±ï¼š</p><ol><li>ä½¿ç”¨ iframe åï¼Œå¯ä»¥å°† canvasã€Three.js çš„ç›¸å…³ä»£ç ç‹¬ç«‹å‡ºæ¥</li><li>å¯ä»¥å¤šä¸ªé¡µé¢éƒ½å¼•ç”¨è¿™ä¸ª iframe</li></ol><p><strong>iframeçš„ç›¸å…³ç¤ºä¾‹ï¼š</strong></p><div class=highlight><pre tabindex=0 style=color:#3c3836;background-color:#fbf1c7;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>&lt;iframe id=&#39;background&#39; src=&#39;xxx.html&#39; &gt;
</span></span><span style=display:flex><span>&lt;div&gt;
</span></span><span style=display:flex><span>    Hello Three.js
</span></span><span style=display:flex><span>&lt;/div&gt;
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#3c3836;background-color:#fbf1c7;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>#background {
</span></span><span style=display:flex><span>    position: fixed;
</span></span><span style=display:flex><span>    width:100%;
</span></span><span style=display:flex><span>    height:100%;
</span></span><span style=display:flex><span>    left:0;
</span></span><span style=display:flex><span>    top:0;
</span></span><span style=display:flex><span>    z-index:-1;
</span></span><span style=display:flex><span>    border:none;
</span></span><span style=display:flex><span>    pointer-events:none;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>ä¸Šè¿° css æ ·å¼ä¸­ï¼š</p><ol><li>position: fixed; å¯ä»¥è®© iframe ä½ç½®å›ºå®š</li><li>z-index: -1; å¯ä»¥è®© iframe å±‚çº§æœ€ä½</li><li>border: none; å¯ä»¥è®© iframe ä¸æ˜¾ç¤ºè¾¹æ¡†</li><li>pointer-events: none; è®© iframe æ°¸è¿œä¸ä¼šæˆä¸ºé¼ æ ‡äº‹ä»¶çš„ targetï¼Œæ„å‘³ç€è®© iframe ä¸æ¥å—é¼ æ ‡äº¤äº’äº‹ä»¶</li></ol><p>å…³äºæ›´å¤š canvas çš„ç›¸å…³ç”¨æ³•ï¼Œå»ºè®®é˜…è¯» MDN ä¸Šå…³äº canvas çš„ç›¸å…³æ–‡æ¡£ï¼š</p><p><a href=https://developer.mozilla.org/zh-CN/docs/Web/API/Canvas_API>https://developer.mozilla.org/zh-CN/docs/Web/API/Canvas_API</a></p><p>è‡³æ­¤ï¼Œå…³äº Three.js çš„ä¸€äº›å¸¸ç”¨æŠ€å·§è®²è§£å®Œæ¯•ã€‚</p><p>æ¥ä¸‹æ¥å¼€å§‹è®²è§£ Three.js çš„ä¸€äº›æ€§èƒ½ä¼˜åŒ–ã€‚</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://bablvsj.github.io/tags/three.js/>Three.js</a></li></ul><nav class=paginav><a class=prev href=https://bablvsj.github.io/posts/threejs/18-three.js%E6%8A%80%E5%B7%A7%E4%B9%8B%E8%B0%83%E8%AF%95/><span class=title>Â« Prev</span><br><span>18 Three.jsæŠ€å·§ä¹‹è°ƒè¯•</span></a>
<a class=next href=https://bablvsj.github.io/posts/threejs/20-three.js%E4%BC%98%E5%8C%96%E4%B9%8B%E5%90%88%E5%B9%B6%E5%AF%B9%E8%B1%A1/><span class=title>Next Â»</span><br><span>20 Three.jsä¼˜åŒ–ä¹‹åˆå¹¶å¯¹è±¡</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://bablvsj.github.io>Bablvsj's Blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span><div class=flex-c-d><a class=flex-d-c href="https://www.upyun.com/?utm_source=lianmeng&utm_medium=referral" target=_blank><span>æœ¬ç«™ç”±</span><img width=60 src=/images/upyun.png>æä¾›CDNåŠ é€Ÿ/äº‘å­˜å‚¨æœåŠ¡</a></div></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>