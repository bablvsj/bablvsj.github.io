<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>20 Three.jsä¼˜åŒ–ä¹‹åˆå¹¶å¯¹è±¡ | Bablvsj&#39;s Blog</title>
<meta name="keywords" content="Three.js">
<meta name="description" content="20 Three.jsä¼˜åŒ–ä¹‹åˆå¹¶å¯¹è±¡ - Bablvsj&#39;s Blog">
<meta name="author" content="">
<link rel="canonical" href="https://bablvsj.github.io/posts/threejs/20-three.js%E4%BC%98%E5%8C%96%E4%B9%8B%E5%90%88%E5%B9%B6%E5%AF%B9%E8%B1%A1/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.5525cc669fcb4f094a55bfc3ebfc5a6e73445e090010c66ab49c2cad14735f57.css" integrity="sha256-VSXMZp/LTwlKVb/D6/xabnNEXgkAEMZqtJwsrRRzX1c=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.acb54fd32bbc1982428b8850317e45d076b95012730a5936667e6bc21777692a.js" integrity="sha256-rLVP0yu8GYJCi4hQMX5F0Ha5UBJzClk2Zn5rwhd3aSo="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://bablvsj.github.io/img/Q.gif">
<link rel="icon" type="image/png" sizes="16x16" href="https://bablvsj.github.io/img/Q.gif">
<link rel="icon" type="image/png" sizes="32x32" href="https://bablvsj.github.io/img/Q.gif">
<link rel="apple-touch-icon" href="https://bablvsj.github.io/Q.gif">
<link rel="mask-icon" href="https://bablvsj.github.io/Q.gif">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="stylesheet" href="/css/syntax.css">


<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="20 Three.jsä¼˜åŒ–ä¹‹åˆå¹¶å¯¹è±¡" />
<meta property="og:description" content="" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://bablvsj.github.io/posts/threejs/20-three.js%E4%BC%98%E5%8C%96%E4%B9%8B%E5%90%88%E5%B9%B6%E5%AF%B9%E8%B1%A1/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-19T17:11:35+08:00" />
<meta property="article:modified_time" content="2023-12-19T17:11:35+08:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="20 Three.jsä¼˜åŒ–ä¹‹åˆå¹¶å¯¹è±¡"/>
<meta name="twitter:description" content=""/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "æ–‡ç« ",
      "item": "https://bablvsj.github.io/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "20 Three.jsä¼˜åŒ–ä¹‹åˆå¹¶å¯¹è±¡",
      "item": "https://bablvsj.github.io/posts/threejs/20-three.js%E4%BC%98%E5%8C%96%E4%B9%8B%E5%90%88%E5%B9%B6%E5%AF%B9%E8%B1%A1/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "20 Three.jsä¼˜åŒ–ä¹‹åˆå¹¶å¯¹è±¡",
  "name": "20 Three.jsä¼˜åŒ–ä¹‹åˆå¹¶å¯¹è±¡",
  "description": "",
  "keywords": [
    "Three.js"
  ],
  "articleBody": "å‰é¢å­¦ä¹ äº† Three.js å…¥é—¨ã€åŸºç¡€ã€æŠ€å·§ï¼Œä»Šå¤©å¼€å§‹å­¦ä¹  Three.js çš„æ€§èƒ½ä¼˜åŒ–ã€‚\nå…³äºæ€§èƒ½ä¼˜åŒ–æœ‰å¾ˆå¤šæ–¹å¼ï¼Œæœ€åŸºç¡€ä¹Ÿæ˜¯æœ€å¸¸è§çš„æ–¹å¼å°±æ˜¯â€”â€”åˆå¹¶å‡ ä½•å¯¹è±¡ã€‚\nåœ¨ â€œThree.js åŸºç¡€ä¹‹å›¾å…ƒâ€ é‚£ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†å‡ ä½•ä½“ç§°å‘¼ä¸º å›¾å…ƒï¼Œç°åœ¨æˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹è¿™ä¸ªç§°å‘¼ï¼Œæœ¬æ–‡ä»¥åï¼Œç»å¤§å¤šæ•°æƒ…å†µä¸‹æˆ‘ä»¬éƒ½ä½¿ç”¨ â€œå‡ ä½•ä½“â€ æ¥ä»£æ›¿ â€œå›¾å…ƒâ€ã€‚\næ—¢ç„¶è°ˆåˆ°æ€§èƒ½ä¼˜åŒ–ï¼Œå°±ä¸èƒ½ä½¿ç”¨ç®€å•çš„ç¤ºä¾‹ï¼Œè¦ä¸ç„¶æ ¹æœ¬æ— æ³•ä½“ç°å‡º ä¼˜åŒ–å‰å’Œä¼˜åŒ–å çš„åŒºåˆ«ã€‚\næ¿€åŠ¨äººå¿ƒçš„æ—¶åˆ»åˆ°äº†ã€‚\næœ¬æ–‡æˆ‘ä»¬çš„ç›®æ ‡ï¼šåˆ¶ä½œå¹¶ä¼˜åŒ–ä¸€ä¸ªæ˜¾ç¤ºåœ°çƒäººå£äººæ•°åˆ†å¸ƒçš„å¯è§†åŒ–3Dåœ°çƒ ä½ å¯ä»¥å…ˆè®¿é—®ä»¥ä¸‹ç½‘å€ï¼Œå…ˆæ„Ÿå—ä¸€ä¸‹æˆ‘ä»¬æœ¬æ–‡è¦æ¨¡ä»¿çš„æ•ˆæœï¼š\nhttps://globe.chromeexperiments.com/\nè¡¥å……è¯´æ˜ï¼šè¿™ä¸ªç½‘ç«™ï¼Œæ˜¯è°·æ­Œæµè§ˆå™¨ä¸ºäº†å‘å¤§ä¼—æ¼”ç¤º WebGL æŠ€æœ¯è€Œåˆ¶ä½œçš„ä¸€ä¸ªæ¼”ç¤ºç½‘é¡µã€‚\næˆ‘ç›¸ä¿¡ä½ ç¬¬ä¸€æ¬¡çœ‹åˆ°è¿™ç§åŸºäºæµè§ˆå™¨çš„ 3D åœ°çƒæ•°æ®å±•ç¤ºï¼Œä¸€å®šä¼šè¢«éœ‡æ’¼åˆ°çš„ã€‚\næ¥ä¸‹æ¥æˆ‘ä»¬å°±è¦é€æ­¥åˆ†æï¼Œæ‰¾å‡ºå®ç°æ–¹å¼ã€‚\næˆ‘ä»¬å…ˆè€ƒè™‘æ€ä¹ˆæŠŠè¿™ä¸ªåœºæ™¯å®ç°å‡ºæ¥ï¼Œç„¶åå†è€ƒè™‘ä¼˜åŒ–çš„äº‹ã€‚\næ ¸å¿ƒæ¨¡å—åˆ†æ æˆ‘ä»¬è¦å…ˆææ˜ç™½è¿™ä¸ª 3D æ•°å­—åœ°çƒçš„æ ¸å¿ƒæ¨¡å—ã€‚\n3D åœ°çƒ\nå°±æ˜¯ä¸€ä¸ªçƒä½“ï¼Œæ·»åŠ ä¸€ä¸ªåœ°çƒçº¹ç†å›¾ç‰‡\nå›¾ç‰‡ä¸ºä¸€ä¸ªçŸ©å½¢åœ°çƒå±•å¼€å›¾ï¼Œæœ¬ç¤ºä¾‹ä½¿ç”¨çš„åœ°çƒçº¹ç†å›¾ç‰‡èµ„æºï¼š\nhttps://threejsfundamentals.org/threejs/resources/images/world.jpg\nè¡¨ç¤ºäººå£å¤šå°‘çš„æŸ±çŠ¶ç‰©\næŸä¸ªåœ°åŒºäººå£å¤šåˆ™æŸ±çŠ¶ç‰©å°±æ¯”è¾ƒé«˜ï¼Œåä¹‹äººå£å°‘åˆ™æŸ±çŠ¶ç‰©æ¯”è¾ƒä½\né¼ æ ‡å¯äº¤äº’\nè¿™ä¸ªç›´æ¥ä½¿ç”¨ OrbitControls å°±å¯ä»¥ åªä¸è¿‡æœ¬ç¤ºä¾‹åªå…è®¸å·¦å³ã€ä¸Šä¸‹æ‹–æ‹½æŸ¥çœ‹ï¼Œä½†ä¸å…è®¸ä¿®æ”¹é•œå¤´è½¨é“çš„è¿œè¿‘è·ç¦»\nä¸Šé¢çš„æ ¸å¿ƒæ¨¡å— 1 ã€3 éƒ½å¾ˆå®¹æ˜“å®ç°ï¼Œé‡ç‚¹æˆ‘ä»¬è¿›ä¸€æ­¥æ‹†è§£ä¸€ä¸‹ â€œè¡¨ç¤ºäººå£å¤šå°‘çš„æŸ±çŠ¶ç‰©â€ã€‚\nå¦‚ä½•å®ç°â€œè¡¨ç¤ºäººå£å¤šå°‘çš„æŸ±çŠ¶ç‰©â€ï¼Ÿ æˆ‘ä»¬é€šè¿‡ä»¥ä¸‹ 3 ä¸ªçµé­‚è¿½é—®ï¼Œæ¥æ¢³ç†æ€è·¯ã€‚\nç¬¬1é—®ï¼šäººå£æ•°æ®ä»å“ªé‡Œæ¥ï¼Ÿ\nåŸç½‘é¡µæä¾› 3 ä¸ªå¹´ä»½çš„äººå£æ•°é‡ç»Ÿè®¡ï¼Œåˆ†åˆ«æ˜¯ 1990ã€1995ã€2000å¹´ã€‚\nç¾å›½å›½å®¶èˆªå¤©å±€(NASA)æä¾›çš„ç»Ÿè®¡ç»“æœä»‹ç»é¡µï¼š https://sedac.ciesin.columbia.edu/data/set/gpw-v4-admin-unit-center-points-population-estimates-rev11/data-download\nè¯·æ³¨æ„ï¼Œè¯¥é¡µé¢è¿˜æä¾›æœ€è¿‘å¹´ä»½çš„ç»Ÿè®¡ç»“æœï¼Œä½†æ˜¯ä¸‹è½½æ—¶å€™æç¤ºéœ€è¦æ³¨å†Œã€‚\næˆ‘ä»¬é€‰æ‹©ä¸ä½¿ç”¨æœ€æ–°çš„ 2020 å¹´æ•°æ®ï¼Œè€Œæ˜¯ä½¿ç”¨ 2010 å¹´çš„ç»“æœã€‚\nä¸ºäº†æ–¹ä¾¿ä½ è·å¾—åˆ° 2010 å¹´ç”·æ€§äººå£ç»Ÿè®¡ç»“æœï¼Œä½ å¯ä»¥ç›´æ¥ç‚¹å‡»ä¸‹é¢è¿™ä¸ªåœ°å€ï¼Œç›´æ¥ä¸‹è½½ï¼š\nhttps://threejsfundamentals.org/threejs/resources/data/gpw/gpw_v4_basic_demographic_characteristics_rev10_a000_014mt_2010_cntm_1_deg.asc\nåæ­£æˆ‘ä»¬æœ¬æ–‡çš„é‡ç‚¹æ˜¯æ¨¡ä»¿æ•ˆæœï¼Œè‡³äºæ•°æ®æ—¶æ•ˆæ€§ä¸å¿…çº ç»“\nè¯¥äººå£ç»Ÿè®¡æ•°æ®æ–‡ä»¶æ ¼å¼ä¸º .ascï¼Œè‡³äºå¦‚ä½•è§£æè¯¥æ–‡ä»¶ï¼Œæˆ‘ä»¬ä¼šç¨åè®²è§£\nä¸ºå•¥æ˜¯ç”·æ€§äººå£ç»Ÿè®¡ï¼Ÿå¥³æ€§äººå£å‘¢ï¼Ÿä¸ºä»€ä¹ˆä¸æ˜¯å…¨éƒ¨äººå£ç»Ÿè®¡å‘¢ï¼Ÿ\nå› ä¸ºåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œå°±ä¼šæœ‰å¥³æ€§äººå£ç»Ÿè®¡ï¼Œç„¶ååšå‡ºåŒä¸€ä¸ªåœ°åŒº ç”·å¥³äººå£æ•°é‡æ¯”è¾ƒ çš„åŠ¨ç”»\nä¸ºäº†ç®€åŒ–ï¼Œæœ¬æ–‡ä¸‹é¢æ–‡å­—ä¸­ï¼Œå°†å¿½ç•¥ â€œç”·æ€§äººå£æ•°é‡â€ è¿™ä¸ªæ¦‚å¿µï¼Œç»Ÿä¸€ç§°å‘¼ä¸º â€œäººå£æ•°æ®â€\nç¬¬2é—®ï¼šäººå£æ•°æ®å’Œåœ°åŒºçš„å¯¹åº”å…³ç³»ï¼Œå¦‚ä½•è¡¨ç°åœ¨åœ°çƒä¸Šï¼Ÿ\næˆ‘ä»¬æŠŠåˆšæ‰ä¸‹è½½å¾—åˆ°çš„äººå£ç»Ÿè®¡æ•°æ®æ–‡ä»¶ï¼Œé‡å‘½åä¸º gpw_v4_014mt_2010.ascï¼Œç„¶åå°†è¯¥æ–‡ä»¶ç§»åŠ¨åˆ°ï¼šsrc/assets/data/ ç›®å½•ä¸­ã€‚\nç‚¹å‡»è¯¥æ–‡ä»¶ï¼Œç”¨è®°äº‹æœ¬æŸ¥çœ‹è¯¥æ–‡ä»¶å†…å®¹ï¼Œä½ ä¼šå‘ç°é‡Œé¢å¤§è‡´ä¸ºä»¥ä¸‹å†…å®¹ï¼š\nncols 360 nrows 145 xllcorner -180 yllcorner -60 cellsize 0.99999999999994 NODATA_value -9999 -9999 -9999 -9999 -9999 -9999 -999... ... ... è¿™é‡Œé¢çš„æ•°æ®å†…å®¹ä¸ºï¼šçŸ©å½¢åœ°çƒåœ°å›¾ä¸Šï¼Œä¸åŒç‚¹(ç»çº¬åº¦)å¯¹åº”çš„æ•°å€¼(äººå£æ•°é‡)ã€‚\nè¡¥å……ï¼šè¿™é‡Œé¢çš„äººå£æ•°é‡å€¼å¹¶ä¸æ˜¯å…·ä½“äººå£æ•°é‡(æ¯”å¦‚ 45932551 ä¸ªäºº)ï¼Œè€Œæ˜¯å…·æœ‰ä¸€å®šæ¯”ä¾‹å•ä½çš„å€¼(ä¾‹å¦‚ 458.6)\nå…·ä½“å•ä½å€¼å¯¹åº”çš„äººå£æˆ‘è¿˜ä¸æ¸…æ¥šï¼Œæˆ–è®¸æ˜¯ ä¸‡ï¼Œä¹Ÿæˆ–è®¸æ˜¯ç™¾ä¸‡ï¼Œä¸è¿‡ä¸å½±å“æˆ‘ä»¬æœ¬ç¤ºä¾‹ï¼Œä½ åªéœ€æŠŠä»–å½“æˆæ•°å­—å³å¯\næˆ‘ä»¬éœ€è¦å°†æ•°æ®ä¸åœ°å›¾çº¹ç†å›¾ç‰‡è¿›è¡Œç‚¹å¯¹ç‚¹çš„ä½ç½®åŒ¹é…ã€‚\n.asc åç¼€çš„æ–‡ä»¶æœ‰ç‰¹åˆ«å¤šç§ç”¨é€”å’Œåœºæ™¯ï¼Œæˆ‘ä»¬è¿™é‡Œæåˆ°çš„ .asc æ–‡ä»¶æ˜¯æŒ‡ï¼šä»¥ PGP (Pretty Good Privacy) ASCII Armored Fileå½¢å¼å­˜åœ¨çš„æ …æ ¼åŒ–ç»“æ„çš„æ•°æ®æ–‡ä»¶ã€‚\n.asc æ …æ ¼åŒ–ç»“æ„çš„æ•°æ®æ–‡ä»¶è¯´æ˜ï¼š\nå…³é”®å­— å¯¹åº”å«ä¹‰ ncols(number colos) è¡¨ç¤ºè¯¥æ•°æ®å†…å®¹æœ‰å¤šå°‘åˆ— nrows(number rows) è¡¨ç¤ºè¯¥æ•°æ®å†…å®¹æœ‰å¤šå°‘è¡Œ xllcorner(x-low-left-corner) æ …æ ¼çš„å·¦ä¸‹è§’åæ ‡ x çš„å€¼ yllcorner(y-low-left-corner) æ …æ ¼çš„å·¦ä¸‹è§’åæ ‡ y çš„å€¼ cellsize(cell size) æ¯ä¸ªå•å…ƒæ ¼å…ƒçš„å°ºå¯¸ NODATA_value å•å…ƒæ ¼å†…æ²¡æœ‰å€¼æ—¶å¯¹åº”çš„å€¼ ä½ å¯ä»¥æŠŠ .ascæ–‡ä»¶ æƒ³è±¡æˆä¸€ä¸ªæ•°æ®è¡¨æ ¼ï¼Œæ¯ä¸ªå•å…ƒæ ¼ä¸ºä¸€é¡¹ï¼Œnrows è¡Œ ncols åˆ— ä¸ªå•å…ƒæ ¼æ„å»ºæˆäº†ä¸€ä¸ª æ•°æ®ç½‘æ ¼ã€‚\né™¤äº† .asc å¼€å¤´çš„å±æ€§å€¼é”®å¯¹å¤–ï¼Œåé¢çš„å°±æ˜¯ä¾æ¬¡å¡«å…¥æ•°æ®å•å…ƒç½‘æ ¼ä¸­çš„æ•°æ®ã€‚\nç¬¬3é—®ï¼šæ ¹æ®äººå£å¤šå°‘ï¼Œå¦‚ä½•åˆ›å»ºå¯¹åº”çš„æŸ±çŠ¶ç‰©ï¼Ÿ\nå½“å¾—åˆ°åœ°çƒæŸä¸ªç»çº¬åº¦(åœ°çƒçº¹ç†å›¾ç‰‡ä¸Šçš„æŸä¸ªåæ ‡)ä¸Šå¯¹åº”çš„äººå£æ•°æ®åï¼Œå°±å¯ä»¥æ ¹æ®äººå£æ•°é‡æŒ‰ç…§ä¸€å®šæ¯”ä¾‹ï¼Œåˆ›å»ºæŸ±çŠ¶ç‰©ã€‚\nåŸç†è®²è¿‡åï¼Œé‚£æ¥ä¸‹æ¥å°±æ˜¯å®é™…æ“ä½œäº†ã€‚\nåŸºç¡€ç¤ºä¾‹ï¼šHelloEarth æ¥ä¸‹æ¥ï¼Œå°†é€šè¿‡ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼Œé€æ­¥å®ç°æˆ‘ä»¬çš„ç›®æ ‡ç¤ºä¾‹ã€‚\nç‰¹åˆ«è¯´æ˜ï¼š\nä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ä¸­çš„ä»£ç ï¼Œé‡ç‚¹æ˜¯å‘ä½ è®²è§£å…·ä½“çš„åŠŸèƒ½å’Œæ€è·¯ï¼Œå¹¶ä¸æ˜¯æœ€ç»ˆçš„ä»£ç ã€‚\næœ€ç»ˆå®Œæ•´çš„ç¤ºä¾‹ä»£ç ä¸­ï¼Œä¼šå¯¹è¿™äº›æ¯ä¸ªæ­¥éª¤ä¸­çš„ä»£ç è¿›è¡Œæ–°çš„ç»„ç»‡ã€‚\nç¬¬1æ­¥ï¼šåŠ è½½äººå£æ•°æ®æ–‡ä»¶(gpw_v4_014mt_2010.asc) æ•°æ®æ–‡ä»¶è·¯å¾„ä¸º ./src/assets/data/gpw_v4_014mt_2010.asc\nç”±äºæˆ‘ä»¬ä½¿ç”¨ alias æ¥å¾—åˆ° .asc æ–‡ä»¶ç¼–è¯‘åçš„è·¯å¾„ï¼Œæ‰€ä»¥è¯·è®°å¾—ï¼š\ntsconfig.pahts.json çš„ paths ä¸­æ·»åŠ  \"@/assets/*\": [\"./src/assets/*\"]\nglobal.d.ts ä¸­æ·»åŠ  declare module '*.asc';\nä»¥ä¸Š 2 å¤„å‡é…ç½®æ­£ç¡®åï¼Œæ‰å¯ä»¥è®©æˆ‘ä»¬åœ¨ä»£ç ä¸­æ–¹ä¾¿ä½¿ç”¨ require('@/assets/xx/xx.asc').default æ¥è·å– .asc èµ„æºçš„è·¯å¾„\nå‡è®¾ä½ å¹¶ä¸æ˜¯ä½¿ç”¨ react + typescript + aliasï¼Œé‚£ä¹ˆä½ å¯ä»¥å¿½ç•¥æˆ‘æåˆ°çš„é…ç½®ï¼Œç›´æ¥è¯·æ±‚ä¸€ä¸ªå›ºå®šçš„ç½‘ç»œèµ„æº(.ascæ–‡ä»¶)å°±å¥½äº†ã€‚\né€šè¿‡ window.fetch() è¿™ä¸ªå‡½æ•°æ¥è·å– .asc æ–‡ä»¶å†…å®¹\næˆ‘ä»¬è¿™é‡Œæ²¡æœ‰ä½¿ç”¨ xhr æˆ– axios æ¥è¯·æ±‚è·å–æ–‡ä»¶èµ„æºï¼Œè€Œæ˜¯ä½¿ç”¨äº† fetch è¿™ä¸ª Web API\nå…³äº fetch çš„ç”¨æ³•ï¼Œè¯·å‚è€ƒï¼šhttps://developer.mozilla.org/zh-CN/docs/Web/API/Fetch_API\nå…·ä½“çš„ä»£ç ï¼š\nconst loadDataFile = async (url: string) =\u003e { try { const res = await window.fetch(url) const text = await res.text() // text å°±æ˜¯ .asc æ–‡ä»¶é‡Œçš„å†…å®¹ } catch (error) { console.log('åŠ è½½æ•°æ®å‡ºé”™') } } const ascURL = require('@/assets/data/gpw_v4_014mt_2010.asc').default loadDataFile(ascURL) é¢å¤–è¯´ä¸€ä¸ªäº‹æƒ…ï¼Œæœ¬æ–‡å¯¹åº”çš„æ˜¯ Three.js å®˜æ–¹æ•™ç¨‹ https://threejsfundamentals.org/threejs/lessons/threejs-optimize-lots-of-objects.html\næˆ‘åœ¨é˜…è¯»è‹±æ–‡åŸæ–‡æ—¶ï¼Œå½“æ—¶ä»–ä»£ç ä¸­ä½¿ç”¨çš„æ˜¯ï¼š\nasync function loadFile(url) { const req = await fetch(url); return req.text(); } æˆ‘è®¤ä¸ºä¸åº”è¯¥å°†è¿”å›å€¼ä½¿ç”¨å˜é‡ req(request)ï¼Œè€Œåº”è¯¥æ˜¯ res(response)ï¼Œäºæ˜¯æˆ‘å°±æäº¤äº†ä¸€ä¸ªåˆå¹¶è¯·æ±‚(PR)ï¼Œç„¶åå¾ˆå¿«å°±å¾—åˆ° greggman çš„å›åº”ï¼Œæˆ‘çš„ PR å·²è¢«åˆå¹¶åˆ° master ä¸­ã€‚\nå‘µï¼Œæˆ‘ä¹Ÿé¡ºå¸¦æˆä¸ºäº†è¿™ä¸ªé¡¹ç›®ä¸­çš„ä¸€å è´¡çŒ®è€…(contributor)ã€‚\nç¬¬2æ­¥ï¼šè§£æäººå£æ•°æ® ä¸ºäº†æ–¹ä¾¿æˆ‘ä»¬ä»¥åä»£ç æç¤ºï¼Œæˆ‘ä»¬å…ˆä½¿ç”¨ TypeScript å®šä¹‰è§£æ .asc æ•°æ®åçš„æ ¼å¼\ntype DataType = (number | undefined)[][] type ASCData = { data: DataType, ncols: number, nrows: number, xllcorner: number, yllcorner: number, cellsize: number, NODATA_value: number, max: number, min: number, } data ä¸ºæ …æ ¼åŒ–çš„ä¸–ç•Œäººå£æ•°æ®ï¼Œä¸€å…± nrows æ¡ï¼Œæ¯ä¸€æ¡æ˜¯ç”± ncols ä¸ªæ•°å­—æ„æˆ\nå‡è®¾æŸä¸ªç‚¹å¯¹åº”æœ‰äººå£æ•°æ®åˆ™å€¼ä¸ºå…·ä½“çš„æ•°å­—ï¼Œè‹¥æ²¡æœ‰äººå£åˆ™å€¼ä¸º undefinedã€‚\nè¯·è®°å¾—æ²¡æœ‰äººå£æ•°æ®çš„å€¼ä¸º undefinedï¼Œè€Œä¸æ˜¯ 0ã€‚\nmaxã€min åˆ†åˆ«ä¸ºæˆ‘ä»¬æ·»åŠ çš„è‡ªå®šä¹‰å±æ€§ï¼Œç”¨æ¥è®°å½•æ‰€æœ‰åœ°åŒºäººå£æ•°æ®ä¸­æœ€å¤šå’Œæœ€å°‘çš„äººå£æ•°é‡ï¼Œä»¥æ­¤æˆ‘ä»¬æ–¹ä¾¿è®¡ç®—å‡º æŸ±çŠ¶é«˜åº¦æ¯”ä¾‹\nå¼€å§‹è§£æ .asc æ–‡ä»¶å†…å®¹ï¼Œå¤§ä½“æ­¥éª¤å¦‚ä¸‹ï¼š\né¦–å…ˆæˆ‘ä»¬çŸ¥é“ .asc ä¸­æ¯ä¸€è¡Œå¯¹åº”ä¸€æ¡æ•°æ®ï¼Œé‚£ä¹ˆå°±å¯ä»¥ä½¿ç”¨æ¢è¡Œç¬¦ â€˜\\nâ€™ æ¥åˆ†éš”å‡ºæ¯ä¸€æ¡æ•°æ®ï¼Œç„¶åé’ˆå¯¹æ¯ä¸€æ¡æ•°æ®è¿›è¡Œè§£æ\ntext.split('\\n').forEach((line) =\u003e { ... }) è¢«åˆ†éš”å‡ºæ¥çš„æ¯ä¸€è¡Œæ•°æ®ï¼Œå†è¿›ä¸€æ­¥è½¬åŒ–å’Œåˆ†æï¼š\nç”±äºå¯èƒ½å­˜åœ¨å¤šä¸ªè¿ç»­ç©ºæ ¼ï¼Œå› æ­¤æˆ‘ä»¬å¯¹æ¯ä¸€æ¡æ•°æ®ï¼Œå†é€šè¿‡æ­£åˆ™è¡¨è¾¾å¼ /\\s+/ è¿›ä¸€æ­¥åˆ†éš”\n// åœ¨æ­£åˆ™è¡¨è¾¾å¼ â€˜/\\s+/â€™ ä¸­ s è¡¨ç¤ºä¸ºç©ºæ ¼ï¼Œ+ è¡¨ç¤º 1ä¸ªæˆ–å¤šä¸ª const parts = line.trim().split(/\\s+/) ä½äº .asc æ–‡ä»¶å¼€å¤´ï¼Œæè¿°æ …æ ¼åŒ–æ•°æ®çš„ä¸€äº›å±æ€§ï¼Œä¾‹å¦‚ ncolsã€nrowsâ€¦ï¼Œè¿™äº›æ•°æ®çš„ç»“æ„ä¸ºï¼šå±æ€§å + ç©ºæ ¼ + å€¼ æ„æˆçš„\nif (parts.length === 2) { ... } ä½äº .asc æ–‡ä»¶ä¸­é—´ï¼Œä¸€è¡Œè¡Œï¼Œä¸€æ¡æ¡å…·ä½“çš„æ•°æ®å€¼ï¼Œè¿™äº›æ•°æ®çš„ç»“æ„ä¸ºï¼šæ•°å­— + ç©ºæ ¼ + æ•°å­— + ...\nif (parts.length \u003e 2) { ... } ä½äº .asc æ–‡ä»¶å°¾éƒ¨ï¼Œå¯èƒ½å­˜åœ¨çš„ã€æ— ç”¨çš„ç©ºç™½æ¢è¡Œï¼Œè¿™äº›ç©ºç™½æ¢è¡Œæ˜¯éœ€è¦è¢«æˆ‘ä»¬é€šè¿‡æ¡ä»¶åˆ¤æ–­æ¥å¿½ç•¥æ‰çš„\nç”±äºå‰é¢å·²ç»è¿›è¡Œäº† length === 2 æˆ– \u003e 2 çš„åˆ¤æ–­ï¼Œé‚£ä¹ˆå‰©ä¸‹çš„å°±è‚¯å®šæ˜¯ç©ºç™½æ— ç”¨çš„æ¢è¡Œï¼Œæˆ‘ä»¬ä»€ä¹ˆä¹Ÿä¸åšå¤„ç†å°±å¥½ã€‚ åœ¨è§£ææ‰€æœ‰äººå£æ•°æ®çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬è¦ä¸æ–­è®°å½•ã€å¾—å‡º äººå£æœ€å¤§æ•°å€¼å’Œæœ€å°æ•°å€¼\næœ€ç»ˆå°†è§£æå¥½çš„æ•°æ®ç»“æœå¯¹è±¡ï¼Œé€šè¿‡ TS çš„ as æ–­è¨€ï¼Œå¯¹å¤–è¿”å›å‡ºç»“æœ\nè¡¥å……ä¸€ç‚¹ï¼šç”±äºæˆ‘ä»¬ä» text ä¸­è¯»å–åˆ°çš„ â€œæ•°å­—â€ å…¶å®æ˜¯ å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥åœ¨è§£æè¿‡ç¨‹ä¸­éƒ½éœ€è¦ä½¿ç”¨ parseFloat() è¿™ä¸ªå‡½æ•°å°† string è½¬åŒ–ä¸º number\nå†è¡¥å……ä¸€ä¸ªç»†èŠ‚ï¼Œåœ¨åˆå§‹åŒ– max å’Œ min æ—¶ï¼š\nè®© max åˆå§‹åŒ–å€¼ä¸º 0ï¼Œå› ä¸ºæˆ‘ä»¬çŸ¥é“æœ‰äººå£æ•°æ®çš„å€¼ä¸€å®šæ˜¯å¤§äº 0 çš„ è®© min åˆå§‹åŒ–å€¼ä¸º 99999ï¼Œå› ä¸ºæˆ‘ä»¬çŸ¥é“ä¸€å®šæœ‰äººå£æ•°æ®çš„å€¼ä¸€å®šæ˜¯å°äº 99999 çš„ï¼Œä¸”äººå£æ•°é‡ä¸€å®šä¸ä¼šæ˜¯è´Ÿæ•° å…·ä½“çš„ä»£ç ï¼š\nconst parseData = (text: string) =\u003e { const data: (number|undefined)[][] = [] const settings: { [key: string]: any } = { data } let max:number = 0 let min:number = 99999 text.split('\\n').forEach((line) =\u003e { const parts = line.trim().split(/\\s+/) if (parts.length === 2) { settings[parts[0]] = parseFloat(parts[1]) } else if(parts.length \u003e 2) { const values = parts.map((item) =\u003e { const value = parseFloat(item) if (value === settings['NODATA_value']) { return undefined } max = Math.max(max, value) min = Math.min(min, value) return value }) data.push(values) } }) return { ...settings, ...{ max, min } } as ASCData } ç¬¬3æ­¥ï¼šåŠ è½½åœ°çƒçº¹ç†å›¾ç‰‡ const loader = new Three.TextureLoader() const texture = loader.load(require('@/assets/imgs/world.jpg').default,render) const material = new Three.MeshPhongMaterial({ map: texture }) const geometry = new Three.SphereBufferGeometry(2, 32, 32) const earth = new Three.Mesh(geometry, material) scene.add(earth) è¯·æ³¨æ„ä¸Šè¿°ä»£ç ä¸­ï¼Œloader.load(xxx, render)ï¼Œæˆ‘ä»¬å¸Œæœ›å½“çº¹ç†å›¾ç‰‡åŠ è½½å®Œæˆåï¼Œæ‰æ‰§è¡Œ render æ¸²æŸ“\nç¬¬4æ­¥ï¼šå°†äººå£æ•°æ®ä¸åœ°çƒçº¹ç†å›¾ç‰‡è¿›è¡Œä½ç½®ä¸Šçš„åŒ¹é… å…ˆä¸è€ƒè™‘çƒä½“ï¼Œå‡è®¾æˆ‘ä»¬ä»…ä»…æƒ³è·å¾—ä¸€å¼ æ˜¾ç¤ºäººå£æ•°é‡åˆ†å¸ƒã€å¹³é¢çš„ä¸–ç•Œåœ°å›¾ï¼Œè¯¥å¦‚ä½•åšå‘¢ï¼Ÿ\nä»£ç æ€è·¯ï¼š\næˆ‘ä»¬é€šè¿‡ ç¬¬ 2 æ­¥éª¤å·²ç»æ‹¿åˆ°äº†æ …æ ¼åŒ–åçš„ä¸–ç•Œäººå£åˆ†å¸ƒæ•°æ® å¹¶ä¸”æˆ‘ä»¬çŸ¥é“æ …æ ¼åŒ–çš„æ•°æ®æ˜¯ç”± nrow(145) è¡Œã€ncols(360) åˆ—ç»„æˆ å‡è®¾ 1 ä¸ªæ•°æ®ç‚¹ å¯¹åº” 1 åƒç´ ï¼Œé‚£ä¹ˆæ …æ ¼åŒ–çš„æ•°æ®å®é™…ä¸Šå¯¹åº”çš„æ˜¯ä¸€ä¸ª é«˜ 145 åƒç´ ã€å®½ 360 åƒç´ çš„å›¾å½¢ å‡è®¾ æ•°æ®ç‚¹æœ€å°(äººå£æœ€å°‘)çš„åœ°æ–¹ï¼Œæˆ‘ä»¬ç”¨é»‘è‰²æ¥å¡«å……ï¼Œè€Œæ•°æ®ç‚¹æœ€å¤§(äººå£æœ€å¤š)çš„åœ°æ–¹ç”¨çº¢è‰²å¡«å……ï¼Œå¤„äºä¸­é—´æ•°é‡çš„ç‚¹æŒ‰ç…§æ¯”ä¾‹ä¾æ¬¡è¿›è¡Œé¢œè‰²å˜åŒ–ï¼Œé‚£ä¹ˆå°±å¯ä»¥å¾—åˆ°æˆ‘ä»¬æƒ³è¦çš„å›¾å½¢äº†ã€‚ å…³äºæŸä¸ªç‚¹å¡«å……çš„é¢œè‰²ï¼Œæˆ‘ä»¬ä½¿ç”¨ HSL(è‰²ç›¸ã€é¥±å’Œåº¦ã€äº®åº¦)ï¼Œå…¶ä¸­å½“ äººå£å°‘æ—¶ L çš„å€¼è¶Šæ¥è¿‘äº 0 (é»‘è‰²)ã€äººå£å¤šæ—¶ L çš„å€¼è¶Šæ¥è¿‘ 1 (çº¢è‰²) å‘ç”»å¸ƒ(canvas) æŸä¸ªç‚¹å¡«å……é¢œè‰²ï¼Œéœ€è¦ç”¨åˆ° canvas ä¸€äº›ç›¸å…³çŸ¥è¯†ï¼Œè¯·è‡ªè¡Œå…ˆå­¦ä¹ äº†è§£ä¸€ä¸‹ canvas ç›¸å…³çŸ¥è¯† å¯¹åº”çš„ä»£ç ï¼š\nconst hsl = (h: number, s: number, l: number) =\u003e { return `hsl(${h * 360 | 0},${s * 100 | 0}%,${l * 100 | 0}%)` } const drawData = (ascData: ASCData) =\u003e { if (canvasRef.current === null) { return } const ctx = canvasRef.current.getContext('2d') if (ctx === null) { return } const range = ascData.max - ascData.min ctx.canvas.width = ascData.ncols ctx.canvas.height = ascData.nrows ctx.fillStyle = '#444' ctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height) ascData.data.forEach((row, rowIndex) =\u003e { row.forEach((value, colIndex) =\u003e { if (value === undefined) { return } const amount = (value - ascData.min) / range const hue = 1 const saturation = 1 const lightness = amount ctx.fillStyle = hsl(hue, saturation, lightness) ctx.fillRect(colIndex,rowIndex,1,1) }) }) } ä¸ºäº†è®©ä½ æ¯”è¾ƒç›´è§‚çœ‹æ¸…ï¼Œè¿™é‡Œè´´å‡ºç›®å‰æˆ‘ä»¬å·²ç»å†™å‡ºæ¥çš„ä»£ç ã€‚\nè¯·æ³¨æ„ä¸‹é¢çš„ä»£ç å¹¶ä¸æ˜¯æˆ‘ä»¬çœŸæ­£ç¤ºä¾‹çš„ä»£ç ï¼Œä½ å¯ä»¥å®é™…è¿è¡Œä»¥ä¸‹ï¼ŒæŸ¥çœ‹æ•ˆæœ\nimport { useEffect, useRef } from 'react' const loadDataFile = async (url: string) =\u003e { const res = await window.fetch(url) const text = await res.text() return text } type DataType = (number | undefined)[][] type ASCData = { data: DataType, ncols: number, nrows: number, xllcorner: number, yllcorner: number, cellsize: number, NODATA_value: number, max: number, min: number, } const parseData = (text: string) =\u003e { const data: DataType = [] const settings: { [key: string]: any } = { data } let max: number = 0 let min: number = 99999 text.split('\\n').forEach((line) =\u003e { const parts = line.trim().split(/\\s+/) if (parts.length === 2) { settings[parts[0]] = parseFloat(parts[1]) } else if (parts.length \u003e 2) { const values = parts.map((item) =\u003e { const value = parseFloat(item) if (value === settings['NODATA_value']) { return undefined } max = Math.max(max, value) min = Math.min(min, value) return value }) data.push(values) } }) return { ...settings, ...{ max, min } } as ASCData } const hsl = (h: number, s: number, l: number) =\u003e { return `hsl(${h * 360 | 0},${s * 100 | 0}%,${l * 100 | 0}%)` } const HelloEarth = () =\u003e { const canvasRef = useRef(null) const drawData = (ascData: ASCData) =\u003e { if (canvasRef.current === null) { return } const ctx = canvasRef.current.getContext('2d') if (ctx === null) { return } const range = ascData.max - ascData.min ctx.canvas.width = ascData.ncols ctx.canvas.height = ascData.nrows ctx.fillStyle = '#444' ctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height) ascData.data.forEach((row, rowIndex) =\u003e { row.forEach((value, colIndex) =\u003e { if (value === undefined) { return } const amount = (value - ascData.min) / range const hue = 1 const saturation = 1 const lightness = amount ctx.fillStyle = hsl(hue, saturation, lightness) ctx.fillRect(colIndex,rowIndex,1,1) }) }) } useEffect(() =\u003e { if (canvasRef.current === null) { return } const ascURL = require('@/assets/data/gpw_v4_014mt_2010.asc').default const doSomthing = async () =\u003e { try { const text = await loadDataFile(ascURL) const ascData = parseData(text) drawData(ascData) } catch (error) { console.log(error) } } doSomthing() return () =\u003e { } }, [canvasRef]) return ( ) } export default HelloEarth å®é™…è¿è¡Œåï¼Œå°±ä¼šçœ‹åˆ°ä¸€å¼  ä¸–ç•Œäººå£åˆ†å¸ƒçš„åœ°å›¾\nè¯·æ³¨æ„è¿™ä¸ª â€œçœ‹ä¼¼æ˜¯ä¸–ç•Œåœ°å›¾â€çš„å›¾ç‰‡å¹¶ä¸æ˜¯çœŸæ­£çš„ä¸–ç•Œåœ°ç†ä½ç½®åœ°å›¾ï¼Œè€Œæ˜¯äººå£æ•°é‡åˆ†å¸ƒå›¾ã€‚\nå¦‚æœä½ å·²ç»çœ‹æ‡‚äº†ä¸Šé¢çš„ä»£ç ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥å°±å¯ä»¥çœŸæ­£å»åˆ¶ä½œ 3D ç«‹ä½“åœ°çƒç¤ºä¾‹äº†ã€‚\næœ¬ç¤ºä¾‹æ˜¯æˆ‘ä»¬åšè¿‡çš„æœ€å¤æ‚çš„ä¾‹å­ï¼Œå°½ç®¡æˆ‘ä»¬å·²ç»è¿›è¡Œäº†è¯¦ç»†çš„æ€è·¯è§£è¯»ï¼Œä½ ä¸€å®šè¦å¤šçœ‹ï¼Œå¤šæ•²å‡ éï¼Œå¦åˆ™æ¥ä¸‹æ¥çš„ä»£ç ä½ å¯èƒ½æ›´åŠ éš¾ä»¥ç†è§£ã€‚\næˆ‘ä»¬éœ€è¦å°†ä¹‹å‰çš„ drawData() ä¿®æ”¹ ä¸º addBoxes()ï¼Œå¹¶ä¸”ä¸å†æ˜¯åœ¨ canvas ä¸­ç»˜åˆ¶ç‚¹ï¼Œè€Œæ˜¯åœ¨çƒä½“ä¸Šæ·»åŠ æŸ±çŠ¶ç‰©ï¼š\nconst addBoxes = (ascData: ASCData, scene: Three.Scene) =\u003e { const geometry = new Three.BoxBufferGeometry(1, 1, 1) geometry.applyMatrix4(new Three.Matrix4().makeTranslation(0, 0, 0.5)) const lonHelper = new Three.Object3D() scene.add(lonHelper) const latHelper = new Three.Object3D() lonHelper.add(latHelper) const positionHelper = new Three.Object3D() positionHelper.position.z = 1 latHelper.add(positionHelper) const range = ascData.max - ascData.min const lonFudge = Math.PI * 0.5 const latFudge = Math.PI * -0.135 ascData.data.forEach((row, latIndex) =\u003e { row.forEach((value, lonIndex) =\u003e { if (value === undefined) { return } const amount = (value - ascData.min) / range const material = new Three.MeshBasicMaterial() const hue = Three.MathUtils.lerp(0.7, 0.3, amount) const saturation = 1 const lightness = Three.MathUtils.lerp(0.1, 1, amount) material.color.setHSL(hue, saturation, lightness) const mesh = new Three.Mesh(geometry, material) scene.add(mesh) lonHelper.rotation.y = Three.MathUtils.degToRad(lonIndex + ascData.xllcorner) + lonFudge latHelper.rotation.x = Three.MathUtils.degToRad(latIndex + ascData.yllcorner) + latFudge positionHelper.updateWorldMatrix(true, false) mesh.applyMatrix4(positionHelper.matrixWorld) mesh.scale.set(0.005, 0.005, Three.MathUtils.lerp(0.001, 0.5, amount)) }) }) } ä¸Šé¢ä»£ç ä¸­ç‰µæ‰¯åˆ°äº†éå¸¸å¤šæ–°çš„ã€ä¹‹å‰ä»æœªä½¿ç”¨è¿‡çš„ä¸€äº›å‡½æ•°æˆ–å±æ€§ã€‚\nè§£é‡Šè¯´æ˜ï¼š\næ …æ ¼åŒ–æ•°æ® å’Œ çº¹ç†å›¾ç‰‡ å‡å¯çœ‹ä½œæ˜¯ 2D çŸ©å½¢åæ ‡ï¼Œæœ€ç»ˆéœ€è¦è½¬åŒ–ä¸º 3D çƒä½“åæ ‡ï¼Œè½¬åŒ–è¿‡ç¨‹ä¸­ lonFudgeã€latFudge å…·ä½“ä½œç”¨æœºç†ï¼Œæš‚æ—¶è¿˜æ²¡ææ˜ç™½ã€‚\nå…ˆè®°ä½è½¬åŒ–å…¬å¼ï¼Œä»¥åå†æ…¢æ…¢ç ”ç©¶\næ …æ ¼åŒ–æ•°æ® ä¸º 360 145ã€çº¹ç†å›¾ç‰‡ä¸º 2048 1024\nThree.Matrix4ï¼šWebGL ä¸­çš„çŸ©é˜µåº“\nThree.MathUtilsï¼šThree.js ä¸­å†…ç½®çš„ä¸€äº›è®¡ç®—å‡½æ•°\nå…³äºè¿™äº›æ–°çš„å¯¹è±¡å…·ä½“è¯¦ç»†ä»‹ç»ï¼Œè¯·æŸ¥é˜… Three.js å®˜æ–¹æ–‡æ¡£\nlonHelperç”¨äºèµ¤é“ä¸Šçš„ç»åº¦æ—‹è½¬ã€latHelperç”¨äºç»´åº¦æ—‹è½¬ã€positionHelperç”¨äº Z è½´(åœ°çƒåœ°é¢)ä¸Šçš„åç§»ã€‚\nlonFudge çš„å€¼ä¸º Math.PI * 0.5ï¼Œä¹Ÿå°±æ˜¯ç›¸å½“äº 1/4 ä¸ªåœ†(åœ°çƒ 1/4 åœˆ)\nlatFudge çš„å€¼ä¸º Math.PI * -0.135ï¼Œè¿™é‡Œçš„ -0.135 ä¸å¤ªæ¸…æ¥šæ˜¯æ€ä¹ˆå¾—å‡ºæ¥çš„ï¼Œä½†æ˜¯å¤§æ¦‚ç‡æ¨æµ‹å®ƒæ˜¯ç”¨æ¥å°†æŸ±çŠ¶ç‰©ä¸çº¹ç†å›¾ç‰‡å¯¹é½çš„\nç¤ºä¾‹æ‰€éœ€å…¶ä»–ä»£ç å—ï¼š\nåˆ›å»º 3D åœ°çƒã€ä»¥åŠåŠ è½½çº¹ç†å›¾ç‰‡ æ·»åŠ  OrbitControls æ§åˆ¶ï¼Œå¹¶ä¸”å¼€å¯ â€œå¼¹æ€§ç»“æŸæ§åˆ¶â€ æ·»åŠ åœºæ™¯æ¸²æŸ“å‡½æ•° renderï¼Œå¹¶ä¸”æ·»åŠ  â€œæŒ‰éœ€æ¸²æŸ“â€ ç›¸å…³ä»£ç  æœ€ç»ˆå®Œæ•´çš„ç¤ºä¾‹ä»£ç ï¼š\nimport { useEffect, useRef } from 'react' import * as Three from 'three' import { OrbitControls } from 'three/examples/jsm/controls/OrbitControls' import './index.scss' const loadDataFile = async (url: string) =\u003e { const res = await window.fetch(url) const text = await res.text() return text } type DataType = (number | undefined)[][] type ASCData = { data: DataType, ncols: number, nrows: number, xllcorner: number, yllcorner: number, cellsize: number, NODATA_value: number, max: number, min: number, } const parseData = (text: string) =\u003e { const data: DataType = [] const settings: { [key: string]: any } = { data } let max: number = 0 let min: number = 99999 text.split('\\n').forEach((line) =\u003e { const parts = line.trim().split(/\\s+/) if (parts.length === 2) { settings[parts[0]] = parseFloat(parts[1]) } else if (parts.length \u003e 2) { const values = parts.map((item) =\u003e { const value = parseFloat(item) if (value === settings['NODATA_value']) { return undefined } max = Math.max(max, value) min = Math.min(min, value) return value }) data.push(values) } }) return { ...settings, ...{ max, min } } as ASCData } // const hsl = (h: number, s: number, l: number) =\u003e { // return `hsl(${h * 360 | 0},${s * 100 | 0}%,${l * 100 | 0}%)` // } let renderRequested = false const HelloEarth = () =\u003e { const canvasRef = useRef(null) // const drawData = (ascData: ASCData) =\u003e { // if (canvasRef.current === null) { return } // const ctx = canvasRef.current.getContext('2d') // if (ctx === null) { return } // const range = ascData.max - ascData.min // ctx.canvas.width = ascData.ncols // ctx.canvas.height = ascData.nrows // ctx.fillStyle = '#444' // ctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height) // ascData.data.forEach((row, rowIndex) =\u003e { // row.forEach((value, colIndex) =\u003e { // if (value === undefined) { return } // const amount = (value - ascData.min) / range // const hue = 1 // const saturation = 1 // const lightness = amount // ctx.fillStyle = hsl(hue, saturation, lightness) // ctx.fillRect(colIndex, rowIndex, 1, 1) // }) // }) // } const addBoxes = (ascData: ASCData, scene: Three.Scene) =\u003e { const geometry = new Three.BoxBufferGeometry(1, 1, 1) geometry.applyMatrix4(new Three.Matrix4().makeTranslation(0, 0, 0.5)) const lonHelper = new Three.Object3D() scene.add(lonHelper) const latHelper = new Three.Object3D() lonHelper.add(latHelper) const positionHelper = new Three.Object3D() positionHelper.position.z = 1 latHelper.add(positionHelper) const range = ascData.max - ascData.min const lonFudge = Math.PI * 0.5 const latFudge = Math.PI * -0.135 ascData.data.forEach((row, latIndex) =\u003e { row.forEach((value, lonIndex) =\u003e { if (value === undefined) { return } const amount = (value - ascData.min) / range const material = new Three.MeshBasicMaterial() const hue = Three.MathUtils.lerp(0.7, 0.3, amount) const saturation = 1 const lightness = Three.MathUtils.lerp(0.1, 1, amount) material.color.setHSL(hue, saturation, lightness) const mesh = new Three.Mesh(geometry, material) scene.add(mesh) lonHelper.rotation.y = Three.MathUtils.degToRad(lonIndex + ascData.xllcorner) + lonFudge latHelper.rotation.x = Three.MathUtils.degToRad(latIndex + ascData.yllcorner) + latFudge positionHelper.updateWorldMatrix(true, false) mesh.applyMatrix4(positionHelper.matrixWorld) mesh.scale.set(0.005, 0.005, Three.MathUtils.lerp(0.001, 0.5, amount)) }) }) } useEffect(() =\u003e { if (canvasRef.current === null) { return } const canvas = canvasRef.current const renderer = new Three.WebGLRenderer({ canvas }) const camera = new Three.PerspectiveCamera(45, 2, 0.1, 100) camera.position.z = 4 const scene = new Three.Scene() scene.background= new Three.Color(0x000000) const controls = new OrbitControls(camera, canvas) controls.enableDamping = true controls.enablePan =false controls.update() const render = () =\u003e { renderRequested = false controls.update() renderer.render(scene, camera) } const handleChange =() =\u003e{ if(renderRequested === false){ renderRequested = true window.requestAnimationFrame(render) } } controls.addEventListener('change',handleChange) const loader = new Three.TextureLoader() const texture = loader.load(require('@/assets/imgs/world.jpg').default, render) const material = new Three.MeshBasicMaterial({ map: texture }) const geometry = new Three.SphereBufferGeometry(1, 64, 32) const earth = new Three.Mesh(geometry, material) scene.add(earth) const handleResize = () =\u003e { const width = canvas.clientWidth const height = canvas.clientHeight camera.aspect = width / height camera.updateProjectionMatrix() renderer.setSize(width, height, false) window.requestAnimationFrame(render) } handleResize() window.addEventListener('resize', handleResize) const ascURL = require('@/assets/data/gpw_v4_014mt_2010.asc').default const doSomthing = async () =\u003e { try { const text = await loadDataFile(ascURL) const ascData = parseData(text) //drawData(ascData) addBoxes(ascData, scene) render() } catch (error) { console.log(error) } } doSomthing() return () =\u003e { controls.removeEventListener('change',handleChange) window.removeEventListener('resize', handleResize) } }, [canvasRef]) return ( ) } export default HelloEarth è°ƒè¯•è¿è¡Œï¼Œé¦–å…ˆå°±ä¼šçœ‹åˆ°ä¸€ä¸ª 3D ç«‹ä½“åœ°çƒï¼Œç­‰å¾… 1 ç§’å·¦å³ï¼Œå¾… .asc æ•°æ®åŠ è½½å¹¶è§£æã€æ·»åŠ åœ°çƒä¸Šçš„æŸ±çŠ¶ç‰©åï¼Œå°±ä¼šçœ‹åˆ°æœ¬ç¤ºä¾‹æ‰€æƒ³æ¼”ç¤ºçš„æœ€ç»ˆæ•ˆæœã€‚\nç»ˆäºç»ˆäºåˆ°è¿™ä¸€æ­¥äº†\nä¸è¿‡å½“ä½ é¼ æ ‡æ‹–åŠ¨åœ°çƒæ—¶ï¼Œä¼šæ„Ÿå—åˆ°ç•¥å¾®å¡é¡¿ï¼Œæˆ–è€…è¯´ä¸å¤Ÿæµç•…ã€‚\né‚£ä¹ˆæ¥ä¸‹æ¥ï¼Œå°±åˆ°äº†æœ¬æ–‡çš„æ ¸å¿ƒå†…å®¹ï¼šé€šè¿‡ åˆå¹¶å¯¹è±¡ æ¥è¾¾åˆ°ä¼˜åŒ–åœºæ™¯çš„ç›®çš„ã€‚\nè¡¥å……ï¼šå¯ç”¨æµè§ˆå™¨ è°ƒè¯•å·¥å…· DevTool çš„ Rendering æŸ¥çœ‹æ¸²æŸ“æ€§èƒ½ é™¤äº†æµè§ˆå™¨æœ¬èº«çš„ æ€§èƒ½(Performance) é¢æ¿å¤–ï¼Œè¿˜æœ‰å¦å¤–ä¸€ä¸ªé‡è¦çš„ã€æ–¹ä¾¿æˆ‘ä»¬æŸ¥çœ‹é¡µé¢æ¸²æŸ“æ€§èƒ½çš„å·¥å…·â€”â€”Renderingã€‚\né€šè¿‡è°·æ­Œè°ƒè¯•å·¥å…· Renderingï¼ŒæŸ¥çœ‹å½“å‰é¡µé¢æ¸²æŸ“æ€§èƒ½æƒ…å†µï¼š\næ‰“å¼€æµè§ˆå™¨è°ƒè¯•å·¥å…· DevTool\nç‚¹å‡»å³ä¾§ 3 ä¸ªå°åœ†ç‚¹\né¼ æ ‡ç§»åŠ¨åˆ° More tools\nç‚¹å‡» Rendering\nåœ¨æ–°å‡ºç°çš„ Rendering é¢æ¿ä¸­ï¼Œå‹¾é€‰ Frame Rendering Stats\nå¤‡æ³¨ï¼šåœ¨æ—§çš„è°·æ­Œæµè§ˆå™¨ä¸­ï¼Œåº”è¯¥å‹¾é€‰çš„æ˜¯ Show FPS meter\nè¿™æ ·å°±å¯ä»¥åœ¨ç½‘é¡µå·¦ä¸Šè§’ï¼Œå®æ—¶çœ‹åˆ°å½“å‰æ¸²æŸ“æ€§èƒ½çŠ¶å†µã€‚\næ€§èƒ½æ•°æ®è§£è¯»ï¼š\næ€§èƒ½å±•ç¤ºçš„æ•°æ®ï¼Œä¸»è¦ 2 ä¸ªæ¨¡å—ï¼šFrames å’Œ GPU\nGPU ç›¸å…³ï¼š\nGPU raster ï¼šon è¡¨ç¤º GPU å…‰æ …åŒ–å·²å¼€å¯\nGPU memoryï¼šGPU å·²ç”¨å¤§å°ã€GPU æœ€å¤§å¯ç”¨å¤§å°\nåœ¨æœ¬ç¤ºä¾‹ä¸­ï¼Œé€šå¸¸æ˜¯å½“ä¿®æ”¹æµè§ˆå™¨å°ºå¯¸æ—¶ï¼Œæ­¤æ—¶éœ€è¦å¤§é‡è®¡ç®—ï¼Œä¼šæ˜¾ç¤ºå‡º GPU memory\nåœ¨æ™®é€šçš„ é¼ æ ‡æ‹–æ‹½ æ”¹å˜åœ°çƒè§†è§’æ—¶ï¼Œä¸ä¼šæ˜¾ç¤º GPU memory\nFramesç›¸å…³ï¼š\nå‡è®¾æŸä¸€æ—¶åˆ»ï¼Œæ¸²æŸ“æ€§èƒ½ç»“æœä¸º Framesï¼š63% 1082(0m) dropped of 2737\nå¯¹åº”çš„è§£è¯»ä¸ºï¼š\nç¬¬1ä¸ªæ•°å­— 63% â€”â€” 63% çš„å¸§æŒ‰æ—¶æ¸²æŸ“å®Œæˆ\nç¬¬2ä¸ªæ•°å­— 1082 â€”â€” æœ‰ 1082 ä¸ªåˆæˆå¸§ä¸¢å¤±(æœªæ¸²æŸ“)\nç¬¬3ä¸ªæ•°å­— 0m â€”â€” æœ‰ 0 ä¸ªå¸§ä¸¢å¤±\nç¬¬4ä¸ªæ•°å­— 2737 â€”â€” åŸæœ¬è®¡åˆ’æ¸²æŸ“ 2737 ä¸ªå¸§\næ•°å­—ä¹‹é—´çš„è®¡ç®—å…³ç³»ä¸º 63% â‰ˆ 1 - (1082 + 0 )/ 2737\nä¹Ÿå°±æ˜¯è¯´ ç¬¬2ä¸ªæ•°å­—(ä¸¢å¤±çš„åˆæˆå¸§)è¶Šå°ï¼Œé‚£ä¹ˆæ•´ä½“æŒ‰æ—¶å®Œæˆæ¸²æŸ“å¸§çš„ç™¾åˆ†æ¯”(ç¬¬1ä¸ªæ•°å­—)è¶Šå¤§ï¼Œæ„å‘³ç€æ­¤åˆ»ç½‘é¡µè¶Šæµç•…ã€‚\nä¼˜åŒ–ä»£ç ï¼šåˆå¹¶å¯¹è±¡ æ ¸å¿ƒä»£ç åˆ†æ åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä»£ç ä¸­ï¼ŒlonHelperç”¨äºèµ¤é“ä¸Šçš„ç»åº¦æ—‹è½¬ã€latHelperç”¨äºç»´åº¦æ—‹è½¬ã€positionHelperç”¨äº Z è½´(åœ°çƒåœ°é¢)ä¸Šçš„åç§»ã€‚\né»˜è®¤ Three.js ä¸­ç‰©ä½“æ˜¯æœ‰ 1/2 ä½äº Z è½´ä¹‹ä¸‹çš„ï¼Œé€šè¿‡Zè½´çš„åç§»è®©æŸ±çŠ¶ç‰©å¯ä»¥å®Œå…¨å‡ºç°åœ¨åœ°é¢ä¸Š\næ¯ä¸€ä¸ªæ•°æ®ç‚¹(æŸ±çŠ¶ç‰©)éƒ½åˆ›å»ºäº†ä¸€ä¸ª MeshBasicMaterial å’Œ Meshã€‚\næˆ‘ä»¬çš„æ•°æ®ç‚¹ä¸€å…±ä¸º 145è¡Œã€360åˆ—ï¼Œé‚£ä¹ˆå°±æ„å‘³ç€å‡è®¾å…¨éƒ¨æ•°æ®ç‚¹éƒ½æœ‰æ•°æ®ï¼Œé‚£ä¹ˆæ•°æ®ç‚¹æ€»æ•°é‡ä¸ºï¼š145 * 360 = 52200ï¼Œä½†æ˜¯è€ƒè™‘åˆ°æœ‰éå¸¸å¤šçš„æ•°æ®ç‚¹çš„å€¼ä¸º -9999(NODATA_value)ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰å€¼ï¼Œä¸éœ€è¦ç»˜åˆ¶ï¼Œé‚£ä¹ˆå‡å»è¿™äº›æ²¡æœ‰æ•°æ®ç‚¹ï¼Œæœ€ç»ˆéœ€è¦ç»˜åˆ¶çš„æ•°æ®ç‚¹(æŸ±çŠ¶ç‰©)å¤§çº¦ä¸º 19000 ä¸ªã€‚\næŸ±çŠ¶ç‰©19000ä¸ªï¼Œå†åŠ ä¸Šå¯¹åº”çš„ 3 ä¸ªè¾…åŠ©å¯¹è±¡(lonHelperã€latHelperã€positionHelper)ï¼Œç›¸å½“äºæ€»ç»˜åˆ¶æ•°é‡ä¸º 19000 * 4 = 76000ã€‚\nä¹Ÿå°±æ˜¯è¯´æ¯ä¸€æ¬¡åœºæ™¯æ›´æ–°ï¼Œå¤§çº¦éœ€è¦ç»˜åˆ¶ 7.6 ä¸‡ä¸ªå¯¹è±¡ï¼Œæ‰€ä»¥è¿™æ‰é€ æˆäº†å¡é¡¿ç°è±¡ã€‚\nå¦‚ä½•è§£å†³å¡é¡¿ï¼Ÿå‡å°‘éœ€è¦æ¸²æŸ“å¯¹è±¡çš„æ•°é‡ï¼\nè¿˜è®°å¾—æˆ‘ä»¬åˆšæ‰ç»Ÿè®¡çš„æ¸²æŸ“å¯¹è±¡æ•°é‡å—ï¼Ÿ\næŸ±çŠ¶ä½“ çº¦ 19000ä¸ª æ¯ä¸ªæŸ±çŠ¶ä½“å¯¹åº” 3 ä¸ªè¾…åŠ©å¯¹è±¡ 19000 * 3 æˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯æŠŠæ‰€æœ‰çš„æŸ±çŠ¶ä½“åˆå¹¶æˆä¸€ä¸ªç‰©ä½“ï¼Œä¹Ÿå°±æ˜¯è¯´åŸæœ¬éœ€è¦æ¸²æŸ“ 19000 ä¸ªæŸ±çŠ¶ä½“ï¼Œåˆå¹¶ä¹‹ååªéœ€æ¸²æŸ“ 1 ä¸ªï¼Œè®©æŸ±çŠ¶ä½“æ•°é‡å‡å°‘ 18999 ä¸ªã€‚\nä¿®æ”¹ addBoxes å‡½æ•°ä»£ç ï¼š\nimport { BufferGeometryUtils } from 'three/examples/jsm/utils/BufferGeometryUtils' const addBoxes = (ascData: ASCData, scene: Three.Scene) =\u003e { //const geometry = new Three.BoxBufferGeometry(1, 1, 1) //geometry.applyMatrix4(new Three.Matrix4().makeTranslation(0, 0, 0.5)) const lonHelper = new Three.Object3D() scene.add(lonHelper) const latHelper = new Three.Object3D() lonHelper.add(latHelper) const positionHelper = new Three.Object3D() positionHelper.position.z = 1 latHelper.add(positionHelper) const originHelper = new Three.Object3D() originHelper.position.z = 0.5 positionHelper.add(originHelper) const range = ascData.max - ascData.min const lonFudge = Math.PI * 0.5 const latFudge = Math.PI * -0.135 const geometries: Three.BoxBufferGeometry[] = [] const color = new Three.Color() ascData.data.forEach((row, latIndex) =\u003e { row.forEach((value, lonIndex) =\u003e { if (value === undefined) { return } const amount = (value - ascData.min) / range //const material = new Three.MeshBasicMaterial() //const hue = Three.MathUtils.lerp(0.7, 0.3, amount) //const saturation = 1 //const lightness = Three.MathUtils.lerp(0.1, 1, amount) //material.color.setHSL(hue, saturation, lightness) //const mesh = new Three.Mesh(geometry, material) //scene.add(mesh) const geometry = new Three.BoxBufferGeometry(1, 1, 1) lonHelper.rotation.y = Three.MathUtils.degToRad(lonIndex + ascData.xllcorner) + lonFudge latHelper.rotation.x = Three.MathUtils.degToRad(latIndex + ascData.yllcorner) + latFudge //positionHelper.updateWorldMatrix(true, false) //mesh.applyMatrix4(positionHelper.matrixWorld) //mesh.scale.set(0.005, 0.005, Three.MathUtils.lerp(0.001, 0.5, amount)) positionHelper.scale.set(0.005, 0.005, Three.MathUtils.lerp(0.01, 0.5, amount)) originHelper.updateWorldMatrix(true, false) geometry.applyMatrix4(originHelper.matrixWorld) const hue = Three.MathUtils.lerp(0.7, 0.3, amount) const saturation = 1 const lightness = Three.MathUtils.lerp(0.1, 1, amount) color.setHSL(hue, saturation, lightness) const rgb = color.toArray().map((value) =\u003e { return value * 255 }) const numVerts = geometry.getAttribute('position').count const itemSize = 3 const colors = new Uint8Array(itemSize * numVerts) //è¿™é‡Œæœ‰ä¸€ä¸ªç¨å¾®å¥‡è‘©ç‚¹çš„å†™æ³•ï¼Œå°±æ˜¯ä½¿ç”¨ä¸‹åˆ’çº¿ _ æ¥èµ·åˆ°å‚æ•°å ä½çš„ä½œç”¨ colors.forEach((_, index) =\u003e { colors[index] = rgb[index % 3] }) const normalized = true const colorAttrib = new Three.BufferAttribute(colors, itemSize, normalized) geometry.setAttribute('color', colorAttrib) geometries.push(geometry) }) }) const mergedGeometry = BufferGeometryUtils.mergeBufferGeometries(geometries) //const material = new Three.MeshBasicMaterial({ color: 'red' }) const material = new Three.MeshBasicMaterial({ vertexColors: true }) const mesh = new Three.Mesh(mergedGeometry, material) scene.add(mesh) } ä¸Šè¿°ä»£ç ä¸­ï¼Œæ³¨é‡Šéƒ¨åˆ†ä¸ºä¹‹å‰ addBoxes() å‡½æ•°çš„ä»£ç ï¼Œé™¤äº† //const material = new Three.MeshBasicMaterial({ color: â€˜redâ€™ }) è¿™ä¸€è¡Œ\nä»£ç è§£æï¼š\nåˆå¹¶æ‰€æœ‰çš„æŸ±çŠ¶ç‰©ï¼Œä½¿ç”¨åˆ°äº†ä¸€ä¸ªæ–°çš„å‡½æ•° BufferGeometryUtils.mergeBufferGeometries()\næ³¨æ„ï¼šBufferGeometryUtils å¹¶éæ¥è‡ª Threeï¼Œè€Œæ˜¯æ¥è‡ª â€™three/examples/jsm/utils/BufferGeometryUtilsâ€™\næŸ±çŠ¶ç‰©çš„é¢œè‰²ï¼Œä¸å†ä½¿ç”¨ color è®¾å®šï¼Œè€Œæ˜¯å¯ç”¨äº† â€œé¡¶ç‚¹ç€è‰²â€ã€‚\nå…³äºè¿™ 2 ä¸ªå¤§çš„çŸ¥è¯†ç‚¹ï¼Œå¯ä»¥å»é˜…è¯» Three.js å®˜æ–¹æ–‡æ¡£\néœ€è¦æ¶è¡¥å®˜æ–¹æ–‡æ¡£ï¼Œå¦‚æœåªæ˜¯çœ‹äº†æœ¬æ•™ç¨‹ï¼Œé‚£ä¹ˆè¿˜ä¼šæœ‰å¤§é‡çš„çŸ¥è¯†ç‚¹æœªæ›¾æ¥è§¦ã€‚\nç»è¿‡åˆå¹¶ä¼˜åŒ–åçš„åœºæ™¯ï¼Œåœ¨æµè§ˆå™¨ä¸­è¿è¡Œï¼Œæ¯”ä¹‹å‰çš„æµç•…éå¸¸å¤šï¼Œæ²¡æœ‰å¡é¡¿çš„ç°è±¡äº†ã€‚\næˆ‘æœ¬æœºç”µè„‘ç¡¬ä»¶é…ç½®æ¯”è¾ƒé«˜ï¼Œæˆ‘åˆ†åˆ«è®°å½•äº† Rendering é¢æ¿ä¸­ ä¼˜åŒ–å‰åçš„ Frames å€¼ã€‚\nä¼˜åŒ–å‰ï¼šé¡ºåˆ©æ¸²æŸ“å¸§çš„ç™¾åˆ†æ¯”çº¦ä¸º 60%\nä¼˜åŒ–åï¼šé¡ºåˆ©æ¸²æŸ“å¸§çš„ç™¾åˆ†æ¯”çº¦ä¸º 90%\nå¯è§ç½‘é¡µæµç•…åº¦ç¡®å®æé«˜äº†å¾ˆå¤š\næœ¬æ–‡å°ç»“ åœ¨ Three.js å¤§å‹çš„åœºæ™¯ä¸­ï¼Œç»å¤§å¤šæ•°éƒ½éœ€è¦é‡‡ç”¨åˆå¹¶å¯¹è±¡çš„ç­–ç•¥æ¥ä¼˜åŒ–æ¸²æŸ“æ€§èƒ½ã€‚\nåˆå¹¶å¯¹è±¡å¯ä»¥å‡å°‘éœ€è¦æ¸²æŸ“çš„å¯¹è±¡æ•°é‡ï¼Œå¹¶ä¸”è¿˜å¯ä»¥å°†æœ‰ä¸€äº›æ ¹æœ¬ä¸å¯è§çš„é¢è¿›è¡Œåˆ é™¤ï¼Œå‡å°‘æ¸²æŸ“é¢ï¼Œæé«˜æ¸²æŸ“æ€§èƒ½ã€‚\nä½ ä»¥ä¸ºå°±è¿™æ ·å¯ä»¥ç»“æŸäº†ï¼Ÿ\näº‹å®ä¸Šè¿˜æœ‰ä¼˜åŒ–ç©ºé—´ï¼Œæœ¬æ–‡å…ˆåˆ°è¿™é‡Œç»“æŸã€‚\nä¸‹ä¸€ç¯‡å°†ç»§ç»­ä¼˜åŒ–è¿™ä¸ªåœºæ™¯ã€‚\n",
  "wordCount" : "7517",
  "inLanguage": "en",
  "datePublished": "2023-12-19T17:11:35+08:00",
  "dateModified": "2023-12-19T17:11:35+08:00",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://bablvsj.github.io/posts/threejs/20-three.js%E4%BC%98%E5%8C%96%E4%B9%8B%E5%90%88%E5%B9%B6%E5%AF%B9%E8%B1%A1/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Bablvsj's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://bablvsj.github.io/img/Q.gif"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://bablvsj.github.io" accesskey="h" title="Bablvsj&#39;s Blog (Alt + H)">Bablvsj&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://bablvsj.github.io/" title="ä¸»é¡µ">
                    <span>ä¸»é¡µ</span>
                </a>
            </li>
            <li>
                <a href="https://bablvsj.github.io/archives/" title="æ—¶é—´è½´">
                    <span>æ—¶é—´è½´</span>
                </a>
            </li>
            <li>
                <a href="https://bablvsj.github.io/tags" title="æ ‡ç­¾">
                    <span>æ ‡ç­¾</span>
                </a>
            </li>
            <li>
                <a href="https://bablvsj.github.io/about" title="å…³äº">
                    <span>å…³äº</span>
                </a>
            </li>
            <li>
                <a href="https://bablvsj.github.io/search" title="ğŸ” (Alt &#43; /)" accesskey=/>
                    <span>ğŸ”</span>
                </a>
            </li>
        </ul>
    </nav>
</header>


<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title">
      20 Three.jsä¼˜åŒ–ä¹‹åˆå¹¶å¯¹è±¡
    </h1>
    <div class="post-meta">
      
<div class="post-tags-meta">
    <a href="https://bablvsj.github.io/tags/three.js/">Three.js</a>
</div>

16 min&nbsp;Â·&nbsp;<span title='2023-12-19 17:11:35 +0800 CST'>2023/12/19</span>


      
    </div>
    
  </header> <aside id="toc-container" class="toc-container wide">
    <div class="toc">
        
        <div class="inner"><ul><ul><ul>
                <li>
                    <a href="#%e6%9c%ac%e6%96%87%e6%88%91%e4%bb%ac%e7%9a%84%e7%9b%ae%e6%a0%87%e5%88%b6%e4%bd%9c%e5%b9%b6%e4%bc%98%e5%8c%96%e4%b8%80%e4%b8%aa%e6%98%be%e7%a4%ba%e5%9c%b0%e7%90%83%e4%ba%ba%e5%8f%a3%e4%ba%ba%e6%95%b0%e5%88%86%e5%b8%83%e7%9a%84%e5%8f%af%e8%a7%86%e5%8c%963d%e5%9c%b0%e7%90%83" aria-label="æœ¬æ–‡æˆ‘ä»¬çš„ç›®æ ‡ï¼šåˆ¶ä½œå¹¶ä¼˜åŒ–ä¸€ä¸ªæ˜¾ç¤ºåœ°çƒäººå£äººæ•°åˆ†å¸ƒçš„å¯è§†åŒ–3Dåœ°çƒ">æœ¬æ–‡æˆ‘ä»¬çš„ç›®æ ‡ï¼šåˆ¶ä½œå¹¶ä¼˜åŒ–ä¸€ä¸ªæ˜¾ç¤ºåœ°çƒäººå£äººæ•°åˆ†å¸ƒçš„å¯è§†åŒ–3Dåœ°çƒ</a></li>
                <li>
                    <a href="#%e6%a0%b8%e5%bf%83%e6%a8%a1%e5%9d%97%e5%88%86%e6%9e%90" aria-label="æ ¸å¿ƒæ¨¡å—åˆ†æ">æ ¸å¿ƒæ¨¡å—åˆ†æ</a></li>
                <li>
                    <a href="#%e5%a6%82%e4%bd%95%e5%ae%9e%e7%8e%b0%e8%a1%a8%e7%a4%ba%e4%ba%ba%e5%8f%a3%e5%a4%9a%e5%b0%91%e7%9a%84%e6%9f%b1%e7%8a%b6%e7%89%a9" aria-label="å¦‚ä½•å®ç°â€œè¡¨ç¤ºäººå£å¤šå°‘çš„æŸ±çŠ¶ç‰©â€ï¼Ÿ">å¦‚ä½•å®ç°â€œè¡¨ç¤ºäººå£å¤šå°‘çš„æŸ±çŠ¶ç‰©â€ï¼Ÿ</a></li></ul>
                    </ul>
                    
                <li>
                    <a href="#%e5%9f%ba%e7%a1%80%e7%a4%ba%e4%be%8bhelloearth" aria-label="åŸºç¡€ç¤ºä¾‹ï¼šHelloEarth">åŸºç¡€ç¤ºä¾‹ï¼šHelloEarth</a><ul>
                        <ul>
                        
                <li>
                    <a href="#%e7%ac%ac1%e6%ad%a5%e5%8a%a0%e8%bd%bd%e4%ba%ba%e5%8f%a3%e6%95%b0%e6%8d%ae%e6%96%87%e4%bb%b6gpw_v4_014mt_2010asc" aria-label="ç¬¬1æ­¥ï¼šåŠ è½½äººå£æ•°æ®æ–‡ä»¶(gpw_v4_014mt_2010.asc)">ç¬¬1æ­¥ï¼šåŠ è½½äººå£æ•°æ®æ–‡ä»¶(gpw_v4_014mt_2010.asc)</a></li>
                <li>
                    <a href="#%e7%ac%ac2%e6%ad%a5%e8%a7%a3%e6%9e%90%e4%ba%ba%e5%8f%a3%e6%95%b0%e6%8d%ae" aria-label="ç¬¬2æ­¥ï¼šè§£æäººå£æ•°æ®">ç¬¬2æ­¥ï¼šè§£æäººå£æ•°æ®</a></li>
                <li>
                    <a href="#%e7%ac%ac3%e6%ad%a5%e5%8a%a0%e8%bd%bd%e5%9c%b0%e7%90%83%e7%ba%b9%e7%90%86%e5%9b%be%e7%89%87" aria-label="ç¬¬3æ­¥ï¼šåŠ è½½åœ°çƒçº¹ç†å›¾ç‰‡">ç¬¬3æ­¥ï¼šåŠ è½½åœ°çƒçº¹ç†å›¾ç‰‡</a></li>
                <li>
                    <a href="#%e7%ac%ac4%e6%ad%a5%e5%b0%86%e4%ba%ba%e5%8f%a3%e6%95%b0%e6%8d%ae%e4%b8%8e%e5%9c%b0%e7%90%83%e7%ba%b9%e7%90%86%e5%9b%be%e7%89%87%e8%bf%9b%e8%a1%8c%e4%bd%8d%e7%bd%ae%e4%b8%8a%e7%9a%84%e5%8c%b9%e9%85%8d" aria-label="ç¬¬4æ­¥ï¼šå°†äººå£æ•°æ®ä¸åœ°çƒçº¹ç†å›¾ç‰‡è¿›è¡Œä½ç½®ä¸Šçš„åŒ¹é…">ç¬¬4æ­¥ï¼šå°†äººå£æ•°æ®ä¸åœ°çƒçº¹ç†å›¾ç‰‡è¿›è¡Œä½ç½®ä¸Šçš„åŒ¹é…</a></li>
                <li>
                    <a href="#%e8%a1%a5%e5%85%85%e5%90%af%e7%94%a8%e6%b5%8f%e8%a7%88%e5%99%a8-%e8%b0%83%e8%af%95%e5%b7%a5%e5%85%b7-devtool-%e7%9a%84-rendering-%e6%9f%a5%e7%9c%8b%e6%b8%b2%e6%9f%93%e6%80%a7%e8%83%bd" aria-label="è¡¥å……ï¼šå¯ç”¨æµè§ˆå™¨ è°ƒè¯•å·¥å…· DevTool çš„ Rendering æŸ¥çœ‹æ¸²æŸ“æ€§èƒ½">è¡¥å……ï¼šå¯ç”¨æµè§ˆå™¨ è°ƒè¯•å·¥å…· DevTool çš„ Rendering æŸ¥çœ‹æ¸²æŸ“æ€§èƒ½</a></li></ul>
                    </ul>
                </li>
                <li>
                    <a href="#%e4%bc%98%e5%8c%96%e4%bb%a3%e7%a0%81%e5%90%88%e5%b9%b6%e5%af%b9%e8%b1%a1" aria-label="ä¼˜åŒ–ä»£ç ï¼šåˆå¹¶å¯¹è±¡">ä¼˜åŒ–ä»£ç ï¼šåˆå¹¶å¯¹è±¡</a><ul>
                        <ul>
                        
                <li>
                    <a href="#%e6%a0%b8%e5%bf%83%e4%bb%a3%e7%a0%81%e5%88%86%e6%9e%90" aria-label="æ ¸å¿ƒä»£ç åˆ†æ">æ ¸å¿ƒä»£ç åˆ†æ</a></li>
                <li>
                    <a href="#%e6%9c%ac%e6%96%87%e5%b0%8f%e7%bb%93" aria-label="æœ¬æ–‡å°ç»“">æœ¬æ–‡å°ç»“</a>
                </li>
            </ul>
            </ul>
            </li>
            </ul>
        </div>
    </div>
</aside>
<script>
    let activeElement;
    let elements;
    window.addEventListener('DOMContentLoaded', function (event) {
        checkTocPosition();

        elements = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]');
         
         activeElement = elements[0];
         const id = encodeURI(activeElement.getAttribute('id')).toLowerCase();
         document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
     }, false);

    window.addEventListener('resize', function(event) {
        checkTocPosition();
    }, false);

    window.addEventListener('scroll', () => {
        
        activeElement = Array.from(elements).find((element) => {
            if ((getOffsetTop(element) - window.pageYOffset) > 0 && 
                (getOffsetTop(element) - window.pageYOffset) < window.innerHeight/2) {
                return element;
            }
        }) || activeElement

        elements.forEach(element => {
             const id = encodeURI(element.getAttribute('id')).toLowerCase();
             if (element === activeElement){
                 document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
             } else {
                 document.querySelector(`.inner ul li a[href="#${id}"]`).classList.remove('active');
             }
         })
     }, false);

    const main = parseInt(getComputedStyle(document.body).getPropertyValue('--article-width'), 10);
    const toc = parseInt(getComputedStyle(document.body).getPropertyValue('--toc-width'), 10);
    const gap = parseInt(getComputedStyle(document.body).getPropertyValue('--gap'), 10);

    function checkTocPosition() {
        const width = document.body.scrollWidth;

        if (width - main - (toc * 2) - (gap * 4) > 0) {
            document.getElementById("toc-container").classList.add("wide");
        } else {
            document.getElementById("toc-container").classList.remove("wide");
        }
    }

    function getOffsetTop(element) {
        if (!element.getClientRects().length) {
            return 0;
        }
        let rect = element.getBoundingClientRect();
        let win = element.ownerDocument.defaultView;
        return rect.top + win.pageYOffset;   
    }
</script>

  <div class="post-content"><p>å‰é¢å­¦ä¹ äº† Three.js å…¥é—¨ã€åŸºç¡€ã€æŠ€å·§ï¼Œä»Šå¤©å¼€å§‹å­¦ä¹  Three.js çš„æ€§èƒ½ä¼˜åŒ–ã€‚</p>
<p>å…³äºæ€§èƒ½ä¼˜åŒ–æœ‰å¾ˆå¤šæ–¹å¼ï¼Œæœ€åŸºç¡€ä¹Ÿæ˜¯æœ€å¸¸è§çš„æ–¹å¼å°±æ˜¯â€”â€”åˆå¹¶å‡ ä½•å¯¹è±¡ã€‚</p>
<blockquote>
<p>åœ¨ â€œThree.js åŸºç¡€ä¹‹å›¾å…ƒâ€ é‚£ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†å‡ ä½•ä½“ç§°å‘¼ä¸º å›¾å…ƒï¼Œç°åœ¨æˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹è¿™ä¸ªç§°å‘¼ï¼Œæœ¬æ–‡ä»¥åï¼Œç»å¤§å¤šæ•°æƒ…å†µä¸‹æˆ‘ä»¬éƒ½ä½¿ç”¨ â€œå‡ ä½•ä½“â€ æ¥ä»£æ›¿ â€œå›¾å…ƒâ€ã€‚</p>
</blockquote>
<p>æ—¢ç„¶è°ˆåˆ°æ€§èƒ½ä¼˜åŒ–ï¼Œå°±ä¸èƒ½ä½¿ç”¨ç®€å•çš„ç¤ºä¾‹ï¼Œè¦ä¸ç„¶æ ¹æœ¬æ— æ³•ä½“ç°å‡º ä¼˜åŒ–å‰å’Œä¼˜åŒ–å çš„åŒºåˆ«ã€‚</p>
<p>æ¿€åŠ¨äººå¿ƒçš„æ—¶åˆ»åˆ°äº†ã€‚</p>
<h4 id="æœ¬æ–‡æˆ‘ä»¬çš„ç›®æ ‡åˆ¶ä½œå¹¶ä¼˜åŒ–ä¸€ä¸ªæ˜¾ç¤ºåœ°çƒäººå£äººæ•°åˆ†å¸ƒçš„å¯è§†åŒ–3dåœ°çƒ">æœ¬æ–‡æˆ‘ä»¬çš„ç›®æ ‡ï¼šåˆ¶ä½œå¹¶ä¼˜åŒ–ä¸€ä¸ªæ˜¾ç¤ºåœ°çƒäººå£äººæ•°åˆ†å¸ƒçš„å¯è§†åŒ–3Dåœ°çƒ<a hidden class="anchor" aria-hidden="true" href="#æœ¬æ–‡æˆ‘ä»¬çš„ç›®æ ‡åˆ¶ä½œå¹¶ä¼˜åŒ–ä¸€ä¸ªæ˜¾ç¤ºåœ°çƒäººå£äººæ•°åˆ†å¸ƒçš„å¯è§†åŒ–3dåœ°çƒ">#</a></h4>
<p>ä½ å¯ä»¥å…ˆè®¿é—®ä»¥ä¸‹ç½‘å€ï¼Œå…ˆæ„Ÿå—ä¸€ä¸‹æˆ‘ä»¬æœ¬æ–‡è¦æ¨¡ä»¿çš„æ•ˆæœï¼š</p>
<p><a href="https://globe.chromeexperiments.com/">https://globe.chromeexperiments.com/</a></p>
<blockquote>
<p>è¡¥å……è¯´æ˜ï¼šè¿™ä¸ªç½‘ç«™ï¼Œæ˜¯è°·æ­Œæµè§ˆå™¨ä¸ºäº†å‘å¤§ä¼—æ¼”ç¤º WebGL æŠ€æœ¯è€Œåˆ¶ä½œçš„ä¸€ä¸ªæ¼”ç¤ºç½‘é¡µã€‚</p>
</blockquote>
<p>æˆ‘ç›¸ä¿¡ä½ ç¬¬ä¸€æ¬¡çœ‹åˆ°è¿™ç§åŸºäºæµè§ˆå™¨çš„ 3D åœ°çƒæ•°æ®å±•ç¤ºï¼Œä¸€å®šä¼šè¢«éœ‡æ’¼åˆ°çš„ã€‚</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬å°±è¦é€æ­¥åˆ†æï¼Œæ‰¾å‡ºå®ç°æ–¹å¼ã€‚</p>
<p><strong>æˆ‘ä»¬å…ˆè€ƒè™‘æ€ä¹ˆæŠŠè¿™ä¸ªåœºæ™¯å®ç°å‡ºæ¥ï¼Œç„¶åå†è€ƒè™‘ä¼˜åŒ–çš„äº‹ã€‚</strong></p>
<h4 id="æ ¸å¿ƒæ¨¡å—åˆ†æ">æ ¸å¿ƒæ¨¡å—åˆ†æ<a hidden class="anchor" aria-hidden="true" href="#æ ¸å¿ƒæ¨¡å—åˆ†æ">#</a></h4>
<p>æˆ‘ä»¬è¦å…ˆææ˜ç™½è¿™ä¸ª 3D æ•°å­—åœ°çƒçš„æ ¸å¿ƒæ¨¡å—ã€‚</p>
<ol>
<li>
<p>3D åœ°çƒ</p>
<blockquote>
<p>å°±æ˜¯ä¸€ä¸ªçƒä½“ï¼Œæ·»åŠ ä¸€ä¸ªåœ°çƒçº¹ç†å›¾ç‰‡</p>
<blockquote>
<p>å›¾ç‰‡ä¸ºä¸€ä¸ªçŸ©å½¢åœ°çƒå±•å¼€å›¾ï¼Œæœ¬ç¤ºä¾‹ä½¿ç”¨çš„åœ°çƒçº¹ç†å›¾ç‰‡èµ„æºï¼š<br>
<a href="https://threejsfundamentals.org/threejs/resources/images/world.jpg">https://threejsfundamentals.org/threejs/resources/images/world.jpg</a></p>
</blockquote>
</blockquote>
</li>
<li>
<p>è¡¨ç¤ºäººå£å¤šå°‘çš„æŸ±çŠ¶ç‰©</p>
<blockquote>
<p>æŸä¸ªåœ°åŒºäººå£å¤šåˆ™æŸ±çŠ¶ç‰©å°±æ¯”è¾ƒé«˜ï¼Œåä¹‹äººå£å°‘åˆ™æŸ±çŠ¶ç‰©æ¯”è¾ƒä½</p>
</blockquote>
</li>
<li>
<p>é¼ æ ‡å¯äº¤äº’</p>
<blockquote>
<p>è¿™ä¸ªç›´æ¥ä½¿ç”¨ OrbitControls å°±å¯ä»¥
åªä¸è¿‡æœ¬ç¤ºä¾‹åªå…è®¸å·¦å³ã€ä¸Šä¸‹æ‹–æ‹½æŸ¥çœ‹ï¼Œä½†ä¸å…è®¸ä¿®æ”¹é•œå¤´è½¨é“çš„è¿œè¿‘è·ç¦»</p>
</blockquote>
</li>
</ol>
<p>ä¸Šé¢çš„æ ¸å¿ƒæ¨¡å— 1 ã€3 éƒ½å¾ˆå®¹æ˜“å®ç°ï¼Œé‡ç‚¹æˆ‘ä»¬è¿›ä¸€æ­¥æ‹†è§£ä¸€ä¸‹ â€œè¡¨ç¤ºäººå£å¤šå°‘çš„æŸ±çŠ¶ç‰©â€ã€‚</p>
<h4 id="å¦‚ä½•å®ç°è¡¨ç¤ºäººå£å¤šå°‘çš„æŸ±çŠ¶ç‰©">å¦‚ä½•å®ç°â€œè¡¨ç¤ºäººå£å¤šå°‘çš„æŸ±çŠ¶ç‰©â€ï¼Ÿ<a hidden class="anchor" aria-hidden="true" href="#å¦‚ä½•å®ç°è¡¨ç¤ºäººå£å¤šå°‘çš„æŸ±çŠ¶ç‰©">#</a></h4>
<p>æˆ‘ä»¬é€šè¿‡ä»¥ä¸‹ 3 ä¸ªçµé­‚è¿½é—®ï¼Œæ¥æ¢³ç†æ€è·¯ã€‚</p>
<p><strong>ç¬¬1é—®ï¼šäººå£æ•°æ®ä»å“ªé‡Œæ¥ï¼Ÿ</strong></p>
<p>åŸç½‘é¡µæä¾› 3 ä¸ªå¹´ä»½çš„äººå£æ•°é‡ç»Ÿè®¡ï¼Œåˆ†åˆ«æ˜¯ 1990ã€1995ã€2000å¹´ã€‚</p>
<p>ç¾å›½å›½å®¶èˆªå¤©å±€(NASA)æä¾›çš„ç»Ÿè®¡ç»“æœä»‹ç»é¡µï¼š
<a href="https://sedac.ciesin.columbia.edu/data/set/gpw-v4-admin-unit-center-points-population-estimates-rev11/data-download">https://sedac.ciesin.columbia.edu/data/set/gpw-v4-admin-unit-center-points-population-estimates-rev11/data-download</a></p>
<p>è¯·æ³¨æ„ï¼Œè¯¥é¡µé¢è¿˜æä¾›æœ€è¿‘å¹´ä»½çš„ç»Ÿè®¡ç»“æœï¼Œä½†æ˜¯ä¸‹è½½æ—¶å€™æç¤ºéœ€è¦æ³¨å†Œã€‚</p>
<p>æˆ‘ä»¬é€‰æ‹©ä¸ä½¿ç”¨æœ€æ–°çš„ 2020 å¹´æ•°æ®ï¼Œè€Œæ˜¯ä½¿ç”¨ 2010 å¹´çš„ç»“æœã€‚</p>
<p>ä¸ºäº†æ–¹ä¾¿ä½ è·å¾—åˆ° 2010 å¹´ç”·æ€§äººå£ç»Ÿè®¡ç»“æœï¼Œä½ å¯ä»¥ç›´æ¥ç‚¹å‡»ä¸‹é¢è¿™ä¸ªåœ°å€ï¼Œç›´æ¥ä¸‹è½½ï¼š</p>
<p><a href="https://threejsfundamentals.org/threejs/resources/data/gpw/gpw_v4_basic_demographic_characteristics_rev10_a000_014mt_2010_cntm_1_deg.asc">https://threejsfundamentals.org/threejs/resources/data/gpw/gpw_v4_basic_demographic_characteristics_rev10_a000_014mt_2010_cntm_1_deg.asc</a></p>
<blockquote>
<p>åæ­£æˆ‘ä»¬æœ¬æ–‡çš„é‡ç‚¹æ˜¯æ¨¡ä»¿æ•ˆæœï¼Œè‡³äºæ•°æ®æ—¶æ•ˆæ€§ä¸å¿…çº ç»“</p>
</blockquote>
<blockquote>
<p>è¯¥äººå£ç»Ÿè®¡æ•°æ®æ–‡ä»¶æ ¼å¼ä¸º .ascï¼Œè‡³äºå¦‚ä½•è§£æè¯¥æ–‡ä»¶ï¼Œæˆ‘ä»¬ä¼šç¨åè®²è§£</p>
</blockquote>
<blockquote>
<p>ä¸ºå•¥æ˜¯ç”·æ€§äººå£ç»Ÿè®¡ï¼Ÿå¥³æ€§äººå£å‘¢ï¼Ÿä¸ºä»€ä¹ˆä¸æ˜¯å…¨éƒ¨äººå£ç»Ÿè®¡å‘¢ï¼Ÿ<br>
å› ä¸ºåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œå°±ä¼šæœ‰å¥³æ€§äººå£ç»Ÿè®¡ï¼Œç„¶ååšå‡ºåŒä¸€ä¸ªåœ°åŒº ç”·å¥³äººå£æ•°é‡æ¯”è¾ƒ çš„åŠ¨ç”»<br>
ä¸ºäº†ç®€åŒ–ï¼Œæœ¬æ–‡ä¸‹é¢æ–‡å­—ä¸­ï¼Œå°†å¿½ç•¥ â€œç”·æ€§äººå£æ•°é‡â€ è¿™ä¸ªæ¦‚å¿µï¼Œç»Ÿä¸€ç§°å‘¼ä¸º â€œäººå£æ•°æ®â€</p>
</blockquote>
<p><strong>ç¬¬2é—®ï¼šäººå£æ•°æ®å’Œåœ°åŒºçš„å¯¹åº”å…³ç³»ï¼Œå¦‚ä½•è¡¨ç°åœ¨åœ°çƒä¸Šï¼Ÿ</strong></p>
<p>æˆ‘ä»¬æŠŠåˆšæ‰ä¸‹è½½å¾—åˆ°çš„äººå£ç»Ÿè®¡æ•°æ®æ–‡ä»¶ï¼Œé‡å‘½åä¸º gpw_v4_014mt_2010.ascï¼Œç„¶åå°†è¯¥æ–‡ä»¶ç§»åŠ¨åˆ°ï¼šsrc/assets/data/ ç›®å½•ä¸­ã€‚</p>
<p>ç‚¹å‡»è¯¥æ–‡ä»¶ï¼Œç”¨è®°äº‹æœ¬æŸ¥çœ‹è¯¥æ–‡ä»¶å†…å®¹ï¼Œä½ ä¼šå‘ç°é‡Œé¢å¤§è‡´ä¸ºä»¥ä¸‹å†…å®¹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#3c3836;background-color:#fbf1c7;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>ncols         360
</span></span><span style="display:flex;"><span>nrows         145
</span></span><span style="display:flex;"><span>xllcorner     -180
</span></span><span style="display:flex;"><span>yllcorner     -60
</span></span><span style="display:flex;"><span>cellsize      0.99999999999994
</span></span><span style="display:flex;"><span>NODATA_value  -9999
</span></span><span style="display:flex;"><span>-9999 -9999 -9999 -9999 -9999 -999...
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>...
</span></span></code></pre></div><p>è¿™é‡Œé¢çš„æ•°æ®å†…å®¹ä¸ºï¼š<strong>çŸ©å½¢åœ°çƒåœ°å›¾ä¸Šï¼Œä¸åŒç‚¹(ç»çº¬åº¦)å¯¹åº”çš„æ•°å€¼(äººå£æ•°é‡)</strong>ã€‚</p>
<blockquote>
<p>è¡¥å……ï¼šè¿™é‡Œé¢çš„äººå£æ•°é‡å€¼å¹¶ä¸æ˜¯å…·ä½“äººå£æ•°é‡(æ¯”å¦‚ 45932551 ä¸ªäºº)ï¼Œè€Œæ˜¯å…·æœ‰ä¸€å®šæ¯”ä¾‹å•ä½çš„å€¼(ä¾‹å¦‚ 458.6)</p>
<p>å…·ä½“å•ä½å€¼å¯¹åº”çš„äººå£æˆ‘è¿˜ä¸æ¸…æ¥šï¼Œæˆ–è®¸æ˜¯ ä¸‡ï¼Œä¹Ÿæˆ–è®¸æ˜¯ç™¾ä¸‡ï¼Œä¸è¿‡ä¸å½±å“æˆ‘ä»¬æœ¬ç¤ºä¾‹ï¼Œä½ åªéœ€æŠŠä»–å½“æˆæ•°å­—å³å¯</p>
</blockquote>
<p>æˆ‘ä»¬éœ€è¦å°†æ•°æ®ä¸åœ°å›¾çº¹ç†å›¾ç‰‡è¿›è¡Œç‚¹å¯¹ç‚¹çš„ä½ç½®åŒ¹é…ã€‚</p>
<blockquote>
<p>.asc åç¼€çš„æ–‡ä»¶æœ‰ç‰¹åˆ«å¤šç§ç”¨é€”å’Œåœºæ™¯ï¼Œæˆ‘ä»¬è¿™é‡Œæåˆ°çš„ .asc æ–‡ä»¶æ˜¯æŒ‡ï¼šä»¥ <code>PGP (Pretty Good Privacy) ASCII Armored File</code>å½¢å¼å­˜åœ¨çš„æ …æ ¼åŒ–ç»“æ„çš„æ•°æ®æ–‡ä»¶ã€‚</p>
</blockquote>
<blockquote>
<p><strong>.asc æ …æ ¼åŒ–ç»“æ„çš„æ•°æ®æ–‡ä»¶è¯´æ˜ï¼š</strong></p>
<table>
<thead>
<tr>
<th>å…³é”®å­—</th>
<th>å¯¹åº”å«ä¹‰</th>
</tr>
</thead>
<tbody>
<tr>
<td>ncols(number colos)</td>
<td>è¡¨ç¤ºè¯¥æ•°æ®å†…å®¹æœ‰å¤šå°‘åˆ—</td>
</tr>
<tr>
<td>nrows(number rows)</td>
<td>è¡¨ç¤ºè¯¥æ•°æ®å†…å®¹æœ‰å¤šå°‘è¡Œ</td>
</tr>
<tr>
<td>xllcorner(x-low-left-corner)</td>
<td>æ …æ ¼çš„å·¦ä¸‹è§’åæ ‡ x çš„å€¼</td>
</tr>
<tr>
<td>yllcorner(y-low-left-corner)</td>
<td>æ …æ ¼çš„å·¦ä¸‹è§’åæ ‡ y çš„å€¼</td>
</tr>
<tr>
<td>cellsize(cell size)</td>
<td>æ¯ä¸ªå•å…ƒæ ¼å…ƒçš„å°ºå¯¸</td>
</tr>
<tr>
<td>NODATA_value</td>
<td>å•å…ƒæ ¼å†…æ²¡æœ‰å€¼æ—¶å¯¹åº”çš„å€¼</td>
</tr>
</tbody>
</table>
<blockquote>
<p>ä½ å¯ä»¥æŠŠ .ascæ–‡ä»¶ æƒ³è±¡æˆä¸€ä¸ªæ•°æ®è¡¨æ ¼ï¼Œæ¯ä¸ªå•å…ƒæ ¼ä¸ºä¸€é¡¹ï¼Œnrows è¡Œ ncols åˆ— ä¸ªå•å…ƒæ ¼æ„å»ºæˆäº†ä¸€ä¸ª æ•°æ®ç½‘æ ¼ã€‚</p>
<p>é™¤äº† .asc å¼€å¤´çš„å±æ€§å€¼é”®å¯¹å¤–ï¼Œåé¢çš„å°±æ˜¯ä¾æ¬¡å¡«å…¥æ•°æ®å•å…ƒç½‘æ ¼ä¸­çš„æ•°æ®ã€‚</p>
</blockquote>
</blockquote>
<p><strong>ç¬¬3é—®ï¼šæ ¹æ®äººå£å¤šå°‘ï¼Œå¦‚ä½•åˆ›å»ºå¯¹åº”çš„æŸ±çŠ¶ç‰©ï¼Ÿ</strong></p>
<p>å½“å¾—åˆ°åœ°çƒæŸä¸ªç»çº¬åº¦(åœ°çƒçº¹ç†å›¾ç‰‡ä¸Šçš„æŸä¸ªåæ ‡)ä¸Šå¯¹åº”çš„äººå£æ•°æ®åï¼Œå°±å¯ä»¥æ ¹æ®äººå£æ•°é‡æŒ‰ç…§ä¸€å®šæ¯”ä¾‹ï¼Œåˆ›å»ºæŸ±çŠ¶ç‰©ã€‚</p>
<p>åŸç†è®²è¿‡åï¼Œé‚£æ¥ä¸‹æ¥å°±æ˜¯å®é™…æ“ä½œäº†ã€‚</p>
<h2 id="åŸºç¡€ç¤ºä¾‹helloearth">åŸºç¡€ç¤ºä¾‹ï¼šHelloEarth<a hidden class="anchor" aria-hidden="true" href="#åŸºç¡€ç¤ºä¾‹helloearth">#</a></h2>
<p>æ¥ä¸‹æ¥ï¼Œå°†é€šè¿‡ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼Œé€æ­¥å®ç°æˆ‘ä»¬çš„ç›®æ ‡ç¤ºä¾‹ã€‚</p>
<p><strong>ç‰¹åˆ«è¯´æ˜ï¼š</strong></p>
<p>ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ä¸­çš„ä»£ç ï¼Œé‡ç‚¹æ˜¯å‘ä½ è®²è§£å…·ä½“çš„åŠŸèƒ½å’Œæ€è·¯ï¼Œå¹¶ä¸æ˜¯æœ€ç»ˆçš„ä»£ç ã€‚</p>
<p>æœ€ç»ˆå®Œæ•´çš„ç¤ºä¾‹ä»£ç ä¸­ï¼Œä¼šå¯¹è¿™äº›æ¯ä¸ªæ­¥éª¤ä¸­çš„ä»£ç è¿›è¡Œæ–°çš„ç»„ç»‡ã€‚</p>
<h4 id="ç¬¬1æ­¥åŠ è½½äººå£æ•°æ®æ–‡ä»¶gpw_v4_014mt_2010asc">ç¬¬1æ­¥ï¼šåŠ è½½äººå£æ•°æ®æ–‡ä»¶(gpw_v4_014mt_2010.asc)<a hidden class="anchor" aria-hidden="true" href="#ç¬¬1æ­¥åŠ è½½äººå£æ•°æ®æ–‡ä»¶gpw_v4_014mt_2010asc">#</a></h4>
<ol>
<li>
<p><strong>æ•°æ®æ–‡ä»¶è·¯å¾„ä¸º ./src/assets/data/gpw_v4_014mt_2010.asc</strong></p>
</li>
<li>
<p><strong>ç”±äºæˆ‘ä»¬ä½¿ç”¨ alias æ¥å¾—åˆ° .asc æ–‡ä»¶ç¼–è¯‘åçš„è·¯å¾„ï¼Œæ‰€ä»¥è¯·è®°å¾—ï¼š</strong></p>
<ol>
<li>
<p>tsconfig.pahts.json çš„ paths ä¸­æ·»åŠ  <code>&quot;@/assets/*&quot;: [&quot;./src/assets/*&quot;]</code></p>
</li>
<li>
<p>global.d.ts ä¸­æ·»åŠ  <code>declare module '*.asc';</code></p>
</li>
<li>
<p>ä»¥ä¸Š 2 å¤„å‡é…ç½®æ­£ç¡®åï¼Œæ‰å¯ä»¥è®©æˆ‘ä»¬åœ¨ä»£ç ä¸­æ–¹ä¾¿ä½¿ç”¨ <code>require('@/assets/xx/xx.asc').default</code> æ¥è·å– .asc èµ„æºçš„è·¯å¾„</p>
<blockquote>
<p>å‡è®¾ä½ å¹¶ä¸æ˜¯ä½¿ç”¨ react + typescript + aliasï¼Œé‚£ä¹ˆä½ å¯ä»¥å¿½ç•¥æˆ‘æåˆ°çš„é…ç½®ï¼Œç›´æ¥è¯·æ±‚ä¸€ä¸ªå›ºå®šçš„ç½‘ç»œèµ„æº(.ascæ–‡ä»¶)å°±å¥½äº†ã€‚</p>
</blockquote>
</li>
</ol>
</li>
<li>
<p><strong>é€šè¿‡ window.fetch() è¿™ä¸ªå‡½æ•°æ¥è·å– .asc æ–‡ä»¶å†…å®¹</strong></p>
<blockquote>
<p>æˆ‘ä»¬è¿™é‡Œæ²¡æœ‰ä½¿ç”¨ xhr æˆ– axios æ¥è¯·æ±‚è·å–æ–‡ä»¶èµ„æºï¼Œè€Œæ˜¯ä½¿ç”¨äº† fetch è¿™ä¸ª Web API</p>
<p>å…³äº fetch çš„ç”¨æ³•ï¼Œè¯·å‚è€ƒï¼š<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Fetch_API">https://developer.mozilla.org/zh-CN/docs/Web/API/Fetch_API</a></p>
</blockquote>
</li>
</ol>
<p><strong>å…·ä½“çš„ä»£ç ï¼š</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#3c3836;background-color:#fbf1c7;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>const loadDataFile = async (url: string) =&gt; {
</span></span><span style="display:flex;"><span>    try {
</span></span><span style="display:flex;"><span>        const res = await window.fetch(url)
</span></span><span style="display:flex;"><span>        const text = await res.text() // text å°±æ˜¯ .asc æ–‡ä»¶é‡Œçš„å†…å®¹
</span></span><span style="display:flex;"><span>    } catch (error) {
</span></span><span style="display:flex;"><span>        console.log(&#39;åŠ è½½æ•°æ®å‡ºé”™&#39;)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>const ascURL = require(&#39;@/assets/data/gpw_v4_014mt_2010.asc&#39;).default
</span></span><span style="display:flex;"><span>loadDataFile(ascURL)
</span></span></code></pre></div><blockquote>
<p>é¢å¤–è¯´ä¸€ä¸ªäº‹æƒ…ï¼Œæœ¬æ–‡å¯¹åº”çš„æ˜¯ Three.js å®˜æ–¹æ•™ç¨‹ <a href="https://threejsfundamentals.org/threejs/lessons/threejs-optimize-lots-of-objects.html">https://threejsfundamentals.org/threejs/lessons/threejs-optimize-lots-of-objects.html</a></p>
<p>æˆ‘åœ¨é˜…è¯»è‹±æ–‡åŸæ–‡æ—¶ï¼Œå½“æ—¶ä»–ä»£ç ä¸­ä½¿ç”¨çš„æ˜¯ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#3c3836;background-color:#fbf1c7;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>async function loadFile(url) {
</span></span><span style="display:flex;"><span>  const req = await fetch(url);
</span></span><span style="display:flex;"><span>  return req.text();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>æˆ‘è®¤ä¸ºä¸åº”è¯¥å°†è¿”å›å€¼ä½¿ç”¨å˜é‡ req(request)ï¼Œè€Œåº”è¯¥æ˜¯ res(response)ï¼Œäºæ˜¯æˆ‘å°±æäº¤äº†ä¸€ä¸ªåˆå¹¶è¯·æ±‚(PR)ï¼Œç„¶åå¾ˆå¿«å°±å¾—åˆ° <a href="https://github.com/greggman">greggman</a> çš„å›åº”ï¼Œæˆ‘çš„ PR å·²è¢«åˆå¹¶åˆ° master ä¸­ã€‚</p>
<p>å‘µï¼Œæˆ‘ä¹Ÿé¡ºå¸¦æˆä¸ºäº†è¿™ä¸ªé¡¹ç›®ä¸­çš„ä¸€å è´¡çŒ®è€…(contributor)ã€‚</p>
</blockquote>
<h4 id="ç¬¬2æ­¥è§£æäººå£æ•°æ®">ç¬¬2æ­¥ï¼šè§£æäººå£æ•°æ®<a hidden class="anchor" aria-hidden="true" href="#ç¬¬2æ­¥è§£æäººå£æ•°æ®">#</a></h4>
<ol>
<li>
<p><strong>ä¸ºäº†æ–¹ä¾¿æˆ‘ä»¬ä»¥åä»£ç æç¤ºï¼Œæˆ‘ä»¬å…ˆä½¿ç”¨ TypeScript å®šä¹‰è§£æ .asc æ•°æ®åçš„æ ¼å¼</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#3c3836;background-color:#fbf1c7;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>type DataType = (number | undefined)[][]
</span></span><span style="display:flex;"><span>type ASCData = {
</span></span><span style="display:flex;"><span>    data: DataType,
</span></span><span style="display:flex;"><span>    ncols: number,
</span></span><span style="display:flex;"><span>    nrows: number,
</span></span><span style="display:flex;"><span>    xllcorner: number,
</span></span><span style="display:flex;"><span>    yllcorner: number,
</span></span><span style="display:flex;"><span>    cellsize: number,
</span></span><span style="display:flex;"><span>    NODATA_value: number,
</span></span><span style="display:flex;"><span>    max: number,
</span></span><span style="display:flex;"><span>    min: number,
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><blockquote>
<p>data ä¸ºæ …æ ¼åŒ–çš„ä¸–ç•Œäººå£æ•°æ®ï¼Œä¸€å…± nrows æ¡ï¼Œæ¯ä¸€æ¡æ˜¯ç”± ncols ä¸ªæ•°å­—æ„æˆ</p>
<p>å‡è®¾æŸä¸ªç‚¹å¯¹åº”æœ‰äººå£æ•°æ®åˆ™å€¼ä¸ºå…·ä½“çš„æ•°å­—ï¼Œè‹¥æ²¡æœ‰äººå£åˆ™å€¼ä¸º undefinedã€‚</p>
<p>è¯·è®°å¾—æ²¡æœ‰äººå£æ•°æ®çš„å€¼ä¸º undefinedï¼Œè€Œä¸æ˜¯ 0ã€‚</p>
<p>maxã€min åˆ†åˆ«ä¸ºæˆ‘ä»¬æ·»åŠ çš„è‡ªå®šä¹‰å±æ€§ï¼Œç”¨æ¥è®°å½•æ‰€æœ‰åœ°åŒºäººå£æ•°æ®ä¸­æœ€å¤šå’Œæœ€å°‘çš„äººå£æ•°é‡ï¼Œä»¥æ­¤æˆ‘ä»¬æ–¹ä¾¿è®¡ç®—å‡º æŸ±çŠ¶é«˜åº¦æ¯”ä¾‹</p>
</blockquote>
</li>
<li>
<p><strong>å¼€å§‹è§£æ .asc æ–‡ä»¶å†…å®¹ï¼Œå¤§ä½“æ­¥éª¤å¦‚ä¸‹ï¼š</strong></p>
<ol>
<li>
<p>é¦–å…ˆæˆ‘ä»¬çŸ¥é“ .asc ä¸­æ¯ä¸€è¡Œå¯¹åº”ä¸€æ¡æ•°æ®ï¼Œé‚£ä¹ˆå°±å¯ä»¥ä½¿ç”¨æ¢è¡Œç¬¦ &lsquo;\n&rsquo; æ¥åˆ†éš”å‡ºæ¯ä¸€æ¡æ•°æ®ï¼Œç„¶åé’ˆå¯¹æ¯ä¸€æ¡æ•°æ®è¿›è¡Œè§£æ</p>
<div class="highlight"><pre tabindex="0" style="color:#3c3836;background-color:#fbf1c7;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>text.split(&#39;\n&#39;).forEach((line) =&gt; { ... })
</span></span></code></pre></div></li>
<li>
<p>è¢«åˆ†éš”å‡ºæ¥çš„æ¯ä¸€è¡Œæ•°æ®ï¼Œå†è¿›ä¸€æ­¥è½¬åŒ–å’Œåˆ†æï¼š</p>
<ol>
<li>
<p>ç”±äºå¯èƒ½å­˜åœ¨å¤šä¸ªè¿ç»­ç©ºæ ¼ï¼Œå› æ­¤æˆ‘ä»¬å¯¹æ¯ä¸€æ¡æ•°æ®ï¼Œå†é€šè¿‡æ­£åˆ™è¡¨è¾¾å¼ <code>/\s+/</code> è¿›ä¸€æ­¥åˆ†éš”</p>
<div class="highlight"><pre tabindex="0" style="color:#3c3836;background-color:#fbf1c7;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>// åœ¨æ­£åˆ™è¡¨è¾¾å¼ â€˜/\s+/â€™ ä¸­ s è¡¨ç¤ºä¸ºç©ºæ ¼ï¼Œ+ è¡¨ç¤º 1ä¸ªæˆ–å¤šä¸ª
</span></span><span style="display:flex;"><span>const parts = line.trim().split(/\s+/)
</span></span></code></pre></div></li>
<li>
<p>ä½äº .asc æ–‡ä»¶å¼€å¤´ï¼Œæè¿°æ …æ ¼åŒ–æ•°æ®çš„ä¸€äº›å±æ€§ï¼Œä¾‹å¦‚ ncolsã€nrows&hellip;ï¼Œè¿™äº›æ•°æ®çš„ç»“æ„ä¸ºï¼š<code>å±æ€§å + ç©ºæ ¼ + å€¼</code> æ„æˆçš„</p>
<div class="highlight"><pre tabindex="0" style="color:#3c3836;background-color:#fbf1c7;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>if (parts.length === 2) { ... }
</span></span></code></pre></div></li>
<li>
<p>ä½äº .asc æ–‡ä»¶ä¸­é—´ï¼Œä¸€è¡Œè¡Œï¼Œä¸€æ¡æ¡å…·ä½“çš„æ•°æ®å€¼ï¼Œè¿™äº›æ•°æ®çš„ç»“æ„ä¸ºï¼š<code>æ•°å­— + ç©ºæ ¼ + æ•°å­— + ...</code></p>
<div class="highlight"><pre tabindex="0" style="color:#3c3836;background-color:#fbf1c7;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>if (parts.length &gt; 2) { ... }
</span></span></code></pre></div></li>
<li>
<p>ä½äº .asc æ–‡ä»¶å°¾éƒ¨ï¼Œå¯èƒ½å­˜åœ¨çš„ã€æ— ç”¨çš„ç©ºç™½æ¢è¡Œï¼Œè¿™äº›ç©ºç™½æ¢è¡Œæ˜¯éœ€è¦è¢«æˆ‘ä»¬é€šè¿‡æ¡ä»¶åˆ¤æ–­æ¥å¿½ç•¥æ‰çš„</p>
<div class="highlight"><pre tabindex="0" style="color:#3c3836;background-color:#fbf1c7;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>ç”±äºå‰é¢å·²ç»è¿›è¡Œäº† length === 2 æˆ– &gt; 2 çš„åˆ¤æ–­ï¼Œé‚£ä¹ˆå‰©ä¸‹çš„å°±è‚¯å®šæ˜¯ç©ºç™½æ— ç”¨çš„æ¢è¡Œï¼Œæˆ‘ä»¬ä»€ä¹ˆä¹Ÿä¸åšå¤„ç†å°±å¥½ã€‚
</span></span></code></pre></div></li>
</ol>
</li>
<li>
<p>åœ¨è§£ææ‰€æœ‰äººå£æ•°æ®çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬è¦ä¸æ–­è®°å½•ã€å¾—å‡º äººå£æœ€å¤§æ•°å€¼å’Œæœ€å°æ•°å€¼</p>
</li>
<li>
<p>æœ€ç»ˆå°†è§£æå¥½çš„æ•°æ®ç»“æœå¯¹è±¡ï¼Œé€šè¿‡ TS çš„ as æ–­è¨€ï¼Œå¯¹å¤–è¿”å›å‡ºç»“æœ</p>
</li>
<li>
<p>è¡¥å……ä¸€ç‚¹ï¼šç”±äºæˆ‘ä»¬ä» text ä¸­è¯»å–åˆ°çš„ â€œæ•°å­—â€ å…¶å®æ˜¯ å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥åœ¨è§£æè¿‡ç¨‹ä¸­éƒ½éœ€è¦ä½¿ç”¨ parseFloat() è¿™ä¸ªå‡½æ•°å°† string è½¬åŒ–ä¸º number</p>
</li>
<li>
<p>å†è¡¥å……ä¸€ä¸ªç»†èŠ‚ï¼Œåœ¨åˆå§‹åŒ– max å’Œ min æ—¶ï¼š</p>
<ol>
<li>è®© max åˆå§‹åŒ–å€¼ä¸º 0ï¼Œå› ä¸ºæˆ‘ä»¬çŸ¥é“æœ‰äººå£æ•°æ®çš„å€¼ä¸€å®šæ˜¯å¤§äº 0 çš„</li>
<li>è®© min åˆå§‹åŒ–å€¼ä¸º 99999ï¼Œå› ä¸ºæˆ‘ä»¬çŸ¥é“ä¸€å®šæœ‰äººå£æ•°æ®çš„å€¼ä¸€å®šæ˜¯å°äº 99999 çš„ï¼Œä¸”äººå£æ•°é‡ä¸€å®šä¸ä¼šæ˜¯è´Ÿæ•°</li>
</ol>
</li>
</ol>
<p><strong>å…·ä½“çš„ä»£ç ï¼š</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#3c3836;background-color:#fbf1c7;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>const parseData = (text: string) =&gt; {
</span></span><span style="display:flex;"><span>    const data: (number|undefined)[][] = []
</span></span><span style="display:flex;"><span>    const settings: { [key: string]: any } = { data }
</span></span><span style="display:flex;"><span>    let max:number = 0
</span></span><span style="display:flex;"><span>    let min:number = 99999
</span></span><span style="display:flex;"><span>    text.split(&#39;\n&#39;).forEach((line) =&gt; {
</span></span><span style="display:flex;"><span>        const parts = line.trim().split(/\s+/)
</span></span><span style="display:flex;"><span>        if (parts.length === 2) {
</span></span><span style="display:flex;"><span>            settings[parts[0]] = parseFloat(parts[1])
</span></span><span style="display:flex;"><span>        } else if(parts.length &gt; 2) {
</span></span><span style="display:flex;"><span>            const values = parts.map((item) =&gt; {
</span></span><span style="display:flex;"><span>                const value = parseFloat(item)
</span></span><span style="display:flex;"><span>                if (value === settings[&#39;NODATA_value&#39;]) {
</span></span><span style="display:flex;"><span>                    return undefined
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                max = Math.max(max, value)
</span></span><span style="display:flex;"><span>                min = Math.min(min, value)
</span></span><span style="display:flex;"><span>                return value
</span></span><span style="display:flex;"><span>            })
</span></span><span style="display:flex;"><span>            data.push(values)
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>    return { ...settings, ...{ max, min } } as ASCData
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div></li>
</ol>
<h4 id="ç¬¬3æ­¥åŠ è½½åœ°çƒçº¹ç†å›¾ç‰‡">ç¬¬3æ­¥ï¼šåŠ è½½åœ°çƒçº¹ç†å›¾ç‰‡<a hidden class="anchor" aria-hidden="true" href="#ç¬¬3æ­¥åŠ è½½åœ°çƒçº¹ç†å›¾ç‰‡">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#3c3836;background-color:#fbf1c7;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>const loader = new Three.TextureLoader()
</span></span><span style="display:flex;"><span>const texture = loader.load(require(&#39;@/assets/imgs/world.jpg&#39;).default,render)
</span></span><span style="display:flex;"><span>const material = new Three.MeshPhongMaterial({
</span></span><span style="display:flex;"><span>    map: texture
</span></span><span style="display:flex;"><span>})
</span></span><span style="display:flex;"><span>const geometry = new Three.SphereBufferGeometry(2, 32, 32)
</span></span><span style="display:flex;"><span>const earth = new Three.Mesh(geometry, material)
</span></span><span style="display:flex;"><span>scene.add(earth)
</span></span></code></pre></div><blockquote>
<p>è¯·æ³¨æ„ä¸Šè¿°ä»£ç ä¸­ï¼Œloader.load(xxx, render)ï¼Œæˆ‘ä»¬å¸Œæœ›å½“çº¹ç†å›¾ç‰‡åŠ è½½å®Œæˆåï¼Œæ‰æ‰§è¡Œ render æ¸²æŸ“</p>
</blockquote>
<h4 id="ç¬¬4æ­¥å°†äººå£æ•°æ®ä¸åœ°çƒçº¹ç†å›¾ç‰‡è¿›è¡Œä½ç½®ä¸Šçš„åŒ¹é…">ç¬¬4æ­¥ï¼šå°†äººå£æ•°æ®ä¸åœ°çƒçº¹ç†å›¾ç‰‡è¿›è¡Œä½ç½®ä¸Šçš„åŒ¹é…<a hidden class="anchor" aria-hidden="true" href="#ç¬¬4æ­¥å°†äººå£æ•°æ®ä¸åœ°çƒçº¹ç†å›¾ç‰‡è¿›è¡Œä½ç½®ä¸Šçš„åŒ¹é…">#</a></h4>
<p><strong>å…ˆä¸è€ƒè™‘çƒä½“ï¼Œå‡è®¾æˆ‘ä»¬ä»…ä»…æƒ³è·å¾—ä¸€å¼ æ˜¾ç¤ºäººå£æ•°é‡åˆ†å¸ƒã€å¹³é¢çš„ä¸–ç•Œåœ°å›¾ï¼Œè¯¥å¦‚ä½•åšå‘¢ï¼Ÿ</strong></p>
<p><strong>ä»£ç æ€è·¯ï¼š</strong></p>
<ol>
<li>æˆ‘ä»¬é€šè¿‡ ç¬¬ 2 æ­¥éª¤å·²ç»æ‹¿åˆ°äº†æ …æ ¼åŒ–åçš„ä¸–ç•Œäººå£åˆ†å¸ƒæ•°æ®</li>
<li>å¹¶ä¸”æˆ‘ä»¬çŸ¥é“æ …æ ¼åŒ–çš„æ•°æ®æ˜¯ç”± nrow(145) è¡Œã€ncols(360) åˆ—ç»„æˆ</li>
<li>å‡è®¾ 1 ä¸ªæ•°æ®ç‚¹ å¯¹åº” 1 åƒç´ ï¼Œé‚£ä¹ˆæ …æ ¼åŒ–çš„æ•°æ®å®é™…ä¸Šå¯¹åº”çš„æ˜¯ä¸€ä¸ª é«˜ 145 åƒç´ ã€å®½ 360 åƒç´ çš„å›¾å½¢</li>
<li>å‡è®¾ æ•°æ®ç‚¹æœ€å°(äººå£æœ€å°‘)çš„åœ°æ–¹ï¼Œæˆ‘ä»¬ç”¨é»‘è‰²æ¥å¡«å……ï¼Œè€Œæ•°æ®ç‚¹æœ€å¤§(äººå£æœ€å¤š)çš„åœ°æ–¹ç”¨çº¢è‰²å¡«å……ï¼Œå¤„äºä¸­é—´æ•°é‡çš„ç‚¹æŒ‰ç…§æ¯”ä¾‹ä¾æ¬¡è¿›è¡Œé¢œè‰²å˜åŒ–ï¼Œé‚£ä¹ˆå°±å¯ä»¥å¾—åˆ°æˆ‘ä»¬æƒ³è¦çš„å›¾å½¢äº†ã€‚
<ol>
<li>å…³äºæŸä¸ªç‚¹å¡«å……çš„é¢œè‰²ï¼Œæˆ‘ä»¬ä½¿ç”¨ HSL(è‰²ç›¸ã€é¥±å’Œåº¦ã€äº®åº¦)ï¼Œå…¶ä¸­å½“ äººå£å°‘æ—¶ L çš„å€¼è¶Šæ¥è¿‘äº 0 (é»‘è‰²)ã€äººå£å¤šæ—¶ L çš„å€¼è¶Šæ¥è¿‘ 1 (çº¢è‰²)</li>
<li>å‘ç”»å¸ƒ(canvas) æŸä¸ªç‚¹å¡«å……é¢œè‰²ï¼Œéœ€è¦ç”¨åˆ° canvas ä¸€äº›ç›¸å…³çŸ¥è¯†ï¼Œè¯·è‡ªè¡Œå…ˆå­¦ä¹ äº†è§£ä¸€ä¸‹ canvas ç›¸å…³çŸ¥è¯†</li>
</ol>
</li>
</ol>
<p><strong>å¯¹åº”çš„ä»£ç ï¼š</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#3c3836;background-color:#fbf1c7;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>const hsl = (h: number, s: number, l: number) =&gt; {
</span></span><span style="display:flex;"><span>    return `hsl(${h * 360 | 0},${s * 100 | 0}%,${l * 100 | 0}%)`
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>const drawData = (ascData: ASCData) =&gt; {
</span></span><span style="display:flex;"><span>    if (canvasRef.current === null) { return }
</span></span><span style="display:flex;"><span>    const ctx = canvasRef.current.getContext(&#39;2d&#39;)
</span></span><span style="display:flex;"><span>    if (ctx === null) { return }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    const range = ascData.max - ascData.min
</span></span><span style="display:flex;"><span>    ctx.canvas.width = ascData.ncols
</span></span><span style="display:flex;"><span>    ctx.canvas.height = ascData.nrows
</span></span><span style="display:flex;"><span>    ctx.fillStyle = &#39;#444&#39;
</span></span><span style="display:flex;"><span>    ctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height)
</span></span><span style="display:flex;"><span>    ascData.data.forEach((row, rowIndex) =&gt; {
</span></span><span style="display:flex;"><span>        row.forEach((value, colIndex) =&gt; {
</span></span><span style="display:flex;"><span>            if (value === undefined) { return }
</span></span><span style="display:flex;"><span>            const amount = (value - ascData.min) / range
</span></span><span style="display:flex;"><span>            const hue = 1
</span></span><span style="display:flex;"><span>            const saturation = 1
</span></span><span style="display:flex;"><span>            const lightness = amount
</span></span><span style="display:flex;"><span>            ctx.fillStyle = hsl(hue, saturation, lightness)
</span></span><span style="display:flex;"><span>            ctx.fillRect(colIndex,rowIndex,1,1)
</span></span><span style="display:flex;"><span>        })
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>ä¸ºäº†è®©ä½ æ¯”è¾ƒç›´è§‚çœ‹æ¸…ï¼Œè¿™é‡Œè´´å‡ºç›®å‰æˆ‘ä»¬å·²ç»å†™å‡ºæ¥çš„ä»£ç ã€‚</p>
<blockquote>
<p>è¯·æ³¨æ„ä¸‹é¢çš„ä»£ç å¹¶ä¸æ˜¯æˆ‘ä»¬çœŸæ­£ç¤ºä¾‹çš„ä»£ç ï¼Œä½ å¯ä»¥å®é™…è¿è¡Œä»¥ä¸‹ï¼ŒæŸ¥çœ‹æ•ˆæœ</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#3c3836;background-color:#fbf1c7;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>import { useEffect, useRef } from &#39;react&#39;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>const loadDataFile = async (url: string) =&gt; {
</span></span><span style="display:flex;"><span>    const res = await window.fetch(url)
</span></span><span style="display:flex;"><span>    const text = await res.text()
</span></span><span style="display:flex;"><span>    return text
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>type DataType = (number | undefined)[][]
</span></span><span style="display:flex;"><span>type ASCData = {
</span></span><span style="display:flex;"><span>    data: DataType,
</span></span><span style="display:flex;"><span>    ncols: number,
</span></span><span style="display:flex;"><span>    nrows: number,
</span></span><span style="display:flex;"><span>    xllcorner: number,
</span></span><span style="display:flex;"><span>    yllcorner: number,
</span></span><span style="display:flex;"><span>    cellsize: number,
</span></span><span style="display:flex;"><span>    NODATA_value: number,
</span></span><span style="display:flex;"><span>    max: number,
</span></span><span style="display:flex;"><span>    min: number,
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>const parseData = (text: string) =&gt; {
</span></span><span style="display:flex;"><span>    const data: DataType = []
</span></span><span style="display:flex;"><span>    const settings: { [key: string]: any } = { data }
</span></span><span style="display:flex;"><span>    let max: number = 0
</span></span><span style="display:flex;"><span>    let min: number = 99999
</span></span><span style="display:flex;"><span>    text.split(&#39;\n&#39;).forEach((line) =&gt; {
</span></span><span style="display:flex;"><span>        const parts = line.trim().split(/\s+/)
</span></span><span style="display:flex;"><span>        if (parts.length === 2) {
</span></span><span style="display:flex;"><span>            settings[parts[0]] = parseFloat(parts[1])
</span></span><span style="display:flex;"><span>        } else if (parts.length &gt; 2) {
</span></span><span style="display:flex;"><span>            const values = parts.map((item) =&gt; {
</span></span><span style="display:flex;"><span>                const value = parseFloat(item)
</span></span><span style="display:flex;"><span>                if (value === settings[&#39;NODATA_value&#39;]) {
</span></span><span style="display:flex;"><span>                    return undefined
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                max = Math.max(max, value)
</span></span><span style="display:flex;"><span>                min = Math.min(min, value)
</span></span><span style="display:flex;"><span>                return value
</span></span><span style="display:flex;"><span>            })
</span></span><span style="display:flex;"><span>            data.push(values)
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>    return { ...settings, ...{ max, min } } as ASCData
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>const hsl = (h: number, s: number, l: number) =&gt; {
</span></span><span style="display:flex;"><span>    return `hsl(${h * 360 | 0},${s * 100 | 0}%,${l * 100 | 0}%)`
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>const HelloEarth = () =&gt; {
</span></span><span style="display:flex;"><span>    const canvasRef = useRef&lt;HTMLCanvasElement&gt;(null)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    const drawData = (ascData: ASCData) =&gt; {
</span></span><span style="display:flex;"><span>        if (canvasRef.current === null) { return }
</span></span><span style="display:flex;"><span>        const ctx = canvasRef.current.getContext(&#39;2d&#39;)
</span></span><span style="display:flex;"><span>        if (ctx === null) { return }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        const range = ascData.max - ascData.min
</span></span><span style="display:flex;"><span>        ctx.canvas.width = ascData.ncols
</span></span><span style="display:flex;"><span>        ctx.canvas.height = ascData.nrows
</span></span><span style="display:flex;"><span>        ctx.fillStyle = &#39;#444&#39;
</span></span><span style="display:flex;"><span>        ctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height)
</span></span><span style="display:flex;"><span>        ascData.data.forEach((row, rowIndex) =&gt; {
</span></span><span style="display:flex;"><span>            row.forEach((value, colIndex) =&gt; {
</span></span><span style="display:flex;"><span>                if (value === undefined) { return }
</span></span><span style="display:flex;"><span>                const amount = (value - ascData.min) / range
</span></span><span style="display:flex;"><span>                const hue = 1
</span></span><span style="display:flex;"><span>                const saturation = 1
</span></span><span style="display:flex;"><span>                const lightness = amount
</span></span><span style="display:flex;"><span>                ctx.fillStyle = hsl(hue, saturation, lightness)
</span></span><span style="display:flex;"><span>                ctx.fillRect(colIndex,rowIndex,1,1)
</span></span><span style="display:flex;"><span>            })
</span></span><span style="display:flex;"><span>        })
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    useEffect(() =&gt; {
</span></span><span style="display:flex;"><span>        if (canvasRef.current === null) { return }
</span></span><span style="display:flex;"><span>        const ascURL = require(&#39;@/assets/data/gpw_v4_014mt_2010.asc&#39;).default
</span></span><span style="display:flex;"><span>        const doSomthing = async () =&gt; {
</span></span><span style="display:flex;"><span>            try {
</span></span><span style="display:flex;"><span>                const text = await loadDataFile(ascURL)
</span></span><span style="display:flex;"><span>                const ascData = parseData(text)
</span></span><span style="display:flex;"><span>                drawData(ascData)
</span></span><span style="display:flex;"><span>            } catch (error) {
</span></span><span style="display:flex;"><span>                console.log(error)
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        doSomthing()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        return () =&gt; {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }, [canvasRef])
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>        return (
</span></span><span style="display:flex;"><span>        &lt;canvas ref={canvasRef} /&gt;
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>export default HelloEarth
</span></span></code></pre></div><p>å®é™…è¿è¡Œåï¼Œå°±ä¼šçœ‹åˆ°ä¸€å¼  ä¸–ç•Œäººå£åˆ†å¸ƒçš„åœ°å›¾</p>
<blockquote>
<p>è¯·æ³¨æ„è¿™ä¸ª â€œçœ‹ä¼¼æ˜¯ä¸–ç•Œåœ°å›¾â€çš„å›¾ç‰‡å¹¶ä¸æ˜¯çœŸæ­£çš„ä¸–ç•Œåœ°ç†ä½ç½®åœ°å›¾ï¼Œè€Œæ˜¯äººå£æ•°é‡åˆ†å¸ƒå›¾ã€‚</p>
</blockquote>
<p><strong>å¦‚æœä½ å·²ç»çœ‹æ‡‚äº†ä¸Šé¢çš„ä»£ç ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥å°±å¯ä»¥çœŸæ­£å»åˆ¶ä½œ 3D ç«‹ä½“åœ°çƒç¤ºä¾‹äº†ã€‚</strong></p>
<blockquote>
<p>æœ¬ç¤ºä¾‹æ˜¯æˆ‘ä»¬åšè¿‡çš„æœ€å¤æ‚çš„ä¾‹å­ï¼Œå°½ç®¡æˆ‘ä»¬å·²ç»è¿›è¡Œäº†è¯¦ç»†çš„æ€è·¯è§£è¯»ï¼Œä½ ä¸€å®šè¦å¤šçœ‹ï¼Œå¤šæ•²å‡ éï¼Œå¦åˆ™æ¥ä¸‹æ¥çš„ä»£ç ä½ å¯èƒ½æ›´åŠ éš¾ä»¥ç†è§£ã€‚</p>
</blockquote>
<p><strong>æˆ‘ä»¬éœ€è¦å°†ä¹‹å‰çš„ drawData() ä¿®æ”¹ ä¸º addBoxes()ï¼Œå¹¶ä¸”ä¸å†æ˜¯åœ¨ canvas ä¸­ç»˜åˆ¶ç‚¹ï¼Œè€Œæ˜¯åœ¨çƒä½“ä¸Šæ·»åŠ æŸ±çŠ¶ç‰©ï¼š</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#3c3836;background-color:#fbf1c7;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>const addBoxes = (ascData: ASCData, scene: Three.Scene) =&gt; {
</span></span><span style="display:flex;"><span>    const geometry = new Three.BoxBufferGeometry(1, 1, 1)
</span></span><span style="display:flex;"><span>    geometry.applyMatrix4(new Three.Matrix4().makeTranslation(0, 0, 0.5))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    const lonHelper = new Three.Object3D()
</span></span><span style="display:flex;"><span>    scene.add(lonHelper)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    const latHelper = new Three.Object3D()
</span></span><span style="display:flex;"><span>    lonHelper.add(latHelper)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    const positionHelper = new Three.Object3D()
</span></span><span style="display:flex;"><span>    positionHelper.position.z = 1
</span></span><span style="display:flex;"><span>    latHelper.add(positionHelper)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    const range = ascData.max - ascData.min
</span></span><span style="display:flex;"><span>    const lonFudge = Math.PI * 0.5
</span></span><span style="display:flex;"><span>    const latFudge = Math.PI * -0.135
</span></span><span style="display:flex;"><span>    ascData.data.forEach((row, latIndex) =&gt; {
</span></span><span style="display:flex;"><span>        row.forEach((value, lonIndex) =&gt; {
</span></span><span style="display:flex;"><span>            if (value === undefined) { return }
</span></span><span style="display:flex;"><span>            const amount = (value - ascData.min) / range
</span></span><span style="display:flex;"><span>            const material = new Three.MeshBasicMaterial()
</span></span><span style="display:flex;"><span>            const hue = Three.MathUtils.lerp(0.7, 0.3, amount)
</span></span><span style="display:flex;"><span>            const saturation = 1
</span></span><span style="display:flex;"><span>            const lightness = Three.MathUtils.lerp(0.1, 1, amount)
</span></span><span style="display:flex;"><span>            material.color.setHSL(hue, saturation, lightness)
</span></span><span style="display:flex;"><span>            const mesh = new Three.Mesh(geometry, material)
</span></span><span style="display:flex;"><span>            scene.add(mesh)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            lonHelper.rotation.y = Three.MathUtils.degToRad(lonIndex + ascData.xllcorner) + lonFudge
</span></span><span style="display:flex;"><span>            latHelper.rotation.x = Three.MathUtils.degToRad(latIndex + ascData.yllcorner) + latFudge
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            positionHelper.updateWorldMatrix(true, false)
</span></span><span style="display:flex;"><span>            mesh.applyMatrix4(positionHelper.matrixWorld)
</span></span><span style="display:flex;"><span>            mesh.scale.set(0.005, 0.005, Three.MathUtils.lerp(0.001, 0.5, amount))
</span></span><span style="display:flex;"><span>        })
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><blockquote>
<p>ä¸Šé¢ä»£ç ä¸­ç‰µæ‰¯åˆ°äº†éå¸¸å¤šæ–°çš„ã€ä¹‹å‰ä»æœªä½¿ç”¨è¿‡çš„ä¸€äº›å‡½æ•°æˆ–å±æ€§ã€‚</p>
</blockquote>
<p><strong>è§£é‡Šè¯´æ˜ï¼š</strong></p>
<ol>
<li>
<p>æ …æ ¼åŒ–æ•°æ® å’Œ çº¹ç†å›¾ç‰‡ å‡å¯çœ‹ä½œæ˜¯ 2D çŸ©å½¢åæ ‡ï¼Œæœ€ç»ˆéœ€è¦è½¬åŒ–ä¸º 3D çƒä½“åæ ‡ï¼Œè½¬åŒ–è¿‡ç¨‹ä¸­ lonFudgeã€latFudge å…·ä½“ä½œç”¨æœºç†ï¼Œæš‚æ—¶è¿˜æ²¡ææ˜ç™½ã€‚</p>
<blockquote>
<p>å…ˆè®°ä½è½¬åŒ–å…¬å¼ï¼Œä»¥åå†æ…¢æ…¢ç ”ç©¶</p>
</blockquote>
<blockquote>
<p>æ …æ ¼åŒ–æ•°æ® ä¸º 360 <em>145ã€çº¹ç†å›¾ç‰‡ä¸º 2048</em> 1024</p>
</blockquote>
</li>
<li>
<p>Three.Matrix4ï¼šWebGL ä¸­çš„çŸ©é˜µåº“</p>
</li>
<li>
<p>Three.MathUtilsï¼šThree.js ä¸­å†…ç½®çš„ä¸€äº›è®¡ç®—å‡½æ•°</p>
<blockquote>
<p>å…³äºè¿™äº›æ–°çš„å¯¹è±¡å…·ä½“è¯¦ç»†ä»‹ç»ï¼Œè¯·æŸ¥é˜… Three.js å®˜æ–¹æ–‡æ¡£</p>
</blockquote>
</li>
<li>
<p>lonHelperç”¨äºèµ¤é“ä¸Šçš„ç»åº¦æ—‹è½¬ã€latHelperç”¨äºç»´åº¦æ—‹è½¬ã€positionHelperç”¨äº Z è½´(åœ°çƒåœ°é¢)ä¸Šçš„åç§»ã€‚</p>
</li>
<li>
<p>lonFudge çš„å€¼ä¸º Math.PI * 0.5ï¼Œä¹Ÿå°±æ˜¯ç›¸å½“äº 1/4 ä¸ªåœ†(åœ°çƒ 1/4 åœˆ)</p>
</li>
<li>
<p>latFudge çš„å€¼ä¸º Math.PI * -0.135ï¼Œè¿™é‡Œçš„ -0.135 ä¸å¤ªæ¸…æ¥šæ˜¯æ€ä¹ˆå¾—å‡ºæ¥çš„ï¼Œä½†æ˜¯å¤§æ¦‚ç‡æ¨æµ‹å®ƒæ˜¯ç”¨æ¥å°†æŸ±çŠ¶ç‰©ä¸çº¹ç†å›¾ç‰‡å¯¹é½çš„</p>
</li>
</ol>
<p><strong>ç¤ºä¾‹æ‰€éœ€å…¶ä»–ä»£ç å—ï¼š</strong></p>
<ol>
<li>åˆ›å»º 3D åœ°çƒã€ä»¥åŠåŠ è½½çº¹ç†å›¾ç‰‡</li>
<li>æ·»åŠ  OrbitControls æ§åˆ¶ï¼Œå¹¶ä¸”å¼€å¯ â€œå¼¹æ€§ç»“æŸæ§åˆ¶â€</li>
<li>æ·»åŠ åœºæ™¯æ¸²æŸ“å‡½æ•° renderï¼Œå¹¶ä¸”æ·»åŠ  â€œæŒ‰éœ€æ¸²æŸ“â€ ç›¸å…³ä»£ç </li>
</ol>
<p><strong>æœ€ç»ˆå®Œæ•´çš„ç¤ºä¾‹ä»£ç ï¼š</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#3c3836;background-color:#fbf1c7;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>import { useEffect, useRef } from &#39;react&#39;
</span></span><span style="display:flex;"><span>import * as Three from &#39;three&#39;
</span></span><span style="display:flex;"><span>import { OrbitControls } from &#39;three/examples/jsm/controls/OrbitControls&#39;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>import &#39;./index.scss&#39;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>const loadDataFile = async (url: string) =&gt; {
</span></span><span style="display:flex;"><span>    const res = await window.fetch(url)
</span></span><span style="display:flex;"><span>    const text = await res.text()
</span></span><span style="display:flex;"><span>    return text
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>type DataType = (number | undefined)[][]
</span></span><span style="display:flex;"><span>type ASCData = {
</span></span><span style="display:flex;"><span>    data: DataType,
</span></span><span style="display:flex;"><span>    ncols: number,
</span></span><span style="display:flex;"><span>    nrows: number,
</span></span><span style="display:flex;"><span>    xllcorner: number,
</span></span><span style="display:flex;"><span>    yllcorner: number,
</span></span><span style="display:flex;"><span>    cellsize: number,
</span></span><span style="display:flex;"><span>    NODATA_value: number,
</span></span><span style="display:flex;"><span>    max: number,
</span></span><span style="display:flex;"><span>    min: number,
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>const parseData = (text: string) =&gt; {
</span></span><span style="display:flex;"><span>    const data: DataType = []
</span></span><span style="display:flex;"><span>    const settings: { [key: string]: any } = { data }
</span></span><span style="display:flex;"><span>    let max: number = 0
</span></span><span style="display:flex;"><span>    let min: number = 99999
</span></span><span style="display:flex;"><span>    text.split(&#39;\n&#39;).forEach((line) =&gt; {
</span></span><span style="display:flex;"><span>        const parts = line.trim().split(/\s+/)
</span></span><span style="display:flex;"><span>        if (parts.length === 2) {
</span></span><span style="display:flex;"><span>            settings[parts[0]] = parseFloat(parts[1])
</span></span><span style="display:flex;"><span>        } else if (parts.length &gt; 2) {
</span></span><span style="display:flex;"><span>            const values = parts.map((item) =&gt; {
</span></span><span style="display:flex;"><span>                const value = parseFloat(item)
</span></span><span style="display:flex;"><span>                if (value === settings[&#39;NODATA_value&#39;]) {
</span></span><span style="display:flex;"><span>                    return undefined
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                max = Math.max(max, value)
</span></span><span style="display:flex;"><span>                min = Math.min(min, value)
</span></span><span style="display:flex;"><span>                return value
</span></span><span style="display:flex;"><span>            })
</span></span><span style="display:flex;"><span>            data.push(values)
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>    return { ...settings, ...{ max, min } } as ASCData
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>// const hsl = (h: number, s: number, l: number) =&gt; {
</span></span><span style="display:flex;"><span>//     return `hsl(${h * 360 | 0},${s * 100 | 0}%,${l * 100 | 0}%)`
</span></span><span style="display:flex;"><span>// }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>let renderRequested = false
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>const HelloEarth = () =&gt; {
</span></span><span style="display:flex;"><span>    const canvasRef = useRef&lt;HTMLCanvasElement&gt;(null)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    // const drawData = (ascData: ASCData) =&gt; {
</span></span><span style="display:flex;"><span>    //     if (canvasRef.current === null) { return }
</span></span><span style="display:flex;"><span>    //     const ctx = canvasRef.current.getContext(&#39;2d&#39;)
</span></span><span style="display:flex;"><span>    //     if (ctx === null) { return }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    //     const range = ascData.max - ascData.min
</span></span><span style="display:flex;"><span>    //     ctx.canvas.width = ascData.ncols
</span></span><span style="display:flex;"><span>    //     ctx.canvas.height = ascData.nrows
</span></span><span style="display:flex;"><span>    //     ctx.fillStyle = &#39;#444&#39;
</span></span><span style="display:flex;"><span>    //     ctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height)
</span></span><span style="display:flex;"><span>    //     ascData.data.forEach((row, rowIndex) =&gt; {
</span></span><span style="display:flex;"><span>    //         row.forEach((value, colIndex) =&gt; {
</span></span><span style="display:flex;"><span>    //             if (value === undefined) { return }
</span></span><span style="display:flex;"><span>    //             const amount = (value - ascData.min) / range
</span></span><span style="display:flex;"><span>    //             const hue = 1
</span></span><span style="display:flex;"><span>    //             const saturation = 1
</span></span><span style="display:flex;"><span>    //             const lightness = amount
</span></span><span style="display:flex;"><span>    //             ctx.fillStyle = hsl(hue, saturation, lightness)
</span></span><span style="display:flex;"><span>    //             ctx.fillRect(colIndex, rowIndex, 1, 1)
</span></span><span style="display:flex;"><span>    //         })
</span></span><span style="display:flex;"><span>    //     })
</span></span><span style="display:flex;"><span>    // }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    const addBoxes = (ascData: ASCData, scene: Three.Scene) =&gt; {
</span></span><span style="display:flex;"><span>        const geometry = new Three.BoxBufferGeometry(1, 1, 1)
</span></span><span style="display:flex;"><span>        geometry.applyMatrix4(new Three.Matrix4().makeTranslation(0, 0, 0.5))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        const lonHelper = new Three.Object3D()
</span></span><span style="display:flex;"><span>        scene.add(lonHelper)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        const latHelper = new Three.Object3D()
</span></span><span style="display:flex;"><span>        lonHelper.add(latHelper)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        const positionHelper = new Three.Object3D()
</span></span><span style="display:flex;"><span>        positionHelper.position.z = 1
</span></span><span style="display:flex;"><span>        latHelper.add(positionHelper)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        const range = ascData.max - ascData.min
</span></span><span style="display:flex;"><span>        const lonFudge = Math.PI * 0.5
</span></span><span style="display:flex;"><span>        const latFudge = Math.PI * -0.135
</span></span><span style="display:flex;"><span>        ascData.data.forEach((row, latIndex) =&gt; {
</span></span><span style="display:flex;"><span>            row.forEach((value, lonIndex) =&gt; {
</span></span><span style="display:flex;"><span>                if (value === undefined) { return }
</span></span><span style="display:flex;"><span>                const amount = (value - ascData.min) / range
</span></span><span style="display:flex;"><span>                const material = new Three.MeshBasicMaterial()
</span></span><span style="display:flex;"><span>                const hue = Three.MathUtils.lerp(0.7, 0.3, amount)
</span></span><span style="display:flex;"><span>                const saturation = 1
</span></span><span style="display:flex;"><span>                const lightness = Three.MathUtils.lerp(0.1, 1, amount)
</span></span><span style="display:flex;"><span>                material.color.setHSL(hue, saturation, lightness)
</span></span><span style="display:flex;"><span>                const mesh = new Three.Mesh(geometry, material)
</span></span><span style="display:flex;"><span>                scene.add(mesh)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                lonHelper.rotation.y = Three.MathUtils.degToRad(lonIndex + ascData.xllcorner) + lonFudge
</span></span><span style="display:flex;"><span>                latHelper.rotation.x = Three.MathUtils.degToRad(latIndex + ascData.yllcorner) + latFudge
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                positionHelper.updateWorldMatrix(true, false)
</span></span><span style="display:flex;"><span>                mesh.applyMatrix4(positionHelper.matrixWorld)
</span></span><span style="display:flex;"><span>                mesh.scale.set(0.005, 0.005, Three.MathUtils.lerp(0.001, 0.5, amount))
</span></span><span style="display:flex;"><span>            })
</span></span><span style="display:flex;"><span>        })
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    useEffect(() =&gt; {
</span></span><span style="display:flex;"><span>        if (canvasRef.current === null) { return }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        const canvas = canvasRef.current
</span></span><span style="display:flex;"><span>        const renderer = new Three.WebGLRenderer({ canvas })
</span></span><span style="display:flex;"><span>        const camera = new Three.PerspectiveCamera(45, 2, 0.1, 100)
</span></span><span style="display:flex;"><span>        camera.position.z = 4
</span></span><span style="display:flex;"><span>        const scene = new Three.Scene()
</span></span><span style="display:flex;"><span>        scene.background= new Three.Color(0x000000)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        const controls = new OrbitControls(camera, canvas)
</span></span><span style="display:flex;"><span>        controls.enableDamping = true
</span></span><span style="display:flex;"><span>        controls.enablePan =false
</span></span><span style="display:flex;"><span>        controls.update()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        const render = () =&gt; {
</span></span><span style="display:flex;"><span>            renderRequested = false
</span></span><span style="display:flex;"><span>            controls.update()
</span></span><span style="display:flex;"><span>            renderer.render(scene, camera)
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        const handleChange =() =&gt;{
</span></span><span style="display:flex;"><span>            if(renderRequested === false){
</span></span><span style="display:flex;"><span>                renderRequested = true
</span></span><span style="display:flex;"><span>                window.requestAnimationFrame(render)
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        controls.addEventListener(&#39;change&#39;,handleChange)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        const loader = new Three.TextureLoader()
</span></span><span style="display:flex;"><span>        const texture = loader.load(require(&#39;@/assets/imgs/world.jpg&#39;).default, render)
</span></span><span style="display:flex;"><span>        const material = new Three.MeshBasicMaterial({
</span></span><span style="display:flex;"><span>            map: texture
</span></span><span style="display:flex;"><span>        })
</span></span><span style="display:flex;"><span>        const geometry = new Three.SphereBufferGeometry(1, 64, 32)
</span></span><span style="display:flex;"><span>        const earth = new Three.Mesh(geometry, material)
</span></span><span style="display:flex;"><span>        scene.add(earth)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        const handleResize = () =&gt; {
</span></span><span style="display:flex;"><span>            const width = canvas.clientWidth
</span></span><span style="display:flex;"><span>            const height = canvas.clientHeight
</span></span><span style="display:flex;"><span>            camera.aspect = width / height
</span></span><span style="display:flex;"><span>            camera.updateProjectionMatrix()
</span></span><span style="display:flex;"><span>            renderer.setSize(width, height, false)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            window.requestAnimationFrame(render)
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        handleResize()
</span></span><span style="display:flex;"><span>        window.addEventListener(&#39;resize&#39;, handleResize)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        const ascURL = require(&#39;@/assets/data/gpw_v4_014mt_2010.asc&#39;).default
</span></span><span style="display:flex;"><span>        const doSomthing = async () =&gt; {
</span></span><span style="display:flex;"><span>            try {
</span></span><span style="display:flex;"><span>                const text = await loadDataFile(ascURL)
</span></span><span style="display:flex;"><span>                const ascData = parseData(text)
</span></span><span style="display:flex;"><span>                //drawData(ascData)
</span></span><span style="display:flex;"><span>                addBoxes(ascData, scene)
</span></span><span style="display:flex;"><span>                render()
</span></span><span style="display:flex;"><span>            } catch (error) {
</span></span><span style="display:flex;"><span>                console.log(error)
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        doSomthing()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        return () =&gt; {
</span></span><span style="display:flex;"><span>            controls.removeEventListener(&#39;change&#39;,handleChange)
</span></span><span style="display:flex;"><span>            window.removeEventListener(&#39;resize&#39;, handleResize)
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }, [canvasRef])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    return (
</span></span><span style="display:flex;"><span>        &lt;canvas ref={canvasRef} className=&#39;full-screen&#39; /&gt;
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>export default HelloEarth
</span></span></code></pre></div><p>è°ƒè¯•è¿è¡Œï¼Œé¦–å…ˆå°±ä¼šçœ‹åˆ°ä¸€ä¸ª 3D ç«‹ä½“åœ°çƒï¼Œç­‰å¾… 1 ç§’å·¦å³ï¼Œå¾… .asc æ•°æ®åŠ è½½å¹¶è§£æã€æ·»åŠ åœ°çƒä¸Šçš„æŸ±çŠ¶ç‰©åï¼Œå°±ä¼šçœ‹åˆ°æœ¬ç¤ºä¾‹æ‰€æƒ³æ¼”ç¤ºçš„æœ€ç»ˆæ•ˆæœã€‚</p>
<blockquote>
<p>ç»ˆäºç»ˆäºåˆ°è¿™ä¸€æ­¥äº†</p>
</blockquote>
<p>ä¸è¿‡å½“ä½ é¼ æ ‡æ‹–åŠ¨åœ°çƒæ—¶ï¼Œä¼šæ„Ÿå—åˆ°ç•¥å¾®å¡é¡¿ï¼Œæˆ–è€…è¯´ä¸å¤Ÿæµç•…ã€‚</p>
<p>é‚£ä¹ˆæ¥ä¸‹æ¥ï¼Œå°±åˆ°äº†æœ¬æ–‡çš„æ ¸å¿ƒå†…å®¹ï¼šé€šè¿‡ åˆå¹¶å¯¹è±¡ æ¥è¾¾åˆ°ä¼˜åŒ–åœºæ™¯çš„ç›®çš„ã€‚</p>
<h4 id="è¡¥å……å¯ç”¨æµè§ˆå™¨-è°ƒè¯•å·¥å…·-devtool-çš„-rendering-æŸ¥çœ‹æ¸²æŸ“æ€§èƒ½">è¡¥å……ï¼šå¯ç”¨æµè§ˆå™¨ è°ƒè¯•å·¥å…· DevTool çš„ Rendering æŸ¥çœ‹æ¸²æŸ“æ€§èƒ½<a hidden class="anchor" aria-hidden="true" href="#è¡¥å……å¯ç”¨æµè§ˆå™¨-è°ƒè¯•å·¥å…·-devtool-çš„-rendering-æŸ¥çœ‹æ¸²æŸ“æ€§èƒ½">#</a></h4>
<p>é™¤äº†æµè§ˆå™¨æœ¬èº«çš„ æ€§èƒ½(Performance) é¢æ¿å¤–ï¼Œè¿˜æœ‰å¦å¤–ä¸€ä¸ªé‡è¦çš„ã€æ–¹ä¾¿æˆ‘ä»¬æŸ¥çœ‹é¡µé¢æ¸²æŸ“æ€§èƒ½çš„å·¥å…·â€”â€”Renderingã€‚</p>
<p><strong>é€šè¿‡è°·æ­Œè°ƒè¯•å·¥å…· Renderingï¼ŒæŸ¥çœ‹å½“å‰é¡µé¢æ¸²æŸ“æ€§èƒ½æƒ…å†µï¼š</strong></p>
<ol>
<li>
<p>æ‰“å¼€æµè§ˆå™¨è°ƒè¯•å·¥å…· DevTool</p>
</li>
<li>
<p>ç‚¹å‡»å³ä¾§ 3 ä¸ªå°åœ†ç‚¹</p>
</li>
<li>
<p>é¼ æ ‡ç§»åŠ¨åˆ° More tools</p>
</li>
<li>
<p>ç‚¹å‡» Rendering</p>
</li>
<li>
<p>åœ¨æ–°å‡ºç°çš„ Rendering é¢æ¿ä¸­ï¼Œå‹¾é€‰ Frame Rendering Stats</p>
<blockquote>
<p>å¤‡æ³¨ï¼šåœ¨æ—§çš„è°·æ­Œæµè§ˆå™¨ä¸­ï¼Œåº”è¯¥å‹¾é€‰çš„æ˜¯ Show FPS meter</p>
</blockquote>
</li>
</ol>
<p>è¿™æ ·å°±å¯ä»¥åœ¨ç½‘é¡µå·¦ä¸Šè§’ï¼Œå®æ—¶çœ‹åˆ°å½“å‰æ¸²æŸ“æ€§èƒ½çŠ¶å†µã€‚</p>
<p><strong>æ€§èƒ½æ•°æ®è§£è¯»ï¼š</strong></p>
<p>æ€§èƒ½å±•ç¤ºçš„æ•°æ®ï¼Œä¸»è¦ 2 ä¸ªæ¨¡å—ï¼šFrames å’Œ GPU</p>
<p><strong>GPU ç›¸å…³ï¼š</strong></p>
<ol>
<li>
<p>GPU raster ï¼šon  è¡¨ç¤º GPU å…‰æ …åŒ–å·²å¼€å¯</p>
</li>
<li>
<p>GPU memoryï¼šGPU å·²ç”¨å¤§å°ã€GPU æœ€å¤§å¯ç”¨å¤§å°</p>
<blockquote>
<p>åœ¨æœ¬ç¤ºä¾‹ä¸­ï¼Œé€šå¸¸æ˜¯å½“ä¿®æ”¹æµè§ˆå™¨å°ºå¯¸æ—¶ï¼Œæ­¤æ—¶éœ€è¦å¤§é‡è®¡ç®—ï¼Œä¼šæ˜¾ç¤ºå‡º GPU memory</p>
<p>åœ¨æ™®é€šçš„ é¼ æ ‡æ‹–æ‹½ æ”¹å˜åœ°çƒè§†è§’æ—¶ï¼Œä¸ä¼šæ˜¾ç¤º GPU memory</p>
</blockquote>
</li>
</ol>
<p><strong>Framesç›¸å…³ï¼š</strong></p>
<p>å‡è®¾æŸä¸€æ—¶åˆ»ï¼Œæ¸²æŸ“æ€§èƒ½ç»“æœä¸º Framesï¼š63% 1082(0m) dropped of 2737</p>
<p>å¯¹åº”çš„è§£è¯»ä¸ºï¼š</p>
<p>ç¬¬1ä¸ªæ•°å­— 63% â€”â€” 63% çš„å¸§æŒ‰æ—¶æ¸²æŸ“å®Œæˆ</p>
<p>ç¬¬2ä¸ªæ•°å­— 1082 â€”â€” æœ‰ 1082 ä¸ªåˆæˆå¸§ä¸¢å¤±(æœªæ¸²æŸ“)</p>
<p>ç¬¬3ä¸ªæ•°å­— 0m â€”â€” æœ‰ 0 ä¸ªå¸§ä¸¢å¤±</p>
<p>ç¬¬4ä¸ªæ•°å­— 2737 â€”â€” åŸæœ¬è®¡åˆ’æ¸²æŸ“ 2737 ä¸ªå¸§</p>
<p>æ•°å­—ä¹‹é—´çš„è®¡ç®—å…³ç³»ä¸º 63% â‰ˆ 1 - (1082 + 0 )/ 2737</p>
<p>ä¹Ÿå°±æ˜¯è¯´ ç¬¬2ä¸ªæ•°å­—(ä¸¢å¤±çš„åˆæˆå¸§)è¶Šå°ï¼Œé‚£ä¹ˆæ•´ä½“æŒ‰æ—¶å®Œæˆæ¸²æŸ“å¸§çš„ç™¾åˆ†æ¯”(ç¬¬1ä¸ªæ•°å­—)è¶Šå¤§ï¼Œæ„å‘³ç€æ­¤åˆ»ç½‘é¡µè¶Šæµç•…ã€‚</p>
<h2 id="ä¼˜åŒ–ä»£ç åˆå¹¶å¯¹è±¡">ä¼˜åŒ–ä»£ç ï¼šåˆå¹¶å¯¹è±¡<a hidden class="anchor" aria-hidden="true" href="#ä¼˜åŒ–ä»£ç åˆå¹¶å¯¹è±¡">#</a></h2>
<h4 id="æ ¸å¿ƒä»£ç åˆ†æ">æ ¸å¿ƒä»£ç åˆ†æ<a hidden class="anchor" aria-hidden="true" href="#æ ¸å¿ƒä»£ç åˆ†æ">#</a></h4>
<p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä»£ç ä¸­ï¼ŒlonHelperç”¨äºèµ¤é“ä¸Šçš„ç»åº¦æ—‹è½¬ã€latHelperç”¨äºç»´åº¦æ—‹è½¬ã€positionHelperç”¨äº Z è½´(åœ°çƒåœ°é¢)ä¸Šçš„åç§»ã€‚</p>
<blockquote>
<p>é»˜è®¤ Three.js ä¸­ç‰©ä½“æ˜¯æœ‰ 1/2 ä½äº Z è½´ä¹‹ä¸‹çš„ï¼Œé€šè¿‡Zè½´çš„åç§»è®©æŸ±çŠ¶ç‰©å¯ä»¥å®Œå…¨å‡ºç°åœ¨åœ°é¢ä¸Š</p>
</blockquote>
<p>æ¯ä¸€ä¸ªæ•°æ®ç‚¹(æŸ±çŠ¶ç‰©)éƒ½åˆ›å»ºäº†ä¸€ä¸ª MeshBasicMaterial å’Œ Meshã€‚</p>
<p>æˆ‘ä»¬çš„æ•°æ®ç‚¹ä¸€å…±ä¸º 145è¡Œã€360åˆ—ï¼Œé‚£ä¹ˆå°±æ„å‘³ç€å‡è®¾å…¨éƒ¨æ•°æ®ç‚¹éƒ½æœ‰æ•°æ®ï¼Œé‚£ä¹ˆæ•°æ®ç‚¹æ€»æ•°é‡ä¸ºï¼š145 * 360 = 52200ï¼Œä½†æ˜¯è€ƒè™‘åˆ°æœ‰éå¸¸å¤šçš„æ•°æ®ç‚¹çš„å€¼ä¸º -9999(NODATA_value)ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰å€¼ï¼Œä¸éœ€è¦ç»˜åˆ¶ï¼Œé‚£ä¹ˆå‡å»è¿™äº›æ²¡æœ‰æ•°æ®ç‚¹ï¼Œ<strong>æœ€ç»ˆéœ€è¦ç»˜åˆ¶çš„æ•°æ®ç‚¹(æŸ±çŠ¶ç‰©)å¤§çº¦ä¸º 19000 ä¸ª</strong>ã€‚</p>
<p><strong>æŸ±çŠ¶ç‰©19000ä¸ªï¼Œå†åŠ ä¸Šå¯¹åº”çš„ 3 ä¸ªè¾…åŠ©å¯¹è±¡(lonHelperã€latHelperã€positionHelper)ï¼Œç›¸å½“äºæ€»ç»˜åˆ¶æ•°é‡ä¸º 19000 * 4 = 76000ã€‚</strong></p>
<p>ä¹Ÿå°±æ˜¯è¯´æ¯ä¸€æ¬¡åœºæ™¯æ›´æ–°ï¼Œå¤§çº¦éœ€è¦ç»˜åˆ¶ 7.6 ä¸‡ä¸ªå¯¹è±¡ï¼Œæ‰€ä»¥è¿™æ‰é€ æˆäº†å¡é¡¿ç°è±¡ã€‚</p>
<p><strong>å¦‚ä½•è§£å†³å¡é¡¿ï¼Ÿå‡å°‘éœ€è¦æ¸²æŸ“å¯¹è±¡çš„æ•°é‡ï¼</strong></p>
<p>è¿˜è®°å¾—æˆ‘ä»¬åˆšæ‰ç»Ÿè®¡çš„æ¸²æŸ“å¯¹è±¡æ•°é‡å—ï¼Ÿ</p>
<ol>
<li>æŸ±çŠ¶ä½“ çº¦ 19000ä¸ª</li>
<li>æ¯ä¸ªæŸ±çŠ¶ä½“å¯¹åº” 3 ä¸ªè¾…åŠ©å¯¹è±¡ 19000 * 3</li>
</ol>
<p>æˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯æŠŠæ‰€æœ‰çš„æŸ±çŠ¶ä½“åˆå¹¶æˆä¸€ä¸ªç‰©ä½“ï¼Œä¹Ÿå°±æ˜¯è¯´åŸæœ¬éœ€è¦æ¸²æŸ“ 19000 ä¸ªæŸ±çŠ¶ä½“ï¼Œåˆå¹¶ä¹‹ååªéœ€æ¸²æŸ“ 1 ä¸ªï¼Œè®©æŸ±çŠ¶ä½“æ•°é‡å‡å°‘ 18999 ä¸ªã€‚</p>
<p><strong>ä¿®æ”¹ addBoxes å‡½æ•°ä»£ç ï¼š</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#3c3836;background-color:#fbf1c7;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>import { BufferGeometryUtils } from &#39;three/examples/jsm/utils/BufferGeometryUtils&#39;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>const addBoxes = (ascData: ASCData, scene: Three.Scene) =&gt; {
</span></span><span style="display:flex;"><span>    //const geometry = new Three.BoxBufferGeometry(1, 1, 1)
</span></span><span style="display:flex;"><span>    //geometry.applyMatrix4(new Three.Matrix4().makeTranslation(0, 0, 0.5))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    const lonHelper = new Three.Object3D()
</span></span><span style="display:flex;"><span>    scene.add(lonHelper)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    const latHelper = new Three.Object3D()
</span></span><span style="display:flex;"><span>    lonHelper.add(latHelper)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    const positionHelper = new Three.Object3D()
</span></span><span style="display:flex;"><span>    positionHelper.position.z = 1
</span></span><span style="display:flex;"><span>    latHelper.add(positionHelper)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    const originHelper = new Three.Object3D()
</span></span><span style="display:flex;"><span>    originHelper.position.z = 0.5
</span></span><span style="display:flex;"><span>    positionHelper.add(originHelper)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    const range = ascData.max - ascData.min
</span></span><span style="display:flex;"><span>    const lonFudge = Math.PI * 0.5
</span></span><span style="display:flex;"><span>    const latFudge = Math.PI * -0.135
</span></span><span style="display:flex;"><span>    const geometries: Three.BoxBufferGeometry[] = []
</span></span><span style="display:flex;"><span>    const color = new Three.Color()
</span></span><span style="display:flex;"><span>    ascData.data.forEach((row, latIndex) =&gt; {
</span></span><span style="display:flex;"><span>        row.forEach((value, lonIndex) =&gt; {
</span></span><span style="display:flex;"><span>            if (value === undefined) { return }
</span></span><span style="display:flex;"><span>            const amount = (value - ascData.min) / range
</span></span><span style="display:flex;"><span>            //const material = new Three.MeshBasicMaterial()
</span></span><span style="display:flex;"><span>            //const hue = Three.MathUtils.lerp(0.7, 0.3, amount)
</span></span><span style="display:flex;"><span>            //const saturation = 1
</span></span><span style="display:flex;"><span>            //const lightness = Three.MathUtils.lerp(0.1, 1, amount)
</span></span><span style="display:flex;"><span>            //material.color.setHSL(hue, saturation, lightness)
</span></span><span style="display:flex;"><span>            //const mesh = new Three.Mesh(geometry, material)
</span></span><span style="display:flex;"><span>            //scene.add(mesh)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            const geometry = new Three.BoxBufferGeometry(1, 1, 1)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            lonHelper.rotation.y = Three.MathUtils.degToRad(lonIndex + ascData.xllcorner) + lonFudge
</span></span><span style="display:flex;"><span>            latHelper.rotation.x = Three.MathUtils.degToRad(latIndex + ascData.yllcorner) + latFudge
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            //positionHelper.updateWorldMatrix(true, false)
</span></span><span style="display:flex;"><span>            //mesh.applyMatrix4(positionHelper.matrixWorld)
</span></span><span style="display:flex;"><span>            //mesh.scale.set(0.005, 0.005, Three.MathUtils.lerp(0.001, 0.5, amount))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            positionHelper.scale.set(0.005, 0.005, Three.MathUtils.lerp(0.01, 0.5, amount))
</span></span><span style="display:flex;"><span>            originHelper.updateWorldMatrix(true, false)
</span></span><span style="display:flex;"><span>            geometry.applyMatrix4(originHelper.matrixWorld)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            const hue = Three.MathUtils.lerp(0.7, 0.3, amount)
</span></span><span style="display:flex;"><span>            const saturation = 1
</span></span><span style="display:flex;"><span>            const lightness = Three.MathUtils.lerp(0.1, 1, amount)
</span></span><span style="display:flex;"><span>            color.setHSL(hue, saturation, lightness)
</span></span><span style="display:flex;"><span>            const rgb = color.toArray().map((value) =&gt; {
</span></span><span style="display:flex;"><span>                return value * 255
</span></span><span style="display:flex;"><span>            })
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            const numVerts = geometry.getAttribute(&#39;position&#39;).count
</span></span><span style="display:flex;"><span>            const itemSize = 3
</span></span><span style="display:flex;"><span>            const colors = new Uint8Array(itemSize * numVerts)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            //è¿™é‡Œæœ‰ä¸€ä¸ªç¨å¾®å¥‡è‘©ç‚¹çš„å†™æ³•ï¼Œå°±æ˜¯ä½¿ç”¨ä¸‹åˆ’çº¿ _ æ¥èµ·åˆ°å‚æ•°å ä½çš„ä½œç”¨
</span></span><span style="display:flex;"><span>            colors.forEach((_, index) =&gt; {
</span></span><span style="display:flex;"><span>                colors[index] = rgb[index % 3]
</span></span><span style="display:flex;"><span>            })
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            const normalized = true
</span></span><span style="display:flex;"><span>            const colorAttrib = new Three.BufferAttribute(colors, itemSize, normalized)
</span></span><span style="display:flex;"><span>            geometry.setAttribute(&#39;color&#39;, colorAttrib)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            geometries.push(geometry)
</span></span><span style="display:flex;"><span>        })
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>    const mergedGeometry = BufferGeometryUtils.mergeBufferGeometries(geometries)
</span></span><span style="display:flex;"><span>    //const material = new Three.MeshBasicMaterial({ color: &#39;red&#39; })
</span></span><span style="display:flex;"><span>    const material = new Three.MeshBasicMaterial({
</span></span><span style="display:flex;"><span>        vertexColors: true
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>    const mesh = new Three.Mesh(mergedGeometry, material)
</span></span><span style="display:flex;"><span>    scene.add(mesh)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><blockquote>
<p>ä¸Šè¿°ä»£ç ä¸­ï¼Œæ³¨é‡Šéƒ¨åˆ†ä¸ºä¹‹å‰ addBoxes() å‡½æ•°çš„ä»£ç ï¼Œé™¤äº† //const material = new Three.MeshBasicMaterial({ color: &lsquo;red&rsquo; }) è¿™ä¸€è¡Œ</p>
</blockquote>
<p><strong>ä»£ç è§£æï¼š</strong></p>
<ol>
<li>
<p>åˆå¹¶æ‰€æœ‰çš„æŸ±çŠ¶ç‰©ï¼Œä½¿ç”¨åˆ°äº†ä¸€ä¸ªæ–°çš„å‡½æ•° BufferGeometryUtils.mergeBufferGeometries()</p>
<blockquote>
<p>æ³¨æ„ï¼šBufferGeometryUtils å¹¶éæ¥è‡ª Threeï¼Œè€Œæ˜¯æ¥è‡ª &rsquo;three/examples/jsm/utils/BufferGeometryUtils&rsquo;</p>
</blockquote>
</li>
<li>
<p>æŸ±çŠ¶ç‰©çš„é¢œè‰²ï¼Œä¸å†ä½¿ç”¨ color è®¾å®šï¼Œè€Œæ˜¯å¯ç”¨äº† â€œé¡¶ç‚¹ç€è‰²â€ã€‚</p>
</li>
</ol>
<blockquote>
<p>å…³äºè¿™ 2 ä¸ªå¤§çš„çŸ¥è¯†ç‚¹ï¼Œå¯ä»¥å»é˜…è¯» Three.js å®˜æ–¹æ–‡æ¡£</p>
</blockquote>
<blockquote>
<p>éœ€è¦æ¶è¡¥å®˜æ–¹æ–‡æ¡£ï¼Œå¦‚æœåªæ˜¯çœ‹äº†æœ¬æ•™ç¨‹ï¼Œé‚£ä¹ˆè¿˜ä¼šæœ‰å¤§é‡çš„çŸ¥è¯†ç‚¹æœªæ›¾æ¥è§¦ã€‚</p>
</blockquote>
<p>ç»è¿‡åˆå¹¶ä¼˜åŒ–åçš„åœºæ™¯ï¼Œåœ¨æµè§ˆå™¨ä¸­è¿è¡Œï¼Œæ¯”ä¹‹å‰çš„æµç•…éå¸¸å¤šï¼Œæ²¡æœ‰å¡é¡¿çš„ç°è±¡äº†ã€‚</p>
<blockquote>
<p>æˆ‘æœ¬æœºç”µè„‘ç¡¬ä»¶é…ç½®æ¯”è¾ƒé«˜ï¼Œæˆ‘åˆ†åˆ«è®°å½•äº† Rendering é¢æ¿ä¸­ ä¼˜åŒ–å‰åçš„ Frames å€¼ã€‚</p>
<p>ä¼˜åŒ–å‰ï¼šé¡ºåˆ©æ¸²æŸ“å¸§çš„ç™¾åˆ†æ¯”çº¦ä¸º 60%</p>
<p>ä¼˜åŒ–åï¼šé¡ºåˆ©æ¸²æŸ“å¸§çš„ç™¾åˆ†æ¯”çº¦ä¸º 90%</p>
<p>å¯è§ç½‘é¡µæµç•…åº¦ç¡®å®æé«˜äº†å¾ˆå¤š</p>
</blockquote>
<h4 id="æœ¬æ–‡å°ç»“">æœ¬æ–‡å°ç»“<a hidden class="anchor" aria-hidden="true" href="#æœ¬æ–‡å°ç»“">#</a></h4>
<p><strong>åœ¨ Three.js å¤§å‹çš„åœºæ™¯ä¸­ï¼Œç»å¤§å¤šæ•°éƒ½éœ€è¦é‡‡ç”¨åˆå¹¶å¯¹è±¡çš„ç­–ç•¥æ¥ä¼˜åŒ–æ¸²æŸ“æ€§èƒ½ã€‚</strong></p>
<p>åˆå¹¶å¯¹è±¡å¯ä»¥å‡å°‘éœ€è¦æ¸²æŸ“çš„å¯¹è±¡æ•°é‡ï¼Œå¹¶ä¸”è¿˜å¯ä»¥å°†æœ‰ä¸€äº›æ ¹æœ¬ä¸å¯è§çš„é¢è¿›è¡Œåˆ é™¤ï¼Œå‡å°‘æ¸²æŸ“é¢ï¼Œæé«˜æ¸²æŸ“æ€§èƒ½ã€‚</p>
<p>ä½ ä»¥ä¸ºå°±è¿™æ ·å¯ä»¥ç»“æŸäº†ï¼Ÿ</p>
<p>äº‹å®ä¸Šè¿˜æœ‰ä¼˜åŒ–ç©ºé—´ï¼Œæœ¬æ–‡å…ˆåˆ°è¿™é‡Œç»“æŸã€‚</p>
<p>ä¸‹ä¸€ç¯‡å°†ç»§ç»­ä¼˜åŒ–è¿™ä¸ªåœºæ™¯ã€‚</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://bablvsj.github.io/tags/three.js/">Three.js</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://bablvsj.github.io/posts/threejs/19-three.js%E6%8A%80%E5%B7%A7%E4%B9%8B%E7%94%BB%E5%B8%83/">
    <span class="title">Â« Prev</span>
    <br>
    <span>19 Three.jsæŠ€å·§ä¹‹ç”»å¸ƒ</span>
  </a>
  <a class="next" href="https://bablvsj.github.io/posts/threejs/21-three.js%E4%BC%98%E5%8C%96%E4%B9%8B%E5%90%88%E5%B9%B6%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%8A%A8%E7%94%BB/">
    <span class="title">Next Â»</span>
    <br>
    <span>21 Three.jsä¼˜åŒ–ä¹‹åˆå¹¶å¯¹è±¡çš„åŠ¨ç”»</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2023 <a href="https://bablvsj.github.io">Bablvsj&#39;s Blog</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
    <div class="flex-c-d">
        <a class="flex-d-c" href="https://www.upyun.com/?utm_source=lianmeng&utm_medium=referral"
            target="_blank"> <span>æœ¬ç«™ç”±</span><img width="60" src="/images/upyun.png">æä¾›CDNåŠ é€Ÿ/äº‘å­˜å‚¨æœåŠ¡</a>
    </div>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script></body>

</html>
