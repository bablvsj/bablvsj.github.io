<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>æµè§ˆå™¨ | Bablvsj's Blog</title><meta name=keywords content="é¢è¯•é¢˜é›†"><meta name=description content="äºŒã€è·¨åŸŸ å› ä¸ºæµè§ˆå™¨å‡ºäºå®‰å…¨è€ƒè™‘ï¼Œæœ‰åŒæºç­–ç•¥ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœåè®®ã€åŸŸåæˆ–è€…ç«¯å£æœ‰ä¸€ä¸ªä¸åŒå°±æ˜¯è·¨åŸŸï¼ŒAjax è¯·æ±‚ä¼šå¤±è´¥ 2.1 JSONP JSONP çš„åŸç†å¾ˆç®€å•ï¼Œå°±æ˜¯åˆ©"><meta name=author content><link rel=canonical href=https://bablvsj.github.io/posts/tech/wait/14-%E5%89%8D%E7%AB%AF%E9%9D%A2%E8%AF%95/%E6%B5%8F%E8%A7%88%E5%99%A8/><link crossorigin=anonymous href=/assets/css/stylesheet.89e53fb10d7090a33517d83b18da1cdb3f4d7bfa546525e8b3cf5a41f9817fb5.css integrity="sha256-ieU/sQ1wkKM1F9g7GNoc2z9Ne/pUZSXos89aQfmBf7U=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://bablvsj.github.io/img/Q.gif><link rel=icon type=image/png sizes=16x16 href=https://bablvsj.github.io/img/Q.gif><link rel=icon type=image/png sizes=32x32 href=https://bablvsj.github.io/img/Q.gif><link rel=apple-touch-icon href=https://bablvsj.github.io/Q.gif><link rel=mask-icon href=https://bablvsj.github.io/Q.gif><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="æµè§ˆå™¨"><meta property="og:description" content="äºŒã€è·¨åŸŸ å› ä¸ºæµè§ˆå™¨å‡ºäºå®‰å…¨è€ƒè™‘ï¼Œæœ‰åŒæºç­–ç•¥ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœåè®®ã€åŸŸåæˆ–è€…ç«¯å£æœ‰ä¸€ä¸ªä¸åŒå°±æ˜¯è·¨åŸŸï¼ŒAjax è¯·æ±‚ä¼šå¤±è´¥ 2.1 JSONP JSONP çš„åŸç†å¾ˆç®€å•ï¼Œå°±æ˜¯åˆ©"><meta property="og:type" content="article"><meta property="og:url" content="https://bablvsj.github.io/posts/tech/wait/14-%E5%89%8D%E7%AB%AF%E9%9D%A2%E8%AF%95/%E6%B5%8F%E8%A7%88%E5%99%A8/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-01-01T17:11:35+08:00"><meta property="article:modified_time" content="2020-01-01T17:11:35+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="æµè§ˆå™¨"><meta name=twitter:description content="äºŒã€è·¨åŸŸ å› ä¸ºæµè§ˆå™¨å‡ºäºå®‰å…¨è€ƒè™‘ï¼Œæœ‰åŒæºç­–ç•¥ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœåè®®ã€åŸŸåæˆ–è€…ç«¯å£æœ‰ä¸€ä¸ªä¸åŒå°±æ˜¯è·¨åŸŸï¼ŒAjax è¯·æ±‚ä¼šå¤±è´¥ 2.1 JSONP JSONP çš„åŸç†å¾ˆç®€å•ï¼Œå°±æ˜¯åˆ©"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"æ–‡ç« ","item":"https://bablvsj.github.io/posts/"},{"@type":"ListItem","position":3,"name":"æµè§ˆå™¨","item":"https://bablvsj.github.io/posts/tech/wait/14-%E5%89%8D%E7%AB%AF%E9%9D%A2%E8%AF%95/%E6%B5%8F%E8%A7%88%E5%99%A8/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"æµè§ˆå™¨","name":"æµè§ˆå™¨","description":"äºŒã€è·¨åŸŸ å› ä¸ºæµè§ˆå™¨å‡ºäºå®‰å…¨è€ƒè™‘ï¼Œæœ‰åŒæºç­–ç•¥ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœåè®®ã€åŸŸåæˆ–è€…ç«¯å£æœ‰ä¸€ä¸ªä¸åŒå°±æ˜¯è·¨åŸŸï¼ŒAjax è¯·æ±‚ä¼šå¤±è´¥ 2.1 JSONP JSONP çš„åŸç†å¾ˆç®€å•ï¼Œå°±æ˜¯åˆ©","keywords":["é¢è¯•é¢˜é›†"],"articleBody":"äºŒã€è·¨åŸŸ å› ä¸ºæµè§ˆå™¨å‡ºäºå®‰å…¨è€ƒè™‘ï¼Œæœ‰åŒæºç­–ç•¥ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœåè®®ã€åŸŸåæˆ–è€…ç«¯å£æœ‰ä¸€ä¸ªä¸åŒå°±æ˜¯è·¨åŸŸï¼ŒAjax è¯·æ±‚ä¼šå¤±è´¥\n2.1 JSONP JSONP çš„åŸç†å¾ˆç®€å•ï¼Œå°±æ˜¯åˆ©ç”¨ scriptæ ‡ç­¾æ²¡æœ‰è·¨åŸŸé™åˆ¶çš„æ¼æ´ã€‚é€šè¿‡ script æ ‡ç­¾æŒ‡å‘ä¸€ä¸ªéœ€è¦è®¿é—®çš„åœ°å€å¹¶æä¾›ä¸€ä¸ªå›è°ƒå‡½æ•°æ¥æ¥æ”¶æ•°æ®å½“éœ€è¦é€šè®¯æ—¶\n1 2 3 4 5 6 \u003cscript src=\"http://domain/api?param1=a\u0026param2=b\u0026callback=jsonp\"\u003e\u003c/script\u003e \u003cscript\u003e function jsonp(data) { console.log(data) } \u003c/script\u003e JSONP ä½¿ç”¨ç®€å•ä¸”å…¼å®¹æ€§ä¸é”™ï¼Œä½†æ˜¯åªé™äº get è¯·æ±‚ 2.2 CORS CORSéœ€è¦æµè§ˆå™¨å’Œåç«¯åŒæ—¶æ”¯æŒ æµè§ˆå™¨ä¼šè‡ªåŠ¨è¿›è¡Œ CORS é€šä¿¡ï¼Œå®ç°CORSé€šä¿¡çš„å…³é”®æ˜¯åç«¯ã€‚åªè¦åç«¯å®ç°äº† CORSï¼Œå°±å®ç°äº†è·¨åŸŸã€‚ æœåŠ¡ç«¯è®¾ç½® Access-Control-Allow-Origin å°±å¯ä»¥å¼€å¯ CORSã€‚ è¯¥å±æ€§è¡¨ç¤ºå“ªäº›åŸŸåå¯ä»¥è®¿é—®èµ„æºï¼Œå¦‚æœè®¾ç½®é€šé…ç¬¦åˆ™è¡¨ç¤ºæ‰€æœ‰ç½‘ç«™éƒ½å¯ä»¥è®¿é—®èµ„æº 2.3 document.domain è¯¥æ–¹å¼åªèƒ½ç”¨äºäºŒçº§åŸŸåç›¸åŒçš„æƒ…å†µä¸‹ï¼Œæ¯”å¦‚ a.test.com å’Œ b.test.com é€‚ç”¨äºè¯¥æ–¹å¼ã€‚ åªéœ€è¦ç»™é¡µé¢æ·»åŠ  document.domain = 'test.com' è¡¨ç¤ºäºŒçº§åŸŸåéƒ½ç›¸åŒå°±å¯ä»¥å®ç°è·¨åŸŸ 2.4 postMessage è¿™ç§æ–¹å¼é€šå¸¸ç”¨äºè·å–åµŒå…¥é¡µé¢ä¸­çš„ç¬¬ä¸‰æ–¹é¡µé¢æ•°æ®ã€‚ä¸€ä¸ªé¡µé¢å‘é€æ¶ˆæ¯ï¼Œå¦ä¸€ä¸ªé¡µé¢åˆ¤æ–­æ¥æºå¹¶æ¥æ”¶æ¶ˆæ¯\n1 2 3 4 5 6 7 8 9 10 11 // å‘é€æ¶ˆæ¯ç«¯ window.parent.postMessage('message', 'http://test.com'); // æ¥æ”¶æ¶ˆæ¯ç«¯ var mc = new MessageChannel(); mc.addEventListener('message', (event) =\u003e { var origin = event.origin || event.originalEvent.origin; if (origin === 'http://test.com') { console.log('éªŒè¯é€šè¿‡') } }); ä¸‰ã€Event loop 3.1 JSä¸­çš„event loop ä¼—æ‰€å‘¨çŸ¥ JS æ˜¯é—¨éé˜»å¡å•çº¿ç¨‹è¯­è¨€ï¼Œå› ä¸ºåœ¨æœ€åˆ JS å°±æ˜¯ä¸ºäº†å’Œæµè§ˆå™¨äº¤äº’è€Œè¯ç”Ÿçš„ã€‚å¦‚æœ JS æ˜¯é—¨å¤šçº¿ç¨‹çš„è¯­è¨€è¯ï¼Œæˆ‘ä»¬åœ¨å¤šä¸ªçº¿ç¨‹ä¸­å¤„ç† DOM å°±å¯èƒ½ä¼šå‘ç”Ÿé—®é¢˜ï¼ˆä¸€ä¸ªçº¿ç¨‹ä¸­æ–°åŠ èŠ‚ç‚¹ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹ä¸­åˆ é™¤èŠ‚ç‚¹ï¼‰\nJS åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ä¼šäº§ç”Ÿæ‰§è¡Œç¯å¢ƒï¼Œè¿™äº›æ‰§è¡Œç¯å¢ƒä¼šè¢«é¡ºåºçš„åŠ å…¥åˆ°æ‰§è¡Œæ ˆä¸­ã€‚å¦‚æœé‡åˆ°å¼‚æ­¥çš„ä»£ç ï¼Œä¼šè¢«æŒ‚èµ·å¹¶åŠ å…¥åˆ° Taskï¼ˆæœ‰å¤šç§ taskï¼‰ é˜Ÿåˆ—ä¸­ã€‚ä¸€æ—¦æ‰§è¡Œæ ˆä¸ºç©ºï¼ŒEvent Loop å°±ä¼šä» Task é˜Ÿåˆ—ä¸­æ‹¿å‡ºéœ€è¦æ‰§è¡Œçš„ä»£ç å¹¶æ”¾å…¥æ‰§è¡Œæ ˆä¸­æ‰§è¡Œï¼Œæ‰€ä»¥æœ¬è´¨ä¸Šæ¥è¯´ JS ä¸­çš„å¼‚æ­¥è¿˜æ˜¯åŒæ­¥è¡Œä¸º 1 2 3 4 5 6 7 console.log('script start'); setTimeout(function() { console.log('setTimeout'); }, 0); console.log('script end'); ä¸åŒçš„ä»»åŠ¡æºä¼šè¢«åˆ†é…åˆ°ä¸åŒçš„ Task é˜Ÿåˆ—ä¸­ï¼Œä»»åŠ¡æºå¯ä»¥åˆ†ä¸º å¾®ä»»åŠ¡ï¼ˆmicrotaskï¼‰ å’Œ å®ä»»åŠ¡ï¼ˆmacrotaskï¼‰ã€‚åœ¨ ES6 è§„èŒƒä¸­ï¼Œmicrotask ç§°ä¸º jobsï¼Œmacrotask ç§°ä¸º task\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 console.log('script start'); setTimeout(function() { console.log('setTimeout'); }, 0); new Promise((resolve) =\u003e { console.log('Promise') resolve() }).then(function() { console.log('promise1'); }).then(function() { console.log('promise2'); }); console.log('script end'); // script start =\u003e Promise =\u003e script end =\u003e promise1 =\u003e promise2 =\u003e setTimeout ä»¥ä¸Šä»£ç è™½ç„¶ setTimeout å†™åœ¨ Promise ä¹‹å‰ï¼Œä½†æ˜¯å› ä¸º Promise å±äºå¾®ä»»åŠ¡è€Œ setTimeout å±äºå®ä»»åŠ¡\nå¾®ä»»åŠ¡\nprocess.nextTick promise Object.observe MutationObserver å®ä»»åŠ¡\nscript setTimeout setInterval setImmediate I/O UI rendering å®ä»»åŠ¡ä¸­åŒ…æ‹¬äº† script ï¼Œæµè§ˆå™¨ä¼šå…ˆæ‰§è¡Œä¸€ä¸ªå®ä»»åŠ¡ï¼Œæ¥ä¸‹æ¥æœ‰å¼‚æ­¥ä»£ç çš„è¯å°±å…ˆæ‰§è¡Œå¾®ä»»åŠ¡\næ‰€ä»¥æ­£ç¡®çš„ä¸€æ¬¡ Event loop é¡ºåºæ˜¯è¿™æ ·çš„\næ‰§è¡ŒåŒæ­¥ä»£ç ï¼Œè¿™å±äºå®ä»»åŠ¡ æ‰§è¡Œæ ˆä¸ºç©ºï¼ŒæŸ¥è¯¢æ˜¯å¦æœ‰å¾®ä»»åŠ¡éœ€è¦æ‰§è¡Œ æ‰§è¡Œæ‰€æœ‰å¾®ä»»åŠ¡ å¿…è¦çš„è¯æ¸²æŸ“ UI ç„¶åå¼€å§‹ä¸‹ä¸€è½® Event loopï¼Œæ‰§è¡Œå®ä»»åŠ¡ä¸­çš„å¼‚æ­¥ä»£ç  é€šè¿‡ä¸Šè¿°çš„ Event loop é¡ºåºå¯çŸ¥ï¼Œå¦‚æœå®ä»»åŠ¡ä¸­çš„å¼‚æ­¥ä»£ç æœ‰å¤§é‡çš„è®¡ç®—å¹¶ä¸”éœ€è¦æ“ä½œ DOM çš„è¯ï¼Œä¸ºäº†æ›´å¿«çš„å“åº”ç•Œé¢å“åº”ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæ“ä½œ DOM æ”¾å…¥å¾®ä»»åŠ¡ä¸­\n3.2 Node ä¸­çš„ Event loop Node ä¸­çš„ Event loop å’Œæµè§ˆå™¨ä¸­çš„ä¸ç›¸åŒã€‚ Node çš„ Event loop åˆ†ä¸º6ä¸ªé˜¶æ®µï¼Œå®ƒä»¬ä¼šæŒ‰ç…§é¡ºåºåå¤è¿è¡Œ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€\u003eâ”‚ timers â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ I/O callbacks â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ idle, prepare â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ incoming: â”‚ â”‚ â”‚ poll â”‚\u003câ”€â”€connectionsâ”€â”€â”€ â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ data, etc. â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ check â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â””â”€â”€â”¤ close callbacks â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ timer\ntimers é˜¶æ®µä¼šæ‰§è¡Œ setTimeout å’Œ setInterval ä¸€ä¸ª timer æŒ‡å®šçš„æ—¶é—´å¹¶ä¸æ˜¯å‡†ç¡®æ—¶é—´ï¼Œè€Œæ˜¯åœ¨è¾¾åˆ°è¿™ä¸ªæ—¶é—´åå°½å¿«æ‰§è¡Œå›è°ƒï¼Œå¯èƒ½ä¼šå› ä¸ºç³»ç»Ÿæ­£åœ¨æ‰§è¡Œåˆ«çš„äº‹åŠ¡è€Œå»¶è¿Ÿ I/O\nI/O é˜¶æ®µä¼šæ‰§è¡Œé™¤äº† close äº‹ä»¶ï¼Œå®šæ—¶å™¨å’Œ setImmediate çš„å›è°ƒ idle, prepare idle, prepare é˜¶æ®µå†…éƒ¨å®ç°\npoll\npoll é˜¶æ®µå¾ˆé‡è¦ï¼Œè¿™ä¸€é˜¶æ®µä¸­ï¼Œç³»ç»Ÿä¼šåšä¸¤ä»¶äº‹æƒ…\næ‰§è¡Œåˆ°ç‚¹çš„å®šæ—¶å™¨ æ‰§è¡Œ poll é˜Ÿåˆ—ä¸­çš„äº‹ä»¶ å¹¶ä¸”å½“ poll ä¸­æ²¡æœ‰å®šæ—¶å™¨çš„æƒ…å†µä¸‹ï¼Œä¼šå‘ç°ä»¥ä¸‹ä¸¤ä»¶äº‹æƒ…\nå¦‚æœ poll é˜Ÿåˆ—ä¸ä¸ºç©ºï¼Œä¼šéå†å›è°ƒé˜Ÿåˆ—å¹¶åŒæ­¥æ‰§è¡Œï¼Œç›´åˆ°é˜Ÿåˆ—ä¸ºç©ºæˆ–è€…ç³»ç»Ÿé™åˆ¶ å¦‚æœ poll é˜Ÿåˆ—ä¸ºç©ºï¼Œä¼šæœ‰ä¸¤ä»¶äº‹å‘ç”Ÿ å¦‚æœæœ‰ setImmediate éœ€è¦æ‰§è¡Œï¼Œpoll é˜¶æ®µä¼šåœæ­¢å¹¶ä¸”è¿›å…¥åˆ° check é˜¶æ®µæ‰§è¡Œ setImmediate å¦‚æœæ²¡æœ‰ setImmediate éœ€è¦æ‰§è¡Œï¼Œä¼šç­‰å¾…å›è°ƒè¢«åŠ å…¥åˆ°é˜Ÿåˆ—ä¸­å¹¶ç«‹å³æ‰§è¡Œå›è°ƒ å¦‚æœæœ‰åˆ«çš„å®šæ—¶å™¨éœ€è¦è¢«æ‰§è¡Œï¼Œä¼šå›åˆ° timer é˜¶æ®µæ‰§è¡Œå›è°ƒã€‚ check\ncheck é˜¶æ®µæ‰§è¡Œ setImmediate close callbacks\nclose callbacks é˜¶æ®µæ‰§è¡Œ close äº‹ä»¶ å¹¶ä¸”åœ¨ Node ä¸­ï¼Œæœ‰äº›æƒ…å†µä¸‹çš„å®šæ—¶å™¨æ‰§è¡Œé¡ºåºæ˜¯éšæœºçš„ 1 2 3 4 5 6 7 8 9 10 setTimeout(() =\u003e { console.log('setTimeout'); }, 0); setImmediate(() =\u003e { console.log('setImmediate'); }) // è¿™é‡Œå¯èƒ½ä¼šè¾“å‡º setTimeoutï¼ŒsetImmediate // å¯èƒ½ä¹Ÿä¼šç›¸åçš„è¾“å‡ºï¼Œè¿™å–å†³äºæ€§èƒ½ // å› ä¸ºå¯èƒ½è¿›å…¥ event loop ç”¨äº†ä¸åˆ° 1 æ¯«ç§’ï¼Œè¿™æ—¶å€™ä¼šæ‰§è¡Œ setImmediate // å¦åˆ™ä¼šæ‰§è¡Œ setTimeout ä¸Šé¢ä»‹ç»çš„éƒ½æ˜¯ macrotask çš„æ‰§è¡Œæƒ…å†µï¼Œmicrotask ä¼šåœ¨ä»¥ä¸Šæ¯ä¸ªé˜¶æ®µå®Œæˆåç«‹å³æ‰§è¡Œ\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 setTimeout(()=\u003e{ console.log('timer1') Promise.resolve().then(function() { console.log('promise1') }) }, 0) setTimeout(()=\u003e{ console.log('timer2') Promise.resolve().then(function() { console.log('promise2') }) }, 0) // ä»¥ä¸Šä»£ç åœ¨æµè§ˆå™¨å’Œ node ä¸­æ‰“å°æƒ…å†µæ˜¯ä¸åŒçš„ // æµè§ˆå™¨ä¸­ä¸€å®šæ‰“å° timer1, promise1, timer2, promise2 // node ä¸­å¯èƒ½æ‰“å° timer1, timer2, promise1, promise2 // ä¹Ÿå¯èƒ½æ‰“å° timer1, promise1, timer2, promise2 Node ä¸­çš„ process.nextTick ä¼šå…ˆäºå…¶ä»– microtask æ‰§è¡Œ\n1 2 3 4 5 6 7 8 9 10 11 12 setTimeout(() =\u003e { console.log(\"timer1\"); Promise.resolve().then(function() { console.log(\"promise1\"); }); }, 0); process.nextTick(() =\u003e { console.log(\"nextTick\"); }); // nextTick, timer1, promise1 å››ã€Service Worker Service workers æœ¬è´¨ä¸Šå……å½“Webåº”ç”¨ç¨‹åºä¸æµè§ˆå™¨ä¹‹é—´çš„ä»£ç†æœåŠ¡å™¨ï¼Œä¹Ÿå¯ä»¥åœ¨ç½‘ç»œå¯ç”¨æ—¶ä½œä¸ºæµè§ˆå™¨å’Œç½‘ç»œé—´çš„ä»£ç†ã€‚å®ƒä»¬æ—¨åœ¨ï¼ˆé™¤å…¶ä»–ä¹‹å¤–ï¼‰ä½¿å¾—èƒ½å¤Ÿåˆ›å»ºæœ‰æ•ˆçš„ç¦»çº¿ä½“éªŒï¼Œæ‹¦æˆªç½‘ç»œè¯·æ±‚å¹¶åŸºäºç½‘ç»œæ˜¯å¦å¯ç”¨ä»¥åŠæ›´æ–°çš„èµ„æºæ˜¯å¦é©»ç•™åœ¨æœåŠ¡å™¨ä¸Šæ¥é‡‡å–é€‚å½“çš„åŠ¨ä½œã€‚ä»–ä»¬è¿˜å…è®¸è®¿é—®æ¨é€é€šçŸ¥å’Œåå°åŒæ­¥API\nç›®å‰è¯¥æŠ€æœ¯é€šå¸¸ç”¨æ¥åšç¼“å­˜æ–‡ä»¶ï¼Œæé«˜é¦–å±é€Ÿåº¦\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 // index.js if (navigator.serviceWorker) { navigator.serviceWorker .register(\"sw.js\") .then(function(registration) { console.log(\"service worker æ³¨å†ŒæˆåŠŸ\"); }) .catch(function(err) { console.log(\"servcie worker æ³¨å†Œå¤±è´¥\"); }); } // sw.js // ç›‘å¬ `install` äº‹ä»¶ï¼Œå›è°ƒä¸­ç¼“å­˜æ‰€éœ€æ–‡ä»¶ self.addEventListener(\"install\", e =\u003e { e.waitUntil( caches.open(\"my-cache\").then(function(cache) { return cache.addAll([\"./index.html\", \"./index.js\"]); }) ); }); // æ‹¦æˆªæ‰€æœ‰è¯·æ±‚äº‹ä»¶ // å¦‚æœç¼“å­˜ä¸­å·²ç»æœ‰è¯·æ±‚çš„æ•°æ®å°±ç›´æ¥ç”¨ç¼“å­˜ï¼Œå¦åˆ™å»è¯·æ±‚æ•°æ® self.addEventListener(\"fetch\", e =\u003e { e.respondWith( caches.match(e.request).then(function(response) { if (response) { return response; } console.log(\"fetch source\"); }) ); }); æ‰“å¼€é¡µé¢ï¼Œå¯ä»¥åœ¨å¼€å‘è€…å·¥å…·ä¸­çš„ Application çœ‹åˆ° Service Worker å·²ç»å¯åŠ¨äº†\nåœ¨ Cache ä¸­ä¹Ÿå¯ä»¥å‘ç°æˆ‘ä»¬æ‰€éœ€çš„æ–‡ä»¶å·²è¢«ç¼“å­˜\nå½“æˆ‘ä»¬é‡æ–°åˆ·æ–°é¡µé¢å¯ä»¥å‘ç°æˆ‘ä»¬ç¼“å­˜çš„æ•°æ®æ˜¯ä» Service Worker ä¸­è¯»å–çš„\näº”ã€æ¸²æŸ“æœºåˆ¶ æµè§ˆå™¨çš„æ¸²æŸ“æœºåˆ¶ä¸€èˆ¬åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ­¥éª¤\nå¤„ç† HTML å¹¶æ„å»º DOM æ ‘ã€‚ å¤„ç† CSS æ„å»º CSSOM æ ‘ã€‚ å°† DOM ä¸ CSSOM åˆå¹¶æˆä¸€ä¸ªæ¸²æŸ“æ ‘ã€‚ æ ¹æ®æ¸²æŸ“æ ‘æ¥å¸ƒå±€ï¼Œè®¡ç®—æ¯ä¸ªèŠ‚ç‚¹çš„ä½ç½®ã€‚ è°ƒç”¨ GPU ç»˜åˆ¶ï¼Œåˆæˆå›¾å±‚ï¼Œæ˜¾ç¤ºåœ¨å±å¹•ä¸Š åœ¨æ„å»º CSSOM æ ‘æ—¶ï¼Œä¼šé˜»å¡æ¸²æŸ“ï¼Œç›´è‡³ CSSOM æ ‘æ„å»ºå®Œæˆã€‚å¹¶ä¸”æ„å»º CSSOM æ ‘æ˜¯ä¸€ä¸ªååˆ†æ¶ˆè€—æ€§èƒ½çš„è¿‡ç¨‹ï¼Œæ‰€ä»¥åº”è¯¥å°½é‡ä¿è¯å±‚çº§æ‰å¹³ï¼Œå‡å°‘è¿‡åº¦å±‚å ï¼Œè¶Šæ˜¯å…·ä½“çš„ CSS é€‰æ‹©å™¨ï¼Œæ‰§è¡Œé€Ÿåº¦è¶Šæ…¢ å½“ HTML è§£æåˆ° script æ ‡ç­¾æ—¶ï¼Œä¼šæš‚åœæ„å»º DOMï¼Œå®Œæˆåæ‰ä¼šä»æš‚åœçš„åœ°æ–¹é‡æ–°å¼€å§‹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä½ æƒ³é¦–å±æ¸²æŸ“çš„è¶Šå¿«ï¼Œå°±è¶Šä¸åº”è¯¥åœ¨é¦–å±å°±åŠ è½½ JS æ–‡ä»¶ã€‚å¹¶ä¸” CSS ä¹Ÿä¼šå½±å“ JS çš„æ‰§è¡Œï¼Œåªæœ‰å½“è§£æå®Œæ ·å¼è¡¨æ‰ä¼šæ‰§è¡Œ JSï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥è®¤ä¸ºè¿™ç§æƒ…å†µä¸‹ï¼ŒCSS ä¹Ÿä¼šæš‚åœæ„å»º DOM 5.1 å›¾å±‚ ä¸€èˆ¬æ¥è¯´ï¼Œå¯ä»¥æŠŠæ™®é€šæ–‡æ¡£æµçœ‹æˆä¸€ä¸ªå›¾å±‚ã€‚ç‰¹å®šçš„å±æ€§å¯ä»¥ç”Ÿæˆä¸€ä¸ªæ–°çš„å›¾å±‚ã€‚ä¸åŒçš„å›¾å±‚æ¸²æŸ“äº’ä¸å½±å“ï¼Œæ‰€ä»¥å¯¹äºæŸäº›é¢‘ç¹éœ€è¦æ¸²æŸ“çš„å»ºè®®å•ç‹¬ç”Ÿæˆä¸€ä¸ªæ–°å›¾å±‚ï¼Œæé«˜æ€§èƒ½ã€‚ä½†ä¹Ÿä¸èƒ½ç”Ÿæˆè¿‡å¤šçš„å›¾å±‚ï¼Œä¼šå¼•èµ·åä½œç”¨\né€šè¿‡ä»¥ä¸‹å‡ ä¸ªå¸¸ç”¨å±æ€§å¯ä»¥ç”Ÿæˆæ–°å›¾å±‚\n3D å˜æ¢ï¼štranslate3dã€translateZ will-change videoã€iframe æ ‡ç­¾ é€šè¿‡åŠ¨ç”»å®ç°çš„ opacity åŠ¨ç”»è½¬æ¢ position: fixed 5.2 é‡ç»˜ï¼ˆRepaintï¼‰å’Œå›æµï¼ˆReflowï¼‰ é‡ç»˜æ˜¯å½“èŠ‚ç‚¹éœ€è¦æ›´æ”¹å¤–è§‚è€Œä¸ä¼šå½±å“å¸ƒå±€çš„ï¼Œæ¯”å¦‚æ”¹å˜ color å°±å«ç§°ä¸ºé‡ç»˜ å›æµæ˜¯å¸ƒå±€æˆ–è€…å‡ ä½•å±æ€§éœ€è¦æ”¹å˜å°±ç§°ä¸ºå›æµ å›æµå¿…å®šä¼šå‘ç”Ÿé‡ç»˜ï¼Œé‡ç»˜ä¸ä¸€å®šä¼šå¼•å‘å›æµã€‚å›æµæ‰€éœ€çš„æˆæœ¬æ¯”é‡ç»˜é«˜çš„å¤šï¼Œæ”¹å˜æ·±å±‚æ¬¡çš„èŠ‚ç‚¹å¾ˆå¯èƒ½å¯¼è‡´çˆ¶èŠ‚ç‚¹çš„ä¸€ç³»åˆ—å›æµ\næ‰€ä»¥ä»¥ä¸‹å‡ ä¸ªåŠ¨ä½œå¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜ï¼š\næ”¹å˜ window å¤§å° æ”¹å˜å­—ä½“ æ·»åŠ æˆ–åˆ é™¤æ ·å¼ æ–‡å­—æ”¹å˜ å®šä½æˆ–è€…æµ®åŠ¨ ç›’æ¨¡å‹ å¾ˆå¤šäººä¸çŸ¥é“çš„æ˜¯ï¼Œé‡ç»˜å’Œå›æµå…¶å®å’Œ Event loop æœ‰å…³\nå½“ Event loop æ‰§è¡Œå®Œ Microtasks åï¼Œä¼šåˆ¤æ–­ document æ˜¯å¦éœ€è¦æ›´æ–°ã€‚å› ä¸ºæµè§ˆå™¨æ˜¯ 60Hz çš„åˆ·æ–°ç‡ï¼Œæ¯ 16ms æ‰ä¼šæ›´æ–°ä¸€æ¬¡ã€‚ ç„¶ååˆ¤æ–­æ˜¯å¦æœ‰ resize æˆ–è€… scroll ï¼Œæœ‰çš„è¯ä¼šå»è§¦å‘äº‹ä»¶ï¼Œæ‰€ä»¥ resize å’Œ scroll äº‹ä»¶ä¹Ÿæ˜¯è‡³å°‘ 16ms æ‰ä¼šè§¦å‘ä¸€æ¬¡ï¼Œå¹¶ä¸”è‡ªå¸¦èŠ‚æµåŠŸèƒ½ã€‚ åˆ¤æ–­æ˜¯å¦è§¦å‘äº† media query æ›´æ–°åŠ¨ç”»å¹¶ä¸”å‘é€äº‹ä»¶ åˆ¤æ–­æ˜¯å¦æœ‰å…¨å±æ“ä½œäº‹ä»¶ æ‰§è¡Œ requestAnimationFrame å›è°ƒ æ‰§è¡Œ IntersectionObserver å›è°ƒï¼Œè¯¥æ–¹æ³•ç”¨äºåˆ¤æ–­å…ƒç´ æ˜¯å¦å¯è§ï¼Œå¯ä»¥ç”¨äºæ‡’åŠ è½½ä¸Šï¼Œä½†æ˜¯å…¼å®¹æ€§ä¸å¥½ æ›´æ–°ç•Œé¢ ä»¥ä¸Šå°±æ˜¯ä¸€å¸§ä¸­å¯èƒ½ä¼šåšçš„äº‹æƒ…ã€‚å¦‚æœåœ¨ä¸€å¸§ä¸­æœ‰ç©ºé—²æ—¶é—´ï¼Œå°±ä¼šå»æ‰§è¡Œ requestIdleCallback å›è°ƒ å‡å°‘é‡ç»˜å’Œå›æµ\nä½¿ç”¨ translate æ›¿ä»£ top ä½¿ç”¨ visibility æ›¿æ¢ display: none ï¼Œå› ä¸ºå‰è€…åªä¼šå¼•èµ·é‡ç»˜ï¼Œåè€…ä¼šå¼•å‘å›æµï¼ˆæ”¹å˜äº†å¸ƒå±€ï¼‰ ä¸è¦ä½¿ç”¨ table å¸ƒå±€ï¼Œå¯èƒ½å¾ˆå°çš„ä¸€ä¸ªå°æ”¹åŠ¨ä¼šé€ æˆæ•´ä¸ª table çš„é‡æ–°å¸ƒå±€ åŠ¨ç”»å®ç°çš„é€Ÿåº¦çš„é€‰æ‹©ï¼ŒåŠ¨ç”»é€Ÿåº¦è¶Šå¿«ï¼Œå›æµæ¬¡æ•°è¶Šå¤šï¼Œä¹Ÿå¯ä»¥é€‰æ‹©ä½¿ç”¨ requestAnimationFrame CSS é€‰æ‹©ç¬¦ä»å³å¾€å·¦åŒ¹é…æŸ¥æ‰¾ï¼Œé¿å… DOM æ·±åº¦è¿‡æ·± å°†é¢‘ç¹è¿è¡Œçš„åŠ¨ç”»å˜ä¸ºå›¾å±‚ï¼Œå›¾å±‚èƒ½å¤Ÿé˜»æ­¢è¯¥èŠ‚ç‚¹å›æµå½±å“åˆ«çš„å…ƒç´ ã€‚æ¯”å¦‚å¯¹äº video æ ‡ç­¾ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨å°†è¯¥èŠ‚ç‚¹å˜ä¸ºå›¾å±‚ ","wordCount":"3590","inLanguage":"en","datePublished":"2020-01-01T17:11:35+08:00","dateModified":"2020-01-01T17:11:35+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://bablvsj.github.io/posts/tech/wait/14-%E5%89%8D%E7%AB%AF%E9%9D%A2%E8%AF%95/%E6%B5%8F%E8%A7%88%E5%99%A8/"},"publisher":{"@type":"Organization","name":"Bablvsj's Blog","logo":{"@type":"ImageObject","url":"https://bablvsj.github.io/img/Q.gif"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://bablvsj.github.io accesskey=h title="Bablvsj's Blog (Alt + H)">Bablvsj's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://bablvsj.github.io/ title=ä¸»é¡µ><span>ä¸»é¡µ</span></a></li><li><a href=https://bablvsj.github.io/archives/ title=æ—¶é—´è½´><span>æ—¶é—´è½´</span></a></li><li><a href=https://bablvsj.github.io/tags title=æ ‡ç­¾><span>æ ‡ç­¾</span></a></li><li><a href=https://bablvsj.github.io/about title=å…³äº><span>å…³äº</span></a></li><li><a href=https://bablvsj.github.io/search title="ğŸ” (Alt + /)" accesskey=/><span>ğŸ”</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>æµè§ˆå™¨</h1><div class=post-meta><ul class=post-tags-meta><a href=https://bablvsj.github.io/tags/%E9%9D%A2%E8%AF%95%E9%A2%98%E9%9B%86/>é¢è¯•é¢˜é›†</a></ul>8 min&nbsp;Â·&nbsp;<span title='2020-01-01 17:11:35 +0800 +0800'>2020/01/01</span></div></header><aside id=toc-container class="toc-container wide"><div class=toc><div class=inner><ul><li><a href=#%e4%ba%8c%e8%b7%a8%e5%9f%9f aria-label=äºŒã€è·¨åŸŸ>äºŒã€è·¨åŸŸ</a><ul><li><a href=#21-jsonp aria-label="2.1 JSONP">2.1 JSONP</a></li><li><a href=#22-cors aria-label="2.2 CORS">2.2 CORS</a></li><li><a href=#23-documentdomain aria-label="2.3 document.domain">2.3 document.domain</a></li><li><a href=#24-postmessage aria-label="2.4 postMessage">2.4 postMessage</a></li></ul></li><li><a href=#%e4%b8%89event-loop aria-label="ä¸‰ã€Event loop">ä¸‰ã€Event loop</a><ul><li><a href=#31-js%e4%b8%ad%e7%9a%84event-loop aria-label="3.1 JSä¸­çš„event loop">3.1 JSä¸­çš„event loop</a></li><li><a href=#32-node-%e4%b8%ad%e7%9a%84-event-loop aria-label="3.2 Node ä¸­çš„ Event loop">3.2 Node ä¸­çš„ Event loop</a></li></ul></li><li><a href=#%e5%9b%9bservice-worker aria-label="å››ã€Service Worker">å››ã€Service Worker</a></li><li><a href=#%e4%ba%94%e6%b8%b2%e6%9f%93%e6%9c%ba%e5%88%b6 aria-label=äº”ã€æ¸²æŸ“æœºåˆ¶>äº”ã€æ¸²æŸ“æœºåˆ¶</a><ul><li><a href=#51-%e5%9b%be%e5%b1%82 aria-label="5.1 å›¾å±‚">5.1 å›¾å±‚</a></li><li><a href=#52-%e9%87%8d%e7%bb%98repaint%e5%92%8c%e5%9b%9e%e6%b5%81reflow aria-label="5.2 é‡ç»˜ï¼ˆRepaintï¼‰å’Œå›æµï¼ˆReflowï¼‰">5.2 é‡ç»˜ï¼ˆRepaintï¼‰å’Œå›æµï¼ˆReflowï¼‰</a></li></ul></li></ul></div></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><h2 id=äºŒè·¨åŸŸ>äºŒã€è·¨åŸŸ<a hidden class=anchor aria-hidden=true href=#äºŒè·¨åŸŸ>#</a></h2><blockquote><p>å› ä¸ºæµè§ˆå™¨å‡ºäºå®‰å…¨è€ƒè™‘ï¼Œæœ‰åŒæºç­–ç•¥ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœåè®®ã€åŸŸåæˆ–è€…ç«¯å£æœ‰ä¸€ä¸ªä¸åŒå°±æ˜¯è·¨åŸŸï¼ŒAjax è¯·æ±‚ä¼šå¤±è´¥</p></blockquote><h3 id=21-jsonp>2.1 JSONP<a hidden class=anchor aria-hidden=true href=#21-jsonp>#</a></h3><blockquote><p>JSONP çš„åŸç†å¾ˆç®€å•ï¼Œå°±æ˜¯åˆ©ç”¨ scriptæ ‡ç­¾æ²¡æœ‰è·¨åŸŸé™åˆ¶çš„æ¼æ´ã€‚é€šè¿‡ script æ ‡ç­¾æŒ‡å‘ä¸€ä¸ªéœ€è¦è®¿é—®çš„åœ°å€å¹¶æä¾›ä¸€ä¸ªå›è°ƒå‡½æ•°æ¥æ¥æ”¶æ•°æ®å½“éœ€è¦é€šè®¯æ—¶</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;http://domain/api?param1=a&amp;param2=b&amp;callback=jsonp&#34;</span><span class=p>&gt;&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=kd>function</span> <span class=nx>jsonp</span><span class=p>(</span><span class=nx>data</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    	<span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>JSONP ä½¿ç”¨ç®€å•ä¸”å…¼å®¹æ€§ä¸é”™ï¼Œä½†æ˜¯åªé™äº get è¯·æ±‚</li></ul><h3 id=22-cors>2.2 CORS<a hidden class=anchor aria-hidden=true href=#22-cors>#</a></h3><ul><li><code>CORS</code>éœ€è¦æµè§ˆå™¨å’Œåç«¯åŒæ—¶æ”¯æŒ</li><li>æµè§ˆå™¨ä¼šè‡ªåŠ¨è¿›è¡Œ <code>CORS</code> é€šä¿¡ï¼Œå®ç°CORSé€šä¿¡çš„å…³é”®æ˜¯åç«¯ã€‚åªè¦åç«¯å®ç°äº† <code>CORS</code>ï¼Œå°±å®ç°äº†è·¨åŸŸã€‚</li><li>æœåŠ¡ç«¯è®¾ç½® <code>Access-Control-Allow-Origin</code> å°±å¯ä»¥å¼€å¯ <code>CORS</code>ã€‚ è¯¥å±æ€§è¡¨ç¤ºå“ªäº›åŸŸåå¯ä»¥è®¿é—®èµ„æºï¼Œå¦‚æœè®¾ç½®é€šé…ç¬¦åˆ™è¡¨ç¤ºæ‰€æœ‰ç½‘ç«™éƒ½å¯ä»¥è®¿é—®èµ„æº</li></ul><h3 id=23-documentdomain>2.3 document.domain<a hidden class=anchor aria-hidden=true href=#23-documentdomain>#</a></h3><ul><li>è¯¥æ–¹å¼åªèƒ½ç”¨äºäºŒçº§åŸŸåç›¸åŒçš„æƒ…å†µä¸‹ï¼Œæ¯”å¦‚ <code>a.test.com</code> å’Œ <code>b.test.com</code> é€‚ç”¨äºè¯¥æ–¹å¼ã€‚</li><li>åªéœ€è¦ç»™é¡µé¢æ·»åŠ  <code>document.domain = 'test.com'</code> è¡¨ç¤ºäºŒçº§åŸŸåéƒ½ç›¸åŒå°±å¯ä»¥å®ç°è·¨åŸŸ</li></ul><h3 id=24-postmessage>2.4 postMessage<a hidden class=anchor aria-hidden=true href=#24-postmessage>#</a></h3><blockquote><p>è¿™ç§æ–¹å¼é€šå¸¸ç”¨äºè·å–åµŒå…¥é¡µé¢ä¸­çš„ç¬¬ä¸‰æ–¹é¡µé¢æ•°æ®ã€‚ä¸€ä¸ªé¡µé¢å‘é€æ¶ˆæ¯ï¼Œå¦ä¸€ä¸ªé¡µé¢åˆ¤æ–­æ¥æºå¹¶æ¥æ”¶æ¶ˆæ¯</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// å‘é€æ¶ˆæ¯ç«¯
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nb>window</span><span class=p>.</span><span class=nx>parent</span><span class=p>.</span><span class=nx>postMessage</span><span class=p>(</span><span class=s1>&#39;message&#39;</span><span class=p>,</span> <span class=s1>&#39;http://test.com&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// æ¥æ”¶æ¶ˆæ¯ç«¯
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>var</span> <span class=nx>mc</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>MessageChannel</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nx>mc</span><span class=p>.</span><span class=nx>addEventListener</span><span class=p>(</span><span class=s1>&#39;message&#39;</span><span class=p>,</span> <span class=p>(</span><span class=nx>event</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>origin</span> <span class=o>=</span> <span class=nx>event</span><span class=p>.</span><span class=nx>origin</span> <span class=o>||</span> <span class=nx>event</span><span class=p>.</span><span class=nx>originalEvent</span><span class=p>.</span><span class=nx>origin</span><span class=p>;</span> 
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>origin</span> <span class=o>===</span> <span class=s1>&#39;http://test.com&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;éªŒè¯é€šè¿‡&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=ä¸‰event-loop>ä¸‰ã€Event loop<a hidden class=anchor aria-hidden=true href=#ä¸‰event-loop>#</a></h2><h3 id=31-jsä¸­çš„event-loop>3.1 JSä¸­çš„event loop<a hidden class=anchor aria-hidden=true href=#31-jsä¸­çš„event-loop>#</a></h3><blockquote><p>ä¼—æ‰€å‘¨çŸ¥ JS æ˜¯é—¨éé˜»å¡å•çº¿ç¨‹è¯­è¨€ï¼Œå› ä¸ºåœ¨æœ€åˆ JS å°±æ˜¯ä¸ºäº†å’Œæµè§ˆå™¨äº¤äº’è€Œè¯ç”Ÿçš„ã€‚å¦‚æœ JS æ˜¯é—¨å¤šçº¿ç¨‹çš„è¯­è¨€è¯ï¼Œæˆ‘ä»¬åœ¨å¤šä¸ªçº¿ç¨‹ä¸­å¤„ç† DOM å°±å¯èƒ½ä¼šå‘ç”Ÿé—®é¢˜ï¼ˆä¸€ä¸ªçº¿ç¨‹ä¸­æ–°åŠ èŠ‚ç‚¹ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹ä¸­åˆ é™¤èŠ‚ç‚¹ï¼‰</p></blockquote><ul><li>JS åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ä¼šäº§ç”Ÿæ‰§è¡Œç¯å¢ƒï¼Œè¿™äº›æ‰§è¡Œç¯å¢ƒä¼šè¢«é¡ºåºçš„åŠ å…¥åˆ°æ‰§è¡Œæ ˆä¸­ã€‚å¦‚æœé‡åˆ°å¼‚æ­¥çš„ä»£ç ï¼Œä¼šè¢«æŒ‚èµ·å¹¶åŠ å…¥åˆ° Taskï¼ˆæœ‰å¤šç§ taskï¼‰ é˜Ÿåˆ—ä¸­ã€‚ä¸€æ—¦æ‰§è¡Œæ ˆä¸ºç©ºï¼ŒEvent Loop å°±ä¼šä» Task é˜Ÿåˆ—ä¸­æ‹¿å‡ºéœ€è¦æ‰§è¡Œçš„ä»£ç å¹¶æ”¾å…¥æ‰§è¡Œæ ˆä¸­æ‰§è¡Œï¼Œæ‰€ä»¥æœ¬è´¨ä¸Šæ¥è¯´ JS ä¸­çš„å¼‚æ­¥è¿˜æ˜¯åŒæ­¥è¡Œä¸º</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;script start&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>setTimeout</span><span class=p>(</span><span class=kd>function</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;setTimeout&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>},</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;script end&#39;</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>ä¸åŒçš„ä»»åŠ¡æºä¼šè¢«åˆ†é…åˆ°ä¸åŒçš„ <code>Task</code> é˜Ÿåˆ—ä¸­ï¼Œä»»åŠ¡æºå¯ä»¥åˆ†ä¸º å¾®ä»»åŠ¡ï¼ˆ<code>microtask</code>ï¼‰ å’Œ å®ä»»åŠ¡ï¼ˆ<code>macrotask</code>ï¼‰ã€‚åœ¨ <code>ES6</code> è§„èŒƒä¸­ï¼Œ<code>microtask</code> ç§°ä¸º jobsï¼Œmacrotask ç§°ä¸º task</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;script start&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>setTimeout</span><span class=p>(</span><span class=kd>function</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;setTimeout&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>},</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>new</span> <span class=nb>Promise</span><span class=p>((</span><span class=nx>resolve</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;Promise&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>resolve</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}).</span><span class=nx>then</span><span class=p>(</span><span class=kd>function</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;promise1&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}).</span><span class=nx>then</span><span class=p>(</span><span class=kd>function</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;promise2&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;script end&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=c1>// script start =&gt; Promise =&gt; script end =&gt; promise1 =&gt; promise2 =&gt; setTimeout
</span></span></span></code></pre></td></tr></table></div></div><blockquote><p>ä»¥ä¸Šä»£ç è™½ç„¶ <code>setTimeout</code> å†™åœ¨ <code>Promise</code> ä¹‹å‰ï¼Œä½†æ˜¯å› ä¸º <code>Promise</code> å±äºå¾®ä»»åŠ¡è€Œ <code>setTimeout</code> å±äºå®ä»»åŠ¡</p></blockquote><p><strong>å¾®ä»»åŠ¡</strong></p><ul><li><code>process.nextTick</code></li><li><code>promise</code></li><li><code>Object.observe</code></li><li><code>MutationObserver</code></li></ul><p><strong>å®ä»»åŠ¡</strong></p><ul><li><code>script</code></li><li><code>setTimeout</code></li><li><code>setInterval</code></li><li><code>setImmediate</code></li><li><code>I/O</code></li><li><code>UI rendering</code></li></ul><blockquote><p>å®ä»»åŠ¡ä¸­åŒ…æ‹¬äº† script ï¼Œæµè§ˆå™¨ä¼šå…ˆæ‰§è¡Œä¸€ä¸ªå®ä»»åŠ¡ï¼Œæ¥ä¸‹æ¥æœ‰å¼‚æ­¥ä»£ç çš„è¯å°±å…ˆæ‰§è¡Œå¾®ä»»åŠ¡</p></blockquote><p><strong>æ‰€ä»¥æ­£ç¡®çš„ä¸€æ¬¡ Event loop é¡ºåºæ˜¯è¿™æ ·çš„</strong></p><ul><li>æ‰§è¡ŒåŒæ­¥ä»£ç ï¼Œè¿™å±äºå®ä»»åŠ¡</li><li>æ‰§è¡Œæ ˆä¸ºç©ºï¼ŒæŸ¥è¯¢æ˜¯å¦æœ‰å¾®ä»»åŠ¡éœ€è¦æ‰§è¡Œ</li><li>æ‰§è¡Œæ‰€æœ‰å¾®ä»»åŠ¡</li><li>å¿…è¦çš„è¯æ¸²æŸ“ UI</li><li>ç„¶åå¼€å§‹ä¸‹ä¸€è½® <code>Event loop</code>ï¼Œæ‰§è¡Œå®ä»»åŠ¡ä¸­çš„å¼‚æ­¥ä»£ç </li></ul><blockquote><p>é€šè¿‡ä¸Šè¿°çš„ <code>Event loop</code> é¡ºåºå¯çŸ¥ï¼Œå¦‚æœå®ä»»åŠ¡ä¸­çš„å¼‚æ­¥ä»£ç æœ‰å¤§é‡çš„è®¡ç®—å¹¶ä¸”éœ€è¦æ“ä½œ <code>DOM</code> çš„è¯ï¼Œä¸ºäº†æ›´å¿«çš„å“åº”ç•Œé¢å“åº”ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæ“ä½œ <code>DOM</code> æ”¾å…¥å¾®ä»»åŠ¡ä¸­</p></blockquote><h3 id=32-node-ä¸­çš„-event-loop>3.2 Node ä¸­çš„ Event loop<a hidden class=anchor aria-hidden=true href=#32-node-ä¸­çš„-event-loop>#</a></h3><ul><li><code>Node</code> ä¸­çš„ <code>Event loop</code> å’Œæµè§ˆå™¨ä¸­çš„ä¸ç›¸åŒã€‚</li><li><code>Node</code> çš„ <code>Event loop</code> åˆ†ä¸º<code>6</code>ä¸ªé˜¶æ®µï¼Œå®ƒä»¬ä¼šæŒ‰ç…§é¡ºåºåå¤è¿è¡Œ</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=err>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
</span></span><span class=line><span class=cl><span class=err>â”Œâ”€</span><span class=o>&gt;</span><span class=err>â”‚</span>        <span class=nx>timers</span>         <span class=err>â”‚</span>
</span></span><span class=line><span class=cl><span class=err>â”‚</span>  <span class=err>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</span></span><span class=line><span class=cl><span class=err>â”‚</span>  <span class=err>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
</span></span><span class=line><span class=cl><span class=err>â”‚</span>  <span class=err>â”‚</span>     <span class=nx>I</span><span class=o>/</span><span class=nx>O</span> <span class=nx>callbacks</span>     <span class=err>â”‚</span>
</span></span><span class=line><span class=cl><span class=err>â”‚</span>  <span class=err>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</span></span><span class=line><span class=cl><span class=err>â”‚</span>  <span class=err>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
</span></span><span class=line><span class=cl><span class=err>â”‚</span>  <span class=err>â”‚</span>     <span class=nx>idle</span><span class=p>,</span> <span class=nx>prepare</span>     <span class=err>â”‚</span>
</span></span><span class=line><span class=cl><span class=err>â”‚</span>  <span class=err>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>      <span class=err>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
</span></span><span class=line><span class=cl><span class=err>â”‚</span>  <span class=err>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>      <span class=err>â”‚</span>   <span class=nx>incoming</span><span class=o>:</span>   <span class=err>â”‚</span>
</span></span><span class=line><span class=cl><span class=err>â”‚</span>  <span class=err>â”‚</span>         <span class=nx>poll</span>          <span class=err>â”‚</span><span class=o>&lt;</span><span class=err>â”€â”€</span><span class=nx>connections</span><span class=err>â”€â”€â”€</span>     <span class=err>â”‚</span>
</span></span><span class=line><span class=cl><span class=err>â”‚</span>  <span class=err>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>      <span class=err>â”‚</span>   <span class=nx>data</span><span class=p>,</span> <span class=nx>etc</span><span class=p>.</span>  <span class=err>â”‚</span>
</span></span><span class=line><span class=cl><span class=err>â”‚</span>  <span class=err>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>      <span class=err>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</span></span><span class=line><span class=cl><span class=err>â”‚</span>  <span class=err>â”‚</span>        <span class=nx>check</span>          <span class=err>â”‚</span>
</span></span><span class=line><span class=cl><span class=err>â”‚</span>  <span class=err>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</span></span><span class=line><span class=cl><span class=err>â”‚</span>  <span class=err>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
</span></span><span class=line><span class=cl><span class=err>â””â”€â”€â”¤</span>    <span class=nx>close</span> <span class=nx>callbacks</span>    <span class=err>â”‚</span>
</span></span><span class=line><span class=cl>   <span class=err>â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>timer</strong></p><ul><li><code>timers</code> é˜¶æ®µä¼šæ‰§è¡Œ <code>setTimeout</code> å’Œ <code>setInterval</code></li><li>ä¸€ä¸ª timer æŒ‡å®šçš„æ—¶é—´å¹¶ä¸æ˜¯å‡†ç¡®æ—¶é—´ï¼Œè€Œæ˜¯åœ¨è¾¾åˆ°è¿™ä¸ªæ—¶é—´åå°½å¿«æ‰§è¡Œå›è°ƒï¼Œå¯èƒ½ä¼šå› ä¸ºç³»ç»Ÿæ­£åœ¨æ‰§è¡Œåˆ«çš„äº‹åŠ¡è€Œå»¶è¿Ÿ</li></ul><p><strong>I/O</strong></p><ul><li><code>I/O</code> é˜¶æ®µä¼šæ‰§è¡Œé™¤äº† <code>close</code> äº‹ä»¶ï¼Œå®šæ—¶å™¨å’Œ <code>setImmediate</code> çš„å›è°ƒ</li></ul><p>idle, prepare
idle, prepare é˜¶æ®µå†…éƒ¨å®ç°</p><p><strong>poll</strong></p><ul><li><p><code>poll</code> é˜¶æ®µå¾ˆé‡è¦ï¼Œè¿™ä¸€é˜¶æ®µä¸­ï¼Œç³»ç»Ÿä¼šåšä¸¤ä»¶äº‹æƒ…</p><ul><li>æ‰§è¡Œåˆ°ç‚¹çš„å®šæ—¶å™¨</li><li>æ‰§è¡Œ <code>poll</code> é˜Ÿåˆ—ä¸­çš„äº‹ä»¶</li></ul></li><li><p>å¹¶ä¸”å½“ poll ä¸­æ²¡æœ‰å®šæ—¶å™¨çš„æƒ…å†µä¸‹ï¼Œä¼šå‘ç°ä»¥ä¸‹ä¸¤ä»¶äº‹æƒ…</p><ul><li>å¦‚æœ poll é˜Ÿåˆ—ä¸ä¸ºç©ºï¼Œä¼šéå†å›è°ƒé˜Ÿåˆ—å¹¶åŒæ­¥æ‰§è¡Œï¼Œç›´åˆ°é˜Ÿåˆ—ä¸ºç©ºæˆ–è€…ç³»ç»Ÿé™åˆ¶</li><li>å¦‚æœ poll é˜Ÿåˆ—ä¸ºç©ºï¼Œä¼šæœ‰ä¸¤ä»¶äº‹å‘ç”Ÿ</li><li>å¦‚æœæœ‰ <code>setImmediate</code> éœ€è¦æ‰§è¡Œï¼Œ<code>poll</code> é˜¶æ®µä¼šåœæ­¢å¹¶ä¸”è¿›å…¥åˆ° <code>check</code> é˜¶æ®µæ‰§è¡Œ <code>setImmediate</code></li><li>å¦‚æœæ²¡æœ‰ <code>setImmediate</code> éœ€è¦æ‰§è¡Œï¼Œä¼šç­‰å¾…å›è°ƒè¢«åŠ å…¥åˆ°é˜Ÿåˆ—ä¸­å¹¶ç«‹å³æ‰§è¡Œå›è°ƒ</li><li>å¦‚æœæœ‰åˆ«çš„å®šæ—¶å™¨éœ€è¦è¢«æ‰§è¡Œï¼Œä¼šå›åˆ° <code>timer</code> é˜¶æ®µæ‰§è¡Œå›è°ƒã€‚</li></ul></li></ul><p><strong>check</strong></p><ul><li><code>check</code> é˜¶æ®µæ‰§è¡Œ <code>setImmediate</code></li></ul><p><strong>close callbacks</strong></p><ul><li><code>close callbacks</code> é˜¶æ®µæ‰§è¡Œ <code>close</code> äº‹ä»¶</li><li>å¹¶ä¸”åœ¨ <code>Node</code> ä¸­ï¼Œæœ‰äº›æƒ…å†µä¸‹çš„å®šæ—¶å™¨æ‰§è¡Œé¡ºåºæ˜¯éšæœºçš„</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>setTimeout</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;setTimeout&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>},</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>setImmediate</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;setImmediate&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=c1>// è¿™é‡Œå¯èƒ½ä¼šè¾“å‡º setTimeoutï¼ŒsetImmediate
</span></span></span><span class=line><span class=cl><span class=c1>// å¯èƒ½ä¹Ÿä¼šç›¸åçš„è¾“å‡ºï¼Œè¿™å–å†³äºæ€§èƒ½
</span></span></span><span class=line><span class=cl><span class=c1>// å› ä¸ºå¯èƒ½è¿›å…¥ event loop ç”¨äº†ä¸åˆ° 1 æ¯«ç§’ï¼Œè¿™æ—¶å€™ä¼šæ‰§è¡Œ setImmediate
</span></span></span><span class=line><span class=cl><span class=c1>// å¦åˆ™ä¼šæ‰§è¡Œ setTimeout
</span></span></span></code></pre></td></tr></table></div></div><blockquote><p>ä¸Šé¢ä»‹ç»çš„éƒ½æ˜¯ macrotask çš„æ‰§è¡Œæƒ…å†µï¼Œmicrotask ä¼šåœ¨ä»¥ä¸Šæ¯ä¸ªé˜¶æ®µå®Œæˆåç«‹å³æ‰§è¡Œ</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>setTimeout</span><span class=p>(()=&gt;{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;timer1&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nb>Promise</span><span class=p>.</span><span class=nx>resolve</span><span class=p>().</span><span class=nx>then</span><span class=p>(</span><span class=kd>function</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;promise1&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>},</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>setTimeout</span><span class=p>(()=&gt;{</span>
</span></span><span class=line><span class=cl>    <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;timer2&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nb>Promise</span><span class=p>.</span><span class=nx>resolve</span><span class=p>().</span><span class=nx>then</span><span class=p>(</span><span class=kd>function</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;promise2&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>},</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// ä»¥ä¸Šä»£ç åœ¨æµè§ˆå™¨å’Œ node ä¸­æ‰“å°æƒ…å†µæ˜¯ä¸åŒçš„
</span></span></span><span class=line><span class=cl><span class=c1>// æµè§ˆå™¨ä¸­ä¸€å®šæ‰“å° timer1, promise1, timer2, promise2
</span></span></span><span class=line><span class=cl><span class=c1>// node ä¸­å¯èƒ½æ‰“å° timer1, timer2, promise1, promise2
</span></span></span><span class=line><span class=cl><span class=c1>// ä¹Ÿå¯èƒ½æ‰“å° timer1, promise1, timer2, promise2
</span></span></span></code></pre></td></tr></table></div></div><blockquote><p><code>Node</code> ä¸­çš„ <code>process.nextTick</code> ä¼šå…ˆäºå…¶ä»– <code>microtask</code> æ‰§è¡Œ</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=nx>setTimeout</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;timer1&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> <span class=nb>Promise</span><span class=p>.</span><span class=nx>resolve</span><span class=p>().</span><span class=nx>then</span><span class=p>(</span><span class=kd>function</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>   <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;promise1&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl> <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>},</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>process</span><span class=p>.</span><span class=nx>nextTick</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;nextTick&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl><span class=c1>// nextTick, timer1, promise1
</span></span></span></code></pre></td></tr></table></div></div><h2 id=å››service-worker>å››ã€Service Worker<a hidden class=anchor aria-hidden=true href=#å››service-worker>#</a></h2><blockquote><p>Service workers æœ¬è´¨ä¸Šå……å½“Webåº”ç”¨ç¨‹åºä¸æµè§ˆå™¨ä¹‹é—´çš„ä»£ç†æœåŠ¡å™¨ï¼Œä¹Ÿå¯ä»¥åœ¨ç½‘ç»œå¯ç”¨æ—¶ä½œä¸ºæµè§ˆå™¨å’Œç½‘ç»œé—´çš„ä»£ç†ã€‚å®ƒä»¬æ—¨åœ¨ï¼ˆé™¤å…¶ä»–ä¹‹å¤–ï¼‰ä½¿å¾—èƒ½å¤Ÿåˆ›å»ºæœ‰æ•ˆçš„ç¦»çº¿ä½“éªŒï¼Œæ‹¦æˆªç½‘ç»œè¯·æ±‚å¹¶åŸºäºç½‘ç»œæ˜¯å¦å¯ç”¨ä»¥åŠæ›´æ–°çš„èµ„æºæ˜¯å¦é©»ç•™åœ¨æœåŠ¡å™¨ä¸Šæ¥é‡‡å–é€‚å½“çš„åŠ¨ä½œã€‚ä»–ä»¬è¿˜å…è®¸è®¿é—®æ¨é€é€šçŸ¥å’Œåå°åŒæ­¥API</p></blockquote><p><strong>ç›®å‰è¯¥æŠ€æœ¯é€šå¸¸ç”¨æ¥åšç¼“å­˜æ–‡ä»¶ï¼Œæé«˜é¦–å±é€Ÿåº¦</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// index.js
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>if</span> <span class=p>(</span><span class=nx>navigator</span><span class=p>.</span><span class=nx>serviceWorker</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>navigator</span><span class=p>.</span><span class=nx>serviceWorker</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nx>register</span><span class=p>(</span><span class=s2>&#34;sw.js&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=kd>function</span><span class=p>(</span><span class=nx>registration</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;service worker æ³¨å†ŒæˆåŠŸ&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=k>catch</span><span class=p>(</span><span class=kd>function</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;servcie worker æ³¨å†Œå¤±è´¥&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=c1>// sw.js
</span></span></span><span class=line><span class=cl><span class=c1>// ç›‘å¬ `install` äº‹ä»¶ï¼Œå›è°ƒä¸­ç¼“å­˜æ‰€éœ€æ–‡ä»¶
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>self</span><span class=p>.</span><span class=nx>addEventListener</span><span class=p>(</span><span class=s2>&#34;install&#34;</span><span class=p>,</span> <span class=nx>e</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>e</span><span class=p>.</span><span class=nx>waitUntil</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=nx>caches</span><span class=p>.</span><span class=nx>open</span><span class=p>(</span><span class=s2>&#34;my-cache&#34;</span><span class=p>).</span><span class=nx>then</span><span class=p>(</span><span class=kd>function</span><span class=p>(</span><span class=nx>cache</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=nx>cache</span><span class=p>.</span><span class=nx>addAll</span><span class=p>([</span><span class=s2>&#34;./index.html&#34;</span><span class=p>,</span> <span class=s2>&#34;./index.js&#34;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// æ‹¦æˆªæ‰€æœ‰è¯·æ±‚äº‹ä»¶
</span></span></span><span class=line><span class=cl><span class=c1>// å¦‚æœç¼“å­˜ä¸­å·²ç»æœ‰è¯·æ±‚çš„æ•°æ®å°±ç›´æ¥ç”¨ç¼“å­˜ï¼Œå¦åˆ™å»è¯·æ±‚æ•°æ®
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>self</span><span class=p>.</span><span class=nx>addEventListener</span><span class=p>(</span><span class=s2>&#34;fetch&#34;</span><span class=p>,</span> <span class=nx>e</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>e</span><span class=p>.</span><span class=nx>respondWith</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=nx>caches</span><span class=p>.</span><span class=nx>match</span><span class=p>(</span><span class=nx>e</span><span class=p>.</span><span class=nx>request</span><span class=p>).</span><span class=nx>then</span><span class=p>(</span><span class=kd>function</span><span class=p>(</span><span class=nx>response</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=nx>response</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nx>response</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s2>&#34;fetch source&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>æ‰“å¼€é¡µé¢ï¼Œå¯ä»¥åœ¨å¼€å‘è€…å·¥å…·ä¸­çš„ Application çœ‹åˆ° Service Worker å·²ç»å¯åŠ¨äº†</p></blockquote><p><img loading=lazy src="https://user-gold-cdn.xitu.io/2018/3/28/1626b1e8eba68e1c?w=1770&h=722&f=png&s=192277" alt></p><blockquote><p>åœ¨ Cache ä¸­ä¹Ÿå¯ä»¥å‘ç°æˆ‘ä»¬æ‰€éœ€çš„æ–‡ä»¶å·²è¢«ç¼“å­˜</p></blockquote><p><img loading=lazy src="https://user-gold-cdn.xitu.io/2018/3/28/1626b20dfc4fcd26?w=1118&h=728&f=png&s=85610" alt></p><p>å½“æˆ‘ä»¬é‡æ–°åˆ·æ–°é¡µé¢å¯ä»¥å‘ç°æˆ‘ä»¬ç¼“å­˜çš„æ•°æ®æ˜¯ä» Service Worker ä¸­è¯»å–çš„</p><h2 id=äº”æ¸²æŸ“æœºåˆ¶>äº”ã€æ¸²æŸ“æœºåˆ¶<a hidden class=anchor aria-hidden=true href=#äº”æ¸²æŸ“æœºåˆ¶>#</a></h2><p><strong>æµè§ˆå™¨çš„æ¸²æŸ“æœºåˆ¶ä¸€èˆ¬åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ­¥éª¤</strong></p><ul><li>å¤„ç† <code>HTML</code> å¹¶æ„å»º <code>DOM</code> æ ‘ã€‚</li><li>å¤„ç† <code>CSS</code> æ„å»º <code>CSSOM</code> æ ‘ã€‚</li><li>å°† <code>DOM</code> ä¸ <code>CSSOM</code> åˆå¹¶æˆä¸€ä¸ªæ¸²æŸ“æ ‘ã€‚</li><li>æ ¹æ®æ¸²æŸ“æ ‘æ¥å¸ƒå±€ï¼Œè®¡ç®—æ¯ä¸ªèŠ‚ç‚¹çš„ä½ç½®ã€‚</li><li>è°ƒç”¨ <code>GPU</code> ç»˜åˆ¶ï¼Œåˆæˆå›¾å±‚ï¼Œæ˜¾ç¤ºåœ¨å±å¹•ä¸Š</li></ul><p><img loading=lazy src="https://user-gold-cdn.xitu.io/2018/4/11/162b2ab2ec70ac5b?w=900&h=352&f=png&s=49983" alt></p><ul><li>åœ¨æ„å»º CSSOM æ ‘æ—¶ï¼Œä¼šé˜»å¡æ¸²æŸ“ï¼Œç›´è‡³ CSSOM æ ‘æ„å»ºå®Œæˆã€‚å¹¶ä¸”æ„å»º CSSOM æ ‘æ˜¯ä¸€ä¸ªååˆ†æ¶ˆè€—æ€§èƒ½çš„è¿‡ç¨‹ï¼Œæ‰€ä»¥åº”è¯¥å°½é‡ä¿è¯å±‚çº§æ‰å¹³ï¼Œå‡å°‘è¿‡åº¦å±‚å ï¼Œè¶Šæ˜¯å…·ä½“çš„ CSS é€‰æ‹©å™¨ï¼Œæ‰§è¡Œé€Ÿåº¦è¶Šæ…¢</li><li>å½“ HTML è§£æåˆ° script æ ‡ç­¾æ—¶ï¼Œä¼šæš‚åœæ„å»º DOMï¼Œå®Œæˆåæ‰ä¼šä»æš‚åœçš„åœ°æ–¹é‡æ–°å¼€å§‹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä½ æƒ³é¦–å±æ¸²æŸ“çš„è¶Šå¿«ï¼Œå°±è¶Šä¸åº”è¯¥åœ¨é¦–å±å°±åŠ è½½ JS æ–‡ä»¶ã€‚å¹¶ä¸” CSS ä¹Ÿä¼šå½±å“ JS çš„æ‰§è¡Œï¼Œåªæœ‰å½“è§£æå®Œæ ·å¼è¡¨æ‰ä¼šæ‰§è¡Œ JSï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥è®¤ä¸ºè¿™ç§æƒ…å†µä¸‹ï¼ŒCSS ä¹Ÿä¼šæš‚åœæ„å»º DOM</li></ul><h3 id=51-å›¾å±‚>5.1 å›¾å±‚<a hidden class=anchor aria-hidden=true href=#51-å›¾å±‚>#</a></h3><blockquote><p>ä¸€èˆ¬æ¥è¯´ï¼Œå¯ä»¥æŠŠæ™®é€šæ–‡æ¡£æµçœ‹æˆä¸€ä¸ªå›¾å±‚ã€‚ç‰¹å®šçš„å±æ€§å¯ä»¥ç”Ÿæˆä¸€ä¸ªæ–°çš„å›¾å±‚ã€‚ä¸åŒçš„å›¾å±‚æ¸²æŸ“äº’ä¸å½±å“ï¼Œæ‰€ä»¥å¯¹äºæŸäº›é¢‘ç¹éœ€è¦æ¸²æŸ“çš„å»ºè®®å•ç‹¬ç”Ÿæˆä¸€ä¸ªæ–°å›¾å±‚ï¼Œæé«˜æ€§èƒ½ã€‚ä½†ä¹Ÿä¸èƒ½ç”Ÿæˆè¿‡å¤šçš„å›¾å±‚ï¼Œä¼šå¼•èµ·åä½œç”¨</p></blockquote><p><strong>é€šè¿‡ä»¥ä¸‹å‡ ä¸ªå¸¸ç”¨å±æ€§å¯ä»¥ç”Ÿæˆæ–°å›¾å±‚</strong></p><ul><li>3D å˜æ¢ï¼š<code>translate3d</code>ã€<code>translateZ</code></li><li><code>will-change</code></li><li><code>video</code>ã€<code>iframe</code> æ ‡ç­¾</li><li>é€šè¿‡åŠ¨ç”»å®ç°çš„ <code>opacity</code> åŠ¨ç”»è½¬æ¢</li><li><code>position: fixed</code></li></ul><h3 id=52-é‡ç»˜repaintå’Œå›æµreflow>5.2 é‡ç»˜ï¼ˆRepaintï¼‰å’Œå›æµï¼ˆReflowï¼‰<a hidden class=anchor aria-hidden=true href=#52-é‡ç»˜repaintå’Œå›æµreflow>#</a></h3><ul><li>é‡ç»˜æ˜¯å½“èŠ‚ç‚¹éœ€è¦æ›´æ”¹å¤–è§‚è€Œä¸ä¼šå½±å“å¸ƒå±€çš„ï¼Œæ¯”å¦‚æ”¹å˜ color å°±å«ç§°ä¸ºé‡ç»˜</li><li>å›æµæ˜¯å¸ƒå±€æˆ–è€…å‡ ä½•å±æ€§éœ€è¦æ”¹å˜å°±ç§°ä¸ºå›æµ</li></ul><blockquote><p>å›æµå¿…å®šä¼šå‘ç”Ÿé‡ç»˜ï¼Œé‡ç»˜ä¸ä¸€å®šä¼šå¼•å‘å›æµã€‚å›æµæ‰€éœ€çš„æˆæœ¬æ¯”é‡ç»˜é«˜çš„å¤šï¼Œæ”¹å˜æ·±å±‚æ¬¡çš„èŠ‚ç‚¹å¾ˆå¯èƒ½å¯¼è‡´çˆ¶èŠ‚ç‚¹çš„ä¸€ç³»åˆ—å›æµ</p></blockquote><p><strong>æ‰€ä»¥ä»¥ä¸‹å‡ ä¸ªåŠ¨ä½œå¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜</strong>ï¼š</p><ul><li>æ”¹å˜ window å¤§å°</li><li>æ”¹å˜å­—ä½“</li><li>æ·»åŠ æˆ–åˆ é™¤æ ·å¼</li><li>æ–‡å­—æ”¹å˜</li><li>å®šä½æˆ–è€…æµ®åŠ¨</li><li>ç›’æ¨¡å‹</li></ul><p><strong>å¾ˆå¤šäººä¸çŸ¥é“çš„æ˜¯ï¼Œé‡ç»˜å’Œå›æµå…¶å®å’Œ Event loop æœ‰å…³</strong></p><ul><li>å½“ Event loop æ‰§è¡Œå®Œ <code>Microtasks</code> åï¼Œä¼šåˆ¤æ–­ <code>document</code> æ˜¯å¦éœ€è¦æ›´æ–°ã€‚å› ä¸ºæµè§ˆå™¨æ˜¯ <code>60Hz </code>çš„åˆ·æ–°ç‡ï¼Œæ¯ <code>16ms </code>æ‰ä¼šæ›´æ–°ä¸€æ¬¡ã€‚</li><li>ç„¶ååˆ¤æ–­æ˜¯å¦æœ‰ <code>resize</code> æˆ–è€… <code>scroll</code> ï¼Œæœ‰çš„è¯ä¼šå»è§¦å‘äº‹ä»¶ï¼Œæ‰€ä»¥ <code>resize</code> å’Œ <code>scroll</code> äº‹ä»¶ä¹Ÿæ˜¯è‡³å°‘ <code>16ms</code> æ‰ä¼šè§¦å‘ä¸€æ¬¡ï¼Œå¹¶ä¸”è‡ªå¸¦èŠ‚æµåŠŸèƒ½ã€‚</li><li>åˆ¤æ–­æ˜¯å¦è§¦å‘äº†<code> media query</code></li><li>æ›´æ–°åŠ¨ç”»å¹¶ä¸”å‘é€äº‹ä»¶</li><li>åˆ¤æ–­æ˜¯å¦æœ‰å…¨å±æ“ä½œäº‹ä»¶</li><li>æ‰§è¡Œ <code>requestAnimationFrame</code> å›è°ƒ</li><li>æ‰§è¡Œ <code>IntersectionObserver</code> å›è°ƒï¼Œè¯¥æ–¹æ³•ç”¨äºåˆ¤æ–­å…ƒç´ æ˜¯å¦å¯è§ï¼Œå¯ä»¥ç”¨äºæ‡’åŠ è½½ä¸Šï¼Œä½†æ˜¯å…¼å®¹æ€§ä¸å¥½</li><li>æ›´æ–°ç•Œé¢</li><li>ä»¥ä¸Šå°±æ˜¯ä¸€å¸§ä¸­å¯èƒ½ä¼šåšçš„äº‹æƒ…ã€‚å¦‚æœåœ¨ä¸€å¸§ä¸­æœ‰ç©ºé—²æ—¶é—´ï¼Œå°±ä¼šå»æ‰§è¡Œ <code>requestIdleCallback</code> å›è°ƒ</li></ul><p><strong>å‡å°‘é‡ç»˜å’Œå›æµ</strong></p><ul><li>ä½¿ç”¨ <code>translate</code> æ›¿ä»£ <code>top</code></li><li>ä½¿ç”¨ <code>visibility</code> æ›¿æ¢<code> display: none</code> ï¼Œå› ä¸ºå‰è€…åªä¼šå¼•èµ·é‡ç»˜ï¼Œåè€…ä¼šå¼•å‘å›æµï¼ˆæ”¹å˜äº†å¸ƒå±€ï¼‰</li><li>ä¸è¦ä½¿ç”¨ <code>table</code> å¸ƒå±€ï¼Œå¯èƒ½å¾ˆå°çš„ä¸€ä¸ªå°æ”¹åŠ¨ä¼šé€ æˆæ•´ä¸ª table çš„é‡æ–°å¸ƒå±€</li><li>åŠ¨ç”»å®ç°çš„é€Ÿåº¦çš„é€‰æ‹©ï¼ŒåŠ¨ç”»é€Ÿåº¦è¶Šå¿«ï¼Œå›æµæ¬¡æ•°è¶Šå¤šï¼Œä¹Ÿå¯ä»¥é€‰æ‹©ä½¿ç”¨ <code>requestAnimationFrame</code></li><li><code>CSS</code> é€‰æ‹©ç¬¦ä»å³å¾€å·¦åŒ¹é…æŸ¥æ‰¾ï¼Œé¿å… <code>DOM</code> æ·±åº¦è¿‡æ·±</li><li>å°†é¢‘ç¹è¿è¡Œçš„åŠ¨ç”»å˜ä¸ºå›¾å±‚ï¼Œå›¾å±‚èƒ½å¤Ÿé˜»æ­¢è¯¥èŠ‚ç‚¹å›æµå½±å“åˆ«çš„å…ƒç´ ã€‚æ¯”å¦‚å¯¹äº <code>video </code>æ ‡ç­¾ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨å°†è¯¥èŠ‚ç‚¹å˜ä¸ºå›¾å±‚</li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://bablvsj.github.io/tags/%E9%9D%A2%E8%AF%95%E9%A2%98%E9%9B%86/>é¢è¯•é¢˜é›†</a></li></ul><nav class=paginav><a class=prev href=https://bablvsj.github.io/posts/tech/wait/14-%E5%89%8D%E7%AB%AF%E9%9D%A2%E8%AF%95/20230801-%E6%A8%A1%E5%9D%97%E5%8C%96/><span class=title>Â« Prev</span><br><span>æ¨¡å—åŒ–</span></a>
<a class=next href=https://bablvsj.github.io/posts/tech/wait/14-%E5%89%8D%E7%AB%AF%E9%9D%A2%E8%AF%95/%E7%A1%85%E8%B0%B7%E7%94%84%E9%80%89%E7%AC%94%E8%AE%B0/><span class=title>Next Â»</span><br><span>æµè§ˆå™¨</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://bablvsj.github.io>Bablvsj's Blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span><div class=flex-c-d><a class=flex-d-c href="https://www.upyun.com/?utm_source=lianmeng&utm_medium=referral" target=_blank><span>æœ¬ç«™ç”±</span><img width=60 src=/images/upyun.png>æä¾›CDNåŠ é€Ÿ/äº‘å­˜å‚¨æœåŠ¡</a></div></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>