<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>09-AntDæ¡†æ¶çš„uploadç»„ä»¶ä¸Šä¼ å›¾ç‰‡æ—¶é‡åˆ°çš„ä¸€äº›å‘ | Bablvsj's Blog</title><meta name=keywords content="Ant Design"><meta name=description content="09-AntDæ¡†æ¶çš„uploadç»„ä»¶ä¸Šä¼ å›¾ç‰‡æ—¶é‡åˆ°çš„ä¸€äº›å‘ - Bablvsj's Blog"><meta name=author content><link rel=canonical href=https://bablvsj.github.io/posts/tech/wait/12-react%E5%9F%BA%E7%A1%80/09-antd%E6%A1%86%E6%9E%B6%E7%9A%84upload%E7%BB%84%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%9B%BE%E7%89%87%E6%97%B6%E9%81%87%E5%88%B0%E7%9A%84%E4%B8%80%E4%BA%9B%E5%9D%91/><link crossorigin=anonymous href=/assets/css/stylesheet.241265d51339977eb0f90d05780e286ec2789600ca4137f29552dec9dee06569.css integrity="sha256-JBJl1RM5l36w+Q0FeA4obsJ4lgDKQTfylVLeyd7gZWk=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://bablvsj.github.io/img/Q.gif><link rel=icon type=image/png sizes=16x16 href=https://bablvsj.github.io/img/Q.gif><link rel=icon type=image/png sizes=32x32 href=https://bablvsj.github.io/img/Q.gif><link rel=apple-touch-icon href=https://bablvsj.github.io/Q.gif><link rel=mask-icon href=https://bablvsj.github.io/Q.gif><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=stylesheet href=/css/syntax.css><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="09-AntDæ¡†æ¶çš„uploadç»„ä»¶ä¸Šä¼ å›¾ç‰‡æ—¶é‡åˆ°çš„ä¸€äº›å‘"><meta property="og:description" content><meta property="og:type" content="article"><meta property="og:url" content="https://bablvsj.github.io/posts/tech/wait/12-react%E5%9F%BA%E7%A1%80/09-antd%E6%A1%86%E6%9E%B6%E7%9A%84upload%E7%BB%84%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%9B%BE%E7%89%87%E6%97%B6%E9%81%87%E5%88%B0%E7%9A%84%E4%B8%80%E4%BA%9B%E5%9D%91/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-01-01T17:11:35+08:00"><meta property="article:modified_time" content="2020-01-01T17:11:35+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="09-AntDæ¡†æ¶çš„uploadç»„ä»¶ä¸Šä¼ å›¾ç‰‡æ—¶é‡åˆ°çš„ä¸€äº›å‘"><meta name=twitter:description content><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"æ–‡ç« ","item":"https://bablvsj.github.io/posts/"},{"@type":"ListItem","position":3,"name":"09-AntDæ¡†æ¶çš„uploadç»„ä»¶ä¸Šä¼ å›¾ç‰‡æ—¶é‡åˆ°çš„ä¸€äº›å‘","item":"https://bablvsj.github.io/posts/tech/wait/12-react%E5%9F%BA%E7%A1%80/09-antd%E6%A1%86%E6%9E%B6%E7%9A%84upload%E7%BB%84%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%9B%BE%E7%89%87%E6%97%B6%E9%81%87%E5%88%B0%E7%9A%84%E4%B8%80%E4%BA%9B%E5%9D%91/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"09-AntDæ¡†æ¶çš„uploadç»„ä»¶ä¸Šä¼ å›¾ç‰‡æ—¶é‡åˆ°çš„ä¸€äº›å‘","name":"09-AntDæ¡†æ¶çš„uploadç»„ä»¶ä¸Šä¼ å›¾ç‰‡æ—¶é‡åˆ°çš„ä¸€äº›å‘","description":"","keywords":["Ant Design"],"articleBody":"å‰è¨€ æœ¬æ¬¡åšåå°ç®¡ç†ç³»ç»Ÿï¼Œé‡‡ç”¨çš„æ˜¯ AntD æ¡†æ¶ã€‚æ¶‰åŠåˆ°å›¾ç‰‡çš„ä¸Šä¼ ï¼Œç”¨çš„æ˜¯AntDçš„ upload ç»„ä»¶ã€‚\nå‰ç«¯åšæ–‡ä»¶ä¸Šä¼ è¿™ä¸ªåŠŸèƒ½ï¼Œæ˜¯å¾ˆæœ‰æŠ€æœ¯éš¾åº¦çš„ã€‚æ—¢ç„¶æ¡†æ¶ç»™æˆ‘ä»¬æä¾›å¥½äº†ï¼Œé‚£å°±ç›´æ¥ç”¨å‘—ã€‚ç»“æœç”¨çš„æ—¶å€™ï¼Œå‘ç° upload ç»„ä»¶çš„å¾ˆå¤šbugã€‚ä¸‹é¢æ¥åˆ—ä¸¾å‡ ä¸ªã€‚\nå¤‡æ³¨ï¼šæœ¬æ–‡å†™äº2019-03-02ï¼Œä½¿ç”¨çš„ antd ç‰ˆæœ¬æ˜¯ 3.13.6ã€‚\nä½¿ç”¨ AntD çš„ upload ç»„ä»¶åšå›¾ç‰‡çš„ä¸Šä¼  å› ä¸ºéœ€è¦ä¸Šä¼ å¤šå¼ å›¾ç‰‡ï¼Œæ‰€ä»¥é‡‡ç”¨çš„æ˜¯ç…§ç‰‡å¢™çš„å½¢å¼ã€‚ä¸Šä¼ æˆåŠŸåçš„ç•Œé¢å¦‚ä¸‹ï¼š\nï¼ˆ1ï¼‰ä¸Šä¼ ä¸­ï¼š\nï¼ˆ2ï¼‰ä¸Šä¼ æˆåŠŸï¼š\nï¼ˆ3ï¼‰å›¾ç‰‡é¢„è§ˆï¼š\næŒ‰ç…§å®˜æ–¹æä¾›çš„å®ä¾‹ï¼Œç‰¹æ­¤æ•´ç†å‡ºé¡¹ç›®å¼€å‘ä¸­çš„å®Œæ•´å†™æ³•ï¼Œäº²æµ‹æœ‰æ•ˆã€‚ä»£ç å¦‚ä¸‹ï¼š\n/* eslint-disable */ import { Upload, Icon, Modal, Form } from 'antd'; const FormItem = Form.Item; class PicturesWall extends PureComponent { state = { previewVisible: false, previewImage: '', imgList: [], }; handleChange = ({ file, fileList }) =\u003e { console.log(JSON.stringify(file)); // file æ˜¯å½“å‰æ­£åœ¨ä¸Šä¼ çš„ å•ä¸ª img console.log(JSON.stringify(fileList)); // fileList æ˜¯å·²ä¸Šä¼ çš„å…¨éƒ¨ img åˆ—è¡¨ this.setState({ imgList: fileList, }); }; handleCancel = () =\u003e this.setState({ previewVisible: false }); handlePreview = file =\u003e { this.setState({ previewImage: file.url || file.thumbUrl, previewVisible: true, }); }; // å‚è€ƒé“¾æ¥ï¼šhttps://www.jianshu.com/p/f356f050b3c9 handleBeforeUpload = file =\u003e { //é™åˆ¶å›¾ç‰‡ æ ¼å¼ã€sizeã€åˆ†è¾¨ç‡ const isJPG = file.type === 'image/jpeg'; const isJPEG = file.type === 'image/jpeg'; const isGIF = file.type === 'image/gif'; const isPNG = file.type === 'image/png'; if (!(isJPG || isJPEG || isGIF || isPNG)) { Modal.error({ title: 'åªèƒ½ä¸Šä¼ JPG ã€JPEG ã€GIFã€ PNGæ ¼å¼çš„å›¾ç‰‡~', }); return; } const isLt2M = file.size / 1024 / 1024 \u003c 2; if (!isLt2M) { Modal.error({ title: 'è¶…è¿‡2Mé™åˆ¶ï¼Œä¸å…è®¸ä¸Šä¼ ~', }); return; } return (isJPG || isJPEG || isGIF || isPNG) \u0026\u0026 isLt2M \u0026\u0026 this.checkImageWH(file); }; //è¿”å›ä¸€ä¸ª promiseï¼šæ£€æµ‹é€šè¿‡åˆ™è¿”å›resolveï¼›å¤±è´¥åˆ™è¿”å›rejectï¼Œå¹¶é˜»æ­¢å›¾ç‰‡ä¸Šä¼  checkImageWH(file) { let self = this; return new Promise(function(resolve, reject) { let filereader = new FileReader(); filereader.onload = e =\u003e { let src = e.target.result; const image = new Image(); image.onload = function() { // è·å–å›¾ç‰‡çš„å®½é«˜ï¼Œå¹¶å­˜æ”¾åˆ°fileå¯¹è±¡ä¸­ console.log('file width :' + this.width); console.log('file height :' + this.height); file.width = this.width; file.height = this.height; resolve(); }; image.onerror = reject; image.src = src; }; filereader.readAsDataURL(file); }); } handleSubmit = e =\u003e { const { dispatch, form } = this.props; e.preventDefault(); form.validateFieldsAndScroll((err, values) =\u003e {// values æ˜¯formè¡¨å•é‡Œçš„å‚æ•° // ç‚¹å‡»æŒ‰é’®åï¼Œå°†è¡¨å•æäº¤ç»™åå° dispatch({ type: 'mymodel/submitFormData', payload: values, }); }); }; render() { const { previewVisible, previewImage, imgList } = this.state; // ä» state ä¸­æ‹¿æ•°æ® const uploadButton = ( \u003cdiv\u003e \u003cIcon type=\"plus\" /\u003e \u003cdiv className=\"ant-upload-text\"\u003eUpload\u003c/div\u003e \u003c/div\u003e ); return ( \u003cdiv className=\"clearfix\"\u003e \u003cForm onSubmit={this.handleSubmit} hideRequiredMark style={{ marginTop: 8 }}\u003e \u003cFormItem label=\"å›¾ç‰‡å›¾ç‰‡\" {...formItemLayout}\u003e {getFieldDecorator('myImg')( \u003cUpload action=\"//jsonplaceholder.typicode.com/posts/\" // è¿™ä¸ªæ˜¯å›¾ç‰‡ä¸Šä¼ çš„æ¥å£è¯·æ±‚ï¼Œå®é™…å¼€å‘ä¸­ï¼Œè¦æ›¿æ¢æˆä½ è‡ªå·±çš„ä¸šåŠ¡æ¥å£ data={file =\u003e ({ // dataé‡Œå­˜æ”¾çš„æ˜¯æ¥å£çš„è¯·æ±‚å‚æ•° param1: myParam1, param2: myParam2, photoCotent: file, // file æ˜¯å½“å‰æ­£åœ¨ä¸Šä¼ çš„å›¾ç‰‡ photoWidth: file.height, // é€šè¿‡ handleBeforeUpload è·å– å›¾ç‰‡çš„å®½é«˜ photoHeight: file.width, })} listType=\"picture-card\" fileList={this.state.imgList} onPreview={this.handlePreview} // ç‚¹å‡»å›¾ç‰‡ç¼©ç•¥å›¾ï¼Œè¿›è¡Œé¢„è§ˆ beforeUpload={this.handleBeforeUpload} // ä¸Šä¼ ä¹‹å‰ï¼Œå¯¹å›¾ç‰‡çš„æ ¼å¼åšæ ¡éªŒï¼Œå¹¶è·å–å›¾ç‰‡çš„å®½é«˜ onChange={this.handleChange} // æ¯æ¬¡ä¸Šä¼ å›¾ç‰‡æ—¶ï¼Œéƒ½ä¼šè§¦å‘è¿™ä¸ªæ–¹æ³• \u003e {this.state.imgList.length \u003e= 9 ? null : uploadButton} \u003c/Upload\u003e )} \u003c/FormItem\u003e \u003c/Form\u003e \u003cModal visible={previewVisible} footer={null} onCancel={this.handleCancel}\u003e \u003cimg alt=\"example\" style={{ width: '100%' }} src={previewImage} /\u003e \u003c/Modal\u003e \u003c/div\u003e ); } } export default PicturesWall; ä¸Šä¼ åï¼Œç‚¹å‡»å›¾ç‰‡é¢„è§ˆï¼Œæµè§ˆå™¨å¡æ­»çš„é—®é¢˜ ä¾æ®ä¸Šæ–¹çš„ä»£ç ï¼Œé€šè¿‡ Antd çš„ upload ç»„ä»¶å°†å›¾ç‰‡ä¸Šä¼ æˆåŠŸåï¼Œç‚¹å‡»å›¾ç‰‡çš„ç¼©ç•¥å›¾ï¼Œç†åº”å¯ä»¥åœ¨å½“å‰é¡µé¢å¼¹å‡º Modalï¼Œé¢„è§ˆå›¾ç‰‡ã€‚ä½†å®é™…çš„ç»“æœæ˜¯ï¼Œæµè§ˆå™¨ä¸€å®šä¼šå¡æ­»ã€‚\nå®šä½é—®é¢˜å‘ç°ï¼ŒåŸå› ç«Ÿç„¶æ˜¯ï¼šå›¾ç‰‡ä¸Šä¼ æˆåŠŸåï¼Œ upload ä¼šå°†å…¶è½¬ä¸º base64ç¼–ç ã€‚base64è¿™ä¸ªå­—ç¬¦ä¸²å¤ªå¤§äº†ï¼Œç‚¹å‡»å›¾ç‰‡é¢„è§ˆçš„æ—¶å€™ï¼Œæµè§ˆå™¨åœ¨è§£æä¸€å¤§ä¸²å­—ç¬¦ä¸²ï¼Œç„¶åå°±å¡æ­»äº†ã€‚è¯¦ç»†è¿‡ç¨‹æè¿°å¦‚ä¸‹ã€‚\nä¸Šæ–¹ä»£ç ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠ handleChange(file, fileList)æ–¹æ³•ä¸­çš„ fileã€ä»¥åŠ fileListæ‰“å°å‡ºæ¥çœ‹çœ‹ã€‚ fileæŒ‡çš„æ˜¯å½“å‰æ­£åœ¨ä¸Šä¼ çš„ å•ä¸ª imgï¼ŒfileListæ˜¯å·²ä¸Šä¼ çš„å…¨éƒ¨ img åˆ—è¡¨ã€‚ å½“æˆ‘ä¸Šä¼ å®Œ ä¸¤å¼ å›¾ç‰‡åï¼Œ æ‰“å°ç»“æœå¦‚ä¸‹ï¼š\nfileçš„æ‰“å°çš„ç»“æœå¦‚ä¸‹ï¼š\n{ \"uid\": \"rc-upload-1551084269812-5\", \"width\": 600, \"height\": 354, \"lastModified\": 1546701318000, \"lastModifiedDate\": \"2019-01-05T15:15:18.000Z\", \"name\": \"e30e7b9680634b2c888c8bb513cc595d.jpg\", \"size\": 31731, \"type\": \"image/jpeg\", \"percent\": 100, \"originFileObj\": { \"uid\": \"rc-upload-1551084269812-5\", \"width\": 600, \"height\": 354 }, \"status\": \"done\", \"thumbUrl\": \"data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAHQ9qKKlbimcXrIH9o2vH/AC2T+ddPj98v+9RRWsuhnHdk0ar9qb5R0Pb6VPB/qh9aKKiRr0Irnt/vUDr+NFFJCRqWxJik5Pb+dLJ938aKK06mYSdKKKKBH//Z\", \"response\": { \"retCode\": 0, \"imgUrl\": \"http://qianguyihao.com/opfewfwj098902kpkpkkj976fe.jpg\", \"photoid\": 271850 } } fileList çš„æ‰“å°ç»“æœï¼š\n[ { \"uid\": \"rc-upload-1551084269812-3\", \"width\": 1000, \"height\": 667, \"lastModified\": 1501414799000, \"lastModifiedDate\": \"2017-07-30T11:39:59.000Z\", \"name\": \"29381f30e924b89914e91b33.jpg\", \"size\": 135204, \"type\": \"image/jpeg\", \"percent\": 100, \"originFileObj\": { \"uid\": \"rc-upload-1551084269812-3\", \"width\": 1000, \"height\": 667 }, \"status\": \"done\", \"thumbUrl\": \"data:image/jpeg;base64,/E3ju1tlaK1fzJOnHQU3LsLV7HO6Zrk11MZJ7luT0A4FZuRagi9quvzQQ4iuEJ7ZpqTG4djDsPFl2Lg733f8C4q+YhQ8zoYfGSqoMmfwo5huLL0HjiyPDSYPvxRdC1XQvxeLrB8fvl/OnoLmL9vrdvvYS3NGFVe2YsASOh71JfQyrqV2mXLHOcccVSIYEnDyZO9XXB9KYH//Z\", \"response\": { \"retCode\": 0, \"msg\": \"success\", \"imgUrl\": \"http://qianguyihao.com/hfwpjouiurewnmbhepr689.jpg\", } }, { \"uid\": \"rc-upload-1551084269812-5\", \"width\": 600, \"height\": 354, \"lastModified\": 1546701318000, \"lastModifiedDate\": \"2019-01-05T15:15:18.000Z\", \"name\": \"e30e7b9680634b2c888c8bb513cc595d.jpg\", \"size\": 31731, \"type\": \"image/jpeg\", \"percent\": 100, \"originFileObj\": { \"uid\": \"rc-upload-1551084269812-5\", \"width\": 600, \"height\": 354 }, \"status\": \"done\", \"thumbUrl\": \"data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAHQ9qKKlbimcXrIH9o2vH/AC2T+ddPj98v+9RRWsuhnHdk0ar9qb5R0Pb6VPB/qh9aKKiRr0Irnt/vUDr+NFFJCRqWxJik5Pb+dLJ938aKK06mYSdKKKKBH//Z\", \"response\": { \"retCode\": 0, \"imgUrl\": \"http://qianguyihao.com/opfewfwj098902kpkpkkj976fe.jpg\", \"photoid\": 271850 } } ] ä¸Šæ–¹çš„jsonæ•°æ®ä¸­ï¼Œéœ€è¦åšå‡ ç‚¹è§£é‡Šï¼š\nï¼ˆ1ï¼‰response å­—æ®µé‡Œé¢çš„æ•°æ®ï¼Œå°±æ˜¯è¯·æ±‚æ¥å£åï¼Œåå°è¿”å›ç»™å‰ç«¯çš„æ•°æ®ï¼Œé‡Œé¢åŒ…å«äº†å›¾ç‰‡çš„urlé“¾æ¥ã€‚\nï¼ˆ2ï¼‰status å­—æ®µé‡Œå­˜æ”¾çš„æ˜¯å›¾ç‰‡ä¸Šä¼ çš„å®æ—¶çŠ¶æ€ï¼ŒåŒ…æ‹¬ä¸Šä¼ ä¸­ã€ä¸Šä¼ å®Œæˆã€ä¸Šä¼ å¤±è´¥ã€‚\nï¼ˆ3ï¼‰thumbUrlå­—æ®µé‡Œé¢å­˜æ”¾çš„æ˜¯å›¾ç‰‡çš„base64ç¼–ç ã€‚\nè¿™ä¸ªbase64ç¼–ç éå¸¸éå¸¸é•¿ã€‚å½“ç‚¹å‡»å›¾ç‰‡é¢„è§ˆçš„æ—¶å€™ï¼Œå…¶å®å°±æ˜¯åŠ è½½çš„ thumbUrl è¿™ä¸ªå­—æ®µé‡Œçš„èµ„æºï¼Œéš¾æ€ªæµè§ˆå™¨ä¼šå¡æ­»ã€‚\nè§£å†³åŠæ³•ï¼šåœ¨ handleChangeæ–¹æ³•é‡Œï¼Œå›¾ç‰‡ä¸Šä¼ æˆåŠŸåï¼Œå°† thumbUrl å­—æ®µé‡Œé¢çš„ base64 ç¼–ç æ”¹ä¸ºçœŸå®çš„å›¾ç‰‡urlã€‚ä»£ç å®ç°å¦‚ä¸‹ï¼š\nhandleChange = ({ file, fileList }) =\u003e { console.log(JSON.stringify(file)); // file æ˜¯å½“å‰æ­£åœ¨ä¸Šä¼ çš„ å•ä¸ª img console.log(JSON.stringify(fileList)); // fileList æ˜¯å·²ä¸Šä¼ çš„å…¨éƒ¨ img åˆ—è¡¨ // ã€é‡è¦ã€‘å°† å›¾ç‰‡çš„base64æ›¿æ¢ä¸ºå›¾ç‰‡çš„urlã€‚ è¿™ä¸€è¡Œä¸€å®šä¸ä¼šèƒ½å°‘ã€‚ // å›¾ç‰‡ä¸Šä¼ æˆåŠŸåï¼ŒfileListæ•°ç»„ä¸­çš„ thumbUrl ä¸­ä¿å­˜çš„æ˜¯å›¾ç‰‡çš„base64å­—ç¬¦ä¸²ï¼Œè¿™ç§æƒ…å†µï¼Œå¯¼è‡´çš„é—®é¢˜æ˜¯ï¼šå›¾ç‰‡ä¸Šä¼ æˆåŠŸåï¼Œç‚¹å‡»å›¾ç‰‡ç¼©ç•¥å›¾ï¼Œæµè§ˆå™¨ä¼šä¼šå¡æ­»ã€‚è€Œä¸‹é¢è¿™è¡Œä»£ç ï¼Œå¯ä»¥è§£å†³è¯¥bugã€‚ fileList.forEach(imgItem =\u003e { if (imgItem \u0026\u0026 imgItem.status == 'done' \u0026\u0026 imgItem.response \u0026\u0026 imgItem.response.imgUrl) { imgItem.thumbUrl = imgItem.response.imgUrl; } }); this.setState({ imgList: fileList, }); }; æ–°éœ€æ±‚ï¼šç¼–è¾‘ç°æœ‰é¡µé¢ ä¸Šé¢ä¸€æ®µçš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬æ˜¯åœ¨æ–°å»ºçš„é¡µé¢ä¸­ï¼Œä»é›¶å¼€å§‹ä¸Šä¼ å›¾ç‰‡ã€‚\nç°åœ¨æœ‰ä¸ªæ–°çš„éœ€æ±‚ï¼šå¦‚ä½•ç¼–è¾‘ç°æœ‰çš„é¡µé¢å‘¢ï¼Ÿä¹Ÿå°±æ˜¯è¯´ï¼Œç°æœ‰çš„é¡µé¢åœ¨åˆå§‹åŒ–æ—¶ï¼Œæ˜¯é»˜è®¤æœ‰å‡ å¼ å›¾ç‰‡çš„ã€‚å½“æˆ‘ç¼–è¾‘è¿™ä¸ªé¡µé¢æ—¶ï¼Œå¯ä»¥å¯¹ç°æœ‰çš„å›¾ç‰‡åšå¢åˆ ï¼Œä¹Ÿèƒ½å¢åŠ æ–°çš„å›¾ç‰‡ã€‚è€Œä¸”è¦ä¿è¯ï¼šæ–°å»ºé¡µé¢å’Œç¼–è¾‘ç°æœ‰é¡µé¢ï¼Œæ˜¯å…±ç”¨ä¸€å¥—ä»£ç ã€‚\næˆ‘çœ‹åˆ°upload ç»„ä»¶æœ‰æä¾› defaultFileList çš„å±æ€§ã€‚æˆ‘è¯•äº†ä¸‹ï¼Œè¿™ä¸ªdefaultFileList çš„å±æ€§æ ¹æœ¬æ²¡æ³•å„¿ç”¨ã€‚\né‚£å°±åªæœ‰æ‰‹åŠ¨å®ç°äº†ã€‚æˆ‘çš„modelå±‚ä»£ç ï¼Œæ˜¯ç”¨ redux å†™çš„ã€‚æ•´ä½“çš„å®ç°æ€è·¯å¦‚ä¸‹ï¼šï¼ˆè¿™ä¸ªä¹Ÿæ˜¯åœ¨çœŸæ­£åœ¨å®æˆ˜ä¸­ç”¨åˆ°çš„ä»£ç ï¼‰\nï¼ˆ1ï¼‰PicturesWall.jsï¼š\n/* eslint-disable */ import { Upload, Icon, Modal, Form } from 'antd'; const FormItem = Form.Item; class PicturesWall extends PureComponent { state = { previewVisible: false, previewImage: '', }; // é¡µé¢åˆå§‹åŒ–çš„æ—¶å€™ï¼Œä»æ¥å£æ‹‰å–é»˜è®¤çš„å›¾ç‰‡æ•°æ® componentDidMount() { const { dispatch } = this.props; dispatch({ type: 'mymodel/getAllInfo', payload: { params: xxx }, }); } handleChange = ({ file, fileList }) =\u003e { const { dispatch } = this.props; // ã€é‡è¦ã€‘å°† å›¾ç‰‡çš„base64æ›¿æ¢ä¸ºå›¾ç‰‡çš„urlã€‚ è¿™ä¸€è¡Œä¸€å®šä¸ä¼šèƒ½å°‘ã€‚ // å›¾ç‰‡ä¸Šä¼ æˆåŠŸåï¼ŒfileListæ•°ç»„ä¸­çš„ thumbUrl ä¸­ä¿å­˜çš„æ˜¯å›¾ç‰‡çš„base64å­—ç¬¦ä¸²ï¼Œè¿™ç§æƒ…å†µï¼Œå¯¼è‡´çš„é—®é¢˜æ˜¯ï¼šå›¾ç‰‡ä¸Šä¼ æˆåŠŸåï¼Œç‚¹å‡»å›¾ç‰‡ç¼©ç•¥å›¾ï¼Œæµè§ˆå™¨ä¼šä¼šå¡æ­»ã€‚è€Œä¸‹é¢è¿™è¡Œä»£ç ï¼Œå¯ä»¥è§£å†³è¯¥bugã€‚ fileList.forEach(imgItem =\u003e { if (imgItem \u0026\u0026 imgItem.status == 'done' \u0026\u0026 imgItem.response \u0026\u0026 imgItem.response.imgUrl) { imgItem.thumbUrl = imgItem.response.imgUrl; } }); dispatch({ type: 'mymodel/setImgList', payload: fileList, }); }; handleCancel = () =\u003e this.setState({ previewVisible: false }); handlePreview = file =\u003e { this.setState({ previewImage: file.url || file.thumbUrl, previewVisible: true, }); }; // å‚è€ƒé“¾æ¥ï¼šhttps://www.jianshu.com/p/f356f050b3c9 handleBeforeUpload = file =\u003e { //é™åˆ¶å›¾ç‰‡ æ ¼å¼ã€sizeã€åˆ†è¾¨ç‡ const isJPG = file.type === 'image/jpeg'; const isJPEG = file.type === 'image/jpeg'; const isGIF = file.type === 'image/gif'; const isPNG = file.type === 'image/png'; const isLt2M = file.size / 1024 / 1024 \u003c 2; if (!(isJPG || isJPEG || isGIF || isPNG)) { Modal.error({ title: 'åªèƒ½ä¸Šä¼ JPG ã€JPEG ã€GIFã€ PNGæ ¼å¼çš„å›¾ç‰‡~', }); } else if (!isLt2M) { Modal.error({ title: 'è¶…è¿‡2Mé™åˆ¶ï¼Œä¸å…è®¸ä¸Šä¼ ~', }); } } // å‚è€ƒé“¾æ¥ï¼šhttps://github.com/ant-design/ant-design/issues/8779 return new Promise((resolve, reject) =\u003e { if (!(isJPG || isJPEG || isGIF || isPNG)) { reject(file); } else { resolve(file \u0026\u0026 this.checkImageWH(file)); } }); }; //è¿”å›ä¸€ä¸ª promiseï¼šæ£€æµ‹é€šè¿‡åˆ™è¿”å›resolveï¼›å¤±è´¥åˆ™è¿”å›rejectï¼Œå¹¶é˜»æ­¢å›¾ç‰‡ä¸Šä¼  checkImageWH(file) { let self = this; return new Promise(function(resolve, reject) { let filereader = new FileReader(); filereader.onload = e =\u003e { let src = e.target.result; const image = new Image(); image.onload = function() { // è·å–å›¾ç‰‡çš„å®½é«˜ï¼Œå¹¶å­˜æ”¾åˆ°fileå¯¹è±¡ä¸­ console.log('file width :' + this.width); console.log('file height :' + this.height); file.width = this.width; file.height = this.height; resolve(); }; image.onerror = reject; image.src = src; }; filereader.readAsDataURL(file); }); } handleSubmit = e =\u003e { const { dispatch, form } = this.props; e.preventDefault(); const { mymodel: { imgList }, // ä»propsä¸­æ‹¿é»˜è®¤çš„å›¾ç‰‡æ•°æ® } = this.props; form.validateFieldsAndScroll((err, values) =\u003e { // values æ˜¯formè¡¨å•é‡Œçš„å‚æ•° // ç‚¹å‡»æŒ‰é’®åï¼Œå°†è¡¨å•æäº¤ç»™åå° // start é—®é¢˜æè¿°ï¼šå½“ç¼–è¾‘ç°æœ‰é¡µé¢æ—¶ï¼Œå¦‚æœé’ˆå¯¹å·²ç»å­˜åœ¨çš„é»˜è®¤å›¾ç‰‡ä¸åšä¿®æ”¹ï¼Œåˆ™ä¸ä¼šè§¦å‘ upload çš„ onChangeæ–¹æ³•ã€‚æ­¤æ—¶æäº¤è¡¨å•ï¼Œè¡¨å•é‡Œçš„ myImg å­—æ®µæ˜¯ç©ºçš„ã€‚ // è§£å†³åŠæ³•ï¼šå¦‚æœå‘ç°å­˜åœ¨é»˜è®¤å›¾ç‰‡ï¼Œåˆ™è¿½åŠ åˆ°è¡¨å•ä¸­ if (!values.myImg) { values.myImg = { fileList: [] }; values.myImg.fileList = imgList; } // end dispatch({ type: 'mymodel/submitFormData', payload: values, }); }); }; render() { const { previewVisible, previewImage } = this.state; // ä» state ä¸­æ‹¿æ•°æ® const { mymodel: { imgList }, // ä»propsä¸­æ‹¿åˆ°çš„å›¾ç‰‡æ•°æ® } = this.props; const uploadButton = ( \u003cdiv\u003e \u003cIcon type=\"plus\" /\u003e \u003cdiv className=\"ant-upload-text\"\u003eUpload\u003c/div\u003e \u003c/div\u003e ); return ( \u003cdiv className=\"clearfix\"\u003e \u003cForm onSubmit={this.handleSubmit} hideRequiredMark style={{ marginTop: 8 }}\u003e \u003cFormItem label=\"å›¾ç‰‡ä¸Šä¼ \" {...formItemLayout}\u003e {getFieldDecorator('myImg')( \u003cUpload action=\"//jsonplaceholder.typicode.com/posts/\" // è¿™ä¸ªæ˜¯å›¾ç‰‡ä¸Šä¼ çš„æ¥å£è¯·æ±‚ï¼Œå®é™…å¼€å‘ä¸­ï¼Œè¦æ›¿æ¢æˆä½ è‡ªå·±çš„ä¸šåŠ¡æ¥å£ data={file =\u003e ({ // dataé‡Œå­˜æ”¾çš„æ˜¯æ¥å£çš„è¯·æ±‚å‚æ•° param1: myParam1, param2: myParam2, photoCotent: file, // file æ˜¯å½“å‰æ­£åœ¨ä¸Šä¼ çš„å›¾ç‰‡ photoWidth: file.height, // é€šè¿‡ handleBeforeUpload è·å– å›¾ç‰‡çš„å®½é«˜ photoHeight: file.width, })} listType=\"picture-card\" fileList={imgList} // æ”¹ä¸ºä» props é‡Œæ‹¿å›¾ç‰‡æ•°æ®ï¼Œè€Œä¸æ˜¯ä» state onPreview={this.handlePreview} // ç‚¹å‡»å›¾ç‰‡ç¼©ç•¥å›¾ï¼Œè¿›è¡Œé¢„è§ˆ beforeUpload={this.handleBeforeUpload} // ä¸Šä¼ ä¹‹å‰ï¼Œå¯¹å›¾ç‰‡çš„æ ¼å¼åšæ ¡éªŒï¼Œå¹¶è·å–å›¾ç‰‡çš„å®½é«˜ onChange={this.handleChange} // æ¯æ¬¡ä¸Šä¼ å›¾ç‰‡æ—¶ï¼Œéƒ½ä¼šè§¦å‘è¿™ä¸ªæ–¹æ³• \u003e {this.state.imgList.length \u003e= 9 ? null : uploadButton} \u003c/Upload\u003e )} \u003c/FormItem\u003e \u003c/Form\u003e \u003cModal visible={previewVisible} footer={null} onCancel={this.handleCancel}\u003e \u003cimg alt=\"example\" style={{ width: '100%' }} src={previewImage} /\u003e \u003c/Modal\u003e \u003c/div\u003e ); } } export default PicturesWall; ï¼ˆ2ï¼‰mymodel.js:\n/* eslint-disable */ import { routerRedux } from 'dva/router'; import { message, Modal } from 'antd'; import { getGoodsInfo, getAllGoods, } from '../services/api'; import { trim, getCookie } from '../utils/utils'; export default { namespace: 'mymodel', state: { form: {}, list: [], listDetail: [], goodsList: [], goodsListDetail: [], pagination: { pageSize: 10, total: 0, current: 1, }, imgList: [], //å›¾ç‰‡ }, subscriptions: { setup({ dispatch, history }) { history.listen(location =\u003e { if (location.pathname !== '/xx/xxx') return; if (!location.state || !location.state.xxxId) return; dispatch({ type: 'fetch', payload: location.state, }); }); }, }, effects: { // æ¥å£ã€‚è·å–æ‰€æœ‰å·¥å‚åº—çš„åˆ—è¡¨ (æ­¥éª¤02) *getAllInfo({ payload }, { select, call, put }) { yield put({ type: 'form', payload, }); console.log('params:' + JSON.stringify(payload)); let params = {}; params = payload; const response = yield call(getGoodsInfo, params); console.log('smyhvae response:' + JSON.stringify(response)); if (response.error) return; yield put({ type: 'allInfo', payload: (response.data \u0026\u0026 response.data.map(item =\u003e ({ xx1: item.yy1, xx2: item.yy2, }))) || [], }); // response é‡ŒåŒ…å«äº†æ¥å£è¿”å›ç»™å‰ç«¯çš„é»˜è®¤å›¾ç‰‡æ•°æ® if (response \u0026\u0026 response.data \u0026\u0026 response.data[0] \u0026\u0026 response.data[0].my_jpg) { let tempImgList = response.data[0].my_jpg.split(','); let imgList = []; if (tempImgList.length \u003e 0) { tempImgList.forEach(item =\u003e { imgList.push({ uid: item, name: 'xxx.png', status: 'done', thumbUrl: item, }); }); } // é€šè¿‡ reduxçš„æ–¹å¼ å°† é»˜è®¤å›¾ç‰‡ ä¼ ç»™ imgList console.log('smyhvae payload imgList:' + JSON.stringify(imgList)); yield put({ type: 'setImgList', payload: imgList, }); } }, *setImgList({ payload }, { call, put }) { console.log('model setImgList'); yield put({ type: 'getImgList', payload, }); }, }, reducers: { allInfo(state, action) { return { ...state, list: action.payload, }; }, getImgList(state, action) { return { ...state, imgList: action.payload, }; }, }, }; ä¸Šé¢çš„ä»£ç ï¼Œå¯ä»¥è§„é¿ upload ç»„ä»¶çš„ä¸€äº›bugï¼›è€Œä¸”å¯ä»¥åœ¨ä¸Šä¼ å‰ï¼Œé€šè¿‡æ ¡éªŒå›¾ç‰‡çš„å°ºå¯¸ã€å¤§å°ç­‰ï¼Œå¦‚æœä¸æ»¡è¶³æ¡ä»¶ï¼Œåˆ™å¼¹å‡ºmodalå¼¹çª—ï¼Œé˜»æ­¢ä¸Šä¼ ã€‚\nå¤§åŠŸå‘Šæˆã€‚æœ¬æ–‡æ„Ÿè°¢ ld åŒå­¦çš„æ”¯æŒã€‚\næ›´å¤šå†…å®¹ï¼Œå¯ä»¥çœ‹æœ¬äººçš„å¦å¤–ä¸€ç¯‡æ–‡ç« ï¼š\nAntDæ¡†æ¶çš„uploadç»„ä»¶ä¸Šä¼ å›¾ç‰‡æ—¶ä½¿ç”¨customRequestæ–¹æ³•è‡ªå®šä¹‰ä¸Šä¼ è¡Œä¸º å…¶ä»–é—®é¢˜ beforeUploadè¿”å›falseåï¼Œæ–‡ä»¶ä»ç„¶ä¸ºä¸Šä¼ ä¸­çš„çŠ¶æ€ æœ€åä¸€æ®µ æœ‰äººè¯´ï¼Œå‰ç«¯å¼€å‘ï¼Œè¿å–èœçš„éƒ½ä¼šã€‚å¯å¦‚æœçœŸçš„é‡åˆ°æŠ€æœ¯éš¾é¢˜ï¼Œè¿˜æ˜¯å¾—æ‰¾ä¸ªé è°±çš„å‰ç«¯åŒå­¦æ‰è¡Œã€‚è¿™ä¸ï¼Œæ¥çœ‹çœ‹å‰ç«¯ç å†œæ—¥å¸¸ï¼š\n","wordCount":"3783","inLanguage":"en","datePublished":"2020-01-01T17:11:35+08:00","dateModified":"2020-01-01T17:11:35+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://bablvsj.github.io/posts/tech/wait/12-react%E5%9F%BA%E7%A1%80/09-antd%E6%A1%86%E6%9E%B6%E7%9A%84upload%E7%BB%84%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%9B%BE%E7%89%87%E6%97%B6%E9%81%87%E5%88%B0%E7%9A%84%E4%B8%80%E4%BA%9B%E5%9D%91/"},"publisher":{"@type":"Organization","name":"Bablvsj's Blog","logo":{"@type":"ImageObject","url":"https://bablvsj.github.io/img/Q.gif"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://bablvsj.github.io accesskey=h title="Bablvsj's Blog (Alt + H)">Bablvsj's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://bablvsj.github.io/ title=ä¸»é¡µ><span>ä¸»é¡µ</span></a></li><li><a href=https://bablvsj.github.io/archives/ title=æ—¶é—´è½´><span>æ—¶é—´è½´</span></a></li><li><a href=https://bablvsj.github.io/tags title=æ ‡ç­¾><span>æ ‡ç­¾</span></a></li><li><a href=https://bablvsj.github.io/about title=å…³äº><span>å…³äº</span></a></li><li><a href=https://bablvsj.github.io/search title="ğŸ” (Alt + /)" accesskey=/><span>ğŸ”</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>09-AntDæ¡†æ¶çš„uploadç»„ä»¶ä¸Šä¼ å›¾ç‰‡æ—¶é‡åˆ°çš„ä¸€äº›å‘</h1><div class=post-meta><div class=post-tags-meta><a href=https://bablvsj.github.io/tags/ant-design/>Ant Design</a></div>8 min&nbsp;Â·&nbsp;<span title='2020-01-01 17:11:35 +0800 +0800'>2020/01/01</span></div></header><aside id=toc-container class="toc-container wide"><div class=toc><div class=inner><ul><li><a href=#%e5%89%8d%e8%a8%80 aria-label=å‰è¨€>å‰è¨€</a></li><li><a href=#%e4%bd%bf%e7%94%a8-antd-%e7%9a%84-upload-%e7%bb%84%e4%bb%b6%e5%81%9a%e5%9b%be%e7%89%87%e7%9a%84%e4%b8%8a%e4%bc%a0 aria-label="ä½¿ç”¨ AntD çš„ upload ç»„ä»¶åšå›¾ç‰‡çš„ä¸Šä¼ ">ä½¿ç”¨ AntD çš„ upload ç»„ä»¶åšå›¾ç‰‡çš„ä¸Šä¼ </a></li><li><a href=#%e4%b8%8a%e4%bc%a0%e5%90%8e%e7%82%b9%e5%87%bb%e5%9b%be%e7%89%87%e9%a2%84%e8%a7%88%e6%b5%8f%e8%a7%88%e5%99%a8%e5%8d%a1%e6%ad%bb%e7%9a%84%e9%97%ae%e9%a2%98 aria-label=ä¸Šä¼ åï¼Œç‚¹å‡»å›¾ç‰‡é¢„è§ˆï¼Œæµè§ˆå™¨å¡æ­»çš„é—®é¢˜>ä¸Šä¼ åï¼Œç‚¹å‡»å›¾ç‰‡é¢„è§ˆï¼Œæµè§ˆå™¨å¡æ­»çš„é—®é¢˜</a></li><li><a href=#%e6%96%b0%e9%9c%80%e6%b1%82%e7%bc%96%e8%be%91%e7%8e%b0%e6%9c%89%e9%a1%b5%e9%9d%a2 aria-label=æ–°éœ€æ±‚ï¼šç¼–è¾‘ç°æœ‰é¡µé¢>æ–°éœ€æ±‚ï¼šç¼–è¾‘ç°æœ‰é¡µé¢</a></li><li><a href=#%e5%85%b6%e4%bb%96%e9%97%ae%e9%a2%98 aria-label=å…¶ä»–é—®é¢˜>å…¶ä»–é—®é¢˜</a></li><li><a href=#%e6%9c%80%e5%90%8e%e4%b8%80%e6%ae%b5 aria-label=æœ€åä¸€æ®µ>æœ€åä¸€æ®µ</a></li></ul></div></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><h2 id=å‰è¨€>å‰è¨€<a hidden class=anchor aria-hidden=true href=#å‰è¨€>#</a></h2><p>æœ¬æ¬¡åšåå°ç®¡ç†ç³»ç»Ÿï¼Œé‡‡ç”¨çš„æ˜¯ AntD æ¡†æ¶ã€‚æ¶‰åŠåˆ°å›¾ç‰‡çš„ä¸Šä¼ ï¼Œç”¨çš„æ˜¯AntDçš„ <a href=https://ant.design/components/upload-cn/>upload</a> ç»„ä»¶ã€‚</p><p>å‰ç«¯åšæ–‡ä»¶ä¸Šä¼ è¿™ä¸ªåŠŸèƒ½ï¼Œæ˜¯å¾ˆæœ‰æŠ€æœ¯éš¾åº¦çš„ã€‚æ—¢ç„¶æ¡†æ¶ç»™æˆ‘ä»¬æä¾›å¥½äº†ï¼Œé‚£å°±ç›´æ¥ç”¨å‘—ã€‚ç»“æœç”¨çš„æ—¶å€™ï¼Œå‘ç° upload ç»„ä»¶çš„å¾ˆå¤šbugã€‚ä¸‹é¢æ¥åˆ—ä¸¾å‡ ä¸ªã€‚</p><p>å¤‡æ³¨ï¼šæœ¬æ–‡å†™äº2019-03-02ï¼Œä½¿ç”¨çš„ antd ç‰ˆæœ¬æ˜¯ 3.13.6ã€‚</p><h2 id=ä½¿ç”¨-antd-çš„-upload-ç»„ä»¶åšå›¾ç‰‡çš„ä¸Šä¼ >ä½¿ç”¨ AntD çš„ upload ç»„ä»¶åšå›¾ç‰‡çš„ä¸Šä¼ <a hidden class=anchor aria-hidden=true href=#ä½¿ç”¨-antd-çš„-upload-ç»„ä»¶åšå›¾ç‰‡çš„ä¸Šä¼ >#</a></h2><p>å› ä¸ºéœ€è¦ä¸Šä¼ å¤šå¼ å›¾ç‰‡ï¼Œæ‰€ä»¥é‡‡ç”¨çš„æ˜¯ç…§ç‰‡å¢™çš„å½¢å¼ã€‚ä¸Šä¼ æˆåŠŸåçš„ç•Œé¢å¦‚ä¸‹ï¼š</p><p>ï¼ˆ1ï¼‰ä¸Šä¼ ä¸­ï¼š</p><p><img loading=lazy src=http://img.smyhvae.com/20190302_1335.png alt></p><p>ï¼ˆ2ï¼‰ä¸Šä¼ æˆåŠŸï¼š</p><p><img loading=lazy src=http://img.smyhvae.com/20190302_1336.png alt></p><p>ï¼ˆ3ï¼‰å›¾ç‰‡é¢„è§ˆï¼š</p><p><img loading=lazy src=http://img.smyhvae.com/20190302_1331.png alt></p><p>æŒ‰ç…§å®˜æ–¹æä¾›çš„å®ä¾‹ï¼Œç‰¹æ­¤æ•´ç†å‡ºé¡¹ç›®å¼€å‘ä¸­çš„å®Œæ•´å†™æ³•ï¼Œäº²æµ‹æœ‰æ•ˆã€‚ä»£ç å¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#3c3836;background-color:#fbf1c7;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#928374;font-style:italic>/* eslint-disable */</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#af3a03>import</span> { Upload, Icon, Modal, Form } from <span style=color:#79740e>&#39;antd&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#af3a03>const</span> FormItem <span style=color:#af3a03>=</span> Form.Item;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#af3a03>class</span> PicturesWall <span style=color:#af3a03>extends</span> PureComponent {
</span></span><span style=display:flex><span>  state <span style=color:#af3a03>=</span> {
</span></span><span style=display:flex><span>    previewVisible<span style=color:#af3a03>:</span> <span style=color:#af3a03>false</span>,
</span></span><span style=display:flex><span>    previewImage<span style=color:#af3a03>:</span> <span style=color:#79740e>&#39;&#39;</span>,
</span></span><span style=display:flex><span>    imgList<span style=color:#af3a03>:</span> [],
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  handleChange <span style=color:#af3a03>=</span> ({ file, fileList }) =&gt; {
</span></span><span style=display:flex><span>    console.log(JSON.stringify(file)); <span style=color:#928374;font-style:italic>// file æ˜¯å½“å‰æ­£åœ¨ä¸Šä¼ çš„ å•ä¸ª img
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic></span>    console.log(JSON.stringify(fileList)); <span style=color:#928374;font-style:italic>// fileList æ˜¯å·²ä¸Šä¼ çš„å…¨éƒ¨ img åˆ—è¡¨
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic></span>
</span></span><span style=display:flex><span>    <span style=color:#af3a03>this</span>.setState({
</span></span><span style=display:flex><span>      imgList<span style=color:#af3a03>:</span> fileList,
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  handleCancel <span style=color:#af3a03>=</span> () =&gt; <span style=color:#af3a03>this</span>.setState({ previewVisible<span style=color:#af3a03>:</span> <span style=color:#af3a03>false</span> });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  handlePreview <span style=color:#af3a03>=</span> file =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#af3a03>this</span>.setState({
</span></span><span style=display:flex><span>      previewImage<span style=color:#af3a03>:</span> file.url <span style=color:#af3a03>||</span> file.thumbUrl,
</span></span><span style=display:flex><span>      previewVisible<span style=color:#af3a03>:</span> <span style=color:#af3a03>true</span>,
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#928374;font-style:italic>// å‚è€ƒé“¾æ¥ï¼šhttps://www.jianshu.com/p/f356f050b3c9
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic></span>  handleBeforeUpload <span style=color:#af3a03>=</span> file =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#928374;font-style:italic>//é™åˆ¶å›¾ç‰‡ æ ¼å¼ã€sizeã€åˆ†è¾¨ç‡
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic></span>    <span style=color:#af3a03>const</span> isJPG <span style=color:#af3a03>=</span> file.type <span style=color:#af3a03>===</span> <span style=color:#79740e>&#39;image/jpeg&#39;</span>;
</span></span><span style=display:flex><span>    <span style=color:#af3a03>const</span> isJPEG <span style=color:#af3a03>=</span> file.type <span style=color:#af3a03>===</span> <span style=color:#79740e>&#39;image/jpeg&#39;</span>;
</span></span><span style=display:flex><span>    <span style=color:#af3a03>const</span> isGIF <span style=color:#af3a03>=</span> file.type <span style=color:#af3a03>===</span> <span style=color:#79740e>&#39;image/gif&#39;</span>;
</span></span><span style=display:flex><span>    <span style=color:#af3a03>const</span> isPNG <span style=color:#af3a03>=</span> file.type <span style=color:#af3a03>===</span> <span style=color:#79740e>&#39;image/png&#39;</span>;
</span></span><span style=display:flex><span>    <span style=color:#af3a03>if</span> (<span style=color:#af3a03>!</span>(isJPG <span style=color:#af3a03>||</span> isJPEG <span style=color:#af3a03>||</span> isGIF <span style=color:#af3a03>||</span> isPNG)) {
</span></span><span style=display:flex><span>      Modal.error({
</span></span><span style=display:flex><span>        title<span style=color:#af3a03>:</span> <span style=color:#79740e>&#39;åªèƒ½ä¸Šä¼ JPG ã€JPEG ã€GIFã€ PNGæ ¼å¼çš„å›¾ç‰‡~&#39;</span>,
</span></span><span style=display:flex><span>      });
</span></span><span style=display:flex><span>      <span style=color:#af3a03>return</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#af3a03>const</span> isLt2M <span style=color:#af3a03>=</span> file.size <span style=color:#af3a03>/</span> <span style=color:#8f3f71>1024</span> <span style=color:#af3a03>/</span> <span style=color:#8f3f71>1024</span> <span style=color:#af3a03>&lt;</span> <span style=color:#8f3f71>2</span>;
</span></span><span style=display:flex><span>    <span style=color:#af3a03>if</span> (<span style=color:#af3a03>!</span>isLt2M) {
</span></span><span style=display:flex><span>      Modal.error({
</span></span><span style=display:flex><span>        title<span style=color:#af3a03>:</span> <span style=color:#79740e>&#39;è¶…è¿‡2Mé™åˆ¶ï¼Œä¸å…è®¸ä¸Šä¼ ~&#39;</span>,
</span></span><span style=display:flex><span>      });
</span></span><span style=display:flex><span>      <span style=color:#af3a03>return</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#af3a03>return</span> (isJPG <span style=color:#af3a03>||</span> isJPEG <span style=color:#af3a03>||</span> isGIF <span style=color:#af3a03>||</span> isPNG) <span style=color:#af3a03>&amp;&amp;</span> isLt2M <span style=color:#af3a03>&amp;&amp;</span> <span style=color:#af3a03>this</span>.checkImageWH(file);
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#928374;font-style:italic>//è¿”å›ä¸€ä¸ª promiseï¼šæ£€æµ‹é€šè¿‡åˆ™è¿”å›resolveï¼›å¤±è´¥åˆ™è¿”å›rejectï¼Œå¹¶é˜»æ­¢å›¾ç‰‡ä¸Šä¼ 
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic></span>  checkImageWH(file) {
</span></span><span style=display:flex><span>    <span style=color:#af3a03>let</span> self <span style=color:#af3a03>=</span> <span style=color:#af3a03>this</span>;
</span></span><span style=display:flex><span>    <span style=color:#af3a03>return</span> <span style=color:#af3a03>new</span> <span style=color:#b57614>Promise</span>(<span style=color:#af3a03>function</span>(resolve, reject) {
</span></span><span style=display:flex><span>      <span style=color:#af3a03>let</span> filereader <span style=color:#af3a03>=</span> <span style=color:#af3a03>new</span> FileReader();
</span></span><span style=display:flex><span>      filereader.onload <span style=color:#af3a03>=</span> e =&gt; {
</span></span><span style=display:flex><span>        <span style=color:#af3a03>let</span> src <span style=color:#af3a03>=</span> e.target.result;
</span></span><span style=display:flex><span>        <span style=color:#af3a03>const</span> image <span style=color:#af3a03>=</span> <span style=color:#af3a03>new</span> Image();
</span></span><span style=display:flex><span>        image.onload <span style=color:#af3a03>=</span> <span style=color:#af3a03>function</span>() {
</span></span><span style=display:flex><span>          <span style=color:#928374;font-style:italic>// è·å–å›¾ç‰‡çš„å®½é«˜ï¼Œå¹¶å­˜æ”¾åˆ°fileå¯¹è±¡ä¸­
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic></span>          console.log(<span style=color:#79740e>&#39;file width :&#39;</span> <span style=color:#af3a03>+</span> <span style=color:#af3a03>this</span>.width);
</span></span><span style=display:flex><span>          console.log(<span style=color:#79740e>&#39;file height :&#39;</span> <span style=color:#af3a03>+</span> <span style=color:#af3a03>this</span>.height);
</span></span><span style=display:flex><span>          file.width <span style=color:#af3a03>=</span> <span style=color:#af3a03>this</span>.width;
</span></span><span style=display:flex><span>          file.height <span style=color:#af3a03>=</span> <span style=color:#af3a03>this</span>.height;
</span></span><span style=display:flex><span>          resolve();
</span></span><span style=display:flex><span>        };
</span></span><span style=display:flex><span>        image.onerror <span style=color:#af3a03>=</span> reject;
</span></span><span style=display:flex><span>        image.src <span style=color:#af3a03>=</span> src;
</span></span><span style=display:flex><span>      };
</span></span><span style=display:flex><span>      filereader.readAsDataURL(file);
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  handleSubmit <span style=color:#af3a03>=</span> e =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#af3a03>const</span> { dispatch, form } <span style=color:#af3a03>=</span> <span style=color:#af3a03>this</span>.props;
</span></span><span style=display:flex><span>    e.preventDefault();
</span></span><span style=display:flex><span>    form.validateFieldsAndScroll((err, values) =&gt; {<span style=color:#928374;font-style:italic>// values æ˜¯formè¡¨å•é‡Œçš„å‚æ•°
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic></span>      <span style=color:#928374;font-style:italic>// ç‚¹å‡»æŒ‰é’®åï¼Œå°†è¡¨å•æäº¤ç»™åå°
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic></span>      dispatch({
</span></span><span style=display:flex><span>        type<span style=color:#af3a03>:</span> <span style=color:#79740e>&#39;mymodel/submitFormData&#39;</span>,
</span></span><span style=display:flex><span>        payload<span style=color:#af3a03>:</span> values,
</span></span><span style=display:flex><span>      });
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  render() {
</span></span><span style=display:flex><span>    <span style=color:#af3a03>const</span> { previewVisible, previewImage, imgList } <span style=color:#af3a03>=</span> <span style=color:#af3a03>this</span>.state; <span style=color:#928374;font-style:italic>//  ä» state ä¸­æ‹¿æ•°æ®
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic></span>    <span style=color:#af3a03>const</span> uploadButton <span style=color:#af3a03>=</span> (
</span></span><span style=display:flex><span>      <span style=color:#af3a03>&lt;</span>div<span style=color:#af3a03>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#af3a03>&lt;</span>Icon type<span style=color:#af3a03>=</span><span style=color:#79740e>&#34;plus&#34;</span> <span style=color:#af3a03>/&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#af3a03>&lt;</span>div className<span style=color:#af3a03>=</span><span style=color:#79740e>&#34;ant-upload-text&#34;</span><span style=color:#af3a03>&gt;</span>Upload<span style=color:#af3a03>&lt;</span>/div&gt;
</span></span><span style=display:flex><span>      <span style=color:#af3a03>&lt;</span>/div&gt;
</span></span><span style=display:flex><span>    );
</span></span><span style=display:flex><span>    <span style=color:#af3a03>return</span> (
</span></span><span style=display:flex><span>      <span style=color:#af3a03>&lt;</span>div className<span style=color:#af3a03>=</span><span style=color:#79740e>&#34;clearfix&#34;</span><span style=color:#af3a03>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#af3a03>&lt;</span>Form onSubmit<span style=color:#af3a03>=</span>{<span style=color:#af3a03>this</span>.handleSubmit} hideRequiredMark style<span style=color:#af3a03>=</span>{{ marginTop<span style=color:#af3a03>:</span> <span style=color:#8f3f71>8</span> }}<span style=color:#af3a03>&gt;</span>
</span></span><span style=display:flex><span>          <span style=color:#af3a03>&lt;</span>FormItem label<span style=color:#af3a03>=</span><span style=color:#79740e>&#34;å›¾ç‰‡å›¾ç‰‡&#34;</span> {...formItemLayout}<span style=color:#af3a03>&gt;</span>
</span></span><span style=display:flex><span>            {getFieldDecorator(<span style=color:#79740e>&#39;myImg&#39;</span>)(
</span></span><span style=display:flex><span>              <span style=color:#af3a03>&lt;</span>Upload
</span></span><span style=display:flex><span>                action<span style=color:#af3a03>=</span><span style=color:#79740e>&#34;//jsonplaceholder.typicode.com/posts/&#34;</span> <span style=color:#928374;font-style:italic>// è¿™ä¸ªæ˜¯å›¾ç‰‡ä¸Šä¼ çš„æ¥å£è¯·æ±‚ï¼Œå®é™…å¼€å‘ä¸­ï¼Œè¦æ›¿æ¢æˆä½ è‡ªå·±çš„ä¸šåŠ¡æ¥å£
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic></span>                data<span style=color:#af3a03>=</span>{file =&gt; ({ <span style=color:#928374;font-style:italic>// dataé‡Œå­˜æ”¾çš„æ˜¯æ¥å£çš„è¯·æ±‚å‚æ•°
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic></span>                  param1<span style=color:#af3a03>:</span> myParam1,
</span></span><span style=display:flex><span>                  param2<span style=color:#af3a03>:</span> myParam2,
</span></span><span style=display:flex><span>                  photoCotent<span style=color:#af3a03>:</span> file, <span style=color:#928374;font-style:italic>// file æ˜¯å½“å‰æ­£åœ¨ä¸Šä¼ çš„å›¾ç‰‡
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic></span>                  photoWidth<span style=color:#af3a03>:</span> file.height, <span style=color:#928374;font-style:italic>// é€šè¿‡  handleBeforeUpload è·å– å›¾ç‰‡çš„å®½é«˜
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic></span>                  photoHeight<span style=color:#af3a03>:</span> file.width,
</span></span><span style=display:flex><span>                })}
</span></span><span style=display:flex><span>                listType<span style=color:#af3a03>=</span><span style=color:#79740e>&#34;picture-card&#34;</span>
</span></span><span style=display:flex><span>                fileList<span style=color:#af3a03>=</span>{<span style=color:#af3a03>this</span>.state.imgList}
</span></span><span style=display:flex><span>                onPreview<span style=color:#af3a03>=</span>{<span style=color:#af3a03>this</span>.handlePreview} <span style=color:#928374;font-style:italic>// ç‚¹å‡»å›¾ç‰‡ç¼©ç•¥å›¾ï¼Œè¿›è¡Œé¢„è§ˆ
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic></span>                beforeUpload<span style=color:#af3a03>=</span>{<span style=color:#af3a03>this</span>.handleBeforeUpload} <span style=color:#928374;font-style:italic>// ä¸Šä¼ ä¹‹å‰ï¼Œå¯¹å›¾ç‰‡çš„æ ¼å¼åšæ ¡éªŒï¼Œå¹¶è·å–å›¾ç‰‡çš„å®½é«˜
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic></span>                onChange<span style=color:#af3a03>=</span>{<span style=color:#af3a03>this</span>.handleChange} <span style=color:#928374;font-style:italic>// æ¯æ¬¡ä¸Šä¼ å›¾ç‰‡æ—¶ï¼Œéƒ½ä¼šè§¦å‘è¿™ä¸ªæ–¹æ³•
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic></span>              <span style=color:#af3a03>&gt;</span>
</span></span><span style=display:flex><span>                {<span style=color:#af3a03>this</span>.state.imgList.length <span style=color:#af3a03>&gt;=</span> <span style=color:#8f3f71>9</span> <span style=color:#af3a03>?</span> <span style=color:#af3a03>null</span> <span style=color:#af3a03>:</span> uploadButton}
</span></span><span style=display:flex><span>              <span style=color:#af3a03>&lt;</span>/Upload&gt;
</span></span><span style=display:flex><span>            )}
</span></span><span style=display:flex><span>          <span style=color:#af3a03>&lt;</span>/FormItem&gt;
</span></span><span style=display:flex><span>        <span style=color:#af3a03>&lt;</span>/Form&gt;
</span></span><span style=display:flex><span>        <span style=color:#af3a03>&lt;</span>Modal visible<span style=color:#af3a03>=</span>{previewVisible} footer<span style=color:#af3a03>=</span>{<span style=color:#af3a03>null</span>} onCancel<span style=color:#af3a03>=</span>{<span style=color:#af3a03>this</span>.handleCancel}<span style=color:#af3a03>&gt;</span>
</span></span><span style=display:flex><span>          <span style=color:#af3a03>&lt;</span>img alt<span style=color:#af3a03>=</span><span style=color:#79740e>&#34;example&#34;</span> style<span style=color:#af3a03>=</span>{{ width<span style=color:#af3a03>:</span> <span style=color:#79740e>&#39;100%&#39;</span> }} src<span style=color:#af3a03>=</span>{previewImage} <span style=color:#af3a03>/&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#af3a03>&lt;</span>/Modal&gt;
</span></span><span style=display:flex><span>      <span style=color:#af3a03>&lt;</span>/div&gt;
</span></span><span style=display:flex><span>    );
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#af3a03>export</span> <span style=color:#af3a03>default</span> PicturesWall;
</span></span></code></pre></div><h2 id=ä¸Šä¼ åç‚¹å‡»å›¾ç‰‡é¢„è§ˆæµè§ˆå™¨å¡æ­»çš„é—®é¢˜>ä¸Šä¼ åï¼Œç‚¹å‡»å›¾ç‰‡é¢„è§ˆï¼Œæµè§ˆå™¨å¡æ­»çš„é—®é¢˜<a hidden class=anchor aria-hidden=true href=#ä¸Šä¼ åç‚¹å‡»å›¾ç‰‡é¢„è§ˆæµè§ˆå™¨å¡æ­»çš„é—®é¢˜>#</a></h2><p>ä¾æ®ä¸Šæ–¹çš„ä»£ç ï¼Œé€šè¿‡ Antd çš„ upload ç»„ä»¶å°†å›¾ç‰‡ä¸Šä¼ æˆåŠŸåï¼Œç‚¹å‡»å›¾ç‰‡çš„ç¼©ç•¥å›¾ï¼Œç†åº”å¯ä»¥åœ¨å½“å‰é¡µé¢å¼¹å‡º Modalï¼Œé¢„è§ˆå›¾ç‰‡ã€‚ä½†å®é™…çš„ç»“æœæ˜¯ï¼Œæµè§ˆå™¨ä¸€å®šä¼šå¡æ­»ã€‚</p><p>å®šä½é—®é¢˜å‘ç°ï¼ŒåŸå› ç«Ÿç„¶æ˜¯ï¼šå›¾ç‰‡ä¸Šä¼ æˆåŠŸåï¼Œ upload ä¼šå°†å…¶è½¬ä¸º base64ç¼–ç ã€‚base64è¿™ä¸ªå­—ç¬¦ä¸²å¤ªå¤§äº†ï¼Œç‚¹å‡»å›¾ç‰‡é¢„è§ˆçš„æ—¶å€™ï¼Œæµè§ˆå™¨åœ¨è§£æä¸€å¤§ä¸²å­—ç¬¦ä¸²ï¼Œç„¶åå°±å¡æ­»äº†ã€‚è¯¦ç»†è¿‡ç¨‹æè¿°å¦‚ä¸‹ã€‚</p><p>ä¸Šæ–¹ä»£ç ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠ handleChange(file, fileList)æ–¹æ³•ä¸­çš„ <code>file</code>ã€ä»¥åŠ <code>fileList</code>æ‰“å°å‡ºæ¥çœ‹çœ‹ã€‚ <code>file</code>æŒ‡çš„æ˜¯å½“å‰æ­£åœ¨ä¸Šä¼ çš„ å•ä¸ª imgï¼Œ<code>fileList</code>æ˜¯å·²ä¸Šä¼ çš„å…¨éƒ¨ img åˆ—è¡¨ã€‚ å½“æˆ‘ä¸Šä¼ å®Œ ä¸¤å¼ å›¾ç‰‡åï¼Œ æ‰“å°ç»“æœå¦‚ä¸‹ï¼š</p><p>fileçš„æ‰“å°çš„ç»“æœå¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#3c3836;background-color:#fbf1c7;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#9d0006>&#34;uid&#34;</span>: <span style=color:#79740e>&#34;rc-upload-1551084269812-5&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#9d0006>&#34;width&#34;</span>: <span style=color:#8f3f71>600</span>,
</span></span><span style=display:flex><span>        <span style=color:#9d0006>&#34;height&#34;</span>: <span style=color:#8f3f71>354</span>,
</span></span><span style=display:flex><span>        <span style=color:#9d0006>&#34;lastModified&#34;</span>: <span style=color:#8f3f71>1546701318000</span>,
</span></span><span style=display:flex><span>        <span style=color:#9d0006>&#34;lastModifiedDate&#34;</span>: <span style=color:#79740e>&#34;2019-01-05T15:15:18.000Z&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#9d0006>&#34;name&#34;</span>: <span style=color:#79740e>&#34;e30e7b9680634b2c888c8bb513cc595d.jpg&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#9d0006>&#34;size&#34;</span>: <span style=color:#8f3f71>31731</span>,
</span></span><span style=display:flex><span>        <span style=color:#9d0006>&#34;type&#34;</span>: <span style=color:#79740e>&#34;image/jpeg&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#9d0006>&#34;percent&#34;</span>: <span style=color:#8f3f71>100</span>,
</span></span><span style=display:flex><span>        <span style=color:#9d0006>&#34;originFileObj&#34;</span>: {
</span></span><span style=display:flex><span>            <span style=color:#9d0006>&#34;uid&#34;</span>: <span style=color:#79740e>&#34;rc-upload-1551084269812-5&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#9d0006>&#34;width&#34;</span>: <span style=color:#8f3f71>600</span>,
</span></span><span style=display:flex><span>            <span style=color:#9d0006>&#34;height&#34;</span>: <span style=color:#8f3f71>354</span>
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        <span style=color:#9d0006>&#34;status&#34;</span>: <span style=color:#79740e>&#34;done&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#9d0006>&#34;thumbUrl&#34;</span>: <span style=color:#79740e>&#34;data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAHQ9qKKlbimcXrIH9o2vH/AC2T+ddPj98v+9RRWsuhnHdk0ar9qb5R0Pb6VPB/qh9aKKiRr0Irnt/vUDr+NFFJCRqWxJik5Pb+dLJ938aKK06mYSdKKKKBH//Z&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#9d0006>&#34;response&#34;</span>: {
</span></span><span style=display:flex><span>            <span style=color:#9d0006>&#34;retCode&#34;</span>: <span style=color:#8f3f71>0</span>,
</span></span><span style=display:flex><span>            <span style=color:#9d0006>&#34;imgUrl&#34;</span>: <span style=color:#79740e>&#34;http://qianguyihao.com/opfewfwj098902kpkpkkj976fe.jpg&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#9d0006>&#34;photoid&#34;</span>: <span style=color:#8f3f71>271850</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span></code></pre></div><p>fileList çš„æ‰“å°ç»“æœï¼š</p><div class=highlight><pre tabindex=0 style=color:#3c3836;background-color:#fbf1c7;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>[
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#9d0006>&#34;uid&#34;</span>: <span style=color:#79740e>&#34;rc-upload-1551084269812-3&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#9d0006>&#34;width&#34;</span>: <span style=color:#8f3f71>1000</span>,
</span></span><span style=display:flex><span>        <span style=color:#9d0006>&#34;height&#34;</span>: <span style=color:#8f3f71>667</span>,
</span></span><span style=display:flex><span>        <span style=color:#9d0006>&#34;lastModified&#34;</span>: <span style=color:#8f3f71>1501414799000</span>,
</span></span><span style=display:flex><span>        <span style=color:#9d0006>&#34;lastModifiedDate&#34;</span>: <span style=color:#79740e>&#34;2017-07-30T11:39:59.000Z&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#9d0006>&#34;name&#34;</span>: <span style=color:#79740e>&#34;29381f30e924b89914e91b33.jpg&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#9d0006>&#34;size&#34;</span>: <span style=color:#8f3f71>135204</span>,
</span></span><span style=display:flex><span>        <span style=color:#9d0006>&#34;type&#34;</span>: <span style=color:#79740e>&#34;image/jpeg&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#9d0006>&#34;percent&#34;</span>: <span style=color:#8f3f71>100</span>,
</span></span><span style=display:flex><span>        <span style=color:#9d0006>&#34;originFileObj&#34;</span>: {
</span></span><span style=display:flex><span>            <span style=color:#9d0006>&#34;uid&#34;</span>: <span style=color:#79740e>&#34;rc-upload-1551084269812-3&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#9d0006>&#34;width&#34;</span>: <span style=color:#8f3f71>1000</span>,
</span></span><span style=display:flex><span>            <span style=color:#9d0006>&#34;height&#34;</span>: <span style=color:#8f3f71>667</span>
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        <span style=color:#9d0006>&#34;status&#34;</span>: <span style=color:#79740e>&#34;done&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#9d0006>&#34;thumbUrl&#34;</span>: <span style=color:#79740e>&#34;data:image/jpeg;base64,/E3ju1tlaK1fzJOnHQU3LsLV7HO6Zrk11MZJ7luT0A4FZuRagi9quvzQQ4iuEJ7ZpqTG4djDsPFl2Lg733f8C4q+YhQ8zoYfGSqoMmfwo5huLL0HjiyPDSYPvxRdC1XQvxeLrB8fvl/OnoLmL9vrdvvYS3NGFVe2YsASOh71JfQyrqV2mXLHOcccVSIYEnDyZO9XXB9KYH//Z&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#9d0006>&#34;response&#34;</span>: {
</span></span><span style=display:flex><span>            <span style=color:#9d0006>&#34;retCode&#34;</span>: <span style=color:#8f3f71>0</span>,
</span></span><span style=display:flex><span>            <span style=color:#9d0006>&#34;msg&#34;</span>: <span style=color:#79740e>&#34;success&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#9d0006>&#34;imgUrl&#34;</span>: <span style=color:#79740e>&#34;http://qianguyihao.com/hfwpjouiurewnmbhepr689.jpg&#34;</span>,
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#9d0006>&#34;uid&#34;</span>: <span style=color:#79740e>&#34;rc-upload-1551084269812-5&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#9d0006>&#34;width&#34;</span>: <span style=color:#8f3f71>600</span>,
</span></span><span style=display:flex><span>        <span style=color:#9d0006>&#34;height&#34;</span>: <span style=color:#8f3f71>354</span>,
</span></span><span style=display:flex><span>        <span style=color:#9d0006>&#34;lastModified&#34;</span>: <span style=color:#8f3f71>1546701318000</span>,
</span></span><span style=display:flex><span>        <span style=color:#9d0006>&#34;lastModifiedDate&#34;</span>: <span style=color:#79740e>&#34;2019-01-05T15:15:18.000Z&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#9d0006>&#34;name&#34;</span>: <span style=color:#79740e>&#34;e30e7b9680634b2c888c8bb513cc595d.jpg&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#9d0006>&#34;size&#34;</span>: <span style=color:#8f3f71>31731</span>,
</span></span><span style=display:flex><span>        <span style=color:#9d0006>&#34;type&#34;</span>: <span style=color:#79740e>&#34;image/jpeg&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#9d0006>&#34;percent&#34;</span>: <span style=color:#8f3f71>100</span>,
</span></span><span style=display:flex><span>        <span style=color:#9d0006>&#34;originFileObj&#34;</span>: {
</span></span><span style=display:flex><span>            <span style=color:#9d0006>&#34;uid&#34;</span>: <span style=color:#79740e>&#34;rc-upload-1551084269812-5&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#9d0006>&#34;width&#34;</span>: <span style=color:#8f3f71>600</span>,
</span></span><span style=display:flex><span>            <span style=color:#9d0006>&#34;height&#34;</span>: <span style=color:#8f3f71>354</span>
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        <span style=color:#9d0006>&#34;status&#34;</span>: <span style=color:#79740e>&#34;done&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#9d0006>&#34;thumbUrl&#34;</span>: <span style=color:#79740e>&#34;data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAHQ9qKKlbimcXrIH9o2vH/AC2T+ddPj98v+9RRWsuhnHdk0ar9qb5R0Pb6VPB/qh9aKKiRr0Irnt/vUDr+NFFJCRqWxJik5Pb+dLJ938aKK06mYSdKKKKBH//Z&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#9d0006>&#34;response&#34;</span>: {
</span></span><span style=display:flex><span>            <span style=color:#9d0006>&#34;retCode&#34;</span>: <span style=color:#8f3f71>0</span>,
</span></span><span style=display:flex><span>            <span style=color:#9d0006>&#34;imgUrl&#34;</span>: <span style=color:#79740e>&#34;http://qianguyihao.com/opfewfwj098902kpkpkkj976fe.jpg&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#9d0006>&#34;photoid&#34;</span>: <span style=color:#8f3f71>271850</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>]
</span></span></code></pre></div><p>ä¸Šæ–¹çš„jsonæ•°æ®ä¸­ï¼Œéœ€è¦åšå‡ ç‚¹è§£é‡Šï¼š</p><p>ï¼ˆ1ï¼‰<code>response</code> å­—æ®µé‡Œé¢çš„æ•°æ®ï¼Œå°±æ˜¯è¯·æ±‚æ¥å£åï¼Œåå°è¿”å›ç»™å‰ç«¯çš„æ•°æ®ï¼Œé‡Œé¢åŒ…å«äº†å›¾ç‰‡çš„urlé“¾æ¥ã€‚</p><p>ï¼ˆ2ï¼‰<code>status</code> å­—æ®µé‡Œå­˜æ”¾çš„æ˜¯å›¾ç‰‡ä¸Šä¼ çš„å®æ—¶çŠ¶æ€ï¼ŒåŒ…æ‹¬ä¸Šä¼ ä¸­ã€ä¸Šä¼ å®Œæˆã€ä¸Šä¼ å¤±è´¥ã€‚</p><p>ï¼ˆ3ï¼‰<code>thumbUrl</code>å­—æ®µé‡Œé¢å­˜æ”¾çš„æ˜¯å›¾ç‰‡çš„base64ç¼–ç ã€‚</p><p>è¿™ä¸ªbase64ç¼–ç éå¸¸éå¸¸é•¿ã€‚å½“ç‚¹å‡»å›¾ç‰‡é¢„è§ˆçš„æ—¶å€™ï¼Œå…¶å®å°±æ˜¯åŠ è½½çš„ thumbUrl è¿™ä¸ªå­—æ®µé‡Œçš„èµ„æºï¼Œéš¾æ€ªæµè§ˆå™¨ä¼šå¡æ­»ã€‚</p><p><strong>è§£å†³åŠæ³•</strong>ï¼šåœ¨ handleChangeæ–¹æ³•é‡Œï¼Œå›¾ç‰‡ä¸Šä¼ æˆåŠŸåï¼Œå°† thumbUrl å­—æ®µé‡Œé¢çš„ base64 ç¼–ç æ”¹ä¸ºçœŸå®çš„å›¾ç‰‡urlã€‚ä»£ç å®ç°å¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#3c3836;background-color:#fbf1c7;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>  handleChange <span style=color:#af3a03>=</span> ({ file, fileList }) =&gt; {
</span></span><span style=display:flex><span>    console.log(JSON.stringify(file)); <span style=color:#928374;font-style:italic>// file æ˜¯å½“å‰æ­£åœ¨ä¸Šä¼ çš„ å•ä¸ª img
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic></span>    console.log(JSON.stringify(fileList)); <span style=color:#928374;font-style:italic>// fileList æ˜¯å·²ä¸Šä¼ çš„å…¨éƒ¨ img åˆ—è¡¨
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic></span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#928374;font-style:italic>// ã€é‡è¦ã€‘å°† å›¾ç‰‡çš„base64æ›¿æ¢ä¸ºå›¾ç‰‡çš„urlã€‚ è¿™ä¸€è¡Œä¸€å®šä¸ä¼šèƒ½å°‘ã€‚
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic></span>    <span style=color:#928374;font-style:italic>// å›¾ç‰‡ä¸Šä¼ æˆåŠŸåï¼ŒfileListæ•°ç»„ä¸­çš„ thumbUrl ä¸­ä¿å­˜çš„æ˜¯å›¾ç‰‡çš„base64å­—ç¬¦ä¸²ï¼Œè¿™ç§æƒ…å†µï¼Œå¯¼è‡´çš„é—®é¢˜æ˜¯ï¼šå›¾ç‰‡ä¸Šä¼ æˆåŠŸåï¼Œç‚¹å‡»å›¾ç‰‡ç¼©ç•¥å›¾ï¼Œæµè§ˆå™¨ä¼šä¼šå¡æ­»ã€‚è€Œä¸‹é¢è¿™è¡Œä»£ç ï¼Œå¯ä»¥è§£å†³è¯¥bugã€‚
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic></span>    fileList.forEach(imgItem =&gt; {
</span></span><span style=display:flex><span>      <span style=color:#af3a03>if</span> (imgItem <span style=color:#af3a03>&amp;&amp;</span> imgItem.status <span style=color:#af3a03>==</span> <span style=color:#79740e>&#39;done&#39;</span> <span style=color:#af3a03>&amp;&amp;</span> imgItem.response <span style=color:#af3a03>&amp;&amp;</span> imgItem.response.imgUrl) {
</span></span><span style=display:flex><span>        imgItem.thumbUrl <span style=color:#af3a03>=</span> imgItem.response.imgUrl;
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#af3a03>this</span>.setState({
</span></span><span style=display:flex><span>      imgList<span style=color:#af3a03>:</span> fileList,
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>  };
</span></span></code></pre></div><h2 id=æ–°éœ€æ±‚ç¼–è¾‘ç°æœ‰é¡µé¢>æ–°éœ€æ±‚ï¼šç¼–è¾‘ç°æœ‰é¡µé¢<a hidden class=anchor aria-hidden=true href=#æ–°éœ€æ±‚ç¼–è¾‘ç°æœ‰é¡µé¢>#</a></h2><p>ä¸Šé¢ä¸€æ®µçš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬æ˜¯åœ¨æ–°å»ºçš„é¡µé¢ä¸­ï¼Œä»é›¶å¼€å§‹ä¸Šä¼ å›¾ç‰‡ã€‚</p><p>ç°åœ¨æœ‰ä¸ªæ–°çš„éœ€æ±‚ï¼šå¦‚ä½•ç¼–è¾‘ç°æœ‰çš„é¡µé¢å‘¢ï¼Ÿä¹Ÿå°±æ˜¯è¯´ï¼Œç°æœ‰çš„é¡µé¢åœ¨åˆå§‹åŒ–æ—¶ï¼Œæ˜¯é»˜è®¤æœ‰å‡ å¼ å›¾ç‰‡çš„ã€‚å½“æˆ‘ç¼–è¾‘è¿™ä¸ªé¡µé¢æ—¶ï¼Œå¯ä»¥å¯¹ç°æœ‰çš„å›¾ç‰‡åšå¢åˆ ï¼Œä¹Ÿèƒ½å¢åŠ æ–°çš„å›¾ç‰‡ã€‚è€Œä¸”è¦ä¿è¯ï¼šæ–°å»ºé¡µé¢å’Œç¼–è¾‘ç°æœ‰é¡µé¢ï¼Œæ˜¯å…±ç”¨ä¸€å¥—ä»£ç ã€‚</p><p>æˆ‘çœ‹åˆ°upload ç»„ä»¶æœ‰æä¾› <code>defaultFileList</code> çš„å±æ€§ã€‚æˆ‘è¯•äº†ä¸‹ï¼Œè¿™ä¸ª<code>defaultFileList</code> çš„å±æ€§æ ¹æœ¬æ²¡æ³•å„¿ç”¨ã€‚</p><p>é‚£å°±åªæœ‰æ‰‹åŠ¨å®ç°äº†ã€‚æˆ‘çš„modelå±‚ä»£ç ï¼Œæ˜¯ç”¨ redux å†™çš„ã€‚æ•´ä½“çš„å®ç°æ€è·¯å¦‚ä¸‹ï¼šï¼ˆè¿™ä¸ªä¹Ÿæ˜¯åœ¨çœŸæ­£åœ¨å®æˆ˜ä¸­ç”¨åˆ°çš„ä»£ç ï¼‰</p><p>ï¼ˆ1ï¼‰PicturesWall.jsï¼š</p><div class=highlight><pre tabindex=0 style=color:#3c3836;background-color:#fbf1c7;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#928374;font-style:italic>/* eslint-disable */</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#af3a03>import</span> { Upload, Icon, Modal, Form } from <span style=color:#79740e>&#39;antd&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#af3a03>const</span> FormItem <span style=color:#af3a03>=</span> Form.Item;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#af3a03>class</span> PicturesWall <span style=color:#af3a03>extends</span> PureComponent {
</span></span><span style=display:flex><span>  state <span style=color:#af3a03>=</span> {
</span></span><span style=display:flex><span>    previewVisible<span style=color:#af3a03>:</span> <span style=color:#af3a03>false</span>,
</span></span><span style=display:flex><span>    previewImage<span style=color:#af3a03>:</span> <span style=color:#79740e>&#39;&#39;</span>,
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#928374;font-style:italic>// é¡µé¢åˆå§‹åŒ–çš„æ—¶å€™ï¼Œä»æ¥å£æ‹‰å–é»˜è®¤çš„å›¾ç‰‡æ•°æ®
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic></span>  componentDidMount() {
</span></span><span style=display:flex><span>    <span style=color:#af3a03>const</span> { dispatch } <span style=color:#af3a03>=</span> <span style=color:#af3a03>this</span>.props;
</span></span><span style=display:flex><span>    dispatch({
</span></span><span style=display:flex><span>      type<span style=color:#af3a03>:</span> <span style=color:#79740e>&#39;mymodel/getAllInfo&#39;</span>,
</span></span><span style=display:flex><span>      payload<span style=color:#af3a03>:</span> { params<span style=color:#af3a03>:</span> xxx },
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  handleChange <span style=color:#af3a03>=</span> ({ file, fileList }) =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#af3a03>const</span> { dispatch } <span style=color:#af3a03>=</span> <span style=color:#af3a03>this</span>.props;
</span></span><span style=display:flex><span>    <span style=color:#928374;font-style:italic>// ã€é‡è¦ã€‘å°† å›¾ç‰‡çš„base64æ›¿æ¢ä¸ºå›¾ç‰‡çš„urlã€‚ è¿™ä¸€è¡Œä¸€å®šä¸ä¼šèƒ½å°‘ã€‚
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic></span>    <span style=color:#928374;font-style:italic>// å›¾ç‰‡ä¸Šä¼ æˆåŠŸåï¼ŒfileListæ•°ç»„ä¸­çš„ thumbUrl ä¸­ä¿å­˜çš„æ˜¯å›¾ç‰‡çš„base64å­—ç¬¦ä¸²ï¼Œè¿™ç§æƒ…å†µï¼Œå¯¼è‡´çš„é—®é¢˜æ˜¯ï¼šå›¾ç‰‡ä¸Šä¼ æˆåŠŸåï¼Œç‚¹å‡»å›¾ç‰‡ç¼©ç•¥å›¾ï¼Œæµè§ˆå™¨ä¼šä¼šå¡æ­»ã€‚è€Œä¸‹é¢è¿™è¡Œä»£ç ï¼Œå¯ä»¥è§£å†³è¯¥bugã€‚
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic></span>    fileList.forEach(imgItem =&gt; {
</span></span><span style=display:flex><span>      <span style=color:#af3a03>if</span> (imgItem <span style=color:#af3a03>&amp;&amp;</span> imgItem.status <span style=color:#af3a03>==</span> <span style=color:#79740e>&#39;done&#39;</span> <span style=color:#af3a03>&amp;&amp;</span> imgItem.response <span style=color:#af3a03>&amp;&amp;</span> imgItem.response.imgUrl) {
</span></span><span style=display:flex><span>        imgItem.thumbUrl <span style=color:#af3a03>=</span> imgItem.response.imgUrl;
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    dispatch({
</span></span><span style=display:flex><span>      type<span style=color:#af3a03>:</span> <span style=color:#79740e>&#39;mymodel/setImgList&#39;</span>,
</span></span><span style=display:flex><span>      payload<span style=color:#af3a03>:</span> fileList,
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  handleCancel <span style=color:#af3a03>=</span> () =&gt; <span style=color:#af3a03>this</span>.setState({ previewVisible<span style=color:#af3a03>:</span> <span style=color:#af3a03>false</span> });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  handlePreview <span style=color:#af3a03>=</span> file =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#af3a03>this</span>.setState({
</span></span><span style=display:flex><span>      previewImage<span style=color:#af3a03>:</span> file.url <span style=color:#af3a03>||</span> file.thumbUrl,
</span></span><span style=display:flex><span>      previewVisible<span style=color:#af3a03>:</span> <span style=color:#af3a03>true</span>,
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#928374;font-style:italic>// å‚è€ƒé“¾æ¥ï¼šhttps://www.jianshu.com/p/f356f050b3c9
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic></span>  handleBeforeUpload <span style=color:#af3a03>=</span> file =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#928374;font-style:italic>//é™åˆ¶å›¾ç‰‡ æ ¼å¼ã€sizeã€åˆ†è¾¨ç‡
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic></span>    <span style=color:#af3a03>const</span> isJPG <span style=color:#af3a03>=</span> file.type <span style=color:#af3a03>===</span> <span style=color:#79740e>&#39;image/jpeg&#39;</span>;
</span></span><span style=display:flex><span>    <span style=color:#af3a03>const</span> isJPEG <span style=color:#af3a03>=</span> file.type <span style=color:#af3a03>===</span> <span style=color:#79740e>&#39;image/jpeg&#39;</span>;
</span></span><span style=display:flex><span>    <span style=color:#af3a03>const</span> isGIF <span style=color:#af3a03>=</span> file.type <span style=color:#af3a03>===</span> <span style=color:#79740e>&#39;image/gif&#39;</span>;
</span></span><span style=display:flex><span>    <span style=color:#af3a03>const</span> isPNG <span style=color:#af3a03>=</span> file.type <span style=color:#af3a03>===</span> <span style=color:#79740e>&#39;image/png&#39;</span>;
</span></span><span style=display:flex><span>    <span style=color:#af3a03>const</span> isLt2M <span style=color:#af3a03>=</span> file.size <span style=color:#af3a03>/</span> <span style=color:#8f3f71>1024</span> <span style=color:#af3a03>/</span> <span style=color:#8f3f71>1024</span> <span style=color:#af3a03>&lt;</span> <span style=color:#8f3f71>2</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#af3a03>if</span> (<span style=color:#af3a03>!</span>(isJPG <span style=color:#af3a03>||</span> isJPEG <span style=color:#af3a03>||</span> isGIF <span style=color:#af3a03>||</span> isPNG)) {
</span></span><span style=display:flex><span>      Modal.error({
</span></span><span style=display:flex><span>        title<span style=color:#af3a03>:</span> <span style=color:#79740e>&#39;åªèƒ½ä¸Šä¼ JPG ã€JPEG ã€GIFã€ PNGæ ¼å¼çš„å›¾ç‰‡~&#39;</span>,
</span></span><span style=display:flex><span>      });
</span></span><span style=display:flex><span>    } <span style=color:#af3a03>else</span> <span style=color:#af3a03>if</span> (<span style=color:#af3a03>!</span>isLt2M) {
</span></span><span style=display:flex><span>      Modal.error({
</span></span><span style=display:flex><span>        title<span style=color:#af3a03>:</span> <span style=color:#79740e>&#39;è¶…è¿‡2Mé™åˆ¶ï¼Œä¸å…è®¸ä¸Šä¼ ~&#39;</span>,
</span></span><span style=display:flex><span>      });
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#928374;font-style:italic>// å‚è€ƒé“¾æ¥ï¼šhttps://github.com/ant-design/ant-design/issues/8779
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic></span>    <span style=color:#af3a03>return</span> <span style=color:#af3a03>new</span> <span style=color:#b57614>Promise</span>((resolve, reject) =&gt; {
</span></span><span style=display:flex><span>      <span style=color:#af3a03>if</span> (<span style=color:#af3a03>!</span>(isJPG <span style=color:#af3a03>||</span> isJPEG <span style=color:#af3a03>||</span> isGIF <span style=color:#af3a03>||</span> isPNG)) {
</span></span><span style=display:flex><span>        reject(file);
</span></span><span style=display:flex><span>      } <span style=color:#af3a03>else</span> {
</span></span><span style=display:flex><span>        resolve(file <span style=color:#af3a03>&amp;&amp;</span> <span style=color:#af3a03>this</span>.checkImageWH(file));
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#928374;font-style:italic>//è¿”å›ä¸€ä¸ª promiseï¼šæ£€æµ‹é€šè¿‡åˆ™è¿”å›resolveï¼›å¤±è´¥åˆ™è¿”å›rejectï¼Œå¹¶é˜»æ­¢å›¾ç‰‡ä¸Šä¼ 
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic></span>  checkImageWH(file) {
</span></span><span style=display:flex><span>    <span style=color:#af3a03>let</span> self <span style=color:#af3a03>=</span> <span style=color:#af3a03>this</span>;
</span></span><span style=display:flex><span>    <span style=color:#af3a03>return</span> <span style=color:#af3a03>new</span> <span style=color:#b57614>Promise</span>(<span style=color:#af3a03>function</span>(resolve, reject) {
</span></span><span style=display:flex><span>      <span style=color:#af3a03>let</span> filereader <span style=color:#af3a03>=</span> <span style=color:#af3a03>new</span> FileReader();
</span></span><span style=display:flex><span>      filereader.onload <span style=color:#af3a03>=</span> e =&gt; {
</span></span><span style=display:flex><span>        <span style=color:#af3a03>let</span> src <span style=color:#af3a03>=</span> e.target.result;
</span></span><span style=display:flex><span>        <span style=color:#af3a03>const</span> image <span style=color:#af3a03>=</span> <span style=color:#af3a03>new</span> Image();
</span></span><span style=display:flex><span>        image.onload <span style=color:#af3a03>=</span> <span style=color:#af3a03>function</span>() {
</span></span><span style=display:flex><span>          <span style=color:#928374;font-style:italic>// è·å–å›¾ç‰‡çš„å®½é«˜ï¼Œå¹¶å­˜æ”¾åˆ°fileå¯¹è±¡ä¸­
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic></span>          console.log(<span style=color:#79740e>&#39;file width :&#39;</span> <span style=color:#af3a03>+</span> <span style=color:#af3a03>this</span>.width);
</span></span><span style=display:flex><span>          console.log(<span style=color:#79740e>&#39;file height :&#39;</span> <span style=color:#af3a03>+</span> <span style=color:#af3a03>this</span>.height);
</span></span><span style=display:flex><span>          file.width <span style=color:#af3a03>=</span> <span style=color:#af3a03>this</span>.width;
</span></span><span style=display:flex><span>          file.height <span style=color:#af3a03>=</span> <span style=color:#af3a03>this</span>.height;
</span></span><span style=display:flex><span>          resolve();
</span></span><span style=display:flex><span>        };
</span></span><span style=display:flex><span>        image.onerror <span style=color:#af3a03>=</span> reject;
</span></span><span style=display:flex><span>        image.src <span style=color:#af3a03>=</span> src;
</span></span><span style=display:flex><span>      };
</span></span><span style=display:flex><span>      filereader.readAsDataURL(file);
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  handleSubmit <span style=color:#af3a03>=</span> e =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#af3a03>const</span> { dispatch, form } <span style=color:#af3a03>=</span> <span style=color:#af3a03>this</span>.props;
</span></span><span style=display:flex><span>    e.preventDefault();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#af3a03>const</span> {
</span></span><span style=display:flex><span>      mymodel<span style=color:#af3a03>:</span> { imgList }, <span style=color:#928374;font-style:italic>// ä»propsä¸­æ‹¿é»˜è®¤çš„å›¾ç‰‡æ•°æ®
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic></span>    } <span style=color:#af3a03>=</span> <span style=color:#af3a03>this</span>.props;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    form.validateFieldsAndScroll((err, values) =&gt; {
</span></span><span style=display:flex><span>      <span style=color:#928374;font-style:italic>// values æ˜¯formè¡¨å•é‡Œçš„å‚æ•°
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic></span>      <span style=color:#928374;font-style:italic>// ç‚¹å‡»æŒ‰é’®åï¼Œå°†è¡¨å•æäº¤ç»™åå°
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic></span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#928374;font-style:italic>// start é—®é¢˜æè¿°ï¼šå½“ç¼–è¾‘ç°æœ‰é¡µé¢æ—¶ï¼Œå¦‚æœé’ˆå¯¹å·²ç»å­˜åœ¨çš„é»˜è®¤å›¾ç‰‡ä¸åšä¿®æ”¹ï¼Œåˆ™ä¸ä¼šè§¦å‘ upload çš„ onChangeæ–¹æ³•ã€‚æ­¤æ—¶æäº¤è¡¨å•ï¼Œè¡¨å•é‡Œçš„ myImg å­—æ®µæ˜¯ç©ºçš„ã€‚
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic></span>      <span style=color:#928374;font-style:italic>// è§£å†³åŠæ³•ï¼šå¦‚æœå‘ç°å­˜åœ¨é»˜è®¤å›¾ç‰‡ï¼Œåˆ™è¿½åŠ åˆ°è¡¨å•ä¸­
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic></span>      <span style=color:#af3a03>if</span> (<span style=color:#af3a03>!</span>values.myImg) {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        values.myImg <span style=color:#af3a03>=</span> { fileList<span style=color:#af3a03>:</span> [] };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        values.myImg.fileList <span style=color:#af3a03>=</span> imgList;
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>      <span style=color:#928374;font-style:italic>// end
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic></span>
</span></span><span style=display:flex><span>      dispatch({
</span></span><span style=display:flex><span>        type<span style=color:#af3a03>:</span> <span style=color:#79740e>&#39;mymodel/submitFormData&#39;</span>,
</span></span><span style=display:flex><span>        payload<span style=color:#af3a03>:</span> values,
</span></span><span style=display:flex><span>      });
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  render() {
</span></span><span style=display:flex><span>    <span style=color:#af3a03>const</span> { previewVisible, previewImage } <span style=color:#af3a03>=</span> <span style=color:#af3a03>this</span>.state; <span style=color:#928374;font-style:italic>//  ä» state ä¸­æ‹¿æ•°æ®
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic></span>
</span></span><span style=display:flex><span>    <span style=color:#af3a03>const</span> {
</span></span><span style=display:flex><span>      mymodel<span style=color:#af3a03>:</span> { imgList }, <span style=color:#928374;font-style:italic>// ä»propsä¸­æ‹¿åˆ°çš„å›¾ç‰‡æ•°æ®
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic></span>    } <span style=color:#af3a03>=</span> <span style=color:#af3a03>this</span>.props;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#af3a03>const</span> uploadButton <span style=color:#af3a03>=</span> (
</span></span><span style=display:flex><span>      <span style=color:#af3a03>&lt;</span>div<span style=color:#af3a03>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#af3a03>&lt;</span>Icon type<span style=color:#af3a03>=</span><span style=color:#79740e>&#34;plus&#34;</span> <span style=color:#af3a03>/&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#af3a03>&lt;</span>div className<span style=color:#af3a03>=</span><span style=color:#79740e>&#34;ant-upload-text&#34;</span><span style=color:#af3a03>&gt;</span>Upload<span style=color:#af3a03>&lt;</span>/div&gt;
</span></span><span style=display:flex><span>      <span style=color:#af3a03>&lt;</span>/div&gt;
</span></span><span style=display:flex><span>    );
</span></span><span style=display:flex><span>    <span style=color:#af3a03>return</span> (
</span></span><span style=display:flex><span>      <span style=color:#af3a03>&lt;</span>div className<span style=color:#af3a03>=</span><span style=color:#79740e>&#34;clearfix&#34;</span><span style=color:#af3a03>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#af3a03>&lt;</span>Form onSubmit<span style=color:#af3a03>=</span>{<span style=color:#af3a03>this</span>.handleSubmit} hideRequiredMark style<span style=color:#af3a03>=</span>{{ marginTop<span style=color:#af3a03>:</span> <span style=color:#8f3f71>8</span> }}<span style=color:#af3a03>&gt;</span>
</span></span><span style=display:flex><span>          <span style=color:#af3a03>&lt;</span>FormItem label<span style=color:#af3a03>=</span><span style=color:#79740e>&#34;å›¾ç‰‡ä¸Šä¼ &#34;</span> {...formItemLayout}<span style=color:#af3a03>&gt;</span>
</span></span><span style=display:flex><span>            {getFieldDecorator(<span style=color:#79740e>&#39;myImg&#39;</span>)(
</span></span><span style=display:flex><span>              <span style=color:#af3a03>&lt;</span>Upload
</span></span><span style=display:flex><span>                action<span style=color:#af3a03>=</span><span style=color:#79740e>&#34;//jsonplaceholder.typicode.com/posts/&#34;</span> <span style=color:#928374;font-style:italic>// è¿™ä¸ªæ˜¯å›¾ç‰‡ä¸Šä¼ çš„æ¥å£è¯·æ±‚ï¼Œå®é™…å¼€å‘ä¸­ï¼Œè¦æ›¿æ¢æˆä½ è‡ªå·±çš„ä¸šåŠ¡æ¥å£
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic></span>                data<span style=color:#af3a03>=</span>{file =&gt; ({
</span></span><span style=display:flex><span>                  <span style=color:#928374;font-style:italic>// dataé‡Œå­˜æ”¾çš„æ˜¯æ¥å£çš„è¯·æ±‚å‚æ•°
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic></span>                  param1<span style=color:#af3a03>:</span> myParam1,
</span></span><span style=display:flex><span>                  param2<span style=color:#af3a03>:</span> myParam2,
</span></span><span style=display:flex><span>                  photoCotent<span style=color:#af3a03>:</span> file, <span style=color:#928374;font-style:italic>// file æ˜¯å½“å‰æ­£åœ¨ä¸Šä¼ çš„å›¾ç‰‡
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic></span>                  photoWidth<span style=color:#af3a03>:</span> file.height, <span style=color:#928374;font-style:italic>// é€šè¿‡  handleBeforeUpload è·å– å›¾ç‰‡çš„å®½é«˜
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic></span>                  photoHeight<span style=color:#af3a03>:</span> file.width,
</span></span><span style=display:flex><span>                })}
</span></span><span style=display:flex><span>                listType<span style=color:#af3a03>=</span><span style=color:#79740e>&#34;picture-card&#34;</span>
</span></span><span style=display:flex><span>                fileList<span style=color:#af3a03>=</span>{imgList}  <span style=color:#928374;font-style:italic>// æ”¹ä¸ºä» props é‡Œæ‹¿å›¾ç‰‡æ•°æ®ï¼Œè€Œä¸æ˜¯ä» state
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic></span>                onPreview<span style=color:#af3a03>=</span>{<span style=color:#af3a03>this</span>.handlePreview} <span style=color:#928374;font-style:italic>// ç‚¹å‡»å›¾ç‰‡ç¼©ç•¥å›¾ï¼Œè¿›è¡Œé¢„è§ˆ
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic></span>                beforeUpload<span style=color:#af3a03>=</span>{<span style=color:#af3a03>this</span>.handleBeforeUpload} <span style=color:#928374;font-style:italic>// ä¸Šä¼ ä¹‹å‰ï¼Œå¯¹å›¾ç‰‡çš„æ ¼å¼åšæ ¡éªŒï¼Œå¹¶è·å–å›¾ç‰‡çš„å®½é«˜
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic></span>                onChange<span style=color:#af3a03>=</span>{<span style=color:#af3a03>this</span>.handleChange} <span style=color:#928374;font-style:italic>// æ¯æ¬¡ä¸Šä¼ å›¾ç‰‡æ—¶ï¼Œéƒ½ä¼šè§¦å‘è¿™ä¸ªæ–¹æ³•
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic></span>              <span style=color:#af3a03>&gt;</span>
</span></span><span style=display:flex><span>                {<span style=color:#af3a03>this</span>.state.imgList.length <span style=color:#af3a03>&gt;=</span> <span style=color:#8f3f71>9</span> <span style=color:#af3a03>?</span> <span style=color:#af3a03>null</span> <span style=color:#af3a03>:</span> uploadButton}
</span></span><span style=display:flex><span>              <span style=color:#af3a03>&lt;</span>/Upload&gt;
</span></span><span style=display:flex><span>            )}
</span></span><span style=display:flex><span>          <span style=color:#af3a03>&lt;</span>/FormItem&gt;
</span></span><span style=display:flex><span>        <span style=color:#af3a03>&lt;</span>/Form&gt;
</span></span><span style=display:flex><span>        <span style=color:#af3a03>&lt;</span>Modal visible<span style=color:#af3a03>=</span>{previewVisible} footer<span style=color:#af3a03>=</span>{<span style=color:#af3a03>null</span>} onCancel<span style=color:#af3a03>=</span>{<span style=color:#af3a03>this</span>.handleCancel}<span style=color:#af3a03>&gt;</span>
</span></span><span style=display:flex><span>          <span style=color:#af3a03>&lt;</span>img alt<span style=color:#af3a03>=</span><span style=color:#79740e>&#34;example&#34;</span> style<span style=color:#af3a03>=</span>{{ width<span style=color:#af3a03>:</span> <span style=color:#79740e>&#39;100%&#39;</span> }} src<span style=color:#af3a03>=</span>{previewImage} <span style=color:#af3a03>/&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#af3a03>&lt;</span>/Modal&gt;
</span></span><span style=display:flex><span>      <span style=color:#af3a03>&lt;</span>/div&gt;
</span></span><span style=display:flex><span>    );
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#af3a03>export</span> <span style=color:#af3a03>default</span> PicturesWall;
</span></span></code></pre></div><p>ï¼ˆ2ï¼‰mymodel.js:</p><div class=highlight><pre tabindex=0 style=color:#3c3836;background-color:#fbf1c7;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#928374;font-style:italic>/* eslint-disable */</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#af3a03>import</span> { routerRedux } from <span style=color:#79740e>&#39;dva/router&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#af3a03>import</span> { message, Modal } from <span style=color:#79740e>&#39;antd&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#af3a03>import</span> {
</span></span><span style=display:flex><span>  getGoodsInfo,
</span></span><span style=display:flex><span>  getAllGoods,
</span></span><span style=display:flex><span>} from <span style=color:#79740e>&#39;../services/api&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#af3a03>import</span> { trim, getCookie } from <span style=color:#79740e>&#39;../utils/utils&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#af3a03>export</span> <span style=color:#af3a03>default</span> {
</span></span><span style=display:flex><span>  namespace<span style=color:#af3a03>:</span> <span style=color:#79740e>&#39;mymodel&#39;</span>,
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  state<span style=color:#af3a03>:</span> {
</span></span><span style=display:flex><span>    form<span style=color:#af3a03>:</span> {},
</span></span><span style=display:flex><span>    list<span style=color:#af3a03>:</span> [],
</span></span><span style=display:flex><span>    listDetail<span style=color:#af3a03>:</span> [],
</span></span><span style=display:flex><span>    goodsList<span style=color:#af3a03>:</span> [],
</span></span><span style=display:flex><span>    goodsListDetail<span style=color:#af3a03>:</span> [],
</span></span><span style=display:flex><span>    pagination<span style=color:#af3a03>:</span> {
</span></span><span style=display:flex><span>      pageSize<span style=color:#af3a03>:</span> <span style=color:#8f3f71>10</span>,
</span></span><span style=display:flex><span>      total<span style=color:#af3a03>:</span> <span style=color:#8f3f71>0</span>,
</span></span><span style=display:flex><span>      current<span style=color:#af3a03>:</span> <span style=color:#8f3f71>1</span>,
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    imgList<span style=color:#af3a03>:</span> [], <span style=color:#928374;font-style:italic>//å›¾ç‰‡
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic></span>  },
</span></span><span style=display:flex><span>  subscriptions<span style=color:#af3a03>:</span> {
</span></span><span style=display:flex><span>    setup({ dispatch, history }) {
</span></span><span style=display:flex><span>      history.listen(location =&gt; {
</span></span><span style=display:flex><span>        <span style=color:#af3a03>if</span> (location.pathname <span style=color:#af3a03>!==</span> <span style=color:#79740e>&#39;/xx/xxx&#39;</span>) <span style=color:#af3a03>return</span>;
</span></span><span style=display:flex><span>        <span style=color:#af3a03>if</span> (<span style=color:#af3a03>!</span>location.state <span style=color:#af3a03>||</span> <span style=color:#af3a03>!</span>location.state.xxxId) <span style=color:#af3a03>return</span>;
</span></span><span style=display:flex><span>        dispatch({
</span></span><span style=display:flex><span>          type<span style=color:#af3a03>:</span> <span style=color:#79740e>&#39;fetch&#39;</span>,
</span></span><span style=display:flex><span>          payload<span style=color:#af3a03>:</span> location.state,
</span></span><span style=display:flex><span>        });
</span></span><span style=display:flex><span>      });
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  effects<span style=color:#af3a03>:</span> {
</span></span><span style=display:flex><span>    <span style=color:#928374;font-style:italic>// æ¥å£ã€‚è·å–æ‰€æœ‰å·¥å‚åº—çš„åˆ—è¡¨ (æ­¥éª¤02)
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic></span>    <span style=color:#af3a03>*</span>getAllInfo({ payload }, { select, call, put }) {
</span></span><span style=display:flex><span>      <span style=color:#af3a03>yield</span> put({
</span></span><span style=display:flex><span>        type<span style=color:#af3a03>:</span> <span style=color:#79740e>&#39;form&#39;</span>,
</span></span><span style=display:flex><span>        payload,
</span></span><span style=display:flex><span>      });
</span></span><span style=display:flex><span>      console.log(<span style=color:#79740e>&#39;params:&#39;</span> <span style=color:#af3a03>+</span> JSON.stringify(payload));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#af3a03>let</span> params <span style=color:#af3a03>=</span> {};
</span></span><span style=display:flex><span>      params <span style=color:#af3a03>=</span> payload;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#af3a03>const</span> response <span style=color:#af3a03>=</span> <span style=color:#af3a03>yield</span> call(getGoodsInfo, params);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      console.log(<span style=color:#79740e>&#39;smyhvae response:&#39;</span> <span style=color:#af3a03>+</span> JSON.stringify(response));
</span></span><span style=display:flex><span>      <span style=color:#af3a03>if</span> (response.error) <span style=color:#af3a03>return</span>;
</span></span><span style=display:flex><span>      <span style=color:#af3a03>yield</span> put({
</span></span><span style=display:flex><span>        type<span style=color:#af3a03>:</span> <span style=color:#79740e>&#39;allInfo&#39;</span>,
</span></span><span style=display:flex><span>        payload<span style=color:#af3a03>:</span>
</span></span><span style=display:flex><span>          (response.data <span style=color:#af3a03>&amp;&amp;</span>
</span></span><span style=display:flex><span>            response.data.map(item =&gt; ({
</span></span><span style=display:flex><span>              xx1<span style=color:#af3a03>:</span> item.yy1,
</span></span><span style=display:flex><span>              xx2<span style=color:#af3a03>:</span> item.yy2,
</span></span><span style=display:flex><span>            }))) <span style=color:#af3a03>||</span>
</span></span><span style=display:flex><span>          [],
</span></span><span style=display:flex><span>      });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#928374;font-style:italic>// response é‡ŒåŒ…å«äº†æ¥å£è¿”å›ç»™å‰ç«¯çš„é»˜è®¤å›¾ç‰‡æ•°æ®
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic></span>      <span style=color:#af3a03>if</span> (response <span style=color:#af3a03>&amp;&amp;</span> response.data <span style=color:#af3a03>&amp;&amp;</span> response.data[<span style=color:#8f3f71>0</span>] <span style=color:#af3a03>&amp;&amp;</span> response.data[<span style=color:#8f3f71>0</span>].my_jpg) {
</span></span><span style=display:flex><span>        <span style=color:#af3a03>let</span> tempImgList <span style=color:#af3a03>=</span> response.data[<span style=color:#8f3f71>0</span>].my_jpg.split(<span style=color:#79740e>&#39;,&#39;</span>);
</span></span><span style=display:flex><span>        <span style=color:#af3a03>let</span> imgList <span style=color:#af3a03>=</span> [];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#af3a03>if</span> (tempImgList.length <span style=color:#af3a03>&gt;</span> <span style=color:#8f3f71>0</span>) {
</span></span><span style=display:flex><span>          tempImgList.forEach(item =&gt; {
</span></span><span style=display:flex><span>            imgList.push({
</span></span><span style=display:flex><span>              uid<span style=color:#af3a03>:</span> item,
</span></span><span style=display:flex><span>              name<span style=color:#af3a03>:</span> <span style=color:#79740e>&#39;xxx.png&#39;</span>,
</span></span><span style=display:flex><span>              status<span style=color:#af3a03>:</span> <span style=color:#79740e>&#39;done&#39;</span>,
</span></span><span style=display:flex><span>              thumbUrl<span style=color:#af3a03>:</span> item,
</span></span><span style=display:flex><span>            });
</span></span><span style=display:flex><span>          });
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#928374;font-style:italic>// é€šè¿‡  reduxçš„æ–¹å¼ å°† é»˜è®¤å›¾ç‰‡ ä¼ ç»™ imgList
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic></span>        console.log(<span style=color:#79740e>&#39;smyhvae payload imgList:&#39;</span> <span style=color:#af3a03>+</span> JSON.stringify(imgList));
</span></span><span style=display:flex><span>        <span style=color:#af3a03>yield</span> put({
</span></span><span style=display:flex><span>          type<span style=color:#af3a03>:</span> <span style=color:#79740e>&#39;setImgList&#39;</span>,
</span></span><span style=display:flex><span>          payload<span style=color:#af3a03>:</span> imgList,
</span></span><span style=display:flex><span>        });
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#af3a03>*</span>setImgList({ payload }, { call, put }) {
</span></span><span style=display:flex><span>      console.log(<span style=color:#79740e>&#39;model setImgList&#39;</span>);
</span></span><span style=display:flex><span>      <span style=color:#af3a03>yield</span> put({
</span></span><span style=display:flex><span>        type<span style=color:#af3a03>:</span> <span style=color:#79740e>&#39;getImgList&#39;</span>,
</span></span><span style=display:flex><span>        payload,
</span></span><span style=display:flex><span>      });
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  reducers<span style=color:#af3a03>:</span> {
</span></span><span style=display:flex><span>    allInfo(state, action) {
</span></span><span style=display:flex><span>      <span style=color:#af3a03>return</span> {
</span></span><span style=display:flex><span>        ...state,
</span></span><span style=display:flex><span>        list<span style=color:#af3a03>:</span> action.payload,
</span></span><span style=display:flex><span>      };
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    getImgList(state, action) {
</span></span><span style=display:flex><span>      <span style=color:#af3a03>return</span> {
</span></span><span style=display:flex><span>        ...state,
</span></span><span style=display:flex><span>        imgList<span style=color:#af3a03>:</span> action.payload,
</span></span><span style=display:flex><span>      };
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><p>ä¸Šé¢çš„ä»£ç ï¼Œå¯ä»¥è§„é¿ upload ç»„ä»¶çš„ä¸€äº›bugï¼›è€Œä¸”å¯ä»¥åœ¨ä¸Šä¼ å‰ï¼Œé€šè¿‡æ ¡éªŒå›¾ç‰‡çš„å°ºå¯¸ã€å¤§å°ç­‰ï¼Œå¦‚æœä¸æ»¡è¶³æ¡ä»¶ï¼Œåˆ™å¼¹å‡ºmodalå¼¹çª—ï¼Œé˜»æ­¢ä¸Šä¼ ã€‚</p><p>å¤§åŠŸå‘Šæˆã€‚æœ¬æ–‡æ„Ÿè°¢ ld åŒå­¦çš„æ”¯æŒã€‚</p><p>æ›´å¤šå†…å®¹ï¼Œå¯ä»¥çœ‹æœ¬äººçš„å¦å¤–ä¸€ç¯‡æ–‡ç« ï¼š</p><ul><li><a href=https://www.cnblogs.com/qianguyihao/p/13093592.html>AntDæ¡†æ¶çš„uploadç»„ä»¶ä¸Šä¼ å›¾ç‰‡æ—¶ä½¿ç”¨customRequestæ–¹æ³•è‡ªå®šä¹‰ä¸Šä¼ è¡Œä¸º</a></li></ul><h2 id=å…¶ä»–é—®é¢˜>å…¶ä»–é—®é¢˜<a hidden class=anchor aria-hidden=true href=#å…¶ä»–é—®é¢˜>#</a></h2><ul><li><a href=https://github.com/ant-design/ant-design/issues/8779>beforeUploadè¿”å›falseåï¼Œæ–‡ä»¶ä»ç„¶ä¸ºä¸Šä¼ ä¸­çš„çŠ¶æ€</a></li></ul><h2 id=æœ€åä¸€æ®µ>æœ€åä¸€æ®µ<a hidden class=anchor aria-hidden=true href=#æœ€åä¸€æ®µ>#</a></h2><p>æœ‰äººè¯´ï¼Œå‰ç«¯å¼€å‘ï¼Œè¿å–èœçš„éƒ½ä¼šã€‚å¯å¦‚æœçœŸçš„é‡åˆ°æŠ€æœ¯éš¾é¢˜ï¼Œè¿˜æ˜¯å¾—æ‰¾ä¸ªé è°±çš„å‰ç«¯åŒå­¦æ‰è¡Œã€‚è¿™ä¸ï¼Œæ¥çœ‹çœ‹å‰ç«¯ç å†œæ—¥å¸¸ï¼š</p><p><img loading=lazy src=http://img.smyhvae.com/20190302_1339_2.png alt></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://bablvsj.github.io/tags/ant-design/>Ant Design</a></li></ul><nav class=paginav><a class=prev href=https://bablvsj.github.io/posts/tech/wait/04-javascript/08-%E8%BF%90%E7%AE%97%E7%AC%A6/><span class=title>Â« Prev</span><br><span>08-è¿ç®—ç¬¦</span></a>
<a class=next href=https://bablvsj.github.io/posts/tech/wait/04-javascript/09-%E5%86%85%E7%BD%AE%E5%AF%B9%E8%B1%A1%E6%89%A9%E5%B1%95set%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/><span class=title>Next Â»</span><br><span>09-å†…ç½®å¯¹è±¡æ‰©å±•ï¼šSetæ•°æ®ç»“æ„</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://bablvsj.github.io>Bablvsj's Blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span><div class=flex-c-d><a class=flex-d-c href="https://www.upyun.com/?utm_source=lianmeng&utm_medium=referral" target=_blank><span>æœ¬ç«™ç”±</span><img width=60 src=/images/upyun.png>æä¾›CDNåŠ é€Ÿ/äº‘å­˜å‚¨æœåŠ¡</a></div></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>