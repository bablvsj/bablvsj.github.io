<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>10-AntDæ¡†æ¶çš„uploadç»„ä»¶ä¸Šä¼ å›¾ç‰‡æ—¶ä½¿ç”¨customRequestæ–¹æ³•è‡ªå®šä¹‰ä¸Šä¼ è¡Œä¸º | Bablvsj's Blog</title><meta name=keywords content="Ant Design"><meta name=description content="10-AntDæ¡†æ¶çš„uploadç»„ä»¶ä¸Šä¼ å›¾ç‰‡æ—¶ä½¿ç”¨customRequestæ–¹æ³•è‡ªå®šä¹‰ä¸Šä¼ è¡Œä¸º - Bablvsj's Blog"><meta name=author content><link rel=canonical href=https://bablvsj.github.io/posts/tech/wait/12-react%E5%9F%BA%E7%A1%80/10-antd%E6%A1%86%E6%9E%B6%E7%9A%84upload%E7%BB%84%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%9B%BE%E7%89%87%E6%97%B6%E4%BD%BF%E7%94%A8customrequest%E6%96%B9%E6%B3%95%E8%87%AA%E5%AE%9A%E4%B9%89%E4%B8%8A%E4%BC%A0%E8%A1%8C%E4%B8%BA/><link crossorigin=anonymous href=/assets/css/stylesheet.b33b75c69bb2ec0d4accfeaad1d3ba05b272f180583f687c640a522d6492076f.css integrity="sha256-szt1xpuy7A1KzP6q0dO6BbJy8YBYP2h8ZApSLWSSB28=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://bablvsj.github.io/img/Q.gif><link rel=icon type=image/png sizes=16x16 href=https://bablvsj.github.io/img/Q.gif><link rel=icon type=image/png sizes=32x32 href=https://bablvsj.github.io/img/Q.gif><link rel=apple-touch-icon href=https://bablvsj.github.io/Q.gif><link rel=mask-icon href=https://bablvsj.github.io/Q.gif><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=stylesheet href=/css/syntax.css><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="10-AntDæ¡†æ¶çš„uploadç»„ä»¶ä¸Šä¼ å›¾ç‰‡æ—¶ä½¿ç”¨customRequestæ–¹æ³•è‡ªå®šä¹‰ä¸Šä¼ è¡Œä¸º"><meta property="og:description" content><meta property="og:type" content="article"><meta property="og:url" content="https://bablvsj.github.io/posts/tech/wait/12-react%E5%9F%BA%E7%A1%80/10-antd%E6%A1%86%E6%9E%B6%E7%9A%84upload%E7%BB%84%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%9B%BE%E7%89%87%E6%97%B6%E4%BD%BF%E7%94%A8customrequest%E6%96%B9%E6%B3%95%E8%87%AA%E5%AE%9A%E4%B9%89%E4%B8%8A%E4%BC%A0%E8%A1%8C%E4%B8%BA/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-01-01T17:11:35+08:00"><meta property="article:modified_time" content="2020-01-01T17:11:35+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="10-AntDæ¡†æ¶çš„uploadç»„ä»¶ä¸Šä¼ å›¾ç‰‡æ—¶ä½¿ç”¨customRequestæ–¹æ³•è‡ªå®šä¹‰ä¸Šä¼ è¡Œä¸º"><meta name=twitter:description content><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"æ–‡ç« ","item":"https://bablvsj.github.io/posts/"},{"@type":"ListItem","position":3,"name":"10-AntDæ¡†æ¶çš„uploadç»„ä»¶ä¸Šä¼ å›¾ç‰‡æ—¶ä½¿ç”¨customRequestæ–¹æ³•è‡ªå®šä¹‰ä¸Šä¼ è¡Œä¸º","item":"https://bablvsj.github.io/posts/tech/wait/12-react%E5%9F%BA%E7%A1%80/10-antd%E6%A1%86%E6%9E%B6%E7%9A%84upload%E7%BB%84%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%9B%BE%E7%89%87%E6%97%B6%E4%BD%BF%E7%94%A8customrequest%E6%96%B9%E6%B3%95%E8%87%AA%E5%AE%9A%E4%B9%89%E4%B8%8A%E4%BC%A0%E8%A1%8C%E4%B8%BA/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"10-AntDæ¡†æ¶çš„uploadç»„ä»¶ä¸Šä¼ å›¾ç‰‡æ—¶ä½¿ç”¨customRequestæ–¹æ³•è‡ªå®šä¹‰ä¸Šä¼ è¡Œä¸º","name":"10-AntDæ¡†æ¶çš„uploadç»„ä»¶ä¸Šä¼ å›¾ç‰‡æ—¶ä½¿ç”¨customRequestæ–¹æ³•è‡ªå®šä¹‰ä¸Šä¼ è¡Œä¸º","description":"","keywords":["Ant Design"],"articleBody":"æœ¬æ¬¡åšåå°ç®¡ç†ç³»ç»Ÿï¼Œé‡‡ç”¨çš„æ˜¯ AntD æ¡†æ¶ã€‚æ¶‰åŠåˆ°å›¾ç‰‡çš„ä¸Šä¼ ï¼Œç”¨çš„æ˜¯AntDçš„ upload ç»„ä»¶ã€‚\næˆ‘åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ã€Šå‰ç«¯AntDæ¡†æ¶çš„uploadç»„ä»¶ä¸Šä¼ å›¾ç‰‡æ—¶é‡åˆ°çš„ä¸€äº›å‘ã€‹ä¸­è®²åˆ°ï¼šAntD çš„ upload ç»„ä»¶æœ‰å¾ˆå¤šå‘ï¼Œå¼•èµ·äº†å¾ˆå¤šäººçš„å…³æ³¨ã€‚æŠ˜è…¾è¿‡çš„äººï¼Œè‡ªç„¶æ˜ç™½å…¶ä¸­çš„è‹¦æ¥šã€‚\nä»Šå¤©è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬ç»§ç»­æ¥ç ”ç©¶ AntD çš„ upload ç»„ä»¶çš„å¦ä¸€ä¸ªå‘ã€‚\nå¤‡æ³¨ï¼šæœ¬æ–‡å†™äº2020-06-11ï¼Œä½¿ç”¨çš„ antd ç‰ˆæœ¬æ˜¯ 3.13.6ã€‚\nä½¿ç”¨ AntD çš„ upload ç»„ä»¶åšå›¾ç‰‡çš„ä¸Šä¼ ï¼Œæ•ˆæœæ¼”ç¤º å› ä¸ºéœ€è¦ä¸Šä¼ å¤šå¼ å›¾ç‰‡ï¼Œæ‰€ä»¥é‡‡ç”¨çš„æ˜¯ç…§ç‰‡å¢™çš„å½¢å¼ã€‚ä¸Šä¼ æˆåŠŸåçš„ç•Œé¢å¦‚ä¸‹ï¼š\nï¼ˆ1ï¼‰ä¸Šä¼ ä¸­ï¼š\nï¼ˆ2ï¼‰ä¸Šä¼ æˆåŠŸï¼š\nï¼ˆ3ï¼‰å›¾ç‰‡é¢„è§ˆï¼š\nä»£ç å®ç° é¦–å…ˆï¼Œä½ éœ€è¦è®©åå°åŒå­¦æä¾›å¥½å›¾ç‰‡ä¸Šä¼ çš„æ¥å£ã€‚ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬æ˜¯æŠŠæ¥å£è°ƒç”¨ç›´æ¥å†™åœ¨äº† æ ‡ç­¾çš„ action å±æ€§å½“ä¸­ã€‚ä½†å¦‚æœä½ åœ¨è°ƒæ¥å£çš„æ—¶å€™ï¼ŒåŠ¨ä½œå¾ˆå¤æ‚ï¼ˆæ¯”å¦‚æ ¹æ®ä¸šåŠ¡è¦æ±‚ï¼Œéœ€è¦è¿ç»­è°ƒä¸¤ä¸ªæ¥å£æ‰èƒ½ä¸Šä¼ å›¾ç‰‡ï¼Œæˆ–è€…åœ¨è°ƒæ¥å£æ—¶è¿˜è¦åšå…¶ä»–çš„äº‹æƒ…ï¼‰ï¼Œè¿™ä¸ª action æ–¹æ³•å°±æ— æ³•æ»¡è¶³éœ€æ±‚äº†ã€‚é‚£è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿ\nå¥½åœ¨ AntD çš„ upload ç»„ä»¶ç»™æˆ‘ä»¬æä¾›äº† customRequestè¿™ä¸ªæ–¹æ³•ï¼š\nå…³äºcustomRequest è¿™ä¸ªæ–¹æ³•ï¼Œ AntD å®˜æ–¹å¹¶æ²¡æœ‰ç»™å‡ºç¤ºä¾‹ï¼Œä»–ä»¬åªæ˜¯åœ¨ GitHub ä¸Šç»™å‡ºäº†è¿™æ ·ä¸€ä¸ªç®€çŸ­çš„ä»‹ç»ï¼š\nä½†è¿™ä¸ªæ–¹æ³•æ€ä¹ˆç”¨å‘¢ï¼Ÿç”¨çš„æ—¶å€™ï¼Œä¼šé‡åˆ°ä»€ä¹ˆé—®é¢˜å‘¢ï¼ŸAntD å®˜æ–¹æ²¡æœ‰è¯´ã€‚æˆ‘åœ¨ç½‘ä¸Šæœäº†åŠå¤©ï¼Œä¹Ÿæ²¡çœ‹åˆ°æ¯”è¾ƒå®Œæ•´çš„ã€åˆ‡å®å¯è¡Œçš„ Demoã€‚æˆ‘å¤©æœåœ°å¤§ç‰©åšï¼Œç½‘ç»œèµ„æ–™æµ©å¦‚çƒŸæµ·ï¼ŒAntD å¯æ˜¯å£å£å£°å£°è¢«äººä»¬å·ç§°æ˜¯å¤©æœæœ€å¥½ç”¨çš„ç®¡ç†åå°çš„æ ·å¼æ¡†æ¶ã€‚å¯å¦‚ä»Šï¼Œå´é¢ä¸´è¿™æ ·çš„å±€é¢ã€‚æˆ‘çœ‹ç€ä½ ä»¬ï¼Œæ»¡æ€€ç¾¡æ…•ã€‚\næ—¢ç„¶å¦‚æ­¤ï¼Œé‚£æˆ‘å°±è‡ªå·±ç ”ç©¶å§ã€‚æŠ˜è…¾äº†ä¸€å¤©ï¼Œæ€»ç®—æ˜¯æŠŠ customRequest çš„å‘è¸©å¾—å·®ä¸å¤šäº†ã€‚\nå•¥ä¹Ÿä¸è¯´äº†ï¼Œç›´æ¥ä¸Šä»£ç ã€‚\né‡‡ç”¨ AntDæ¡†æ¶çš„ upload ç»„ä»¶çš„ customRequest æ–¹æ³•ï¼Œè‡ªå®šä¹‰ä¸Šä¼ è¡Œä¸ºã€‚æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š\nimport React, { PureComponent } from 'react'; import { Button, Card, Form, message, Upload, Icon, Modal, Row, Col } from 'antd'; import { connect } from 'dva'; import { queryMyData, submitData } from '../api'; import { uploadImage } from '../../utils/wq.img.upload'; import styles from '../../utils/form.less'; const FormItem = Form.Item; @Form.create() export default class PicturesWall extends PureComponent { constructor(props) { super(props); const { id } = this.props.match.params; this.state = { id, img: undefined, // ä»æ¥å£æ‹¿åˆ°çš„å›¾ç‰‡å­—æ®µ imgList: [], // å±•ç¤ºåœ¨ antdå›¾ç‰‡ç»„ä»¶ä¸Šçš„æ•°æ® previewVisible: false, previewImage: '', }; } componentDidMount() { const { id } = this.state; id \u0026\u0026 this.queryData(); } // è°ƒæ¥å£ï¼ŒæŸ¥è¯¢å·²æœ‰çš„æ•°æ® queryData() { const { id } = this.state; queryMyData({ id, }) .then(({ ret, data }) =\u003e { if (ret == 0 \u0026\u0026 data \u0026\u0026 data.list \u0026\u0026 data.list.length) { const item = data.list[0]; const img = data.img; const imgList = item.img ? [ { uid: '1', // æ³¨æ„ï¼Œè¿™ä¸ªuidä¸€å®šä¸èƒ½å°‘ï¼Œå¦åˆ™å±•ç¤ºå¤±è´¥ name: 'hehe.png', status: 'done', url: img, }, ] : []; this.setState({ img, imgList, }); } else { return Promise.reject(); } }) .catch(() =\u003e { message.error('æŸ¥è¯¢å‡ºé”™ï¼Œè¯·é‡è¯•'); }); } handleCancel = () =\u003e this.setState({ previewVisible: false }); // æ–¹æ³•ï¼šå›¾ç‰‡é¢„è§ˆ handlePreview = (file) =\u003e { console.log('smyhvae handlePreview:' + JSON.stringify(file)); this.setState({ previewImage: file.url || file.thumbUrl, previewVisible: true, }); }; // å‚è€ƒé“¾æ¥ï¼šhttps://www.jianshu.com/p/f356f050b3c9 handleBeforeUpload = (file) =\u003e { console.log('smyhvae handleBeforeUpload file:' + JSON.stringify(file)); console.log('smyhvae handleBeforeUpload file.file:' + JSON.stringify(file.file)); console.log('smyhvae handleBeforeUpload file type:' + JSON.stringify(file.type)); //é™åˆ¶å›¾ç‰‡ æ ¼å¼ã€sizeã€åˆ†è¾¨ç‡ const isJPG = file.type === 'image/jpeg'; const isJPEG = file.type === 'image/jpeg'; const isGIF = file.type === 'image/gif'; const isPNG = file.type === 'image/png'; const isLt2M = file.size / 1024 / 1024 \u003c 1; if (!(isJPG || isJPEG || isPNG)) { Modal.error({ title: 'åªèƒ½ä¸Šä¼ JPGã€JPEGã€PNGæ ¼å¼çš„å›¾ç‰‡~', }); } else if (!isLt2M) { Modal.error({ title: 'å›¾ç‰‡è¶…è¿‡1Mé™åˆ¶ï¼Œä¸å…è®¸ä¸Šä¼ ~', }); } return (isJPG || isJPEG || isPNG) \u0026\u0026 isLt2M; }; // checkImageWH è¿”å›ä¸€ä¸ªpromise æ£€æµ‹é€šè¿‡è¿”å›resolve å¤±è´¥è¿”å›rejecté˜»æ­¢å›¾ç‰‡ä¸Šä¼  checkImageWH(file) { return new Promise(function (resolve, reject) { let filereader = new FileReader(); filereader.onload = (e) =\u003e { let src = e.target.result; const image = new Image(); image.onload = function () { // è·å–å›¾ç‰‡çš„å®½é«˜ file.width = this.width; file.height = this.height; resolve(); }; image.onerror = reject; image.src = src; }; filereader.readAsDataURL(file); }); } // å›¾ç‰‡ä¸Šä¼  doImgUpload = (options) =\u003e { const { onSuccess, onError, file, onProgress } = options; // startï¼šè¿›åº¦æ¡ç›¸å…³ // ä¼ªè£…æˆ handleChangeé‡Œé¢çš„å›¾ç‰‡ä¸Šä¼ çŠ¶æ€ const imgItem = { uid: '1', // æ³¨æ„ï¼Œè¿™ä¸ªuidä¸€å®šä¸èƒ½å°‘ï¼Œå¦åˆ™ä¸Šä¼ å¤±è´¥ name: 'hehe.png', status: 'uploading', url: '', percent: 99, // æ³¨æ„ä¸è¦å†™100ã€‚100è¡¨ç¤ºä¸Šä¼ å®Œæˆ }; this.setState({ imgList: [imgItem], }); // æ›´æ–° imgList // endï¼šè¿›åº¦æ¡ç›¸å…³ const reader = new FileReader(); reader.readAsDataURL(file); // è¯»å–å›¾ç‰‡æ–‡ä»¶ reader.onload = (file) =\u003e { const params = { myBase64: file.target.result, // æŠŠ æœ¬åœ°å›¾ç‰‡çš„base64ç¼–ç ä¼ ç»™åå°ï¼Œè°ƒæ¥å£ï¼Œç”Ÿæˆå›¾ç‰‡çš„url }; // ä¸Šä¼ å›¾ç‰‡çš„base64ç¼–ç ï¼Œè°ƒæ¥å£åï¼Œè¿”å› imageId uploadImage(params) .then((res) =\u003e { console.log('smyhvae doImgUpload:' + JSON.stringify(res)); console.log('smyhvae å›¾ç‰‡ä¸Šä¼ æˆåŠŸï¼š' + res.imageUrl); const imgItem = { uid: '1', // æ³¨æ„ï¼Œè¿™ä¸ªuidä¸€å®šä¸èƒ½å°‘ï¼Œå¦åˆ™ä¸Šä¼ å¤±è´¥ name: 'hehe.png', status: 'done', url: res.imageUrl, // url æ˜¯å±•ç¤ºåœ¨é¡µé¢ä¸Šçš„ç»å¯¹é“¾æ¥ imgUrl: res.imageUrl, // imgUrl æ˜¯å­˜åˆ° db é‡Œçš„ç›¸å¯¹é“¾æ¥ // response: '{\"status\": \"success\"}', }; this.setState({ imgList: [imgItem], }); // æ›´æ–° imgList }) .catch((e) =\u003e { console.log('smyhvae å›¾ç‰‡ä¸Šä¼ å¤±è´¥:' + JSON.stringify(e || '')); message.error('å›¾ç‰‡ä¸Šä¼ å¤±è´¥ï¼Œè¯·é‡è¯•'); }); }; }; handleChange = ({ file, fileList }) =\u003e { console.log('smyhvae handleChange file:' + JSON.stringify(file)); console.log('smyhvae handleChange fileList:' + JSON.stringify(fileList)); if (file.status == 'removed') { this.setState({ imgList: [], }); } }; submit = (e) =\u003e { e.preventDefault(); this.props.form.validateFields((err, fieldsValue) =\u003e { if (err) { return; } const { id, imgList } = this.state; const tempImgList = imgList.filter((item) =\u003e item.status == 'done'); // ç­›é€‰å‡º status = done çš„å›¾ç‰‡ const imgArr = []; tempImgList.forEach((item) =\u003e { imgArr.push(item.imgUrl); // imgArr.push(item.url); }); submitData({ id, img: imgArr[0] || '', // 1ã€æš‚æ—¶åªä¼ ä¸€å¼ å›¾ç‰‡ç»™åå°ã€‚å¦‚æœä¼ å¤šå¼ å›¾ç‰‡ï¼Œé‚£ä¹ˆï¼Œuploadç»„ä»¶éœ€è¦è¿›ä¸€æ­¥å®Œå–„ï¼Œæ¯”è¾ƒéº»çƒ¦ï¼Œä»¥åæœ‰éœ€æ±‚å†ä¼˜åŒ–ã€‚2ã€å¦‚æœå›¾ç‰‡å­—æ®µæ˜¯é€‰å¡«ï¼Œé‚£å°±ç”¨ç©ºå­—ç¬¦ä¸²å…œåº• }) .then((res) =\u003e { if (res.ret == 0) { message.success(`${id ? 'ä¿®æ”¹' : 'æ–°å¢'}æˆåŠŸï¼Œè‡ªåŠ¨è·³è½¬ä¸­...`); } else if (res.ret == 201 || res.ret == 202 || res.ret == 203 || res.ret == 6) { return Promise.reject(res.msg); } else { return Promise.reject(); } }) .catch((e) =\u003e { message.error(e || 'æäº¤å¤±è´¥ï¼Œè¯·é‡è¯•'); }); }); }; render() { const { id, imgList } = this.state; console.log('smyhvae render imgList:' + JSON.stringify(imgList)); const { getFieldDecorator } = this.props.form; const formItemLayout = { labelCol: { span: 3 }, wrapperCol: { span: 10 }, }; const buttonItemLayout = { wrapperCol: { span: 10, offset: 3 }, }; const uploadButton = ( \u003cdiv\u003e \u003cIcon type=\"plus\" /\u003e \u003cdiv className=\"ant-upload-text\"\u003eUpload\u003c/div\u003e \u003c/div\u003e ); return ( \u003cCard title={id ? 'ä¿®æ”¹ä¿¡æ¯' : 'æ–°å¢ä¿¡æ¯'}\u003e \u003cForm onSubmit={this.submit} layout=\"horizontal\"\u003e {/* æ–°å»ºå›¾ç‰‡ã€ç¼–è¾‘å›¾ç‰‡ */} \u003cFormItem label=\"å›¾ç‰‡\" {...formItemLayout}\u003e {getFieldDecorator('img', { rules: [{ required: false, message: 'è¯·ä¸Šä¼ å›¾ç‰‡' }], })( \u003cUpload action=\"2\" customRequest={this.doImgUpload} listType=\"picture-card\" fileList={imgList} onPreview={this.handlePreview} beforeUpload={this.handleBeforeUpload} onChange={this.handleChange} \u003e {imgList.length \u003e= 1 ? null : uploadButton} \u003c/Upload\u003e )} \u003c/FormItem\u003e \u003cRow\u003e \u003cCol span={3} /\u003e \u003cCol span={18} className={styles.graytext}\u003e æ³¨ï¼šå›¾ç‰‡æ”¯æŒJPGã€JPEGã€PNGæ ¼å¼ï¼Œå°äº1Mï¼Œæœ€å¤šä¸Šä¼ 1å¼  \u003c/Col\u003e \u003c/Row\u003e \u003cFormItem {...buttonItemLayout}\u003e \u003cButton type=\"primary\" htmlType=\"submit\"\u003e æäº¤ \u003c/Button\u003e \u003c/FormItem\u003e \u003c/Form\u003e {/* å›¾ç‰‡ç‚¹å¼€é¢„è§ˆ */} \u003cModal visible={this.state.previewVisible} footer={null} onCancel={this.handleCancel}\u003e \u003cimg alt=\"example\" style={{ width: '100%' }} src={this.state.previewImage} /\u003e \u003c/Modal\u003e \u003c/Card\u003e ); } } å‚è€ƒé“¾æ¥ æ³¨æ„fileçš„æ ¼å¼ï¼šhttps://www.lmonkey.com/t/oREQA5XE1\nDemoåœ¨çº¿æ¼”ç¤ºï¼š\nhttps://stackoverflow.com/questions/58128062/using-customrequest-in-ant-design-file-upload\nhttps://stackblitz.com/edit/so-58128062-upload-progress\nfileList æ ¼å¼åœ¨çº¿æ¼”ç¤ºï¼š\nhttps://stackoverflow.com/questions/51514757/action-function-is-required-with-antd-upload-control-but-i-dont-need-it\nhttps://codesandbox.io/s/rl7ooo544q\nant design Uploadç»„ä»¶çš„ä½¿ç”¨æ€»ç»“ï¼šhttps://www.jianshu.com/p/0aa4612af987\nantdä¸Šä¼ åŠŸèƒ½çš„CustomRequestï¼šhttps://mlog.club/article/3832743\n","wordCount":"2345","inLanguage":"en","datePublished":"2020-01-01T17:11:35+08:00","dateModified":"2020-01-01T17:11:35+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://bablvsj.github.io/posts/tech/wait/12-react%E5%9F%BA%E7%A1%80/10-antd%E6%A1%86%E6%9E%B6%E7%9A%84upload%E7%BB%84%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%9B%BE%E7%89%87%E6%97%B6%E4%BD%BF%E7%94%A8customrequest%E6%96%B9%E6%B3%95%E8%87%AA%E5%AE%9A%E4%B9%89%E4%B8%8A%E4%BC%A0%E8%A1%8C%E4%B8%BA/"},"publisher":{"@type":"Organization","name":"Bablvsj's Blog","logo":{"@type":"ImageObject","url":"https://bablvsj.github.io/img/Q.gif"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://bablvsj.github.io accesskey=h title="Bablvsj's Blog (Alt + H)">Bablvsj's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://bablvsj.github.io/ title=ä¸»é¡µ><span>ä¸»é¡µ</span></a></li><li><a href=https://bablvsj.github.io/archives/ title=æ—¶é—´è½´><span>æ—¶é—´è½´</span></a></li><li><a href=https://bablvsj.github.io/tags title=æ ‡ç­¾><span>æ ‡ç­¾</span></a></li><li><a href=https://bablvsj.github.io/about title=å…³äº><span>å…³äº</span></a></li><li><a href=https://bablvsj.github.io/search title="ğŸ” (Alt + /)" accesskey=/><span>ğŸ”</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>10-AntDæ¡†æ¶çš„uploadç»„ä»¶ä¸Šä¼ å›¾ç‰‡æ—¶ä½¿ç”¨customRequestæ–¹æ³•è‡ªå®šä¹‰ä¸Šä¼ è¡Œä¸º</h1><div class=post-meta><div class=post-tags-meta><a href=https://bablvsj.github.io/tags/ant-design/>Ant Design</a></div>5 min&nbsp;Â·&nbsp;<span title='2020-01-01 17:11:35 +0800 +0800'>2020/01/01</span></div></header><aside id=toc-container class="toc-container wide"><div class=toc><div class=inner><ul><li><a href=#%e4%bd%bf%e7%94%a8-antd-%e7%9a%84-upload-%e7%bb%84%e4%bb%b6%e5%81%9a%e5%9b%be%e7%89%87%e7%9a%84%e4%b8%8a%e4%bc%a0%e6%95%88%e6%9e%9c%e6%bc%94%e7%a4%ba aria-label="ä½¿ç”¨ AntD çš„ upload ç»„ä»¶åšå›¾ç‰‡çš„ä¸Šä¼ ï¼Œæ•ˆæœæ¼”ç¤º">ä½¿ç”¨ AntD çš„ upload ç»„ä»¶åšå›¾ç‰‡çš„ä¸Šä¼ ï¼Œæ•ˆæœæ¼”ç¤º</a></li><li><a href=#%e4%bb%a3%e7%a0%81%e5%ae%9e%e7%8e%b0 aria-label=ä»£ç å®ç°>ä»£ç å®ç°</a></li><li><a href=#%e5%8f%82%e8%80%83%e9%93%be%e6%8e%a5 aria-label=å‚è€ƒé“¾æ¥>å‚è€ƒé“¾æ¥</a></li></ul></div></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><p>æœ¬æ¬¡åšåå°ç®¡ç†ç³»ç»Ÿï¼Œé‡‡ç”¨çš„æ˜¯ AntD æ¡†æ¶ã€‚æ¶‰åŠåˆ°å›¾ç‰‡çš„ä¸Šä¼ ï¼Œç”¨çš„æ˜¯AntDçš„ <a href=https://ant.design/components/upload-cn/>upload</a> ç»„ä»¶ã€‚</p><p>æˆ‘åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ã€Š<a href=https://www.cnblogs.com/qianguyihao/p/10460834.html>å‰ç«¯AntDæ¡†æ¶çš„uploadç»„ä»¶ä¸Šä¼ å›¾ç‰‡æ—¶é‡åˆ°çš„ä¸€äº›å‘</a>ã€‹ä¸­è®²åˆ°ï¼šAntD çš„ upload ç»„ä»¶æœ‰å¾ˆå¤šå‘ï¼Œå¼•èµ·äº†å¾ˆå¤šäººçš„å…³æ³¨ã€‚æŠ˜è…¾è¿‡çš„äººï¼Œè‡ªç„¶æ˜ç™½å…¶ä¸­çš„è‹¦æ¥šã€‚</p><p>ä»Šå¤©è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬ç»§ç»­æ¥ç ”ç©¶ AntD çš„ upload ç»„ä»¶çš„å¦ä¸€ä¸ªå‘ã€‚</p><p>å¤‡æ³¨ï¼šæœ¬æ–‡å†™äº2020-06-11ï¼Œä½¿ç”¨çš„ antd ç‰ˆæœ¬æ˜¯ 3.13.6ã€‚</p><h2 id=ä½¿ç”¨-antd-çš„-upload-ç»„ä»¶åšå›¾ç‰‡çš„ä¸Šä¼ æ•ˆæœæ¼”ç¤º>ä½¿ç”¨ AntD çš„ upload ç»„ä»¶åšå›¾ç‰‡çš„ä¸Šä¼ ï¼Œæ•ˆæœæ¼”ç¤º<a hidden class=anchor aria-hidden=true href=#ä½¿ç”¨-antd-çš„-upload-ç»„ä»¶åšå›¾ç‰‡çš„ä¸Šä¼ æ•ˆæœæ¼”ç¤º>#</a></h2><p>å› ä¸ºéœ€è¦ä¸Šä¼ å¤šå¼ å›¾ç‰‡ï¼Œæ‰€ä»¥é‡‡ç”¨çš„æ˜¯ç…§ç‰‡å¢™çš„å½¢å¼ã€‚ä¸Šä¼ æˆåŠŸåçš„ç•Œé¢å¦‚ä¸‹ï¼š</p><p>ï¼ˆ1ï¼‰ä¸Šä¼ ä¸­ï¼š</p><p><img loading=lazy src=http://img.smyhvae.com/20190302_1335.png alt></p><p>ï¼ˆ2ï¼‰ä¸Šä¼ æˆåŠŸï¼š</p><p><img loading=lazy src=http://img.smyhvae.com/20190302_1336.png alt></p><p>ï¼ˆ3ï¼‰å›¾ç‰‡é¢„è§ˆï¼š</p><p><img loading=lazy src=http://img.smyhvae.com/20190302_1331.png alt></p><h2 id=ä»£ç å®ç°>ä»£ç å®ç°<a hidden class=anchor aria-hidden=true href=#ä»£ç å®ç°>#</a></h2><p>é¦–å…ˆï¼Œä½ éœ€è¦è®©åå°åŒå­¦æä¾›å¥½å›¾ç‰‡ä¸Šä¼ çš„æ¥å£ã€‚ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬æ˜¯æŠŠæ¥å£è°ƒç”¨ç›´æ¥å†™åœ¨äº† <code>&lt;Upload></code> æ ‡ç­¾çš„ action å±æ€§å½“ä¸­ã€‚ä½†å¦‚æœä½ åœ¨è°ƒæ¥å£çš„æ—¶å€™ï¼ŒåŠ¨ä½œå¾ˆå¤æ‚ï¼ˆæ¯”å¦‚æ ¹æ®ä¸šåŠ¡è¦æ±‚ï¼Œéœ€è¦è¿ç»­è°ƒä¸¤ä¸ªæ¥å£æ‰èƒ½ä¸Šä¼ å›¾ç‰‡ï¼Œæˆ–è€…åœ¨è°ƒæ¥å£æ—¶è¿˜è¦åšå…¶ä»–çš„äº‹æƒ…ï¼‰ï¼Œè¿™ä¸ª action æ–¹æ³•å°±æ— æ³•æ»¡è¶³éœ€æ±‚äº†ã€‚é‚£è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿ</p><p>å¥½åœ¨ AntD çš„ upload ç»„ä»¶ç»™æˆ‘ä»¬æä¾›äº† <code>customRequest</code>è¿™ä¸ªæ–¹æ³•ï¼š</p><p><img loading=lazy src=http://img.smyhvae.com/20200611_1543.png alt></p><p>å…³äºcustomRequest è¿™ä¸ªæ–¹æ³•ï¼Œ AntD å®˜æ–¹å¹¶æ²¡æœ‰ç»™å‡ºç¤ºä¾‹ï¼Œä»–ä»¬åªæ˜¯åœ¨ GitHub ä¸Šç»™å‡ºäº†è¿™æ ·ä¸€ä¸ªç®€çŸ­çš„ä»‹ç»ï¼š</p><p><img loading=lazy src=http://img.smyhvae.com/20200611_1536.png alt></p><p>ä½†è¿™ä¸ªæ–¹æ³•æ€ä¹ˆç”¨å‘¢ï¼Ÿç”¨çš„æ—¶å€™ï¼Œä¼šé‡åˆ°ä»€ä¹ˆé—®é¢˜å‘¢ï¼ŸAntD å®˜æ–¹æ²¡æœ‰è¯´ã€‚æˆ‘åœ¨ç½‘ä¸Šæœäº†åŠå¤©ï¼Œä¹Ÿæ²¡çœ‹åˆ°æ¯”è¾ƒå®Œæ•´çš„ã€åˆ‡å®å¯è¡Œçš„ Demoã€‚æˆ‘å¤©æœåœ°å¤§ç‰©åšï¼Œç½‘ç»œèµ„æ–™æµ©å¦‚çƒŸæµ·ï¼ŒAntD å¯æ˜¯å£å£å£°å£°è¢«äººä»¬å·ç§°æ˜¯å¤©æœæœ€å¥½ç”¨çš„ç®¡ç†åå°çš„æ ·å¼æ¡†æ¶ã€‚å¯å¦‚ä»Šï¼Œå´é¢ä¸´è¿™æ ·çš„å±€é¢ã€‚æˆ‘çœ‹ç€ä½ ä»¬ï¼Œæ»¡æ€€ç¾¡æ…•ã€‚</p><p>æ—¢ç„¶å¦‚æ­¤ï¼Œé‚£æˆ‘å°±è‡ªå·±ç ”ç©¶å§ã€‚æŠ˜è…¾äº†ä¸€å¤©ï¼Œæ€»ç®—æ˜¯æŠŠ customRequest çš„å‘è¸©å¾—å·®ä¸å¤šäº†ã€‚</p><p>å•¥ä¹Ÿä¸è¯´äº†ï¼Œç›´æ¥ä¸Šä»£ç ã€‚</p><p>é‡‡ç”¨ AntDæ¡†æ¶çš„ <a href=https://ant.design/components/upload-cn/>upload</a> ç»„ä»¶çš„ customRequest æ–¹æ³•ï¼Œè‡ªå®šä¹‰ä¸Šä¼ è¡Œä¸ºã€‚æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#3c3836;background-color:#fbf1c7;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#af3a03>import</span> React, { PureComponent } from <span style=color:#79740e>&#39;react&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#af3a03>import</span> { Button, Card, Form, message, Upload, Icon, Modal, Row, Col } from <span style=color:#79740e>&#39;antd&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#af3a03>import</span> { connect } from <span style=color:#79740e>&#39;dva&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#af3a03>import</span> { queryMyData, submitData } from <span style=color:#79740e>&#39;../api&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#af3a03>import</span> { uploadImage } from <span style=color:#79740e>&#39;../../utils/wq.img.upload&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#af3a03>import</span> styles from <span style=color:#79740e>&#39;../../utils/form.less&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#af3a03>const</span> FormItem <span style=color:#af3a03>=</span> Form.Item;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>@Form.create()
</span></span><span style=display:flex><span><span style=color:#af3a03>export</span> <span style=color:#af3a03>default</span> <span style=color:#af3a03>class</span> PicturesWall <span style=color:#af3a03>extends</span> PureComponent {
</span></span><span style=display:flex><span>  constructor(props) {
</span></span><span style=display:flex><span>    <span style=color:#af3a03>super</span>(props);
</span></span><span style=display:flex><span>    <span style=color:#af3a03>const</span> { id } <span style=color:#af3a03>=</span> <span style=color:#af3a03>this</span>.props.match.params;
</span></span><span style=display:flex><span>    <span style=color:#af3a03>this</span>.state <span style=color:#af3a03>=</span> {
</span></span><span style=display:flex><span>      id,
</span></span><span style=display:flex><span>      img<span style=color:#af3a03>:</span> <span style=color:#af3a03>undefined</span>, <span style=color:#928374;font-style:italic>// ä»æ¥å£æ‹¿åˆ°çš„å›¾ç‰‡å­—æ®µ
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic></span>      imgList<span style=color:#af3a03>:</span> [], <span style=color:#928374;font-style:italic>// å±•ç¤ºåœ¨ antdå›¾ç‰‡ç»„ä»¶ä¸Šçš„æ•°æ®
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic></span>      previewVisible<span style=color:#af3a03>:</span> <span style=color:#af3a03>false</span>,
</span></span><span style=display:flex><span>      previewImage<span style=color:#af3a03>:</span> <span style=color:#79740e>&#39;&#39;</span>,
</span></span><span style=display:flex><span>    };
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  componentDidMount() {
</span></span><span style=display:flex><span>    <span style=color:#af3a03>const</span> { id } <span style=color:#af3a03>=</span> <span style=color:#af3a03>this</span>.state;
</span></span><span style=display:flex><span>    id <span style=color:#af3a03>&amp;&amp;</span> <span style=color:#af3a03>this</span>.queryData();
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#928374;font-style:italic>// è°ƒæ¥å£ï¼ŒæŸ¥è¯¢å·²æœ‰çš„æ•°æ®
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic></span>  queryData() {
</span></span><span style=display:flex><span>    <span style=color:#af3a03>const</span> { id } <span style=color:#af3a03>=</span> <span style=color:#af3a03>this</span>.state;
</span></span><span style=display:flex><span>    queryMyData({
</span></span><span style=display:flex><span>      id,
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>      .then(({ ret, data }) =&gt; {
</span></span><span style=display:flex><span>        <span style=color:#af3a03>if</span> (ret <span style=color:#af3a03>==</span> <span style=color:#8f3f71>0</span> <span style=color:#af3a03>&amp;&amp;</span> data <span style=color:#af3a03>&amp;&amp;</span> data.list <span style=color:#af3a03>&amp;&amp;</span> data.list.length) {
</span></span><span style=display:flex><span>          <span style=color:#af3a03>const</span> item <span style=color:#af3a03>=</span> data.list[<span style=color:#8f3f71>0</span>];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>          <span style=color:#af3a03>const</span> img <span style=color:#af3a03>=</span> data.img;
</span></span><span style=display:flex><span>          <span style=color:#af3a03>const</span> imgList <span style=color:#af3a03>=</span> item.img
</span></span><span style=display:flex><span>            <span style=color:#af3a03>?</span> [
</span></span><span style=display:flex><span>              {
</span></span><span style=display:flex><span>                uid<span style=color:#af3a03>:</span> <span style=color:#79740e>&#39;1&#39;</span>, <span style=color:#928374;font-style:italic>// æ³¨æ„ï¼Œè¿™ä¸ªuidä¸€å®šä¸èƒ½å°‘ï¼Œå¦åˆ™å±•ç¤ºå¤±è´¥
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic></span>                name<span style=color:#af3a03>:</span> <span style=color:#79740e>&#39;hehe.png&#39;</span>,
</span></span><span style=display:flex><span>                status<span style=color:#af3a03>:</span> <span style=color:#79740e>&#39;done&#39;</span>,
</span></span><span style=display:flex><span>                url<span style=color:#af3a03>:</span> img,
</span></span><span style=display:flex><span>              },
</span></span><span style=display:flex><span>            ]
</span></span><span style=display:flex><span>            <span style=color:#af3a03>:</span> [];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>          <span style=color:#af3a03>this</span>.setState({
</span></span><span style=display:flex><span>            img,
</span></span><span style=display:flex><span>            imgList,
</span></span><span style=display:flex><span>          });
</span></span><span style=display:flex><span>        } <span style=color:#af3a03>else</span> {
</span></span><span style=display:flex><span>          <span style=color:#af3a03>return</span> <span style=color:#b57614>Promise</span>.reject();
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      })
</span></span><span style=display:flex><span>      .<span style=color:#af3a03>catch</span>(() =&gt; {
</span></span><span style=display:flex><span>        message.error(<span style=color:#79740e>&#39;æŸ¥è¯¢å‡ºé”™ï¼Œè¯·é‡è¯•&#39;</span>);
</span></span><span style=display:flex><span>      });
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  handleCancel <span style=color:#af3a03>=</span> () =&gt; <span style=color:#af3a03>this</span>.setState({ previewVisible<span style=color:#af3a03>:</span> <span style=color:#af3a03>false</span> });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#928374;font-style:italic>// æ–¹æ³•ï¼šå›¾ç‰‡é¢„è§ˆ
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic></span>  handlePreview <span style=color:#af3a03>=</span> (file) =&gt; {
</span></span><span style=display:flex><span>    console.log(<span style=color:#79740e>&#39;smyhvae handlePreview:&#39;</span> <span style=color:#af3a03>+</span> JSON.stringify(file));
</span></span><span style=display:flex><span>    <span style=color:#af3a03>this</span>.setState({
</span></span><span style=display:flex><span>      previewImage<span style=color:#af3a03>:</span> file.url <span style=color:#af3a03>||</span> file.thumbUrl,
</span></span><span style=display:flex><span>      previewVisible<span style=color:#af3a03>:</span> <span style=color:#af3a03>true</span>,
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#928374;font-style:italic>// å‚è€ƒé“¾æ¥ï¼šhttps://www.jianshu.com/p/f356f050b3c9
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic></span>  handleBeforeUpload <span style=color:#af3a03>=</span> (file) =&gt; {
</span></span><span style=display:flex><span>    console.log(<span style=color:#79740e>&#39;smyhvae handleBeforeUpload file:&#39;</span> <span style=color:#af3a03>+</span> JSON.stringify(file));
</span></span><span style=display:flex><span>    console.log(<span style=color:#79740e>&#39;smyhvae handleBeforeUpload file.file:&#39;</span> <span style=color:#af3a03>+</span> JSON.stringify(file.file));
</span></span><span style=display:flex><span>    console.log(<span style=color:#79740e>&#39;smyhvae handleBeforeUpload file type:&#39;</span> <span style=color:#af3a03>+</span> JSON.stringify(file.type));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#928374;font-style:italic>//é™åˆ¶å›¾ç‰‡ æ ¼å¼ã€sizeã€åˆ†è¾¨ç‡
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic></span>    <span style=color:#af3a03>const</span> isJPG <span style=color:#af3a03>=</span> file.type <span style=color:#af3a03>===</span> <span style=color:#79740e>&#39;image/jpeg&#39;</span>;
</span></span><span style=display:flex><span>    <span style=color:#af3a03>const</span> isJPEG <span style=color:#af3a03>=</span> file.type <span style=color:#af3a03>===</span> <span style=color:#79740e>&#39;image/jpeg&#39;</span>;
</span></span><span style=display:flex><span>    <span style=color:#af3a03>const</span> isGIF <span style=color:#af3a03>=</span> file.type <span style=color:#af3a03>===</span> <span style=color:#79740e>&#39;image/gif&#39;</span>;
</span></span><span style=display:flex><span>    <span style=color:#af3a03>const</span> isPNG <span style=color:#af3a03>=</span> file.type <span style=color:#af3a03>===</span> <span style=color:#79740e>&#39;image/png&#39;</span>;
</span></span><span style=display:flex><span>    <span style=color:#af3a03>const</span> isLt2M <span style=color:#af3a03>=</span> file.size <span style=color:#af3a03>/</span> <span style=color:#8f3f71>1024</span> <span style=color:#af3a03>/</span> <span style=color:#8f3f71>1024</span> <span style=color:#af3a03>&lt;</span> <span style=color:#8f3f71>1</span>;
</span></span><span style=display:flex><span>    <span style=color:#af3a03>if</span> (<span style=color:#af3a03>!</span>(isJPG <span style=color:#af3a03>||</span> isJPEG <span style=color:#af3a03>||</span> isPNG)) {
</span></span><span style=display:flex><span>      Modal.error({
</span></span><span style=display:flex><span>        title<span style=color:#af3a03>:</span> <span style=color:#79740e>&#39;åªèƒ½ä¸Šä¼ JPGã€JPEGã€PNGæ ¼å¼çš„å›¾ç‰‡~&#39;</span>,
</span></span><span style=display:flex><span>      });
</span></span><span style=display:flex><span>    } <span style=color:#af3a03>else</span> <span style=color:#af3a03>if</span> (<span style=color:#af3a03>!</span>isLt2M) {
</span></span><span style=display:flex><span>      Modal.error({
</span></span><span style=display:flex><span>        title<span style=color:#af3a03>:</span> <span style=color:#79740e>&#39;å›¾ç‰‡è¶…è¿‡1Mé™åˆ¶ï¼Œä¸å…è®¸ä¸Šä¼ ~&#39;</span>,
</span></span><span style=display:flex><span>      });
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#af3a03>return</span> (isJPG <span style=color:#af3a03>||</span> isJPEG <span style=color:#af3a03>||</span> isPNG) <span style=color:#af3a03>&amp;&amp;</span> isLt2M;
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#928374;font-style:italic>// checkImageWH  è¿”å›ä¸€ä¸ªpromise  æ£€æµ‹é€šè¿‡è¿”å›resolve  å¤±è´¥è¿”å›rejecté˜»æ­¢å›¾ç‰‡ä¸Šä¼ 
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic></span>  checkImageWH(file) {
</span></span><span style=display:flex><span>    <span style=color:#af3a03>return</span> <span style=color:#af3a03>new</span> <span style=color:#b57614>Promise</span>(<span style=color:#af3a03>function</span> (resolve, reject) {
</span></span><span style=display:flex><span>      <span style=color:#af3a03>let</span> filereader <span style=color:#af3a03>=</span> <span style=color:#af3a03>new</span> FileReader();
</span></span><span style=display:flex><span>      filereader.onload <span style=color:#af3a03>=</span> (e) =&gt; {
</span></span><span style=display:flex><span>        <span style=color:#af3a03>let</span> src <span style=color:#af3a03>=</span> e.target.result;
</span></span><span style=display:flex><span>        <span style=color:#af3a03>const</span> image <span style=color:#af3a03>=</span> <span style=color:#af3a03>new</span> Image();
</span></span><span style=display:flex><span>        image.onload <span style=color:#af3a03>=</span> <span style=color:#af3a03>function</span> () {
</span></span><span style=display:flex><span>          <span style=color:#928374;font-style:italic>// è·å–å›¾ç‰‡çš„å®½é«˜
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic></span>          file.width <span style=color:#af3a03>=</span> <span style=color:#af3a03>this</span>.width;
</span></span><span style=display:flex><span>          file.height <span style=color:#af3a03>=</span> <span style=color:#af3a03>this</span>.height;
</span></span><span style=display:flex><span>          resolve();
</span></span><span style=display:flex><span>        };
</span></span><span style=display:flex><span>        image.onerror <span style=color:#af3a03>=</span> reject;
</span></span><span style=display:flex><span>        image.src <span style=color:#af3a03>=</span> src;
</span></span><span style=display:flex><span>      };
</span></span><span style=display:flex><span>      filereader.readAsDataURL(file);
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#928374;font-style:italic>// å›¾ç‰‡ä¸Šä¼ 
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic></span>  doImgUpload <span style=color:#af3a03>=</span> (options) =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#af3a03>const</span> { onSuccess, onError, file, onProgress } <span style=color:#af3a03>=</span> options;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#928374;font-style:italic>// startï¼šè¿›åº¦æ¡ç›¸å…³
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic></span>    <span style=color:#928374;font-style:italic>// ä¼ªè£…æˆ handleChangeé‡Œé¢çš„å›¾ç‰‡ä¸Šä¼ çŠ¶æ€
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic></span>    <span style=color:#af3a03>const</span> imgItem <span style=color:#af3a03>=</span> {
</span></span><span style=display:flex><span>      uid<span style=color:#af3a03>:</span> <span style=color:#79740e>&#39;1&#39;</span>, <span style=color:#928374;font-style:italic>// æ³¨æ„ï¼Œè¿™ä¸ªuidä¸€å®šä¸èƒ½å°‘ï¼Œå¦åˆ™ä¸Šä¼ å¤±è´¥
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic></span>      name<span style=color:#af3a03>:</span> <span style=color:#79740e>&#39;hehe.png&#39;</span>,
</span></span><span style=display:flex><span>      status<span style=color:#af3a03>:</span> <span style=color:#79740e>&#39;uploading&#39;</span>,
</span></span><span style=display:flex><span>      url<span style=color:#af3a03>:</span> <span style=color:#79740e>&#39;&#39;</span>,
</span></span><span style=display:flex><span>      percent<span style=color:#af3a03>:</span> <span style=color:#8f3f71>99</span>, <span style=color:#928374;font-style:italic>// æ³¨æ„ä¸è¦å†™100ã€‚100è¡¨ç¤ºä¸Šä¼ å®Œæˆ
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic></span>    };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#af3a03>this</span>.setState({
</span></span><span style=display:flex><span>      imgList<span style=color:#af3a03>:</span> [imgItem],
</span></span><span style=display:flex><span>    }); <span style=color:#928374;font-style:italic>// æ›´æ–° imgList
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic></span>    <span style=color:#928374;font-style:italic>// endï¼šè¿›åº¦æ¡ç›¸å…³
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic></span>
</span></span><span style=display:flex><span>    <span style=color:#af3a03>const</span> reader <span style=color:#af3a03>=</span> <span style=color:#af3a03>new</span> FileReader();
</span></span><span style=display:flex><span>    reader.readAsDataURL(file); <span style=color:#928374;font-style:italic>// è¯»å–å›¾ç‰‡æ–‡ä»¶
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic></span>
</span></span><span style=display:flex><span>    reader.onload <span style=color:#af3a03>=</span> (file) =&gt; {
</span></span><span style=display:flex><span>      <span style=color:#af3a03>const</span> params <span style=color:#af3a03>=</span> {
</span></span><span style=display:flex><span>        myBase64<span style=color:#af3a03>:</span> file.target.result, <span style=color:#928374;font-style:italic>// æŠŠ æœ¬åœ°å›¾ç‰‡çš„base64ç¼–ç ä¼ ç»™åå°ï¼Œè°ƒæ¥å£ï¼Œç”Ÿæˆå›¾ç‰‡çš„url
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic></span>      };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#928374;font-style:italic>// ä¸Šä¼ å›¾ç‰‡çš„base64ç¼–ç ï¼Œè°ƒæ¥å£åï¼Œè¿”å› imageId
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic></span>      uploadImage(params)
</span></span><span style=display:flex><span>        .then((res) =&gt; {
</span></span><span style=display:flex><span>          console.log(<span style=color:#79740e>&#39;smyhvae doImgUpload:&#39;</span> <span style=color:#af3a03>+</span> JSON.stringify(res));
</span></span><span style=display:flex><span>          console.log(<span style=color:#79740e>&#39;smyhvae å›¾ç‰‡ä¸Šä¼ æˆåŠŸï¼š&#39;</span> <span style=color:#af3a03>+</span> res.imageUrl);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>          <span style=color:#af3a03>const</span> imgItem <span style=color:#af3a03>=</span> {
</span></span><span style=display:flex><span>            uid<span style=color:#af3a03>:</span> <span style=color:#79740e>&#39;1&#39;</span>, <span style=color:#928374;font-style:italic>// æ³¨æ„ï¼Œè¿™ä¸ªuidä¸€å®šä¸èƒ½å°‘ï¼Œå¦åˆ™ä¸Šä¼ å¤±è´¥
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic></span>            name<span style=color:#af3a03>:</span> <span style=color:#79740e>&#39;hehe.png&#39;</span>,
</span></span><span style=display:flex><span>            status<span style=color:#af3a03>:</span> <span style=color:#79740e>&#39;done&#39;</span>,
</span></span><span style=display:flex><span>            url<span style=color:#af3a03>:</span> res.imageUrl, <span style=color:#928374;font-style:italic>// url æ˜¯å±•ç¤ºåœ¨é¡µé¢ä¸Šçš„ç»å¯¹é“¾æ¥
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic></span>            imgUrl<span style=color:#af3a03>:</span> res.imageUrl, <span style=color:#928374;font-style:italic>// imgUrl æ˜¯å­˜åˆ° db é‡Œçš„ç›¸å¯¹é“¾æ¥
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic></span>            <span style=color:#928374;font-style:italic>// response: &#39;{&#34;status&#34;: &#34;success&#34;}&#39;,
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic></span>          };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>          <span style=color:#af3a03>this</span>.setState({
</span></span><span style=display:flex><span>            imgList<span style=color:#af3a03>:</span> [imgItem],
</span></span><span style=display:flex><span>          }); <span style=color:#928374;font-style:italic>// æ›´æ–° imgList
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic></span>        })
</span></span><span style=display:flex><span>        .<span style=color:#af3a03>catch</span>((e) =&gt; {
</span></span><span style=display:flex><span>          console.log(<span style=color:#79740e>&#39;smyhvae å›¾ç‰‡ä¸Šä¼ å¤±è´¥:&#39;</span> <span style=color:#af3a03>+</span> JSON.stringify(e <span style=color:#af3a03>||</span> <span style=color:#79740e>&#39;&#39;</span>));
</span></span><span style=display:flex><span>          message.error(<span style=color:#79740e>&#39;å›¾ç‰‡ä¸Šä¼ å¤±è´¥ï¼Œè¯·é‡è¯•&#39;</span>);
</span></span><span style=display:flex><span>        });
</span></span><span style=display:flex><span>    };
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  handleChange <span style=color:#af3a03>=</span> ({ file, fileList }) =&gt; {
</span></span><span style=display:flex><span>    console.log(<span style=color:#79740e>&#39;smyhvae handleChange file:&#39;</span> <span style=color:#af3a03>+</span> JSON.stringify(file));
</span></span><span style=display:flex><span>    console.log(<span style=color:#79740e>&#39;smyhvae handleChange fileList:&#39;</span> <span style=color:#af3a03>+</span> JSON.stringify(fileList));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#af3a03>if</span> (file.status <span style=color:#af3a03>==</span> <span style=color:#79740e>&#39;removed&#39;</span>) {
</span></span><span style=display:flex><span>      <span style=color:#af3a03>this</span>.setState({
</span></span><span style=display:flex><span>        imgList<span style=color:#af3a03>:</span> [],
</span></span><span style=display:flex><span>      });
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  submit <span style=color:#af3a03>=</span> (e) =&gt; {
</span></span><span style=display:flex><span>    e.preventDefault();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#af3a03>this</span>.props.form.validateFields((err, fieldsValue) =&gt; {
</span></span><span style=display:flex><span>      <span style=color:#af3a03>if</span> (err) {
</span></span><span style=display:flex><span>        <span style=color:#af3a03>return</span>;
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#af3a03>const</span> { id, imgList } <span style=color:#af3a03>=</span> <span style=color:#af3a03>this</span>.state;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#af3a03>const</span> tempImgList <span style=color:#af3a03>=</span> imgList.filter((item) =&gt; item.status <span style=color:#af3a03>==</span> <span style=color:#79740e>&#39;done&#39;</span>); <span style=color:#928374;font-style:italic>// ç­›é€‰å‡º status = done çš„å›¾ç‰‡
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic></span>      <span style=color:#af3a03>const</span> imgArr <span style=color:#af3a03>=</span> [];
</span></span><span style=display:flex><span>      tempImgList.forEach((item) =&gt; {
</span></span><span style=display:flex><span>        imgArr.push(item.imgUrl);
</span></span><span style=display:flex><span>        <span style=color:#928374;font-style:italic>// imgArr.push(item.url);
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic></span>      });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      submitData({
</span></span><span style=display:flex><span>        id,
</span></span><span style=display:flex><span>        img<span style=color:#af3a03>:</span> imgArr[<span style=color:#8f3f71>0</span>] <span style=color:#af3a03>||</span> <span style=color:#79740e>&#39;&#39;</span>, <span style=color:#928374;font-style:italic>// 1ã€æš‚æ—¶åªä¼ ä¸€å¼ å›¾ç‰‡ç»™åå°ã€‚å¦‚æœä¼ å¤šå¼ å›¾ç‰‡ï¼Œé‚£ä¹ˆï¼Œuploadç»„ä»¶éœ€è¦è¿›ä¸€æ­¥å®Œå–„ï¼Œæ¯”è¾ƒéº»çƒ¦ï¼Œä»¥åæœ‰éœ€æ±‚å†ä¼˜åŒ–ã€‚2ã€å¦‚æœå›¾ç‰‡å­—æ®µæ˜¯é€‰å¡«ï¼Œé‚£å°±ç”¨ç©ºå­—ç¬¦ä¸²å…œåº•
</span></span></span><span style=display:flex><span><span style=color:#928374;font-style:italic></span>      })
</span></span><span style=display:flex><span>        .then((res) =&gt; {
</span></span><span style=display:flex><span>          <span style=color:#af3a03>if</span> (res.ret <span style=color:#af3a03>==</span> <span style=color:#8f3f71>0</span>) {
</span></span><span style=display:flex><span>            message.success(<span style=color:#79740e>`</span><span style=color:#79740e>${</span>id <span style=color:#af3a03>?</span> <span style=color:#79740e>&#39;ä¿®æ”¹&#39;</span> <span style=color:#af3a03>:</span> <span style=color:#79740e>&#39;æ–°å¢&#39;</span><span style=color:#79740e>}</span><span style=color:#79740e>æˆåŠŸï¼Œè‡ªåŠ¨è·³è½¬ä¸­...`</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>          } <span style=color:#af3a03>else</span> <span style=color:#af3a03>if</span> (res.ret <span style=color:#af3a03>==</span> <span style=color:#8f3f71>201</span> <span style=color:#af3a03>||</span> res.ret <span style=color:#af3a03>==</span> <span style=color:#8f3f71>202</span> <span style=color:#af3a03>||</span> res.ret <span style=color:#af3a03>==</span> <span style=color:#8f3f71>203</span> <span style=color:#af3a03>||</span> res.ret <span style=color:#af3a03>==</span> <span style=color:#8f3f71>6</span>) {
</span></span><span style=display:flex><span>            <span style=color:#af3a03>return</span> <span style=color:#b57614>Promise</span>.reject(res.msg);
</span></span><span style=display:flex><span>          } <span style=color:#af3a03>else</span> {
</span></span><span style=display:flex><span>            <span style=color:#af3a03>return</span> <span style=color:#b57614>Promise</span>.reject();
</span></span><span style=display:flex><span>          }
</span></span><span style=display:flex><span>        })
</span></span><span style=display:flex><span>        .<span style=color:#af3a03>catch</span>((e) =&gt; {
</span></span><span style=display:flex><span>          message.error(e <span style=color:#af3a03>||</span> <span style=color:#79740e>&#39;æäº¤å¤±è´¥ï¼Œè¯·é‡è¯•&#39;</span>);
</span></span><span style=display:flex><span>        });
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>  };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  render() {
</span></span><span style=display:flex><span>    <span style=color:#af3a03>const</span> { id, imgList } <span style=color:#af3a03>=</span> <span style=color:#af3a03>this</span>.state;
</span></span><span style=display:flex><span>    console.log(<span style=color:#79740e>&#39;smyhvae render imgList:&#39;</span> <span style=color:#af3a03>+</span> JSON.stringify(imgList));
</span></span><span style=display:flex><span>    <span style=color:#af3a03>const</span> { getFieldDecorator } <span style=color:#af3a03>=</span> <span style=color:#af3a03>this</span>.props.form;
</span></span><span style=display:flex><span>    <span style=color:#af3a03>const</span> formItemLayout <span style=color:#af3a03>=</span> {
</span></span><span style=display:flex><span>      labelCol<span style=color:#af3a03>:</span> { span<span style=color:#af3a03>:</span> <span style=color:#8f3f71>3</span> },
</span></span><span style=display:flex><span>      wrapperCol<span style=color:#af3a03>:</span> { span<span style=color:#af3a03>:</span> <span style=color:#8f3f71>10</span> },
</span></span><span style=display:flex><span>    };
</span></span><span style=display:flex><span>    <span style=color:#af3a03>const</span> buttonItemLayout <span style=color:#af3a03>=</span> {
</span></span><span style=display:flex><span>      wrapperCol<span style=color:#af3a03>:</span> { span<span style=color:#af3a03>:</span> <span style=color:#8f3f71>10</span>, offset<span style=color:#af3a03>:</span> <span style=color:#8f3f71>3</span> },
</span></span><span style=display:flex><span>    };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#af3a03>const</span> uploadButton <span style=color:#af3a03>=</span> (
</span></span><span style=display:flex><span>      <span style=color:#af3a03>&lt;</span>div<span style=color:#af3a03>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#af3a03>&lt;</span>Icon type<span style=color:#af3a03>=</span><span style=color:#79740e>&#34;plus&#34;</span> <span style=color:#af3a03>/&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#af3a03>&lt;</span>div className<span style=color:#af3a03>=</span><span style=color:#79740e>&#34;ant-upload-text&#34;</span><span style=color:#af3a03>&gt;</span>Upload<span style=color:#af3a03>&lt;</span>/div&gt;
</span></span><span style=display:flex><span>      <span style=color:#af3a03>&lt;</span>/div&gt;
</span></span><span style=display:flex><span>    );
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#af3a03>return</span> (
</span></span><span style=display:flex><span>      <span style=color:#af3a03>&lt;</span>Card title<span style=color:#af3a03>=</span>{id <span style=color:#af3a03>?</span> <span style=color:#79740e>&#39;ä¿®æ”¹ä¿¡æ¯&#39;</span> <span style=color:#af3a03>:</span> <span style=color:#79740e>&#39;æ–°å¢ä¿¡æ¯&#39;</span>}<span style=color:#af3a03>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#af3a03>&lt;</span>Form onSubmit<span style=color:#af3a03>=</span>{<span style=color:#af3a03>this</span>.submit} layout<span style=color:#af3a03>=</span><span style=color:#79740e>&#34;horizontal&#34;</span><span style=color:#af3a03>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>          {<span style=color:#928374;font-style:italic>/* æ–°å»ºå›¾ç‰‡ã€ç¼–è¾‘å›¾ç‰‡ */</span>}
</span></span><span style=display:flex><span>          <span style=color:#af3a03>&lt;</span>FormItem label<span style=color:#af3a03>=</span><span style=color:#79740e>&#34;å›¾ç‰‡&#34;</span> {...formItemLayout}<span style=color:#af3a03>&gt;</span>
</span></span><span style=display:flex><span>            {getFieldDecorator(<span style=color:#79740e>&#39;img&#39;</span>, {
</span></span><span style=display:flex><span>              rules<span style=color:#af3a03>:</span> [{ required<span style=color:#af3a03>:</span> <span style=color:#af3a03>false</span>, message<span style=color:#af3a03>:</span> <span style=color:#79740e>&#39;è¯·ä¸Šä¼ å›¾ç‰‡&#39;</span> }],
</span></span><span style=display:flex><span>            })(
</span></span><span style=display:flex><span>              <span style=color:#af3a03>&lt;</span>Upload
</span></span><span style=display:flex><span>                action<span style=color:#af3a03>=</span><span style=color:#79740e>&#34;2&#34;</span>
</span></span><span style=display:flex><span>                customRequest<span style=color:#af3a03>=</span>{<span style=color:#af3a03>this</span>.doImgUpload}
</span></span><span style=display:flex><span>                listType<span style=color:#af3a03>=</span><span style=color:#79740e>&#34;picture-card&#34;</span>
</span></span><span style=display:flex><span>                fileList<span style=color:#af3a03>=</span>{imgList}
</span></span><span style=display:flex><span>                onPreview<span style=color:#af3a03>=</span>{<span style=color:#af3a03>this</span>.handlePreview}
</span></span><span style=display:flex><span>                beforeUpload<span style=color:#af3a03>=</span>{<span style=color:#af3a03>this</span>.handleBeforeUpload}
</span></span><span style=display:flex><span>                onChange<span style=color:#af3a03>=</span>{<span style=color:#af3a03>this</span>.handleChange}
</span></span><span style=display:flex><span>              <span style=color:#af3a03>&gt;</span>
</span></span><span style=display:flex><span>                {imgList.length <span style=color:#af3a03>&gt;=</span> <span style=color:#8f3f71>1</span> <span style=color:#af3a03>?</span> <span style=color:#af3a03>null</span> <span style=color:#af3a03>:</span> uploadButton}
</span></span><span style=display:flex><span>              <span style=color:#af3a03>&lt;</span>/Upload&gt;
</span></span><span style=display:flex><span>            )}
</span></span><span style=display:flex><span>          <span style=color:#af3a03>&lt;</span>/FormItem&gt;
</span></span><span style=display:flex><span>          <span style=color:#af3a03>&lt;</span>Row<span style=color:#af3a03>&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#af3a03>&lt;</span>Col span<span style=color:#af3a03>=</span>{<span style=color:#8f3f71>3</span>} <span style=color:#af3a03>/&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#af3a03>&lt;</span>Col span<span style=color:#af3a03>=</span>{<span style=color:#8f3f71>18</span>} className<span style=color:#af3a03>=</span>{styles.graytext}<span style=color:#af3a03>&gt;</span>
</span></span><span style=display:flex><span>              æ³¨ï¼šå›¾ç‰‡æ”¯æŒJPGã€JPEGã€PNGæ ¼å¼ï¼Œå°äº1Mï¼Œæœ€å¤šä¸Šä¼ 1å¼ 
</span></span><span style=display:flex><span>            <span style=color:#af3a03>&lt;</span>/Col&gt;
</span></span><span style=display:flex><span>          <span style=color:#af3a03>&lt;</span>/Row&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>          <span style=color:#af3a03>&lt;</span>FormItem {...buttonItemLayout}<span style=color:#af3a03>&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#af3a03>&lt;</span>Button type<span style=color:#af3a03>=</span><span style=color:#79740e>&#34;primary&#34;</span> htmlType<span style=color:#af3a03>=</span><span style=color:#79740e>&#34;submit&#34;</span><span style=color:#af3a03>&gt;</span>
</span></span><span style=display:flex><span>              æäº¤
</span></span><span style=display:flex><span>            <span style=color:#af3a03>&lt;</span>/Button&gt;
</span></span><span style=display:flex><span>          <span style=color:#af3a03>&lt;</span>/FormItem&gt;
</span></span><span style=display:flex><span>        <span style=color:#af3a03>&lt;</span>/Form&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        {<span style=color:#928374;font-style:italic>/* å›¾ç‰‡ç‚¹å¼€é¢„è§ˆ */</span>}
</span></span><span style=display:flex><span>        <span style=color:#af3a03>&lt;</span>Modal visible<span style=color:#af3a03>=</span>{<span style=color:#af3a03>this</span>.state.previewVisible} footer<span style=color:#af3a03>=</span>{<span style=color:#af3a03>null</span>} onCancel<span style=color:#af3a03>=</span>{<span style=color:#af3a03>this</span>.handleCancel}<span style=color:#af3a03>&gt;</span>
</span></span><span style=display:flex><span>          <span style=color:#af3a03>&lt;</span>img alt<span style=color:#af3a03>=</span><span style=color:#79740e>&#34;example&#34;</span> style<span style=color:#af3a03>=</span>{{ width<span style=color:#af3a03>:</span> <span style=color:#79740e>&#39;100%&#39;</span> }} src<span style=color:#af3a03>=</span>{<span style=color:#af3a03>this</span>.state.previewImage} <span style=color:#af3a03>/&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#af3a03>&lt;</span>/Modal&gt;
</span></span><span style=display:flex><span>      <span style=color:#af3a03>&lt;</span>/Card&gt;
</span></span><span style=display:flex><span>    );
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=å‚è€ƒé“¾æ¥>å‚è€ƒé“¾æ¥<a hidden class=anchor aria-hidden=true href=#å‚è€ƒé“¾æ¥>#</a></h2><p>æ³¨æ„fileçš„æ ¼å¼ï¼šhttps://www.lmonkey.com/t/oREQA5XE1</p><p>Demoåœ¨çº¿æ¼”ç¤ºï¼š</p><ul><li><p><a href=https://stackoverflow.com/questions/58128062/using-customrequest-in-ant-design-file-upload>https://stackoverflow.com/questions/58128062/using-customrequest-in-ant-design-file-upload</a></p></li><li><p><a href=https://stackblitz.com/edit/so-58128062-upload-progress>https://stackblitz.com/edit/so-58128062-upload-progress</a></p></li></ul><p>fileList æ ¼å¼åœ¨çº¿æ¼”ç¤ºï¼š</p><ul><li><p><a href=https://stackoverflow.com/questions/51514757/action-function-is-required-with-antd-upload-control-but-i-dont-need-it>https://stackoverflow.com/questions/51514757/action-function-is-required-with-antd-upload-control-but-i-dont-need-it</a></p></li><li><p><a href=https://codesandbox.io/s/rl7ooo544q>https://codesandbox.io/s/rl7ooo544q</a></p></li></ul><p>ant design Uploadç»„ä»¶çš„ä½¿ç”¨æ€»ç»“ï¼šhttps://www.jianshu.com/p/0aa4612af987</p><p>antdä¸Šä¼ åŠŸèƒ½çš„CustomRequestï¼šhttps://mlog.club/article/3832743</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://bablvsj.github.io/tags/ant-design/>Ant Design</a></li></ul><nav class=paginav><a class=prev href=https://bablvsj.github.io/posts/tech/wait/04-javascript/09-%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6%E8%AF%AD%E5%8F%A5%E9%80%89%E6%8B%A9%E7%BB%93%E6%9E%84if%E5%92%8Cswitch/><span class=title>Â« Prev</span><br><span>09-æµç¨‹æ§åˆ¶è¯­å¥ï¼šé€‰æ‹©ç»“æ„ï¼ˆifå’Œswitchï¼‰</span></a>
<a class=next href=https://bablvsj.github.io/posts/tech/wait/04-javascript/10-promise%E5%85%A5%E9%97%A8%E8%AF%A6%E8%A7%A3/><span class=title>Next Â»</span><br><span>10-Promiseå…¥é—¨è¯¦è§£</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://bablvsj.github.io>Bablvsj's Blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span><div class=flex-c-d><a class=flex-d-c href="https://www.upyun.com/?utm_source=lianmeng&utm_medium=referral" target=_blank><span>æœ¬ç«™ç”±</span><img width=60 src=/images/upyun.png>æä¾›CDNåŠ é€Ÿ/äº‘å­˜å‚¨æœåŠ¡</a></div></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>